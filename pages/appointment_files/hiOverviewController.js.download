let hiOverviewController=function($scope,$http,$ocLazyLoad,$templateCache,$modal,$timeout,PSACService,dataTruncUtilityService,hospiceCommentService,HccFilterService){$scope.acceptedHCCList=[];$scope.hiRcpPotentialDxHistoryList=[];$scope.isHiRcpLoading=true;$scope.isHiPendingLoading=false;$scope.isHiHistoricalLoading=false;$scope.hiShowPDDataDiv=false;$scope.hiShowCIPCDataDiv=true;$scope.hiShowHCCDataDiv=true;$scope.hiShowHistoricalDataDiv=false;$scope.hiShowPendingDataDiv=true;$scope.isPdxAddressed=false;$scope.showOtherTextBox=false;$scope.openPDxRecordId='';let patientComment;$scope.lastRefreshedHeading='';$scope.completedCount=0;$scope.unReviewedCount=0;$scope.insufficientCount=0;$scope.PLCount=0;$scope.CMSCount=0;$scope.AcceptedCount=0;$scope.PNCount=0;$scope.totalCount=0;$scope.insufficientOnly=false;$scope.hasAccessForAction=0;let assessmentCodeList=[];$scope.visitTypeBasedAccess=false;$scope.sortBy={'Pending':"date",'Historical':"date"};$scope.orderBy={'Pending':"desc",'Historical':"desc"};$scope.disagreeReasons=[{key:"Dx not clinically significant",value:"1"},{key:"Dx supported by code previously addressed",value:"2"},{key:"More specific code applies",value:"3"},{key:"No evidence to support Dx",value:"4"},{key:"Resolved",value:"5"},{key:"Other",value:"6"}];$scope.ptHospiceNotes="";$scope.ptHospiceDate="";$scope.selectedHistoricalYear="0";$scope.selectedMAYear="0";$scope.historicalFilter=1;$scope.yearValues={0:"Current Year",1:"Last Year",2:"Last 2 Years",3:"Last 3 Years",4:"Last 4 Years",5:"Last 5 Years"};$scope.addAssessmentType={0:"PN",1:"PL",2:"All"};$scope.selAddAssessmentType='All';$scope.setAssessmentTypeValue=function(selAddAssessmentType){$scope.selAddAssessmentType=selAddAssessmentType};$scope.hIHospiceCommentForm={};var formName='LOCK_HI_PDX_AlertId_';var lockObjHI={};var releaseLockForHIAlerts=false;var openDisagreeAlertPopupPosition='';var printPNTimer;var resetICDDetails={};var rcpAttestationPerfectScrollbar;var hIPreviewContentPerfectScrollbar;var DEFAULT_NOTIFICATION_TIMEOUT;const ACTION_SOURCE_RIGHT_CHART_PANEL='Right Chart Panel';let isProcessingICDFromPDList;const setDefaultNotificationTimeOut=function(){DEFAULT_NOTIFICATION_TIMEOUT=Number(getItemKeyValue("HealowInsightsToasterNotificationTimeout"));if(isNaN(DEFAULT_NOTIFICATION_TIMEOUT)){DEFAULT_NOTIFICATION_TIMEOUT=notification.time}};setDefaultNotificationTimeOut();$scope.setFilterCSSBasedOnData=function(){let timeoutHandler=function(){let btnGroup=$("#"+$scope.$parent.context+"-btn-check-grp");btnGroup.find('button:visible:first').addClass('brd-left-radius-5');btnGroup.find('button:visible:last').addClass('brd-right-radius-5')};setTimeout(timeoutHandler)};$scope.init=function(isUserAuthorizedForHCCComment){$scope.isUserAuthorizedForHCCComment=isUserAuthorizedForHCCComment;$scope.hiHccPendingFilter='0';loadHiPdxPage();if(getPermission("AllowHealowInsightsOverviewPDX",global.TrUserId)){$scope.hasAccessForAction=1}else if(getPermission("HealowInsightsUnrestrictedDisagreeAndRestrictedAgree",global.TrUserId)){$scope.hasAccessForAction=2}else if(getPermission("HealowInsightsRestrictedDisagreeAndAgree",global.TrUserId)){$scope.hasAccessForAction=3}else{$scope.hasAccessForAction=0}if($scope.$parent.context==='progressnotes'){setVisitTypeBasedAccess()}};$scope.applyPNPLFilter=function(value){if($scope.hiHccPNPLFilter===value){$scope.hiHccPNPLFilter='-1'}else{$scope.hiHccPNPLFilter=value}getFilteredDataForPendingSection()};$scope.applyFiltersForHIToggleInsufficient=function(){$scope.insufficientOnly=!$scope.insufficientOnly;$scope.applyFiltersForHI($scope.hiHccPendingFilter)};$scope.applyFiltersForHI=function(value){$scope.hiHccPendingFilter=value;getFilteredDataForPendingSection();if(value==='0'){$("."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey, ."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey-pill").toggleClass('active')}};$scope.hiPendingPLFilter=false;$scope.hiPendingPNFilter=false;$scope.hiPendingCMSFilter=false;$scope.hiPendingAcceptedFilter=false;$scope.applyPNFilter=function(value){$scope.hiPendingPNFilter=!$scope.hiPendingPNFilter;getFilteredDataForPendingSection();if(value==='0'){$("."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey, ."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey-pill").toggleClass('active')}};$scope.applyPLFilter=function(value){$scope.hiPendingPLFilter=!$scope.hiPendingPLFilter;getFilteredDataForPendingSection();if(value==='0'){$("."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey, ."+$scope.$parent.context+"-hi-filter-bar .hi-btn-grey-pill").toggleClass('active')}};$scope.applyCMSFilter=function(){$scope.hiPendingCMSFilter=!$scope.hiPendingCMSFilter;getFilteredDataForPendingSection();if($scope.hiPendingCMSFilter){$("#"+$scope.$parent.context+"-hiBtnCMS").toggleClass('active')}};$scope.applyAcceptedFilter=function(){$scope.hiPendingAcceptedFilter=!$scope.hiPendingAcceptedFilter;getFilteredDataForPendingSection();if($scope.hiPendingAcceptedFilter){$("#"+$scope.$parent.context+"-hiBtnAccepted").toggleClass('active')}};$scope.showDataBasedOnFilter=function(obj){let showData=true;if($scope.hiHccPendingFilter==='0'){if($scope.insufficientOnly){showData=HccFilterService.isICDInsufficient(obj)}}else if($scope.hiHccPendingFilter==='1'){showData=!(obj.status==='Addressed'||obj.status==='Add Assessment')}else if($scope.hiHccPendingFilter==='2'){showData=obj.status==='Addressed'||obj.status==='Add Assessment'}if(showData){if($scope.hiHccPNPLFilter==='1'){showData=HccFilterService.isICDInsufficient(obj)}else if($scope.hiHccPNPLFilter==='2'){showData=$scope.isPresentInPN(obj.potentialdx)}else if($scope.hiHccPNPLFilter==='3'){showData=HccFilterService.IsPresentInProblemList(obj)}else if($scope.hiHccPNPLFilter==='4'){showData=isCMSAccepted(obj)}else if($scope.hiHccPNPLFilter==='5'){showData=isAccepted(obj)}}if(showData){$scope.isNoRecordsForPendingHCC=false}return showData};let isCMSAccepted=function(obj){return HccFilterService.isCMSAccepted(obj)};let isAccepted=function(obj){return HccFilterService.isAccepted(obj)};$scope.isAnyRowForToReview=function(list){let isNotActed=false;for(let i=0,len=list.length;i<len;i++){if(!(list[i].status==='Addressed'||list[i].status==='Add Assessment')){isNotActed=true}}return isNotActed};$scope.isChildEntryPresent=function(list){let isPresent=false;for(let i=0,len=list.length;i<len;i++){if($scope.showDataBasedOnFilter(list[i])){isPresent=true;$scope.isNoRecordsForPendingHCC=false}}if($scope.isNoRecordsForPendingHCC===true){$scope.AcceptedHCCErrorMessage="No records found"}return isPresent};$scope.openHIPendingSortPopup=function(elem){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info, #'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason, #'+$scope.$parent.context+'-pending-info-popup');const openDisagreeAlertPopupPosition=angular.element(elem.target);const classz='.'+$scope.$parent.context+'-pending-sort-selector';$(classz+' input[type="radio"]').prop('checked',false);$(classz).show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-20 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};$scope.sortHIPendingSection=function(sortBy){if($scope.sortBy['Pending']===sortBy){if($scope.orderBy['Pending']==="desc"){$scope.orderBy['Pending']="asc"}else{$scope.orderBy['Pending']="desc"}}else if(sortBy==="hcccode"){$scope.orderBy['Pending']="asc"}else{$scope.orderBy['Pending']="desc"}$scope.sortBy['Pending']=sortBy;getFilteredDataForPendingSection()};const updateHealowInsightsICWSessionStorage=function(key,value){let healowInsightsICW={};if(isSupportsLocalStorage()){if(!containsKey("healowInsightsICW")){healowInsightsICW[key]=value;put("healowInsightsICW",JSON.stringify(healowInsightsICW))}else{healowInsightsICW=JSON.parse(get("healowInsightsICW"));healowInsightsICW[key]=value;put("healowInsightsICW",JSON.stringify(healowInsightsICW))}return healowInsightsICW[key]}return value};const getHealowInsightsICWSessionStorage=function(key,defaultValue){let healowInsightsICW={};if(isSupportsLocalStorage()){if(!containsKey("healowInsightsICW")){healowInsightsICW[key]=defaultValue;put("healowInsightsICW",JSON.stringify(healowInsightsICW))}else{healowInsightsICW=JSON.parse(get("healowInsightsICW"));if(!(key in healowInsightsICW)){healowInsightsICW[key]=defaultValue;put("healowInsightsICW",JSON.stringify(healowInsightsICW))}}return healowInsightsICW[key]}return defaultValue};const showPDXPendingSectionFilter=function(){let hiRCPInsufficientFilterData=getHealowInsightsUserSettings("insufficientConfig");if(!hiRCPInsufficientFilterData){hiRCPInsufficientFilterData=getItemKeyValue("HealowInsightsRCPInsufficientConfig")}let hiRCPCMSAcceptedData=getHealowInsightsUserSettings("cmsAcceptedConfig");if(!hiRCPCMSAcceptedData){hiRCPCMSAcceptedData=getItemKeyValue("HealowInsightsRCPCMSAcceptedConfig")}hiRCPInsufficientFilterData=JSON.parse(hiRCPInsufficientFilterData);hiRCPCMSAcceptedData=JSON.parse(hiRCPCMSAcceptedData);$scope.hiShowInsufficientFilter=hiRCPInsufficientFilterData.showFilter==="1"&&(hiRCPInsufficientFilterData.displayType==="0"||$scope.insufficientCount>0);$scope.hiShowCMSFilter=hiRCPCMSAcceptedData.showFilter==="1"&&(hiRCPCMSAcceptedData.displayType==="0"||$scope.CMSCount>0);$scope.hiShowAcceptedFilter=hiRCPCMSAcceptedData.showFilter==="1"&&(hiRCPCMSAcceptedData.displayType==="0"||$scope.AcceptedCount>0)};$scope.sortHIHistoricalSection=function(sortBy){if($scope.sortBy['Historical']===sortBy){if($scope.orderBy['Historical']==="desc"){$scope.orderBy['Historical']="asc"}else{$scope.orderBy['Historical']="desc"}}else if(sortBy==="hcccode"){$scope.orderBy['Historical']="asc"}else{$scope.orderBy['Historical']="desc"}$scope.sortBy['Historical']=sortBy;$scope.getFilteredDataByDate($scope.selectedHistoricalYear)};var calculateCountsForFilters=function(){$scope.completedCount=0;$scope.unReviewedCount=0;$scope.insufficientCount=0;$scope.totalCount=0;$scope.PNCount=0;$scope.PLCount=0;$scope.CMSCount=0;$scope.AcceptedCount=0;if($scope.acceptedHCCList&&$scope.acceptedHCCList.length>0){for(let i=0,len=$scope.acceptedHCCList.length;i<len;i++){if($scope.acceptedHCCList[i].status==='Addressed'||$scope.acceptedHCCList[i].status==='Add Assessment'){$scope.completedCount+=1;if($scope.hiHccPendingFilter==='2'||$scope.hiHccPendingFilter==='0'){if(isCMSAccepted($scope.acceptedHCCList[i])){$scope.CMSCount+=1}if(isAccepted($scope.acceptedHCCList[i])){$scope.AcceptedCount+=1}}}else{$scope.unReviewedCount+=1;if($scope.hiHccPendingFilter==='1'||$scope.hiHccPendingFilter==='0'){if(isCMSAccepted($scope.acceptedHCCList[i])){$scope.CMSCount+=1}if(isAccepted($scope.acceptedHCCList[i])){$scope.AcceptedCount+=1}}}}}if($scope.pendingHCCList&&$scope.pendingHCCList.length>0){let pendingData;for(let i=0,len=$scope.pendingHCCList.length;i<len;i++){pendingData=$scope.pendingHCCList[i];if(pendingData.hccheaderlist&&pendingData.hccheaderlist.length>0){for(let j=0,len=pendingData.hccheaderlist.length;j<len;j++){if(pendingData.hccheaderlist[j].status==='Addressed'||pendingData.hccheaderlist[j].status==='Add Assessment'){$scope.completedCount+=1;if($scope.hiHccPendingFilter==='2'||$scope.hiHccPendingFilter==='0'){calculateCountForPNPL(pendingData.hccheaderlist[j])}}else{$scope.unReviewedCount+=1;if($scope.hiHccPendingFilter==='1'||$scope.hiHccPendingFilter==='0'){calculateCountForPNPL(pendingData.hccheaderlist[j])}}}}}}$scope.totalCount=$scope.unReviewedCount+$scope.completedCount};let calculateCountForPNPL=function(pendingData){if(HccFilterService.isICDInsufficient(pendingData)){$scope.insufficientCount+=1}if(HccFilterService.IsPresentInProblemList(pendingData)){$scope.PLCount+=1}if($scope.isPresentInPN(pendingData.potentialdx)){$scope.PNCount+=1}if(isCMSAccepted(pendingData)){$scope.CMSCount+=1}if(isAccepted(pendingData)){$scope.AcceptedCount+=1}};$scope.HistoricalFilter=function(type){$scope.historicalFilter=type;if(type===1){$("#hiBtnVisitType").addClass("active")}else if(type===0){$("#hiBtnTotal").addClass("active")}$scope.getFilteredDataByDate($scope.selectedHistoricalYear)};$scope.showConfiguredVisitTypePopup=function(elem){let popupContainer=$('#'+$scope.$parent.context+'-configured-visit-type-popup');getConfiguredVisitTypeList(false);var openDisagreeAlertPopupPosition=angular.element(elem.target);if($scope.$parent.context!=='progressnotes'&&$scope.$parent.context!=='patienthub'){popupContainer.width(260)}popupContainer.toggle().animate({},100,function(){popupContainer.position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-8',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+"-configured-visit-type-popup .hcc-tooltip-arrow").show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-27 top+5',collision:"flipfit"})})};$scope.hideConfiguredVisitTypePopup=function(){$('#'+$scope.$parent.context+'-configured-visit-type-popup').hide()};const getConfiguredVisitTypeList=function(isVisitTypeConfigured){$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'getConfiguredVisitType',checkVisitTypeConfigured:isVisitTypeConfigured}),cache:false}).then(function(response){if(response.data){if(isVisitTypeConfigured){$scope.isVisitTypeConfigured=response.data.isVisitTypeConfigured}else{$scope.historicalConfiguredVisitType=response.data.data;if($scope.historicalConfiguredVisitType.length===0){$scope.historicalFilter=0}}}},function(){$('#divLoadingImg').hide()})};$scope.getHTMLColor=function(color){if(color&&color.length>0){return"#"+color}else{return"#FFFFFF"}};$scope.openHiHistoricalSortPopup=function(elem){const openDisagreeAlertPopupPosition=angular.element(elem.target);const classz='.'+$scope.$parent.context+'-historical-sort-selector';$(classz+' input[type="radio"]').prop('checked',false);$(classz).show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};$scope.openHiRcpActionOnHandIcon=function(elem,potentialdxid,status){$scope.openPDxRecordId=potentialdxid;releaseLockForHIAlerts=false;$scope.closeHiRcpResolved();releaseLockForHIAlerts=true;$scope.currentStatusCipc=status;$scope.closeHiRcpReassessPopup();$scope.closeHiRcpDisagreePopup();$scope.closeHiRcpResolvedPopup();$scope.closeHiRcpReasonOnHandIcon();openDisagreeAlertPopupPosition=angular.element(elem.target);var classz='.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector';$(classz+' input[type="radio"]').prop('checked',false);$(classz).show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};const hiMouseUpHandler=function(e){var container=$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector,.myhealthplan-popup-cipc,.'+$scope.$parent.context+'-pending-sort-selector,.'+$scope.$parent.context+'-historical-sort-selector');if(!container.is(e.target)&&container.has(e.target).length===0){container.hide()}};const loadHiPdxPage=function(){$(document).on('mouseup',hiMouseUpHandler);$scope.getHiRcpPotentialDxList(true)};$scope.showPendingAlert=function(elem,action){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();var _that=angular.element(elem.target);var my='right top';var at='right+5 top+23';var arrowAt='right-31 top+17';if(action==='2'){my='left top';at='left+75 top-25';arrowAt='left+75 top+10'}$("#"+$scope.$parent.context+"-pending-alert-selector").show().animate({},100,function(){$(this).position({of:_that,my:my,at:at,collision:"none"}).animate({"opacity":1},100)});$("#"+$scope.$parent.context+"-pending-alert-selector .diagnosis-right-arrow").show().animate({},100,function(){$(this).position({of:_that,my:my,at:arrowAt,collision:"flipfit"}).animate({"opacity":1},100)})};$scope.checkHCCValid=function(elem,action,icddata,type){if(icddata.hccheaderlist&&icddata.hccheaderlist.length>0){notification.show('success','Notification','Cannot proceed with action. Please click on "Check for New" button in Member Insights screen.',DEFAULT_NOTIFICATION_TIMEOUT)}else{$scope.checkICDAssessed(elem,action,icddata,type)}};$scope.openDisagreeReason=function(icddata,index,hcccode){if(icddata.status==='Addressed'){$scope.selectedDisagreeReason=JSON.parse(icddata.actiondetails).actionValue;$('#'+$scope.$parent.context+'-selected-disagree-reason-'+hcccode+'-'+index).tooltip({title:$scope.selectedDisagreeReason});$('#'+$scope.$parent.context+'-selected-disagree-reason-'+hcccode+'-'+index).tooltip('show')}};$scope.closeDisagreeReason=function(index,hcccode){$('#'+$scope.$parent.context+'-selected-disagree-reason-'+hcccode+'-'+index).tooltip('hide')};var isIcdPresentInGivenEncounterId=function(encounterid,itemid){var result={};$.ajax({type:'POST',url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'checkICDPresenceInProgressnote',encounterid:encounterid,itemid:itemid},jQuery.ajaxSettings.traditional),"async":false,success:function(response){$('#divLoadingImg').hide();if(response){response=JSON.parse(response);if(response.status&&response.status.toLowerCase()==='success'){result=response}else{notification.show('error','Notification',response.message?response.message:'Unable to verify Diagnosis in encounter.',DEFAULT_NOTIFICATION_TIMEOUT)}}}});return result};$scope.resetPdxStatus=function(){var params={};params.pdxid=resetICDDetails.pdxid;params.encounterid=resetICDDetails.encounterid;params.itemid=resetICDDetails.itemid;params.request_source_type=resetICDDetails.request_source_type;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'resetPDXitem',params:JSON.stringify(params)}),cache:false}).success(function(response){updateHIRCPCurrentScrollPosition();$scope.getHiRcpPotentialDxList(false);$scope.closePendingAlert();$('#divLoadingImg').hide();if(response&&response.status&&response.status.toLowerCase()==='success'){notification.show('success','Notification','Data updated successfully.',DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification',response.message?response.message:'Unable to update data.',DEFAULT_NOTIFICATION_TIMEOUT)}}).error(function(){$('#divLoadingImg').hide();notification.show('error','Notification','Unable to update data.',DEFAULT_NOTIFICATION_TIMEOUT)})};const setVisitTypeBasedAccess=function(){$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'isAuthorised',encounterid:$scope.encounterid}),cache:false}).then(function(res){let response=res.data;if(response){$scope.visitTypeBasedAccess=response.status&&response.status.toLowerCase()==='success'}else{notification.show('error','Notification','Unable to fetch visit type based access.',DEFAULT_NOTIFICATION_TIMEOUT)}},function(){notification.show('error','Notification','Unable to fetch visit type based access.',DEFAULT_NOTIFICATION_TIMEOUT)})};$scope.isAuthorised=function(action){if($scope.$parent.encLockVal_RP==="1"){return false}if($scope.hasAccessForAction===1){return true}else if($scope.hasAccessForAction===2){return'Disagree'===action||$scope.visitTypeBasedAccess}else if($scope.hasAccessForAction===3){return $scope.$parent.context==='progressnotes'&&$scope.visitTypeBasedAccess}else{return false}};$scope.checkICDAssessed=function(elem,action,icddata,type){resetICDDetails={};$scope.currentStatusHCC=icddata.status;$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-info-popup');if(action==='1'){if(icddata.evaluationdxstatus==='0'){var encounterDetails=isIcdPresentInGivenEncounterId(icddata.encounterid,icddata.itemid);if(icddata.encounterid&&icddata.itemid&&!encounterDetails.isItemIdPresent&&encounterDetails.encounterdate){$scope.enableReset=true;resetICDDetails.encounterid=icddata.encounterid;resetICDDetails.request_source_type=icddata.request_source_type;resetICDDetails.itemid=icddata.itemid;resetICDDetails.pdxid=icddata.potentialdxid;$scope.alertText='This assessment has been removed from encounter '+encounterDetails.encounterdate+'.';if($scope.isAuthorised('Add Assessment')){$scope.alertText+='<br/>Click on reset button to take further action.'}}else{$scope.enableReset=false;$scope.alertText='This Assessment has been previously accepted. To make changes, first remove it from the Progress Note from '+encounterDetails.encounterdate+'.'}$scope.showPendingAlert(elem,action)}else{if(icddata.status==='Addressed'){$scope.isPdxAddressed=true;if(type==='HCC'){icddata.potentialdxid=icddata.pdxid}openDisagreeReasonPopup(elem,icddata);for(var i=0;i<$scope.disagreeReasons.length;i++){var key=$scope.disagreeReasons[i].key;if(key===JSON.parse(icddata.actiondetails).actionValue){$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason input[name="selectedDisagreeReasonBtn"][value='+$scope.disagreeReasons[i].value+']').prop('checked',true);break}}if(!$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason input[name="selectedDisagreeReasonBtn"]:checked').val()){$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason input[name="selectedDisagreeReasonBtn"][value="6"]').prop('checked',true);$scope.showOtherTextBox=true;$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val(JSON.parse(icddata.actiondetails).actionValue)}let actionDetails=JSON.parse(icddata.actiondetails);if(actionDetails.actionValueType==='Agree'){$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-header').text("Address Reason (Addressed from "+actionDetails.actionSource+")");$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-selection').hide()}else{$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-header').text("Disagree Reason");$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-selection').show()}}else{$scope.isPdxAddressed=false;if(type==='HCC'){icddata.potentialdxid=icddata.pdxid}openDisagreeReasonPopup(elem,icddata);$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-header').text("Disagree Reason");$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-selection').show()}$scope.acquireLockHI(formName,icddata.potentialdxid,4)}}else if(action==='2'){if(type==='HCC'){if(icddata.actiondetails&&JSON.parse(icddata.actiondetails).actionValueType==='Disagree'){$scope.alertText='This assessment is currently in disagree status. In order to add this assessment, please click on the disagree hand and remove your selection.';$scope.showPendingAlert(elem,action)}else{$scope.openHiRcpTreatmentModel(icddata.hccheader,'HCC',icddata.pdxid,icddata.hcccode)}}else{if(icddata.status==='Addressed'){$scope.alertText='This assessment is currently in disagree status. In order to add this assessment, please click on the disagree hand and remove your selection.';$scope.showPendingAlert(elem,action)}else{if(HccFilterService.IsPresentInProblemList(icddata)){let itemid=isSameCodeAndDescriptionPresentInPL(icddata);let params={};params.icdcode=icddata.potentialdx;params.patientid=$scope.patientid;params.encounterid=$scope.encounterid;params.pdxid=icddata.potentialdxid;params.icddecription=icddata.potentialdxmessage;if(itemid>0){params.itemid=itemid;$scope.hiAddICDToAssessment(params)}else{params.payorname=icddata.payorname;getICDListFromCode(elem,params,icddata)}}else{$scope.validateICDAndAddToAssessment(elem,icddata.potentialdxid,icddata.itemid,icddata.potentialdx,icddata.potentialdxmessage,false,icddata)}}}}};const isSameCodeAndDescriptionPresentInPL=function(icddata){for(let i=0,len=icddata.problemList.length;i<len;i++){if(icddata.problemList[i].icdcode.trim().toLowerCase()===icddata.potentialdx.trim().toLowerCase()&&icddata.problemList[i].icddesc.trim().toLowerCase()===icddata.potentialdxmessage.trim().toLowerCase()){return icddata.problemList[i].itemid}}return 0};$scope.showHandIconColor=function(rowdata){var classs;if(rowdata.status==='Addressed'&&rowdata.actiondetails&&JSON.parse(rowdata.actiondetails).actionValueType==='Disagree'){classs='hi-disagree-filled'}else{classs='hi-disagree'}return classs};const openDisagreeReasonPopup=function(elem,icddata){releaseLockForHIAlerts=false;$scope.closeHiRcpResolved();$scope.closePendingAlert();$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');releaseLockForHIAlerts=true;$scope.closeHiRcpReassessPopup();$scope.closeHiRcpDisagreePopup();$scope.closeHiRcpResolvedPopup();$scope.closeHiRcpReasonOnHandIcon();$scope.openPDxRecordId=icddata.potentialdxid;var _that=angular.element(elem.target);if($scope.$parent.context!=='progressnotes'&&$scope.$parent.context!=='patienthub'){$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason').width(249)}$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason input[type="radio"]').prop('checked',false);var at='right+7 top+20';var arrowAt='right-15 top+14';if($scope.isPdxAddressed){at='right top+23';arrowAt='right-35 top+17'}$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:at,collision:"none"}).animate({"opacity":1},100)});$("#"+$scope.$parent.context+"-hi-rcp-pending-disagree-reason #diagnosis-reason-popup-arrow").show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:arrowAt,collision:"flipfit"}).animate({"opacity":1},100)})};$scope.clickDisagreeButton=function(value){$scope.showOtherTextBox=value==="6"&&!$scope.showOtherTextBox};$scope.reopenDisagreeReason=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHiRcpReasonOnHandIcon();return}var actionParams={};actionParams.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;actionParams.actionName='Reopen addressed alert';actionParams.actionValue='';actionParams.actionValueType='Reopened';callService('reopenAddressedAlert',actionParams,disagreeReasonCallback)};$scope.showeAttestationLegend=function(elem){if($('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup').is(':visible')){$scope.closeAddNotesPopUp(true)}if($('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').is(':visible')){releaseLockForHIAlerts=true;$scope.closeHospicePopUpView()}if($('#'+$scope.$parent.context+'-pDxHospiceWarningPopup').is(':visible')){releaseLockForHIAlerts=true;$scope.cancelHospiceWarningPopUpView()}var _that=angular.element(elem.target);$('#'+$scope.$parent.context+'-hi-rcp-eattestation').show().animate({},100,function(){$(this).position({of:_that,my:'right',at:'right-10',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-hi-rcp-eattestation .eattestation-popup-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-24 top-0',collision:"flipfit"})});if(rcpAttestationPerfectScrollbar){rcpAttestationPerfectScrollbar.update()}else{rcpAttestationPerfectScrollbar=new PerfectScrollbar('#'+$scope.$parent.context+'-hi-rcp-eattestation')}};$scope.hideeAttestationLegend=function(){$('#'+$scope.$parent.context+'-hi-rcp-eattestation').hide()};$scope.saveDisagreeReason=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHiRcpReasonOnHandIcon();return}var actionParams={};$scope.selectedDisagreeReasonBtn=$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason input[name="selectedDisagreeReasonBtn"]:checked').val();actionParams.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;actionParams.actionName='User Disagrees with Condition';actionParams.actionValue="";actionParams.actionValueType="Disagree";actionParams.oldStatus=$scope.currentStatusHCC;if($scope.$parent.context==='progressnotes'){actionParams.encounterid=$scope.encounterid}switch($scope.selectedDisagreeReasonBtn){case"1":actionParams.actionValue='Dx not clinically significant';break;case"2":actionParams.actionValue='Dx supported by code previously addressed';break;case"3":actionParams.actionValue='More specific code applies';break;case"4":actionParams.actionValue='No evidence to support Dx';break;case"5":actionParams.actionValue='Resolved';break;case"6":var otherText=$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val().trim();if(otherText){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_pdx_pending_disagree',$scope.$parent.context+'-hi-rcp-pending-disagree-reason','bluetheme');if(checkFieldLength){actionParams.actionValue=otherText}else{return}}else{notification.show('error','Notification','Disagree reason is mandatory',DEFAULT_NOTIFICATION_TIMEOUT);return}break;default:notification.show('error','Notification','Please select a reason!',DEFAULT_NOTIFICATION_TIMEOUT);return}callService('disagreeAlert',actionParams,disagreeReasonCallback)};const disagreeReasonCallback=function(){notification.show('success','Notification','Data updated successfully.',DEFAULT_NOTIFICATION_TIMEOUT);$scope.closeHiRcpReasonOnHandIcon();$scope.isPdxAddressed=false;$scope.showOtherTextBox=false};$scope.getHospiceDataForPatient=function(){hospiceCommentService.getHospiceDataForPatient($scope.patientid,$scope.onSuccessGetHospiceCallback,$scope.onErrorGetHospiceCallback)};$scope.onErrorGetHospiceCallback=function(){$('#divLoadingImg').hide();notification.show('error','Notification','Unable to get Hospice data',DEFAULT_NOTIFICATION_TIMEOUT)};$scope.onSuccessGetHospiceCallback=function(response){$('#divLoadingImg').hide();if(response.status&&response.status==='failure'){var failureMessage=response.message?response.message:"Unable to fetch log details";notification.show('error','Notification',failureMessage,DEFAULT_NOTIFICATION_TIMEOUT)}else{$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop('checked',response.hospice===1);$scope.healowInsightsHospiceCheckBoxVal=response.hospice===1;$scope.ptHospiceActualValue=response.hospice===1;$scope.ptHospiceDate=response.hospiceDate;$scope.ptHospiceNotes=response.hospiceNotes}};$scope.saveUpdateErrorCallback=function(response){$('#divLoadingImg').hide();notification.show('error','Notification','Unable to update Hospice data',DEFAULT_NOTIFICATION_TIMEOUT)};$scope.updatePtHospiceInfo=function(saveFlag){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_hcc_hospice_notes_'+$scope.$parent.context,$scope.$parent.context+'-hi-rcp-hospiceTab','bluetheme');if(checkFieldLength){$('#divLoadingImg').show();var hospiceText=$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val();var params={patientId:$scope.patientid,hospice:$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop("checked")?'1':'0',hospiceDate:$("#"+$scope.$parent.context+"-pDxHospiceDate").val().trim(),hospiceNotes:hospiceText,saveFlag:saveFlag};hospiceCommentService.updatePtHospiceInfo(params,$scope.saveUpdateSuccessCallback,$scope.saveUpdateErrorCallback)}};$scope.saveUpdateSuccessCallback=function(response){$('#divLoadingImg').hide();if(response&&response.status==='success'){$scope.ptHospiceActualValue=$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop("checked");$scope.ptHospiceDate=$("#"+$scope.$parent.context+"-pDxHospiceDate").val().trim();$scope.ptHospiceNotes=$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val();if($scope.$parent.context==='patienthub'&&$scope.PatientHubInfo){$scope.PatientHubInfo.isHealowInsightsHospice=$scope.ptHospiceActualValue}notification.show('success','Notification','Data saved successfully.',DEFAULT_NOTIFICATION_TIMEOUT);$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').hide()}else{$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop('checked',$scope.ptHospiceActualValue);$scope.healowInsightsHospiceCheckBoxVal=$scope.ptHospiceActualValue;$("#"+$scope.$parent.context+"-pDxHospiceDate").val($scope.ptHospiceDate);$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val($scope.ptHospiceNotes);$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').hide();notification.show('error','Notification',response.message?response.message:'Unable to update Hospice info',DEFAULT_NOTIFICATION_TIMEOUT)}releaseLockForHIAlerts=true;$scope.releaseLockHI()};$scope.openHospiceLogsPopup=function(){$scope.patientHospiceLogsUrl="";$ocLazyLoad.load({name:'hiPatientHospiceLogsModule',files:['/mobiledoc/jsp/healowInsights/hospice/js/PatientHospiceLogsController.js','/mobiledoc/jsp/healowInsights/templates/pagination-tpl.js']}).then(function(){$scope.patientHospiceLogsUrl=makeHealowInsightsAPIURL('hospice/logs/view/'+$scope.patientid+'/'+$scope.$parent.context)},function(e){})};$scope.showHospiceComment=function(){if($scope.ptHospiceActualValue){$('#'+$scope.$parent.context+'-pDxHospicePopup').show()}};$scope.hideHospiceComment=function(){$('#'+$scope.$parent.context+'-pDxHospicePopup').hide()};$scope.openHospicePopUp=function(elem){$scope.releaseLockHI();$scope.hideHospiceWarningPopUp();$scope.acquireLockHI('frmNewHealowInsightHospiceId',$scope.patientid,7);$(".hi-hospice-date").datepicker({showButtonPanel:true,dateFormat:'mm/dd/yy'});$(".hi-hospice-date").datepicker("setDate",$scope.ptHospiceDate);$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val($scope.ptHospiceNotes);$(".icon-inputcalender").on('click',hiHospiceCalendarClickHandler);var _that=angular.element(elem.target);$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').show().animate({},100,function(){$(this).position({of:_that,my:'left top',at:'left-10 top+22',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab .hospice-top-view-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'left top',at:'left+10 top+22',collision:"flipfit"})});$('.hi-comments-info-popup').hide();$('#'+$scope.$parent.context+'-hi-rcp-eattestation').hide()};$scope.showHospicePopUp=function(elem){$scope.healowInsightsHospiceCheckBoxVal=$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop("checked");$('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup').hide();releaseLockForHIAlerts=false;$('#'+$scope.$parent.context+'-hi-rcp-eattestation').hide();if($scope.healowInsightsHospiceCheckBoxVal===false&&$scope.ptHospiceActualValue===true){$scope.showHospiceWarningPopUp()}else{$scope.openHospicePopUp(elem)}};$scope.closeHospicePopUp=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false}else{releaseLockForHIAlerts=true}$scope.closeHospicePopUpView()};$scope.closeHospicePopUpView=function(){$scope.releaseLockHI();$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').hide();if($("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop("checked")&&!$scope.ptHospiceActualValue){$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop('checked',false);$scope.healowInsightsHospiceCheckBoxVal=false}};$scope.savePatientHospiceInfo=function(saveFlag){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHospicePopUpView();return}var hospiceDate=$("#"+$scope.$parent.context+"-pDxHospiceDate").val().trim();var isHospiceMarked=$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop("checked");if(isHospiceMarked&&hospiceDate===''){notification.show('error','Notification','Please select valid Date in Hospice Notes.',DEFAULT_NOTIFICATION_TIMEOUT);return}$scope.updatePtHospiceInfo(saveFlag)};$scope.showHospiceWarningPopUp=function(){$('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup').hide();$scope.releaseLockHI();$('#'+$scope.$parent.context+'-hi-rcp-eattestation').hide();$('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').hide();$('#'+$scope.$parent.context+'-pDxHospiceWarningPopup').show();$scope.acquireLockHI('frmNewHealowInsightHospiceId',$scope.patientid,8)};$scope.hideHospiceWarningPopUp=function(){$('#'+$scope.$parent.context+'-pDxHospiceWarningPopup').hide()};$scope.cancelHospiceWarningPopUp=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false}else{releaseLockForHIAlerts=true}$scope.cancelHospiceWarningPopUpView()};$scope.cancelHospiceWarningPopUpView=function(){$scope.releaseLockHI();$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop('checked',true);$scope.healowInsightsHospiceCheckBoxVal=true;$scope.hideHospiceWarningPopUp()};$scope.removeHospice=function(){$("#"+$scope.$parent.context+"-hi-rcp-hospicecheck").prop('checked',false);$scope.healowInsightsHospiceCheckBoxVal=false;$scope.hideHospiceWarningPopUp();$("#"+$scope.$parent.context+"-pDxHospiceDate").val('');$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val('');$scope.savePatientHospiceInfo(0)};$scope.successfullyFetchComments=function(response){$('#divLoadingImg').hide();if(response&&response.status==='success'){patientComment=response.comments;$('#'+$scope.$parent.context+'-pdxNewComment').val(response.comments)}else{notification.show('error','Notification','Unable to fetch patient identifier data or comments log data.',DEFAULT_NOTIFICATION_TIMEOUT)}};$scope.errorFetchComments=function(response){$('#divLoadingImg').hide();notification.show('error','Notification','Unable to get Comments',DEFAULT_NOTIFICATION_TIMEOUT)};$scope.openPatientHCCComments=function(elem){if($('#'+$scope.$parent.context+'-hi-rcp-hospiceTab').is(':visible')){releaseLockForHIAlerts=true;$scope.closeHospicePopUpView()}if($('#'+$scope.$parent.context+'-pDxHospiceWarningPopup').is(':visible')){releaseLockForHIAlerts=true;$scope.cancelHospiceWarningPopUpView()}$('#divLoadingImg').show();hospiceCommentService.getPatientComments($scope.patientid,$scope.successfullyFetchComments,$scope.errorFetchComments);var _that=angular.element(elem.target);$('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-20 top+30',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup .hi-comments-info-popup-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right+20 top+30',collision:"flipfit"})});$scope.acquireLockHI('frmNewHealowInsightWLHccListId',$scope.patientid,6);$('button[name="addCommentOkButton"]').attr('disabled','disabled');$('#'+$scope.$parent.context+'-hi-rcp-eattestation').hide()};$scope.disableCommentOk=function(){if($('textarea[id='+$scope.$parent.context+"-pdxNewComment"+']').val()===patientComment){$('button[name="addCommentOkButton"]').attr('disabled','disabled')}else{$('button[name="addCommentOkButton"]').prop('disabled',false)}};$scope.closeAddNotesPopUp=function(requireToReleaseLock){$('#'+$scope.$parent.context+'-hi-rcp-comments-info-popup').hide();if(requireToReleaseLock){releaseLockForHIAlerts=true;$scope.releaseLockHI()}};$scope.hiAddOrUpdateComment=function(){$ocLazyLoad.load({name:'hccCommentLogModule',files:['/mobiledoc/jsp/healowInsights/rightpanel/js/hiHCCCommentLogs.js','/mobiledoc/jsp/healowInsights/templates/pagination-tpl.js','/mobiledoc/jsp/healowInsights/rightpanel/js/hiHospiceHccCommentService.js']}).then(function(){var url='/mobiledoc/jsp/healowInsights/rightpanel/view/hiHCCCommentLogs.jsp?ptid='+$scope.patientid+'&context='+$scope.$parent.context;$scope.patientCommentsUrl=makeURL(url)},function(e){})};$scope.successfullyUpdatedComments=function(response){$('#divLoadingImg').hide();$scope.closeAddNotesPopUp(true);if(response&&response.status==='failure'){var message=response.message?response.message:"An error occurred while updating user comment.";notification.show('error','Notification',message,DEFAULT_NOTIFICATION_TIMEOUT)}else if(response&&response.status==='success'){patientComment=$("#"+$scope.$parent.context+"-pdxNewComment").val().trim();notification.show('success','Notification','Comment saved successfully.',DEFAULT_NOTIFICATION_TIMEOUT)}else if(response&&response.status==='Unauthorized'&&response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}};$scope.updateComment=function(){if(!isLockMine2(lockObjHI)){$scope.closeAddNotesPopUp(false);return}if($scope.isUserAuthorizedForHCCComment&&$("#"+$scope.$parent.context+"-pdxNewComment").val()!==patientComment){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_hcc_comments_'+$scope.$parent.context,$scope.$parent.context+'-hi-rcp-comments-info-popup','bluetheme');if(checkFieldLength){var commentText=$("#"+$scope.$parent.context+"-pdxNewComment").val();$('#divLoadingImg').show();var reqParams={};reqParams.patientId=$scope.patientid;reqParams.comments=commentText.trim();hospiceCommentService.updateComment(reqParams,$scope.successfullyUpdatedComments,$scope.onErrorUpdatedComments)}}else{notification.show('error','Notification','You do not have access to update comments or you have not updated comment.',DEFAULT_NOTIFICATION_TIMEOUT);releaseLockForHIAlerts=true;$scope.releaseLockHI()}};$scope.onErrorUpdatedComments=function(response){$('#divLoadingImg').hide();$scope.closeAddNotesPopUp(true);notification.show('error','Notification','An error occurred while updating user comment.',DEFAULT_NOTIFICATION_TIMEOUT)};$scope.cancelComment=function(){$('#hcclist-modal').modal('hide')};function hiHospiceCalendarClickHandler(){$(this).parent().parent().parent().find('input[type="text"]').datepicker("show")}$scope.closeHiRcpReasonOnHandIcon=function(){var pendingDisagreeContext=$('#'+$scope.$parent.context+'-hi-rcp-pending-disagree-reason');if(pendingDisagreeContext.is(':visible')){$scope.releaseLockHI();pendingDisagreeContext.hide();$scope.openPDxRecordId='';$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val('');$scope.showOtherTextBox=false}};$scope.getActionStatus=function(actiondetail){var action="Agreed";if(actiondetail){actiondetail=JSON.parse(actiondetail);if(actiondetail&&actiondetail.actionValueType==='Disagree'){action="Disagreed"}else if(actiondetail&&actiondetail.actionValueType==='Moved'){action="Moved"}}return action};$scope.getHistoricalDate=function(data){if(data&&data.logsActionDetails){let actionDetail=JSON.parse(data.logsActionDetails);if(actionDetail&&actionDetail.actionValueType==='Disagree'||actionDetail.actionValueType==='Agree'&&actionDetail.actionSource==='Worklist'){return data.updateddate}else{return data.encounterdate}}};const getActionSource=function(actiondetails){let source=JSON.parse(actiondetails).actionSource;if(source){return" - Addressed from "+source}return''};$scope.isAgreed=function(pendingICDList){if(pendingICDList&&pendingICDList.status){return pendingICDList.status==='Add Assessment'||pendingICDList.status==='Addressed'&&pendingICDList.actiondetails&&JSON.parse(pendingICDList.actiondetails).actionValueType==='Agree'}return false};$scope.getActionStatusForInfo=function(obj){if(obj){let action=$scope.getActionStatus(obj.actiondetails);let logsActionValueType=$scope.getActionStatus(obj.logsActionDetails);if(action==="Moved"&&obj.logsActionDate){action=logsActionValueType+(obj.logsStatus==='Addressed'&&logsActionValueType==='Agreed'?getActionSource(obj.logsActionDetails):'')+" ("+action+" : "+obj.logsActionDate+")"}else{if(obj.logsStatus==='Addressed'&&logsActionValueType==='Agreed'){return logsActionValueType+getActionSource(obj.logsActionDetails)}}return action}};$scope.isHCCReoccurringInSelectedYear=function(acceptedHCC){let isPresent=false;if($scope.historicalHCCList&&Object.keys($scope.historicalHCCList).length>0){angular.forEach($scope.historicalHCCList,function(value,key){for(let i=0,len=value.length;i<len;i++){if(value[i].hcccode&&value[i].hcccode===acceptedHCC.hcccode){isPresent=true;break}}})}return isPresent};$scope.isICDReoccurringInSelectedYear=function(pendingICD){let isPresent=false;if($scope.historicalHCCList&&Object.keys($scope.historicalHCCList).length>0&&$scope.historicalHCCList[pendingICD.potentialdx]&&$scope.historicalHCCList[pendingICD.potentialdx].length>0){isPresent=true}return isPresent};$scope.isHistoricalICDPresentInPendingSection=function(potentialdx){let isPresent=false;if($scope.pendingHCCList&&$scope.pendingHCCList.length>0){let pendingData;for(let i=0,len=$scope.pendingHCCList.length;i<len;i++){pendingData=$scope.pendingHCCList[i];if(pendingData.hccheaderlist&&pendingData.hccheaderlist.length>0){for(let j=0,len=pendingData.hccheaderlist.length;j<len;j++){if(pendingData.hccheaderlist[j].potentialdx===potentialdx&&pendingData.hccheaderlist[j].icd_status&&pendingData.hccheaderlist[j].icd_status.toLowerCase()==='insufficient'){isPresent=true;break}}}}}return isPresent};$scope.getHiRcpPotentialDxList=function(getLastRefreshDate){var filterParams={};filterParams.patientid=$scope.patientid;if($scope.$parent.context==='progressnotes'){filterParams.encounterid=$scope.encounterid}filterParams.sortByPending=$scope.sortBy['Pending'];filterParams.orderByPending=$scope.orderBy['Pending'];filterParams.sortByHistorical=$scope.sortBy['Historical'];filterParams.orderByHistorical=$scope.orderBy['Historical'];filterParams.filterByConfiguredVisitType=$scope.historicalFilter===1;filterParams.getLastRefreshDate=getLastRefreshDate;$scope.isHiRcpLoading=true;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'getPotentialDxList',years:$scope.selectedHistoricalYear,params:JSON.stringify(filterParams)}),cache:false}).success(function(response){if(response){if(response.status==='success'){setPDDataList(response);if(response.AcceptedHCCStatus&&response.AcceptedHCCStatus.toLowerCase()==='success'&&response.AcceptedHCCList&&response.AcceptedHCCList.length>0){$scope.acceptedHCCList=response.AcceptedHCCList}else{$scope.acceptedHCCList=[];$scope.AcceptedHCCErrorMessage=response.AcceptedHCCErrorMessage?response.AcceptedHCCErrorMessage:"No records found"}if(response.PendingHCCStatus&&response.PendingHCCStatus.toLowerCase()==='success'&&response.PendingHCCList&&response.PendingHCCList.length>0){if(response.assessmentCodeList){assessmentCodeList=response.assessmentCodeList}$scope.pendingHCCList=response.PendingHCCList}else{$scope.pendingHCCList=[];$scope.PendingHCCErrorMessage=response.PendingHCCErrorMessage?response.PendingHCCErrorMessage:"No records found"}setHistoricalDataList(response);if(response.CIPCStatus&&response.CIPCStatus.toLowerCase()==='success'&&response.CIPCList&&response.CIPCList.length>0){$scope.CIPCList=response.CIPCList}else{$scope.CIPCList=[];$scope.CIPCErrorMessage=response.CIPCErrorMessage?response.CIPCErrorMessage:"No records found"}if(response.sectionInfo){$scope.sectionInfo=response.sectionInfo}if(response.sectionInfo){$scope.sectionInfo=response.sectionInfo}if(response.payorname&&response.createddate&&response.payorname!==''&&response.createddate!==''){$scope.lastRefreshedHeading='Last refreshed on '+response.createddate+' from '+response.payorname}}else{var message=response.message?response.message:"Unable to get Data";notification.show('error','Notification',message,DEFAULT_NOTIFICATION_TIMEOUT)}}if(getItemKeyValue("HealowInsightsHospice").toLowerCase()==="yes"&&getPermission("AllowHealowInsightsHospice",global.TrUserId)){$scope.getHospiceDataForPatient()}$scope.isHiRcpLoading=false;calculateCountsForFilters();$scope.isNoRecordsForPendingHCC=true;setHIRCPScrollPosition();showPDXPendingSectionFilter()}).error(function(response){$scope.isHiRcpLoading=false;setHIRCPScrollPosition()})};const setHIRCPScrollPosition=function(){let scrollPosition=getHealowInsightsICWSessionStorage('hi-rcp-scroll-position-'+$scope.$parent.context,0);if(scrollPosition>0){let rcpScrollDiv=getHIRCPScrollingDiv();if(rcpScrollDiv&&rcpScrollDiv.length>0){$(rcpScrollDiv).animate({scrollTop:scrollPosition},1)}updateHealowInsightsICWSessionStorage('hi-rcp-scroll-position-'+$scope.$parent.context,0)}};const updateHIRCPCurrentScrollPosition=function(){if(isProcessingICDFromPDList){updateHealowInsightsICWSessionStorage('hi-rcp-scroll-position-'+$scope.$parent.context,0)}else{let rcpScrollDiv=getHIRCPScrollingDiv();if(rcpScrollDiv&&rcpScrollDiv.length>0){updateHealowInsightsICWSessionStorage('hi-rcp-scroll-position-'+$scope.$parent.context,rcpScrollDiv.scrollTop())}}};const getHIRCPScrollingDiv=function(){for(let i=0;i<angular.element("[ng-controller='rpTabsCtrl']").length;i++){let rpScope=angular.element("[ng-controller='rpTabsCtrl']").eq(i).scope();if(rpScope&&rpScope.context&&rpScope.context.toLowerCase()===$scope.$parent.context.toLowerCase()){let rightPanelDiv=angular.element("[ng-controller='rpTabsCtrl']").find('#rightPanelCtrl').eq(0);let rightPanelScrollDiv=rightPanelDiv.find('.rightpanelscroll').eq(0);if(rightPanelScrollDiv.length>0){let divHeight=Math.ceil(rightPanelScrollDiv.height());let scrollHeight=Math.ceil(rightPanelScrollDiv[0].scrollHeight);if(scrollHeight>divHeight){return rightPanelScrollDiv}else{let accordListDiv=rightPanelScrollDiv.find('.accord-list');if(accordListDiv.length>0){return accordListDiv}}}}}};const setPDDataList=function(response){if(response.PdStatus&&response.PdStatus.toLowerCase()==='success'&&response.PDList){$scope.PDList=response.PDList;$scope.pdListCount=Object.keys($scope.PDList).length;if($scope.pdListCount<=0){$scope.pdMessage="No records found"}}else{$scope.PDList=[];$scope.pdListCount=0;$scope.pdMessage=response.PdErrorMessage?response.PdErrorMessage:"No records found"}};const setHistoricalDataList=function(response){if(response.HistoricalHCCStatus&&response.HistoricalHCCStatus.toLowerCase()==='success'&&response.HistoricalHCCList){$scope.historicalHCCList=response.HistoricalHCCList;$scope.historicalHCCListCount=Object.keys($scope.historicalHCCList).length;if($scope.historicalHCCListCount<=0){$scope.HistoricalHCCErrorMessage="No records found"}}else{$scope.historicalHCCList=[];$scope.historicalHCCListCount=0;$scope.HistoricalHCCErrorMessage=response.HistoricalHCCErrorMessage?response.HistoricalHCCErrorMessage:"No records found"}};$scope.toggleShowHistoricalDataDiv=function(){$scope.hiShowHistoricalDataDiv=!$scope.hiShowHistoricalDataDiv;if($scope.hiShowHistoricalDataDiv&&$scope.isVisitTypeConfigured===undefined){getConfiguredVisitTypeList(true)}};const getFilteredDataForPendingSection=function(){var filterParams={};filterParams.patientid=$scope.patientid;if($scope.$parent.context==='progressnotes'){filterParams.encounterid=$scope.encounterid}filterParams.sortBy=$scope.sortBy['Pending'];filterParams.orderBy=$scope.orderBy['Pending'];filterParams.filterByConfiguredVisitType=$scope.historicalFilter===1;filterParams.isFilterForHistoricalSection=false;$scope.isHiPendingLoading=true;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'filterPotentialDxByDate',years:0,params:JSON.stringify(filterParams)}),cache:false}).then(function(res){let response=res.data;if(response){if(response.status==='success'){if(response.AcceptedHCCStatus&&response.AcceptedHCCStatus.toLowerCase()==='success'&&response.AcceptedHCCList&&response.AcceptedHCCList.length>0){$scope.acceptedHCCList=response.AcceptedHCCList}else{$scope.AcceptedHCCErrorMessage=response.AcceptedHCCErrorMessage?response.AcceptedHCCErrorMessage:"No records found"}if(response.PendingHCCStatus&&response.PendingHCCStatus.toLowerCase()==='success'&&response.PendingHCCList&&response.PendingHCCList.length>0){if(response.assessmentCodeList){assessmentCodeList=response.assessmentCodeList}$scope.pendingHCCList=response.PendingHCCList}else{$scope.PendingHCCErrorMessage=response.PendingHCCErrorMessage?response.PendingHCCErrorMessage:"No records found"}}else{const message=response.message?response.message:"Unable to get Data";notification.show('error','Notification',message,DEFAULT_NOTIFICATION_TIMEOUT)}}if(getItemKeyValue("HealowInsightsHospice").toLowerCase()==="yes"&&getPermission("AllowHealowInsightsHospice",global.TrUserId)){$scope.getHospiceDataForPatient()}$scope.isHiPendingLoading=false;calculateCountsForFilters();$scope.isNoRecordsForPendingHCC=true},function(){$scope.isHiPendingLoading=false})};$scope.isPresentInPN=function(code){if($scope.$parent.context==='progressnotes'&&code&&assessmentCodeList){let index=assessmentCodeList.findIndex(element=>{return element.trim().toUpperCase()===code.trim().toUpperCase()});return index!==-1}return false};$scope.getFilteredDataByDate=function(numberofYears){$scope.selectedHistoricalYear=numberofYears;var filterParams={};filterParams.patientid=$scope.patientid;if($scope.$parent.context==='progressnotes'){filterParams.encounterid=$scope.encounterid}filterParams.sortBy=$scope.sortBy['Historical'];filterParams.orderBy=$scope.orderBy['Historical'];filterParams.filterByConfiguredVisitType=$scope.historicalFilter===1;filterParams.isFilterForHistoricalSection=true;$scope.isHiHistoricalLoading=true;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'filterPotentialDxByDate',years:numberofYears,params:JSON.stringify(filterParams)}),cache:false}).then(function(res){let response=res.data;if(response.status&&response.status==='success'){setHistoricalDataList(response)}else{if(response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Unable to fetch Manually Added HCC.',DEFAULT_NOTIFICATION_TIMEOUT)}}$scope.isHiHistoricalLoading=false},function(){$scope.isHiHistoricalLoading=false;notification.show('error','Notification','Unable to fetch Manually Added HCC.',DEFAULT_NOTIFICATION_TIMEOUT)})};const removeHccCodeFromDescriptionForHI=function(description,code){var array=description.split('-');code=code.trim();if(array[array.length-1].trim()===code){description=description.substring(0,description.lastIndexOf("-")).trim()}return description};const isEligibleForProcessing=function(pdxid,toPerformAction){var obj={};obj.alertId=pdxid;obj.toPerformAction=toPerformAction;obj.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;var result=false;$.ajax({type:'POST',url:makeURL('/mobiledoc/jsp/healowInsights/worklists/controller/HIPdxController.jsp'),data:$.param({action:'isEligibleToPerformExternalAction',params:JSON.stringify(obj)},jQuery.ajaxSettings.traditional),"async":false,success:function(response){if(response.status==='success'){result=true}else if(response.status==='failure'||response.status==='unauthorized'){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT);result=false}else{result=false;notification.show('error','Notification','Error while checking the eligibility for further processing.',DEFAULT_NOTIFICATION_TIMEOUT)}}});return result};$scope.openHiRcpTreatmentModel=function(description,type,id,code){if(isEligibleForProcessing(id,'add_assessment')){var hiparams={};hiparams.type=type;hiparams.id=id;hiparams.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;if(type==='HCC'){description=removeHccCodeFromDescriptionForHI(description,code)}$scope.loadTreatmentModel(description,hiparams)}};$scope.loadTreatmentModel=function(description,hiparams){$ocLazyLoad.load({name:'AddICDModule',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/ICD_Treatment.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/ICD_Treatment.jsp?hiicdtext='+btoa(description)+'&hipdxdata='+btoa(JSON.stringify(hiparams))),controller:'AddICDCtrl',windowClass:'app-modal-window bluetheme modal-width',backdrop:"static",resolve:{patientID:function(){return $scope.patientid},encounterID:function(){return $scope.encounterid},loginuserid:function(){return global.TrUserId},parentForm:function(){return"HICIPC"},asmtList:function(){return""}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){updateHIRCPCurrentScrollPosition();refreshDashboard($scope.encounterid,$scope.patientid)})})};$scope.getHiRcpPdxTypeName=function(type){if(type==='CIPC'){return"Clinical Inference and Potential Conditions"}else if(type==='PD'){return"Previous Diagnosis(es)"}else if(type==='HCC'){return"HCC"}else if(type==='Diagnosis(es)'){return"Diagnosis(es)"}};$scope.openHistoryPopup=function(){$ocLazyLoad.load({name:'potentialConditionLogs',files:['/mobiledoc/jsp/healowInsights/rightpanel/js/hiPotentialConditionLogsController.js','/mobiledoc/jsp/healowInsights/templates/pagination-tpl.js']}).then(function(){var url='/mobiledoc/jsp/healowInsights/rightpanel/view/hiPotentialConditionLogs.jsp?ptid='+$scope.patientid+'&context='+$scope.$parent.context;$scope.hiRCPPotentialConditionLogsUrl=makeURL(url)},function(e){})};$scope.getHCCHeader=function(hccHeader){return hccHeader};$scope.getHCCCode=function(hccCode){return'HCC '+hccCode};$scope.openHCCItemInfoPopup=function(elem,createddate,infodata,classs,source){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();if(infodata&&classs){$scope.pdxitemInfo=JSON.parse(infodata);if($scope.pdxitemInfo.length>0){angular.forEach($scope.pdxitemInfo,function(item){if(item.key==='Source'){item.value=source}})}var data={};data.key="Date Received";data.value=createddate;data.order=5;$scope.pdxitemInfo.push(data);openPDXItemPopup(elem,classs)}else{$scope.potentialInfoClick(elem,'','No information available...')}};$scope.openHccDocument=function(pdxPendingitemInfo,isLogInfo){$ocLazyLoad.load({name:'pdfHccRefContentModule',files:['/mobiledoc/jsp/healowInsights/rightpanel/js/openHccDocument.js']}).then(function(){var id=-1;var alertId=-1;if(pdxPendingitemInfo.id){id=pdxPendingitemInfo.id}if(pdxPendingitemInfo.potentialdxid){alertId=pdxPendingitemInfo.potentialdxid}if(id!==0){$scope.hiRCPPdfRefContentURL=makeHealowInsightsAPIURL('rightpanel/view/'+isLogInfo+'/'+id+'/'+alertId+'/'+$scope.$parent.context)}},function(e){})};$scope.openPendingItemInfoPopup=function(elem,hcccode,hccdesc,pendingIcdData,source){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();$scope.pdxPendingitemInfo=pendingIcdData;$scope.pdxPendingitemInfo.hcccode=hcccode;$scope.pdxPendingitemInfo.hccdesc=hccdesc;if(pendingIcdData.infodata){if(pendingIcdData.request_source_type==='HI_HOSTED'){$scope.pdxPendingitemInfo.infoList=[];var infoList=JSON.parse(pendingIcdData.infodata);var item;for(var index in infoList){item=infoList[index];for(var itemKey in item){var infodata={};infodata.key=itemKey;infodata.value=item[itemKey];$scope.pdxPendingitemInfo.infoList.push(infodata)}}var data={};data.key="Source";data.value=pendingIcdData.payorname;$scope.pdxPendingitemInfo.infoList.push(data)}else{$scope.pdxPendingitemInfo.infoList=JSON.parse(pendingIcdData.infodata);if($scope.pdxPendingitemInfo.infoList.length>0){angular.forEach($scope.pdxPendingitemInfo.infoList,function(item){if(item.key==='Source'){item.value=source}})}var data={};data.key="Date Received";data.value=pendingIcdData.createddate;data.order=5;$scope.pdxPendingitemInfo.infoList.push(data)}}var _that=angular.element(elem.target);if($scope.$parent.context!=='progressnotes'&&$scope.$parent.context!=='patienthub'){$('#'+$scope.$parent.context+'-pending-info-popup').width(260)}$('#'+$scope.$parent.context+'-pending-info-popup').toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-20 top-65',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-pending-info-popup .hcc-tooltip-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-21 top+10',collision:"flipfit"})})};$scope.openManuallyItemInfoPopup=function(elem,providerName){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-pending-info-popup');$scope.closeHiRcpReasonOnHandIcon();$scope.pdxManuallyAddedProviderName=providerName;if($scope.$parent.context!=='progressnotes'&&$scope.$parent.context!=='patienthub'){$('#'+$scope.$parent.context+'-manually-added-info').width(260)}var _that=angular.element(elem.target);$('#'+$scope.$parent.context+'-manually-added-info').toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-15 top-10',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-manually-added-info .hcc-tooltip-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-18 top+5',collision:"flipfit"})})};$scope.openHistoricalItemInfoPopup=function(elem,icddata){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-pending-info-popup');$scope.closeHiRcpReasonOnHandIcon();$scope.pdxHistoricalitemInfo=icddata;if(icddata.infodata){if(icddata.request_source_type==='HI_HOSTED'){$scope.pdxHistoricalitemInfo.infoList=[];var infoList=JSON.parse(icddata.infodata);var item;for(var index in infoList){item=infoList[index];for(var itemKey in item){var infodata={};infodata.key=itemKey;infodata.value=item[itemKey];$scope.pdxHistoricalitemInfo.infoList.push(infodata)}}}else{$scope.pdxHistoricalitemInfo.infoList=JSON.parse(icddata.infodata);if($scope.pdxHistoricalitemInfo.infoList.length>0){angular.forEach($scope.pdxHistoricalitemInfo.infoList,function(item){if(item.key==='Source'){item.value=icddata.payorname}})}var data={};data.key="Date Received";data.value=icddata.updateddate;data.order=5;$scope.pdxHistoricalitemInfo.infoList.push(data)}}if($scope.$parent.context!=='progressnotes'&&$scope.$parent.context!=='patienthub'){$('#'+$scope.$parent.context+'-historical-info').width(260)}var _that=angular.element(elem.target);$('#'+$scope.$parent.context+'-historical-info').toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-20 top-65',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-historical-info .hcc-tooltip-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-22 top+10',collision:"flipfit"})})};$scope.isActionReasonAvailForHistorical=function(obj){if(obj&&obj.logsStatus==='Addressed'&&obj.logsActionDetails){var actionJSON=JSON.parse(obj.logsActionDetails);if(actionJSON&&actionJSON.actionValueType==='Disagree'){$('#'+$scope.$parent.context+'-historical-info-Disagree-label').text("Disagree")}else{$('#'+$scope.$parent.context+'-historical-info-Disagree-label').text("Address")}return true}return false};$scope.getDisagreeReasonForHistorical=function(logsActionDetails){var actionDetailsJSON=JSON.parse(logsActionDetails);if(actionDetailsJSON){var reason=actionDetailsJSON.actionValue;if(reason){return reason}}return"Not Available"};$scope.openCIPCItemInfoPopop=function(elem,createddate,infodata,classs,payerName){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();if(infodata&&classs){$scope.pdxitemInfo=JSON.parse(infodata);if($scope.pdxitemInfo.length>0){angular.forEach($scope.pdxitemInfo,function(item){if(item.key==='Source'){item.value=payerName}})}var data={};data.key="Date Received";data.value=createddate;data.order=2;$scope.pdxitemInfo.splice(1,0,data);openPDXItemPopup(elem,classs)}else{$scope.potentialInfoClick(elem,'','No information available...')}};$scope.openCIPCICDItemInfoPopup=function(elem,addedByName,classs,actionDate){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();if(addedByName&&actionDate&&classs){$scope.pdxitemInfo=[];let data={};data.key="Action By";data.value=addedByName;data.order=1;$scope.pdxitemInfo.push(data);data={};data.key="Action Date";data.value=actionDate;data.order=2;$scope.pdxitemInfo.push(data);openPDXItemPopup(elem,classs)}else{$scope.potentialInfoClick(elem,'','No information available...')}};$scope.openPDItemInfoPopop=function(elem,infodata,classs,source){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();if(infodata&&classs){$scope.pdxitemInfo=JSON.parse(infodata);let findHighestOrder=0;angular.forEach($scope.pdxitemInfo,function(value,key){if(value.order>findHighestOrder){findHighestOrder=value.order}});let sourceObj={};sourceObj.key="Source";sourceObj.order=findHighestOrder+1;sourceObj.value=source;$scope.pdxitemInfo.push(sourceObj);openPDXItemPopup(elem,classs)}else{$scope.potentialInfoClick(elem,'','No information available...')}};$scope.openPDActionItemInfoPopup=function(elem,classs,rowObj){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();if(rowObj&&classs){$scope.pdxitemInfo=[];let sourceObj={};sourceObj.key="Action By";sourceObj.order=1;sourceObj.value=rowObj.actionbyname;$scope.pdxitemInfo.push(sourceObj);sourceObj={};sourceObj.key="Action Date";sourceObj.order=2;sourceObj.value=rowObj.actiondate;$scope.pdxitemInfo.push(sourceObj);sourceObj={};sourceObj.key="Encounter Date";sourceObj.order=3;sourceObj.value=rowObj.log_encounterdate;$scope.pdxitemInfo.push(sourceObj);openPDXItemPopup(elem,classs)}else{$scope.potentialInfoClick(elem,'','No information available...')}};const openPDXItemPopup=function(elem,classs){var _that=angular.element(elem.target);$(classs).toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-20 top-14',collision:"flipfit"}).animate({"opacity":1},100)});classs=classs+' .info-popup-arrow';$(classs).show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-21 top+19',collision:"flipfit"})})};$scope.hidePDXItemPopup=function(classs){$(classs).hide()};$scope.potentialInfoClick=function(eleml,type,text){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pending-alert-selector, #'+$scope.$parent.context+'-potential-info-popup, #'+$scope.$parent.context+'-pdx-item-info, #'+$scope.$parent.context+'-historical-info');$scope.closeHiRcpReasonOnHandIcon();var _that=angular.element(eleml.target);if(text){$scope.hiSectionInfoPopupText=text;$('#'+$scope.$parent.context+'-potential-info-popup').toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-20 top-15',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-potential-info-popup .info-popup-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-21 top+5',collision:"flipfit"})})}else{$scope.potentialInfoClick(eleml,type,getDefaultMsgOfPdxTypeForHI(type))}};$scope.potentialInfoHistoryPopup=function(eleml,type,text){$scope.hidePDXItemPopup('#'+$scope.$parent.context+'-pdx-item-info-history, #'+$scope.$parent.context+'-potential-info-popup-history, #'+$scope.$parent.context+'-pending-info-popup-history');var _that=angular.element(eleml.target);if(text){$("#hi-section-info-popup-history").text(text);$('#'+$scope.$parent.context+'-potential-info-popup-history').toggle().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-23 top-2',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-potential-info-popup-history .hcc-tooltip-arrow').show().animate({},100,function(){$(this).position({of:_that,my:'right top',at:'right-25 top+9',collision:"flipfit"})})}else{$scope.potentialInfoClick(eleml,type,getDefaultMsgOfPdxTypeForHI(type))}};const getDefaultMsgOfPdxTypeForHI=function(type){if(type==='CIPC'){return"During the patient's next office visit, please assess the patient for the condition(s) listed below. If in your clinical judgment you agree the patient has the condition, please document the diagnosis in the chart and corresponding claim."}else if(type==='PD'){return"Assessments displayed are shared through patients's insurance for provider information.It is the provider's responsibility to act on or ignore these assessments."}};$scope.openDisagreeAlertPopup=function(){$('#'+$scope.$parent.context+'-hi-rcp-disagree-reason').show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-15',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+"-hi-rcp-disagree-reason .diagnosis-right-arrow").show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-27 top+10',collision:"flipfit"}).animate({"opacity":1},100)});$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.acquireLockHI(formName,$scope.openPDxRecordId,1)};$scope.openResolvedAlertPopup=function(){$('#'+$scope.$parent.context+'-hi-rcp-resolved-reason').show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-15',collision:"flipfit"}).animate({"opacity":1},100)});$("#"+$scope.$parent.context+"-hi-rcp-resolved-reason .diagnosis-right-arrow").show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-27 top+10',collision:"flipfit"}).animate({"opacity":1},100)});$('#'+$scope.$parent.context+'-resolved-data').hide();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.acquireLockHI(formName,$scope.openPDxRecordId,3)};$scope.openResolvePopup=function(){$('#'+$scope.$parent.context+'-resolved-data').show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-13',collision:"flipfit"}).animate({"opacity":1},100)});$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide()};$scope.closeHiRcpResolved=function(){$('#'+$scope.$parent.context+'-resolved-data').hide()};$scope.closePendingAlert=function(){resetICDDetails={};$("#"+$scope.$parent.context+"-pending-alert-selector").hide()};const hiWorklistsPdxCalendarClickHandler=function(){$(this).parent().parent().parent().find('input[type="text"]').datepicker("show")};$scope.openReassessPopup=function(){$scope.reassessEndDate='';$scope.reassessReason='';$(".overview-reassess-end-date").datepicker({showButtonPanel:true,dateFormat:'mm/dd/yy',minDate:0});$(".icon-inputcalender").on('click',hiWorklistsPdxCalendarClickHandler);$('#'+$scope.$parent.context+'-hi-rcp-reassess-reason').show().animate({},100,function(){$(this).position({of:openDisagreeAlertPopupPosition,my:'right top',at:'right-25 top-45',collision:"flipfit"}).animate({"opacity":1},100)});$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.acquireLockHI(formName,$scope.openPDxRecordId,2)};$scope.closeHiRcpReassessPopup=function(){var reassessReasonContext=$('#'+$scope.$parent.context+'-hi-rcp-reassess-reason');if(reassessReasonContext.is(':visible')){$scope.reassessEndDate='';$scope.reassessReason='';reassessReasonContext.hide();$scope.releaseLockHI()}};$scope.resetReassess=function(){$scope.reassessEndDate=''};$scope.acquireLockHI=function(formname,id,option){lockObjHI={formName:formname,uniqueKey:formname+id,g_cancel:false,strKey:"",isOpenform:false};acquireFormLock(lockObjHI,function(){if(lockObjHI.g_cancel){if(option===1){releaseLockForHIAlerts=false;$scope.closeHiRcpDisagreePopup();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide()}else if(option===2){releaseLockForHIAlerts=false;$scope.closeHiRcpReassessPopup();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide()}else if(option===3){releaseLockForHIAlerts=false;$scope.closeHiRcpResolvedPopup();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide()}else if(option===4){releaseLockForHIAlerts=false;$scope.closeHiRcpReasonOnHandIcon()}else if(option===5){releaseLockForHIAlerts=false;$scope.closeHiICDPopup()}else if(option===6){$scope.closeAddNotesPopUp(false)}else if(option===7){releaseLockForHIAlerts=false;$scope.closeHospicePopUpView()}else if(option===8){releaseLockForHIAlerts=false;$scope.cancelHospiceWarningPopUpView()}}});return lockObjHI.g_cancel};$scope.releaseLockHI=function(){if(!releaseLockForHIAlerts)return;if(lockObjHI.strKey!==""&&lockObjHI.strKey!==null&&lockObjHI.strKey!==undefined){if(!isLockMine2(lockObjHI)){}}releaseFormLock(lockObjHI);$scope.lockObjHI={}};$scope.openProgressnotePopup=function(encid){$scope.hiSelectedEncId=encid;PSACService.checkBothStaffAndChartPermission($scope.patientid,encid,"","",$scope.viewEncounter)};const bottomPanelPrintNoCallback=function(){};const bottomPanelPrintYesCallback=function(response){var hIPreviewContent=$('#hipreviewContent');hIPreviewContent.html("");hIPreviewContent.html(removeScriptTags(response));$("#hipreviewDialogApp").modal('show');$(".modal-backdrop").css('position','relative');if(hIPreviewContentPerfectScrollbar){hIPreviewContentPerfectScrollbar.update()}else{hIPreviewContentPerfectScrollbar=new PerfectScrollbar('#hipreviewContent')}};$scope.viewEncounter=function(){var varUrl=makeURL('/mobiledoc/jsp/catalog/xml/printChartOptions.jsp?FormData=Default&isHtml=true&style=Default&encounterID='+$scope.hiSelectedEncId);$scope.hititle="Lock Preview";PSACService.callPrintChartOptions(varUrl,$scope.hiSelectedEncId,'','',$scope.patientid,bottomPanelPrintYesCallback,bottomPanelPrintNoCallback,'1')};$scope.closeHiRcpPreviewDialog=function(){$('#hipreviewDialogApp').modal('hide');var hIPreviewContent=$('#hipreviewContent');if(hIPreviewContentPerfectScrollbar){hIPreviewContentPerfectScrollbar.destroy();hIPreviewContentPerfectScrollbar=null}hIPreviewContent.html("")};$scope.openHIPrintDialog=function(){var windowContent=$('#hipreviewContent').html();$('<iframe id="myFrame" name="myFrame">').appendTo('body');var doc=$("#myFrame")[0].contentWindow.document;doc.open();doc.write(windowContent);doc.close();hiBottomPanelOnReadyState2()};const hiBottomPanelOnReadyState2=function(){try{printPNTimer=$timeout(function(){var hiTimeOut=0;if(window.frames["myFrame"].window.document.readyState==="complete"){window.frames["myFrame"].focus();window.frames["myFrame"].print()}else{hiTimeOut++;if(hiTimeOut>150){notification.show('error','Notification','Could Not Load the Requested page,try again!',DEFAULT_NOTIFICATION_TIMEOUT);return false}hiBottomPanelOnReadyState2()}},200)}catch(e){}};$scope.reassessAlert=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHiRcpReassessPopup();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();return}if($scope.reassessEndDate&&$scope.reassessReason){if(new Date($scope.reassessEndDate)>new Date){$scope.updatePdxActionTaken(2)}else{notification.show('error','Notification','Please select proper reassess date. reassess date should be future date.',DEFAULT_NOTIFICATION_TIMEOUT)}}else{notification.show('error','Notification','Please provide required inputs.',DEFAULT_NOTIFICATION_TIMEOUT)}};$scope.addDaysInEndDayDate=function(frequency,frequencyType){var date=new Date;if(frequencyType==='W'){date.setDate(date.getDate()+frequency*7)}else if(frequencyType==='M'){date.setMonth(date.getMonth()+frequency)}else if(frequencyType==='Y'){date.setDate(date.getDate()+frequency*365)}var strMonth=date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1;var strDate=date.getDate()<10?"0"+date.getDate():date.getDate();var strYear=date.getFullYear();var dateString=new Date(strMonth+"/"+strDate+"/"+strYear);$scope.reassessEndDate=dateString.format("mm/dd/yyyy")};$scope.validateLengthAndSplChar=function(fieldText,fieldLabelName,specialCharPattern,patternDesc,maxLength,minLength){var isValid=true;var splCharArray=[];var maxLengthArray=[];var minLengthArray=[];var maxValueArray=[];var minValueArray=[];var fieldTextLength=fieldText.length;if(maxLength>0&&fieldTextLength>maxLength){var maxLengthObj={};maxLengthObj.fieldLabelName=fieldLabelName;maxLengthObj.supportedFieldLength=maxLength;maxLengthObj.enteredFieldLength=fieldTextLength;maxLengthArray.push(maxLengthObj)}if(fieldTextLength<minLength){var minLengthObj={};minLengthObj.fieldLabelName=fieldLabelName;minLengthObj.supportedMinFieldLength=minLength;minLengthObj.enteredMinFieldLength=fieldTextLength;minLengthArray.push(minLengthObj)}if(specialCharPattern!=null&&""!==specialCharPattern.trim()){var unsupportedchars=validatePattern(atob(specialCharPattern).toString(),fieldText);unsupportedchars=unsupportedchars.trim();if(unsupportedchars.length>0){var splcharObj={};splcharObj.fieldLabelName=fieldLabelName;splcharObj.validCharacters=patternDesc;splcharObj.enteredCharacters=unsupportedchars;splCharArray.push(splcharObj)}}if(maxLengthArray.length>0||minLengthArray.length>0||splCharArray.length>0){$ocLazyLoad.load({name:'generateDTSPLModule',files:['/mobiledoc/jsp/webemr/datatruncationframework/js/generateDTSplValidationMsg.js']}).then(function(){$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/datatruncationframework/generateDTSplValidationMsg.html"),controller:'generateDTSPLValidationMsgController',windowClass:'app-modal-window bluetheme  medium-width',backdrop:"static",keyboard:false,resolve:{oMaxLengthObj:function(){return maxLengthArray},oMinLengthObj:function(){return minLengthArray},oSplCharObj:function(){return splCharArray},oMaxValueObj:function(){return maxValueArray},oMinValueObj:function(){return minValueArray},oTheme:function(){return"bluetheme"},modalClosedCallbackFn:function(){return null},oDataTypeObj:function(){return[]}}})});isValid=false}return isValid};const getICDListFromCode=function(elem,params,icddata){$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'getICDDescriptionFromCode',icdcode:params.icdcode,icddesc:params.icddecription,encounterid:$scope.encounterid,actionSource:ACTION_SOURCE_RIGHT_CHART_PANEL}),cache:false}).then(function(response){let isSameIcdDescriptionPresent=false;if(response.data&&response.data.status&&response.data.status==='success'){let availableIcdDescriptionList=response.data.availableIcdDescriptionList;if(availableIcdDescriptionList.action){preparePopupParams(elem,availableIcdDescriptionList,params,icddata);if(availableIcdDescriptionList.action==='2'){angular.forEach($scope.hiICDPopupParams.icdlist,function(value,key){if(value&&value.itemDesc&&params.icddecription&&params.icddecription.trim().toLowerCase()===value.itemDesc.trim().toLowerCase()){isSameIcdDescriptionPresent=true}})}if(response.data.assessedICD){$scope.hiICDPopupParams.assessmentICDListForCode=[];if(Object.keys(response.data.assessedICD.icdlist).length>0){angular.forEach(response.data.assessedICD.icdlist,function(value,key){let data={};data.itemid=key;data.itemDesc=value;$scope.hiICDPopupParams.assessmentICDListForCode.push(data)})}if($scope.hiICDPopupParams.assessmentICDListForCode.length===1){$scope.hiICDPopupParams.itemid=$scope.hiICDPopupParams.assessmentICDListForCode[0].itemid}}if(icddata&&HccFilterService.IsPresentInProblemList(icddata)){for(let i=$scope.hiICDPopupParams.icdlist.length-1;i>=0;i--){if(isPresentInProblemList(icddata.problemList,$scope.hiICDPopupParams.icdlist[i].itemid)){$scope.hiICDPopupParams.icdlist[i].isPresentInPL=true}else{if(isSameIcdDescriptionPresent&&params.icddecription.trim().toLowerCase()!==$scope.hiICDPopupParams.icdlist[i].itemDesc.trim().toLowerCase()||isPresentInAssessmentList($scope.hiICDPopupParams.assessmentICDListForCode,$scope.hiICDPopupParams.icdlist[i].itemid)){$scope.hiICDPopupParams.icdlist.splice(i,1)}}}}openICDInfoTooltip(elem,isSameIcdDescriptionPresent);$scope.acquireLockHI(formName,params.pdxid,5);releaseLockForHIAlerts=true}}else{if(response.data.message){notification.show('error','Notification',response.data.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Unable to get icd list.',DEFAULT_NOTIFICATION_TIMEOUT)}}},function(){notification.show('error','Notification','Unable to get icd list.',DEFAULT_NOTIFICATION_TIMEOUT)})};const checkIfICDExistsInPDList=function(pdxId){if($scope.PDList&&pdxId&&pdxId>0){for(let key in $scope.PDList){let data=$scope.PDList[key];if(data[0].potentialdxid&&data[0].potentialdxid===pdxId){return true}}}return false};$scope.validateICDAndAddToAssessment=function(elem,potentialdxid,itemid,potentialdx,potentialdxmessage,skipPNCheck,icdData){if($scope.validateLengthAndSplChar(potentialdxmessage,"ICD Description",'W15hLXpBLVowLTksYCEnLl9eOn4qXFxcXHxcLyIlJitAISQ9PyMoKTs8Pnt9XFtcXVxzXG4tXSo=','Characters found on a standard U.S. keyboard',255,1)){isProcessingICDFromPDList=checkIfICDExistsInPDList(icdData.potentialdxid);var params={};params.icdcode=potentialdx;params.icddecription=potentialdxmessage;params.encounterid=$scope.encounterid;params.patientid=$scope.patientid;params.pdxid=potentialdxid;if(skipPNCheck===true){params.skipPNCheck=true}params.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'validateICD',params:JSON.stringify(params)}),cache:false}).success(function(response){$('#divLoadingImg').hide();$scope.ICDElementPosition=elem;if(response&&response.status&&response.status==='success'){if(response.action){if(response.action==='1'){if(response.asssessmentStatus){if(response.asssessmentStatus==='success'){var problemlistParams={};problemlistParams.itemid=response.itemid;problemlistParams.icdcode=params.icdcode;problemlistParams.icddecription=params.icddecription;problemlistParams.icdversion=response.isValidICD10==='true'?'10':'9';problemlistParams.isItemIdPresentInPL=response.isItemIdPresentInPL;hiAddAssessmentSuccessHandler(problemlistParams)}else if(response.asssessmentStatus==='Invalid'){if(response.itemid){params.itemid=response.itemid;openHIICDValidationConfirmDialog(params)}}}}else if(response.action==='2'||response.action==='3'||response.action==='4'){preparePopupParams(elem,response,params,icdData);if(icdData&&HccFilterService.IsPresentInProblemList(icdData)){for(let i=0,len=$scope.hiICDPopupParams.icdlist.length;i<len;i++){if(isPresentInProblemList(icdData.problemList,$scope.hiICDPopupParams.icdlist[i].itemid)){$scope.hiICDPopupParams.icdlist[i].isPresentInPL=true}}}openICDInfoTooltip(elem,false);$scope.acquireLockHI(formName,params.pdxid,5);releaseLockForHIAlerts=true}}}else{if(response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)}}}).error(function(response){$('#divLoadingImg').hide();notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)})}};const preparePopupParams=function(elem,response,params,icdData){$scope.hiICDPopupParams={};$scope.hiICDPopupParams.actionType=response.action;$scope.hiICDPopupParams.icdcode=params.icdcode;$scope.hiICDPopupParams.icddecription=params.icddecription;$scope.hiICDPopupParams.pdxid=params.pdxid;$scope.hiICDPopupParams.payorname=icdData.payorname;$scope.hiICDPopupParams.icdData=icdData;if(response.action==='2'){$scope.hiICDPopupParams.icdlist=response.icdlist;$scope.hiICDPopupParams.source='eClinicalWorks ICD table'}else if(response.action==='3'){$scope.hiICDPopupParams.source='healow Insights'}else if(response.action==='4'){$scope.hiICDPopupParams.assessmentICDListForCode=[];if(Object.keys(response.icdlist).length>0){angular.forEach(response.icdlist,function(value,key){let data={};data.itemid=key;data.itemDesc=value;$scope.hiICDPopupParams.assessmentICDListForCode.push(data)})}if($scope.hiICDPopupParams.assessmentICDListForCode.length===1){$scope.hiICDPopupParams.itemid=$scope.hiICDPopupParams.assessmentICDListForCode[0].itemid}}};const isPresentInProblemList=function(problemList,itemid){for(let i=0,len=problemList.length;i<len;i++){if(parseInt(problemList[i].itemid,10)===parseInt(itemid,10)){return true}}return false};const isPresentInAssessmentList=function(assessmentList,itemid){if(assessmentList&&assessmentList.length){for(let i=0,len=assessmentList.length;i<len;i++){if(parseInt(assessmentList[i].itemid,10)===parseInt(itemid,10)){return true}}}return false};const hiAddAssessmentSuccessHandler=function(params){if(params.isItemIdPresentInPL&&params.isItemIdPresentInPL.toLowerCase()==='false'){addToProblemListPdx(params);$scope.getProblemList()}notification.show('success',params.icdcode,' added to Assessment.',DEFAULT_NOTIFICATION_TIMEOUT);updateHIRCPCurrentScrollPosition();refreshDashboard($scope.encounterid,$scope.patientid)};$scope.hiAddICDToAssessment=function(params){params.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'addAssessment',params:JSON.stringify(params)}),cache:false}).success(function(response){$scope.releaseLockHI();$('#divLoadingImg').hide();if(response&&response.status&&response.status==='success'){var problemlistParams={};problemlistParams.itemid=response.itemid;problemlistParams.icdcode=params.icdcode;problemlistParams.icddecription=params.icddecription;problemlistParams.icdversion=response.isValidICD10==='true'?'10':'9';problemlistParams.isItemIdPresentInPL=response.isItemIdPresentInPL;hiAddAssessmentSuccessHandler(problemlistParams)}else{if(response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)}}}).error(function(response){$scope.releaseLockHI();$('#divLoadingImg').hide();notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)})};const openHIICDValidationConfirmDialog=function(params){var yesCallback=function(){$scope.hiAddICDToAssessment(params)};ecwConfirm("ICD Code: "+params.icdcode+" not active or non billable for Encounter Date. Do you want to choose this anyway?",'eClinicalWorks',yesCallback,null,'','',true,'Yes','No','zindex-bootstrap',false)};$scope.createICDCode=function(params){params.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'createICD',params:JSON.stringify(params)}),cache:false}).success(function(response){$('#divLoadingImg').hide();$scope.releaseLockHI();if(response.status&&response.status==='success'){if(response.asssessmentStatus){if(response.asssessmentStatus==='success'){var problemlistParams={};problemlistParams.itemid=response.itemid;problemlistParams.icdcode=params.icdcode;problemlistParams.icddecription=params.icddecription;problemlistParams.icdversion=response.isValidICD10==='true'?'10':'9';problemlistParams.isItemIdPresentInPL=response.isItemIdPresentInPL;hiAddAssessmentSuccessHandler(problemlistParams)}else if(response.asssessmentStatus==='Invalid'){if(response.itemid){params.itemid=response.itemid;openHIICDValidationConfirmDialog(params)}}}else{notification.show('error','Notification',response.message?response.message:'Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)}}else{if(response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)}}}).error(function(response){$scope.releaseLockHI();$('#divLoadingImg').hide();notification.show('error','Notification','Unable to add assessment.',DEFAULT_NOTIFICATION_TIMEOUT)})};const setNewICDpopupData=function(elem){$scope.openPDxRecordId=$scope.hiICDPopupParams.pdxid;$("#icdTooltipTitle").text("ICD Code");$("#hiICDTextHeader").text("ICD Code Mismatch");$("#hiICDText").text("- The selected ICD code could not be found in your eCW database. Click okay to add the code and description as it appears(Code/Description will be added to ICD table.) Click cancel and this ICD will not be added to the assessment section of the progress note.");$("#hiIcdCode").text($scope.hiICDPopupParams.icdcode);$("#hiIcdDescription").text($scope.hiICDPopupParams.icddecription);$("#hiICDSourceName").text($scope.hiICDPopupParams.source);var _that=angular.element(elem.target);$('.hi-pdx-icd-tooltip').show().animate({},100,function(){$(this).position({of:_that,my:'left top',at:'left+25 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};const setAvailableICDpopupData=function(elem,showOnlyPLWithCurrent){$scope.openPDxRecordId=$scope.hiICDPopupParams.pdxid;$("#icdTooltipTitle").text("ICD Description Reconciliation");if(showOnlyPLWithCurrent){$("#hiICDTextHeader").text();$("#hiICDText").html("ICD code is already present in Assessment List or Problem List with different description as per below. <br/>Select one of the option(s) below to proceed")}else{$("#hiICDTextHeader").text("ICD Description Reconciliation");$("#hiICDText").text("- The selected ICD code's description is not available in your eCW database. Click OK to add the code and description from your eCW ICD database. Click cancel and this ICD will not be added to the assessment section of the progress note.")}$("#hiIcdCode").text($scope.hiICDPopupParams.icdcode);$("#hiIcdDescription").text($scope.hiICDPopupParams.icddecription);$("#hiICDSourceName").text($scope.hiICDPopupParams.source);var _that=angular.element(elem.target);$('.hi-pdx-icd-tooltip').show().animate({},100,function(){$(this).position({of:_that,my:'left top',at:'left+25 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};const setDataForCodePresentInPN=function(elem){$scope.openPDxRecordId=$scope.hiICDPopupParams.pdxid;$("#icdTooltipTitle").text("ICD Description Reconciliation");$("#hiICDTextHeader").text("");$("#hiICDText").html("ICD code is already present in Assessment List with different description as per below. <br/>Select one of the option(s) below to proceed");$("#hiIcdCode").text($scope.hiICDPopupParams.icdcode);$("#hiIcdDescription-1").text($scope.hiICDPopupParams.icddecription);$("#hiICDSourceName").text($scope.hiICDPopupParams.source);var _that=angular.element(elem.target);$('.hi-pdx-icd-tooltip').show().animate({},100,function(){$(this).position({of:_that,my:'left top',at:'left+25 top-8',collision:"flipfit"}).animate({"opacity":1},100)})};const openICDInfoTooltip=function(elem,showOnlyPLWithCurrent){if($scope.hiICDPopupParams.actionType==='2'){setAvailableICDpopupData(elem,showOnlyPLWithCurrent)}else if($scope.hiICDPopupParams.actionType==='3'){setNewICDpopupData(elem)}else if($scope.hiICDPopupParams.actionType==='4'){setDataForCodePresentInPN(elem)}};$scope.closeHiICDPopup=function(){$scope.releaseLockHI();$scope.openPDxRecordId='';$(".hi-pdx-icd-tooltip").hide()};$scope.getExistingICD=function(elem){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHiICDPopup();return}$scope.validateICDAndAddToAssessment(elem,$scope.hiICDPopupParams.pdxid,0,$scope.hiICDPopupParams.icdcode,$scope.hiICDPopupParams.icddecription,true,$scope.hiICDPopupParams.icdData)};$scope.okICDPopupAction=function(){if(!isLockMine2(lockObjHI)){releaseLockForHIAlerts=false;$scope.closeHiICDPopup();return}var params={};params.icdcode=$scope.hiICDPopupParams.icdcode;params.encounterid=$scope.encounterid;params.patientid=$scope.patientid;params.pdxid=$scope.hiICDPopupParams.pdxid;params.shouldUpdateEncDetail=$scope.hiICDPopupParams.shouldUpdateEncDetail;if($scope.hiICDPopupParams.actionType==='2'){params.itemid=$scope.hiICDPopupParams.itemid;angular.forEach($scope.hiICDPopupParams.icdlist,function(value,key){if(value.itemid===$scope.hiICDPopupParams.itemid){params.icddecription=value.itemDesc}});$scope.hiAddICDToAssessment(params)}else if($scope.hiICDPopupParams.actionType==='3'){params.icddecription=$scope.hiICDPopupParams.icddecription;$scope.createICDCode(params)}else if($scope.hiICDPopupParams.actionType==='4'){if($scope.hiICDPopupParams.itemid===-1){$scope.getExistingICD($scope.ICDElementPosition)}else{params.itemid=$scope.hiICDPopupParams.itemid;angular.forEach($scope.hiICDPopupParams.assessmentICDListForCode,function(value,key){if(value.itemid===$scope.hiICDPopupParams.itemid){params.icddecription=value.itemDesc}});$scope.hiAddICDToAssessment(params)}}$(".hi-pdx-icd-tooltip").hide()};const addToProblemListPdx=function(problemlistParams){var hs={id:problemlistParams.itemid,medicalcode:problemlistParams.icdcode,snowMedCode:"",name:problemlistParams.icddecription,specify:"",notes:"",OnsetDate:"",axis:"",dxType:0,risk:"",primary:0,ICDData:undefined,icdversion:problemlistParams.icdversion};$scope.addNewProblem(hs)};const callService=function(callAction,actionParams,callback){actionParams.alertId=$scope.openPDxRecordId;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/worklists/controller/HIPdxController.jsp'),data:$.param({action:callAction,params:JSON.stringify(actionParams)}),cache:false}).success(function(response){$('#divLoadingImg').hide();if("success"===response.status){if(callAction!=='addtoAssessment'){updateHIRCPCurrentScrollPosition();$scope.getHiRcpPotentialDxList(false)}$scope.closeHiRcpResolvedPopup();$('#'+$scope.$parent.context+'-resolved-data').hide();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.closeHiRcpDisagreePopup();$scope.closeHiRcpReassessPopup();callback()}else if(response&&response.status==='unauthorized'){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else if(response.message){notification.show('error','Notification',response.message,DEFAULT_NOTIFICATION_TIMEOUT)}else{notification.show('error','Notification','Error occurred while saving action for selected Potential Diagnosis',DEFAULT_NOTIFICATION_TIMEOUT)}}).error(function(response){$('#divLoadingImg').hide();notification.show('error','Notification','An error occurred while updating alert status.',DEFAULT_NOTIFICATION_TIMEOUT)})};const disagreeAlertCallback=function(){$scope.clearDisagreeReason();notification.show('success','Notification','Data Updated successfully.',DEFAULT_NOTIFICATION_TIMEOUT);$scope.releaseLockHI()};const reassessAlertCallback=function(){$scope.reassessEndDate='';$scope.reassessReason='';notification.show('success','Notification','Data Updated successfully.',DEFAULT_NOTIFICATION_TIMEOUT);$scope.releaseLockHI()};const resolveAlertCallback=function(){$scope.clearResolveReason();notification.show('success','Notification','Data Updated successfully.',DEFAULT_NOTIFICATION_TIMEOUT);$scope.releaseLockHI()};$scope.updatePdxActionTaken=function(actionTaken){if(!isLockMine2(lockObjHI)){if(actionTaken===1){releaseLockForHIAlerts=false;$scope.closeHiRcpDisagreePopup()}else if(actionTaken===2){releaseLockForHIAlerts=false;$scope.closeHiRcpReassessPopup()}else if(actionTaken===3){releaseLockForHIAlerts=false;$scope.closeHiRcpResolvedPopup()}$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();return}if($scope.openPDxRecordId){var actionParams={};actionParams.oldStatus=$scope.currentStatusCipc;actionParams.actionSource=ACTION_SOURCE_RIGHT_CHART_PANEL;if(actionTaken===1){var pDxDisagreeReason=$('#pDxDisagreeReason').val().trim();if(pDxDisagreeReason){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_pdx_disagree',$scope.$parent.context+'-hi-rcp-disagree-reason','bluetheme');if(checkFieldLength){actionParams.actionName='User Disagrees with Condition';actionParams.actionValueType='Disagree';actionParams.actionValue=pDxDisagreeReason;callService('disagreeAlert',actionParams,disagreeAlertCallback)}}else{notification.show('error','Notification','Disagree reason is mandatory.',DEFAULT_NOTIFICATION_TIMEOUT)}}else if(actionTaken===2){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_pdx_reassess',$scope.$parent.context+'-hi-rcp-reassess-reason','bluetheme');if(checkFieldLength){actionParams.actionName='Alert scheduled for Reassessment';actionParams.reassessEndDate=$scope.reassessEndDate;actionParams.actionValueType='Reassess';actionParams.actionValue=$scope.reassessReason;callService('updateToReassessAlert',actionParams,reassessAlertCallback)}}else if(actionTaken===3){var pDxResolvedReason=$('#pDxResolvedReason').val().trim();if(pDxResolvedReason){var checkFieldLength=dataTruncUtilityService.getTextFieldWidthsFromTable('web_hi_rcp_pdx_resolve',$scope.$parent.context+'-hi-rcp-resolved-reason','bluetheme');if(checkFieldLength){actionParams.actionName='User Marks Condition as Resolved';actionParams.actionValueType='Resolved';actionParams.actionValue=pDxResolvedReason;callService('resolve',actionParams,resolveAlertCallback)}}else{notification.show('error','Notification',"Resolved reason is mandatory",DEFAULT_NOTIFICATION_TIMEOUT)}}}else{notification.show('error','Notification','Please select a valid potential diagnosis from the available list',DEFAULT_NOTIFICATION_TIMEOUT)}};$scope.showKeywords=function(type){$scope.hiRcpKeywordsModal=true;$scope.hiRcpSearchKey={value:''};$scope.hiRcpKeywords={items:[],module:'',maxcount:'',selectedItems:[],favorite:'',notes:''};$scope.hiRcpKeywords.module='Messages';$scope.hiRcpKeywords.maxcount='20';$scope.hiRcpKeywords.currentIndex='1';$scope.hiRcpKeywords.favorite='';$scope.hiRcpKeywords.notes='';$scope.popupType=type;if(type==='disagree'&&$("#pDxDisagreeReason").val()){$scope.hiRcpKeywords.notes=$("#pDxDisagreeReason").val()+' '}else if(type==='resolve'&&$("#pDxResolvedReason").val()){$scope.hiRcpKeywords.notes=$("#pDxResolvedReason").val()+' '}else if(type==='PendingDisagree'&&$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val()){$scope.hiRcpKeywords.notes=$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val()+' '}else if(type==='comment'&&$("#"+$scope.$parent.context+"-pdxNewComment").val()){$scope.hiRcpKeywords.notes=$("#"+$scope.$parent.context+"-pdxNewComment").val()+' '}else if(type==='hospice'&&$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val()){$scope.hiRcpKeywords.notes=$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val()+' '}var url=makeURL("/mobiledoc/jsp/catalog/xml/getChildNodes2.jsp?keyName="+$scope.hiRcpKeywords.module+"&Options=1&SortBy=ItemName&itemName=&counter=1&MAXCOUNT="+$scope.hiRcpKeywords.maxcount);var data=getCachedData(url,$scope.hiRcpKeywords.module);var x2js=new X2JS;var jsonData=x2js.xml_str2json(data);var value=jsonData.Envelope.Body['return'].item;if(value){if(value.length>0){$scope.hiRcpKeywords.items=value}else{$scope.hiRcpKeywords.items.push(value)}}$("#"+$scope.$parent.context+"-hi-rcp-keywords").modal()};$scope.saveHIDirectiveCheck=function(){if($scope.popupType==='disagree'){$scope.pDxDisagreeReason=''+$scope.hiRcpKeywords.notes}else if($scope.popupType==='resolve'){$scope.pDxResolvedReason=$scope.hiRcpKeywords.notes}else if($scope.popupType==='PendingDisagree'){$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val($scope.hiRcpKeywords.notes+'')}else if($scope.popupType==='comment'){$("#"+$scope.$parent.context+"-pdxNewComment").val($scope.hiRcpKeywords.notes+'');$scope.disableCommentOk()}else if($scope.popupType==='hospice'){$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val($scope.hiRcpKeywords.notes+'').trigger('input')}hideKeyWords()};$scope.hiRcpCancelDirectiveCheck=function(){removeAllCachedURL($scope.hiRcpKeywords.module);hideKeyWords()};const hideKeyWords=function(){$scope.hiRcpSearchKey={value:''};$scope.hiRcpKeywords={items:[],module:'',maxcount:'',selectedItems:[],favorite:'',notes:''};$scope.hiRcpKeywordsModal=false;$scope.popupType='';$("#"+$scope.$parent.context+"-hi-rcp-keywords").modal('hide')};$scope.spellChecking=function(type){if(type==='disagree'){$scope.spellCheckOnElement='pDxDisagreeReason';$scope.hiRcpSpellCheckObj={misSpelledText:$scope.pDxDisagreeReason,correctedSpellText:"",spellCheckOnElement:'pDxDisagreeReason'}}else if(type==='resolve'){$scope.spellCheckOnElement='pDxResolvedReason';$scope.hiRcpSpellCheckObj={misSpelledText:$scope.pDxResolvedReason,correctedSpellText:"",spellCheckOnElement:'pDxResolvedReason'}}else if(type==='PendingDisagree'){$scope.spellCheckOnElement=$scope.$parent.context+'-pDxPendingDisagreeReason';$scope.hiRcpSpellCheckObj={misSpelledText:$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val(),correctedSpellText:"",spellCheckOnElement:$scope.$parent.context+'-pDxPendingDisagreeReason'}}else if(type==='hospice'){$scope.spellCheckOnElement=$scope.$parent.context+"-pDxHospiceDisagreeReason";$scope.hiRcpSpellCheckObj={misSpelledText:$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val(),correctedSpellText:"",spellCheckOnElement:$scope.$parent.context+"-pDxHospiceDisagreeReason"}}else if(type==='comment'){$scope.spellCheckOnElement=$scope.$parent.context+"-pdxNewComment";$scope.hiRcpSpellCheckObj={misSpelledText:$("#"+$scope.$parent.context+"-pdxNewComment").val(),correctedSpellText:"",spellCheckOnElement:$scope.$parent.context+"-pdxNewComment"}}$scope.hiRcpSpellCheckFlag=true;$scope.spellCheckType=type};$scope.hiRcpApplySpellChecking=function(){$scope.hiRcpSpellCheckFlag=false;var elementId=$scope.spellCheckOnElement;if(elementId){if($scope.spellCheckType==='disagree'){$scope.pDxDisagreeReason=$scope.hiRcpSpellCheckObj.correctedSpellText}else if($scope.spellCheckType==='resolve'){$scope.pDxResolvedReason=$scope.hiRcpSpellCheckObj.correctedSpellText}else if($scope.spellCheckType==='PendingDisagree'){$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val($scope.hiRcpSpellCheckObj.correctedSpellText)}else if($scope.spellCheckType==='hospice'){$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val($scope.hiRcpSpellCheckObj.correctedSpellText).trigger('input')}else if($scope.spellCheckType==='comment'){$("#"+$scope.$parent.context+"-pdxNewComment").val($scope.hiRcpSpellCheckObj.correctedSpellText)}}$scope.spellCheckType=''};$scope.clearReason=function(type){if(type==='disagree'&&$("#pDxDisagreeReason").val()){ecwConfirm('Are you sure want to clear the Reason?','',$scope.clearDisagreeReason)}else if(type==='resolve'&&$("#pDxResolvedReason").val()){ecwConfirm('Are you sure want to clear the Reason?','',$scope.clearResolveReason)}else if(type==='PendingDisagree'&&$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val()){ecwConfirm('Are you sure want to clear the Reason?','',$scope.clearPendingDisagreeReason)}else if(type==='hospice'&&$("#"+$scope.$parent.context+"-pDxHospiceDisagreeReason").val()){ecwConfirm('Are you sure want to clear the Hospice Notes?','',$scope.clearHospiceReason)}else if(type==='comment'&&$("#"+$scope.$parent.context+"-pdxNewComment").val()){ecwConfirm('Are you sure want to clear the HCC Comment?','',$scope.clearComment)}};$scope.closeHiRcpDisagreePopup=function(){var disagreeReasonContext=$('#'+$scope.$parent.context+'-hi-rcp-disagree-reason');if(disagreeReasonContext.is(':visible')){$scope.clearDisagreeReason();disagreeReasonContext.hide();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.releaseLockHI()}};$scope.closeHiRcpResolvedPopup=function(){var resolvedReasonContext=$('#'+$scope.$parent.context+'-hi-rcp-resolved-reason');if(resolvedReasonContext.is(':visible')){$scope.clearResolveReason();resolvedReasonContext.hide();$('.'+$scope.$parent.context+'-diagnosis-alerts-popup-selector').hide();$scope.releaseLockHI()}};$scope.clearDisagreeReason=function(){$("#pDxDisagreeReason").val('');$scope.pDxDisagreeReason=''};$scope.clearResolveReason=function(){$("#pDxResolvedReason").val('');$scope.pDxResolvedReason=''};$scope.clearHospiceReason=function(){$('#'+$scope.$parent.context+'-pDxHospiceDisagreeReason').val("").trigger('input');$('#'+$scope.$parent.context+'-pDxHospiceDate').val("").trigger('input')};$scope.clearPendingDisagreeReason=function(){$("#"+$scope.$parent.context+"-pDxPendingDisagreeReason").val('')};$scope.clearComment=function(){$('textarea[id='+$scope.$parent.context+"-pdxNewComment"+']').val('');$scope.disableCommentOk()};var clinicalstatus=[{option:'All',value:0},{option:'All Active',value:1},{option:'Well Controlled',value:2},{option:'Stable',value:3},{option:'Poorly Controlled',value:4},{option:'Resolved',value:5},{option:'Inactive',value:6},{option:'Recurrence',value:7},{option:'Remission',value:8}];var mdlclstatus=clinicalstatus[0];var dxtype=[{option:'All',value:0},{option:'Acute Dx',value:1},{option:'Chronic Dx',value:2}];var mdldxType=dxtype[0];$scope.problems=[];$scope.getProblemList=function(){$scope.problems=[];var param={ptid:$scope.patientid,DxType:mdldxType.value,Clinicalstatus:mdlclstatus.value,RowSort:"asc",SortText:""};var response=urlPost('/mobiledoc/jsp/catalog/xml/getProblemList.jsp',param);if(response!=null&&response.trim()!==''){var x2js=new X2JS;var jsonData=x2js.xml_str2json(response.trim());var value=jsonData.Envelope.Body["return"].FIELDS;if(value!=null){if(value instanceof Array){$scope.problems=value}else{$scope.problems.push(value)}angular.forEach($scope.problems,function(item){item.selected="";item.selectedType="";item.selectedWuStatus="";if(item.onsetdate==='0001-01-01'){item.onsetdate=''}})}else{$scope.problems=[]}}};$scope.addNewProblem=function(obj){var strdate=moment().format('MM/DD/YYYY');var pljson={};pljson.icdversion=obj.icdversion===undefined?"":obj.icdversion;pljson.itemid=obj.id===undefined?0:obj.id;pljson.itemcode=obj.medicalcode===undefined?"":obj.medicalcode;pljson.itemname=obj.name===undefined?"":obj.name;pljson.specify=obj.specify===undefined?"":obj.specify;pljson.notes=obj.notes===undefined?"":obj.notes;pljson.encounterid=-1;pljson.onsetdate=obj.onsetdate===undefined?"":obj.onsetdate;pljson.userid=obj.userid===undefined?$scope.trUserId:obj.userid;pljson.snowMedCode=obj.snowMedCode===undefined?"":obj.snowMedCode;pljson.AddedDate=obj.AddedDate===undefined?strdate:obj.AddedDate;pljson.logdate=obj.logdate===undefined?strdate:obj.logdate;pljson.wustatus=obj.wustatus===undefined?"confirmed":obj.wustatus;pljson.condition=obj.condition===undefined?"":obj.condition;pljson.risk=obj.risk===undefined?"":obj.risk;pljson.resolvedon=obj.resolvedon===undefined?"":obj.resolvedon;pljson.problemtype=obj.problemtype===undefined?"":obj.problemtype;pljson.selected=obj.selected===undefined?"":obj.selected;pljson.selectedType=obj.selectedType===undefined?"":obj.selectedType;pljson.PrimServiceLoc=obj.PrimServiceLoc===undefined?"":obj.PrimServiceLoc;pljson.inactiveFlag=obj.inactiveFlag===undefined?"":obj.inactiveFlag;pljson.severity=obj.severity===undefined?"":obj.severity;pljson.reqmapping=obj.reqmapping===undefined?"":obj.reqmapping;var dup_entry=0;angular.forEach($scope.problems,function(item){if(item.itemcode===obj.code&&item.itemname===obj.name){$scope.showAlert("ICD already exists");dup_entry=1}});if(dup_entry!==1){$scope.problems.push(pljson);callToSetProblemList($scope.problems)}};const callToSetProblemList=function(modRows){var xw=new XMLWriter;startSoapPacket(xw);angular.forEach(modRows,function(ItemId){var itemid=ItemId.itemid;xw.writeStartElement('item');xw.writeAttributeString('xsi:type','xsd:string');addElement(xw,'logtime',moment().format('HH:mm:ss'),'xsi:type','xsd:string');addElement(xw,'asmtId',itemid,'xsi:type','xsd:string');var icode=ItemId.itemcode;addElement(xw,'code',icode,'xsi:type','xsd:string');var itype="";if(ItemId.SelType!==undefined){itype=ItemId.SelType.option}addElement(xw,'probtype',itype,'xsi:type','xsd:string');var iname=ItemId.itemname;addElement(xw,'name',"<![CDATA["+iname+"]]>",'xsi:type','xsd:string');var ispc=ItemId.specify;addElement(xw,'specify',"<![CDATA["+ispc+"]]>",'xsi:type','xsd:string');var onsetdate=ItemId.onsetdate;addElement(xw,'onsetdate',onsetdate,'xsi:type','xsd:string');var logdate=ItemId.logdate;addElement(xw,'logdate',logdate,'xsi:type','xsd:string');var addeddate=ItemId.AddedDate;addElement(xw,'AddedDate',addeddate,'xsi:type','xsd:string');var snowMedCode=ItemId.snowMedCode;addElement(xw,'snowMedCode',snowMedCode,'xsi:type','xsd:string');var notes=ItemId.notes;addElement(xw,'notes',"<![CDATA["+notes+"]]>",'xsi:type','xsd:string');var wustatus="";if(ItemId.SelWuStatus!==undefined){wustatus=ItemId.SelWuStatus.option}addElement(xw,'WUStatus',wustatus,'xsi:type','xsd:string');var condition="";if(ItemId.selected!==undefined&&ItemId.selected.option!==undefined){condition=ItemId.selected.option}if(wustatus!=='confirmed')condition="";addElement(xw,'condition',condition,'xsi:type','xsd:string');var resolveddate=ItemId.resolvedon;addElement(xw,'resolveddate',resolveddate,'xsi:type','xsd:string');var modBy=ItemId.userid;addElement(xw,'modifiedby',modBy,'xsi:type','xsd:string');var risk="";if(ItemId.risk!==undefined){risk=ItemId.risk}addElement(xw,'risk',risk,'xsi:type','xsd:string');xw.writeEndElement()});var xml="";endSoapPacket(xw);xml=xw.flush();var param={FormData:xml,patientId:$scope.patientid,encounterId:$scope.encounterid,dbEncId:$scope.dbencid,TrUserId:$scope.trUserId};var strHiProblemXMLResponse=urlPost('/mobiledoc/jsp/catalog/xml/setProblemList.jsp',param);var x2js=new X2JS;var strHiProblemJsonData=x2js.xml_str2json(strHiProblemXMLResponse).Envelope.Body["return"];if("SUCCESS"!==strHiProblemJsonData.status.trim().toUpperCase()){notification.show('error','Notification','Unable to add data into Problem List',DEFAULT_NOTIFICATION_TIMEOUT)}if(typeof $scope.applyFilters==="function"){$scope.applyFilters()}try{if(getItemKeyValue("EnableCCM").toUpperCase()==='YES'){if(typeof $scope.reloadCcmBand==="function"){$scope.reloadCcmBand()}else if(typeof $parent.reloadCcmBand==="function"){$parent.reloadCcmBand()}}}catch(e){}};const cleanUp=function(){$(".icon-inputcalender").off('click',hiWorklistsPdxCalendarClickHandler);$(document).off('mouseup',hiMouseUpHandler);if(rcpAttestationPerfectScrollbar){rcpAttestationPerfectScrollbar.destroy()}$("#"+$scope.$parent.context+"-hi-rcp-keywords").on('hidden.bs.modal',function(){$(this).data('bs.modal',null)});$('#hipreviewDialogApp').on('hidden.bs.modal',function(){$(this).data('bs.modal',null)});$templateCache.remove($scope.hiRCPPotentialConditionLogsUrl);removeScopePropertyAndMethod($scope);$timeout.cancel(printPNTimer);delete $scope.openHiRcpTreatmentModel;delete $scope.getFilteredDataByDate};$scope.$on('$destroy',cleanUp)};let hiOverviewDependencies=['oc.lazyLoad','ecw.dir.keywords','ecw.spellchecker','ecw.service.PSAC','ecw.datatruncUtilityModule','hiHospiceHccCommentService','ecw.component.hi.hcc.filter.service'];hiOverviewController.$inject=['$scope','$http','$ocLazyLoad','$templateCache','$modal','$timeout','PSACService','dataTruncUtilityService','hospiceCommentService','HccFilterService'];angular.module('hiOverviewModule',hiOverviewDependencies).controller('hiOverviewController',hiOverviewController);