(function(){let emarRxApp=angular.module('ecw.emarRx',['oc.lazyLoad','ui.bootstrap']);emarRxApp.component('emarRxComponent',{bindings:{emarRxs:'=',requestParam:'=',context:'=',selectCallBack:'&',favRefreshCallback:'&'},controller:['$http','$modal','$ocLazyLoad',emarRxController],controllerAs:'vm',templateUrl:"/mobiledoc/jsp/webemr/progressnotes/ecwrx/patientCentricDosing/emarRx/html/emarRx-tpl.html",transclude:true});function emarRxController($http,$modal,$ocLazyLoad){var vm=this;vm.selectedDrugIndex=-1;vm.emarOptions={administeredOrder:0,dispenseOrder:0,placeOrder:0};vm.showEmarOptions=function(index){vm.emarOptions={administeredOrder:0,dispenseOrder:0,placeOrder:0};if(vm.emarRxs[index].administerFlag===1||vm.emarRxs[index].administerFlag==='1'){vm.emarOptions.administeredOrder=1}if(vm.emarRxs[index].dispenseFlag===1||vm.emarRxs[index].dispenseFlag==='1'){vm.emarOptions.dispenseOrder=1}vm.selectedDrugIndex=index;vm.viewEmarOptions()};vm.viewEmarOptions=function(){$ocLazyLoad.load({name:'emarOrderOptions',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/patientCentricDosing/emarRx/emarOrderOptionsController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:'/mobiledoc/jsp/webemr/progressnotes/ecwrx/patientCentricDosing/emarRx/html/emarOrderOptions-tpl.html',controller:'emarOrderOptionsController as vm',size:'lg',windowClass:'w1300 orangetheme emarOrderOptions',backdrop:'static',keyboard:false,resolve:{emarOptions:function(){return vm.emarOptions}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(modalInstanceResponse!=='close'){vm.emarOptions=modalInstanceResponse;vm.selectDose(vm.selectedDrugIndex)}})})};vm.selectDose=function(index){let doseObj=vm.emarRxs[index];vm.selectCallBack({arg0:convertToResponseObj(doseObj)})};vm.openRxEdit=function(index){let doseObj=vm.emarRxs[index];doseObj.DispensableItemId=0;vm.openRxEditModal(convertToResponseObj(doseObj))};vm.openRxEditModal=function(doseObj){doseObj.context=vm.context;$ocLazyLoad.load({name:'RxEditModule',files:['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/js/RxEditController.js','/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.min.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/rx-editmodal.html'),controller:'RxEditCtrl',windowClass:'rxeditscreen bluetheme rx-topmargin',backdrop:"static",keyboard:false,resolve:{patientID:function(){return vm.requestParam.patientId},encounterID:function(){return vm.requestParam.encounterId},RxEditObject:function(){return doseObj},loginuserid:function(){return global.TrUserId},parentName:function(){return"RxQuickSearch"}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(!angular.isUndefined(modalInstanceResponse)&&typeof modalInstanceResponse==='object'){vm.selectCallBack({arg0:modalInstanceResponse})}else if(vm.favRefreshCallback){vm.favRefreshCallback()}})})};function convertToResponseObj(doseObj){var newObj={};newObj.AdministerFlag=doseObj.administerFlag;newObj.DispenseFlag=doseObj.dispenseFlag;newObj.rxFormulary='Y';newObj.AdministerFlagValue=vm.emarOptions.administeredOrder;newObj.DispenseFlagValue=vm.emarOptions.dispenseOrder;newObj.rxFormularyId=doseObj.rxFormularyId;newObj.IVHydration=doseObj.ivHydration;newObj.DrugNameId=doseObj.drugNameId;newObj.IVHydration=doseObj.ivHydration;newObj.IsRxSupplies=doseObj.rxSupplies||"NO";newObj.ItemId=doseObj.itemId;newObj.RxItemId=doseObj.itemId;newObj.drugName=doseObj.description;newObj.sItemName=doseObj.description;newObj.MMDCode=doseObj.mmdcode||"";newObj.ObsoleteDate=doseObj.obsoleteDate||"";newObj.awup="";newObj.controlled=doseObj.controlled||"";newObj.controlledCode=doseObj.controlledSubstanceCode||"";newObj.description=doseObj.description;newObj.dispense=doseObj.dispense||"";newObj.doseunit="";newObj.drugNameType=doseObj.drugNameType||"";newObj.drugOTC=doseObj.drugOTC||"";newObj.duration=doseObj.duration;newObj.favorite="0";newObj.formulation=doseObj.formulation;newObj.freq=doseObj.frequency;newObj.isCompound="0";if(doseObj.ndc==null){newObj.ndc='';newObj.NDC=''}else{newObj.ndc=doseObj.ndc;newObj.NDC=doseObj.ndc}newObj.refills=doseObj.refills||"";newObj.route=doseObj.route;newObj.strength=doseObj.strength;newObj.take=doseObj.take;newObj.AddInstructions="";if(vm.requestParam.dxId){newObj.assessId=vm.requestParam.dxId}else{newObj.assessId="0"}return newObj}}})();