class AppDragHandler{headerStyles=[".modal-header",".modal-content .orange-header",".modal-content .drk-blheader",".modal-content .os-blue-header"];activeHandlerIdMap={};dragHandlerMap={};constructor(){$(document).on("mouseover","div.bcrumb-blue-header:not([data-drag])",e=>this.handleBreadcrumbDrag.bind(this)(e));$(document).on("mouseover","div.bootstrap-dialog-header:not([data-drag])",e=>this.handleBootstrapDrag.bind(this)(e));$(document).on("show.bs.modal",e=>{this.onModalShow.bind(this)(e)});$(document).on("hide.bs.modal",e=>this.onModalHide.bind(this)(e))}setupActiveWindowHandler(modalElement){const windowHandlerId=this.getModalHandlerId(modalElement);this.activeHandlerIdMap[windowHandlerId]=e=>{if($(e.target).is(modalElement)){const overlay=$("<div class='activeWindowOverlay'></div>");$(e.target).find(".modal-content").prepend(overlay);let timeout=setTimeout(function(){$(".activeWindowOverlay").remove();clearTimeout(timeout)},500);e.stopPropagation();return false}};$(document).on(`click.${windowHandlerId}`,this.activeHandlerIdMap[windowHandlerId])}setupWindowBoundaryHandler(modalElement){const windowHandlerId=this.getModalHandlerId(modalElement);this.dragHandlerMap[windowHandlerId]=e=>this.onDragEnd(e.target);$(document).on(`dragstop.${windowHandlerId}`,this.dragHandlerMap[windowHandlerId])}handleDragImplementation(header,handleSelector,cancelSelector){$(header).attr("data-drag",1);const closestModalDialog=$(header).closest(".modal-dialog");this.setupDragHandler(closestModalDialog,{handle:handleSelector,cancel:cancelSelector});this.setCursorToMove($(header));this.setupActiveWindowHandler($(header).closest(".modal"))}getCustomDraggableSelectors(customSelector){const relevantSelectors=[customSelector,...this.headerStyles];const handleSelector=relevantSelectors.join(", ");const cancelSelector=relevantSelectors.map(s=>`${s} :not(div):not(span):not(h4)`).join(", ");return[handleSelector,cancelSelector]}handleBreadcrumbDrag(eventTarget){const[handleSelector,cancelSelector]=this.getCustomDraggableSelectors("div.bcrumb-blue-header");const clazz=this;$(eventTarget.target).each(function(){clazz.handleDragImplementation(this,handleSelector,cancelSelector);$(document).off("mouseover","div.bcrumb-blue-header[data-drag]",clazz.handleBreadcrumbDrag)})}handleBootstrapDrag(eventTarget){const[handleSelector,cancelSelector]=this.getCustomDraggableSelectors("div.bootstrap-dialog-header");const clazz=this;$(eventTarget.target).each(function(){clazz.handleDragImplementation(this,handleSelector,cancelSelector)})}getModalHeader(modalWindow){for(let style of this.headerStyles){const headerRef=$(modalWindow).find(style);if(headerRef.length>0){return headerRef}}return null}conditionallyHandleDrag(elTarget){const targetModal=$(elTarget).find(".modal-dialog");const targetModalIsDraggable=targetModal.hasClass("ui-draggable");if(!targetModalIsDraggable){this.setupDragHandler(targetModal,{handle:this.headerStyles.join(", ")});return true}return false}onModalShow(target){const elTarget=target.target;const header=this.getModalHeader(elTarget);if(header==null){return}if(elTarget.hasAttribute("drag-applied")){return}elTarget.setAttribute("drag-applied",1);elTarget.modalHandlerId=Date.now();this.setupActiveWindowHandler($(elTarget));this.setupWindowBoundaryHandler($(elTarget));this.setCursorToMove(header);if(this.conditionallyHandleDrag(elTarget)){this.adjustForOversizedWindowsOnShow(elTarget)}}adjustForOversizedWindowsOnDrag(elTarget,isDragging){if(isDragging){$(elTarget).closest(".modal").first().css({"overflow":"visible"})}else{const windowHeight=$(window).height();const modalHeight=$(elTarget).closest(".modal").first().find(".modal-content").first().height();if(modalHeight>=windowHeight){$(elTarget).closest(".modal").first().css({"overflow":"auto"})}}}adjustForOversizedWindowsOnShow(elTarget){$(elTarget).closest(".modal").first().css({"overflow":"auto"})}setCursorToMove(element){if(element.css("cursor")!=="move"){element.css({"cursor":"move"})}}setupDragHandler(modalTarget,options){const clazz=this;modalTarget.draggable({...options,cursor:"move",start:function(){clazz.adjustForOversizedWindowsOnDrag(this,true)},stop:function(){clazz.adjustForOversizedWindowsOnDrag(this,false)}})}onDragEnd(target){const OFFSET_VERTICAL=50;const OFFSET_HORIZONTAL=50;const MODAL_RECT=target.getBoundingClientRect();if(MODAL_RECT.y<0){$(target).offset({top:0})}else if(MODAL_RECT.y>$(window).height()-OFFSET_VERTICAL){$(target).offset({top:$(window).height()-OFFSET_VERTICAL})}if(MODAL_RECT.x<0&&Math.abs(MODAL_RECT.x)>MODAL_RECT.width-OFFSET_HORIZONTAL){$(target).offset({left:0-(MODAL_RECT.width-OFFSET_HORIZONTAL)})}else if(MODAL_RECT.x>$(window).width()-OFFSET_HORIZONTAL){$(target).offset({left:$(window).width()-OFFSET_HORIZONTAL})}}onModalHide(target){target.target.removeAttribute('drag-applied');const targetHandleId=this.getModalHandlerId(target.target);if(this.activeHandlerIdMap[targetHandleId]){$(document).off(`click.${targetHandleId}`,this.activeHandlerIdMap[targetHandleId]);delete this.activeHandlerIdMap[targetHandleId]}if(this.dragHandlerMap[targetHandleId]){$(document).off(`dragstop.${targetHandleId}`,this.dragHandlerMap[targetHandleId]);delete this.dragHandlerMap[targetHandleId]}}getModalHandlerId(element){if(element==null){return 0}else if(element.modalHandlerId!=null){return element.modalHandlerId}else if(element[0]!=null){return element[0].modalHandlerId||0}else{return 0}}}if(typeof exports!=="undefined"){module.exports=AppDragHandler}new AppDragHandler;