var rightPanelModule=angular.module('rightPanelModule',['oc.lazyLoad','ecw.service.EncDetailsService','ecw.service.PSAC','ecw.datatruncUtilityModule','InjectionDrugInteraction',getEhxCommonFuncsJsDependency(true)]);if(getItemKeyValue('prismaEnabled').toLowerCase()==='yes'){rightPanelModule.requires.push('mainPrismaApp')}rightPanelModule.controller('rpTabsCtrl',function rpTabsCtrl($scope,$sce,$http,$templateCache,$ocLazyLoad,EncDetailsService,$timeout,$attrs,$modal,PSACService,dataTruncUtilityService,injectionDrugInteractionService,$q){var context=$attrs.context;var patientId=$attrs.patientId;var encounterId=$attrs.encounterId;var patientdetails=$attrs.ptDetails;var callFrom=$attrs.callFrom;var x2js=new X2JS;var eN=$attrs.encounterId;var p=$attrs.patientId;var u=global.TrUserId;$scope.hasLastModifiedDateTime=false;$scope.displayPNAsmt="0";$scope.patientName="";$scope.uptodateURL="";$scope.isCalledFromEPrescription=callFrom==='ejellybean'||callFrom==='RxChange'?true:false;$scope.isPrismaEnabled=getItemKeyValue('prismaEnabled').toLowerCase()==='yes';$scope.showTemplatesWarning=false;$scope.setShowTemplatesWarning=function(value){$scope.showTemplatesWarning=value};$scope.mySettingsPermission=getPermission("MySettings",global.TrUserId);$scope.rcpAlerts=[];$scope.onClickTab=onClickTab;$scope.rcpUniqueId=(""+Math.random()).substring(2,6);$ocLazyLoad.load({name:'css',files:['/mobiledoc/jsp/webemr/rightpanel/css/rightpanel.css']});$scope.getPatientIdentifiers=function(){if(patientdetails){$scope.patientIdentifiers=JSON.parse(patientdetails);if(!angular.equals($scope.patientIdentifiers,{})){$scope.patientName=getPatientFullNameWithSuffix($scope.patientIdentifiers.lastName,$scope.patientIdentifiers.suffix,$scope.patientIdentifiers.firstName,$scope.patientIdentifiers.middleInitial);$scope.gender=$scope.patientIdentifiers.sex.substring(0,1).toUpperCase()}else{var patientInfo=getPatientInfo(patientId);$scope.patientName=patientInfo.namewithsuffix;$scope.gender=patientInfo.sex.substring(0,1).toUpperCase()}}else{$scope.patientIdentifiers={id:patientId};var patientInfo=getPatientInfo(patientId);$scope.patientName=patientInfo.namewithsuffix;$scope.gender=patientInfo.sex.substring(0,1).toUpperCase()}return $scope.patientIdentifiers};$scope.getPatientIdentifiers();$scope.rpanelPopupUrl='';$scope.mySettingsPopupUrl='';$scope.moduleid="";$scope.context=context;$scope.isCCMEnabled=getItemKeyValue("EnableCCM").toLowerCase()=='yes'?true:false;$scope.isCPOEnabled=getItemKeyValue("EnableCPO").toLowerCase()=='yes'?true:false;$scope.isRPMEnabled=getItemKeyValue("EnableRPM").toLowerCase()=='yes'?true:false;$scope.isAssignSNOMEDEnabled=getItemKeyValue("AssignSNOMED").toLowerCase()=='yes'?true:false;var rp=0;var strValue="";$scope.tabs=[];var $rcpTabsContainer;var $primaryTabs;var $tabListPopup;var rcpTabsTimout,pushToRcpAlertTimeout;if(getUserProfile("ProgressNotesTopPanel")=="0"&&(callFrom!=''&&callFrom=='obFlowsheet')){rp=$('html').height()-140}$scope.isResolutionStandard=false;if(window.innerWidth<1440){$scope.isResolutionStandard=true}else if(callFrom&&callFrom==='pnmodal'){if($('#pn').hasClass('responsive-pn')&&$('#pn').find('#mainPNDialog').width()<1400){$scope.isResolutionStandard=true}}if($scope.context==='telenc'&&!$('#smart-panel').is(':visible')){$scope.isResolutionStandard=false}$scope.setcontextbasedheight=function(){let topHeader=$('.right-panel').find('.right-panel-header').height();let tabsheight=$('.right-panel').find('.right-tabnav').height();let identifierHeight=$('.right-panel').find('.progress-nav').height();let ejelyAdjustScrollHeight=50;if($scope.hasLastModifiedDateTime){ejelyAdjustScrollHeight=60}switch($scope.context){case"progressnotes":adjustProgressNoteRcpHeight();$scope.moduleid="pnDashboard";break;case"patienthub":if(callFrom==='ejellybean'){adjustRcpHeight("#eRefill",".modal-body")}else if(callFrom==='RxChange'){adjustRcpHeight("#RxChangeMain",".modal-body")}else if(callFrom==='ePA'){adjustRcpHeight("#epaQuestionnaireDiv",".modal-body")}else{adjustRcpHeight("#patient_hub",".modal-body")}$scope.moduleid="patient_hub";break;case"dentalicw":adjustRcpHeight("#dentalExammodal",".modal-body",-31);$scope.moduleid="dentalExammodal";break;case"telenc":adjustRcpHeight("#TJellyDetailViewd",".approve-wrap");$scope.moduleid="TJellyDetailViewd";break;case"Treatment":adjustRcpHeight("html","#pnmodal-icw-div");$scope.moduleid="treatment-screen-popUp-FromPN";break;case"documents":adjustRcpHeight("#documentViewControllerId",".approve-wrap");$scope.moduleid="documentViewControllerId";break;case"LAB_RESULT_SCREEN":adjustRcpHeight("#LabReportController",".approve-wrap");$scope.moduleid="LabReportController";break;case"VIEW_ALL_REPORT":adjustRcpHeight("#viewAllReport-modal","#view-all-reports-content > .modal-body");$scope.moduleid="viewAllLabReportCriteriaCtrl";break;case"devicereportscreen":adjustRcpHeight("#devicereports",".view-report-pane");$scope.moduleid="devicereports";break;case"labapprovalscreen":adjustRcpHeight("#lab_approval_screen",".view-report-pane");$scope.moduleid="lab_approval_screen";break;case"aftercarescreen":adjustRcpHeight("#afterCareCTRL","#right-inplace12");$scope.moduleid="afterCareRightPanelId";break;case"healowHub":adjustRcpHeight("#HealowHub",".hub-modal-dialog",-40);$scope.moduleid="healowHub";break;case"phmHub":adjustRcpHeight("#phmHubView",".main-hra-content");$scope.moduleid="phmHubView";break;default:rp=$('html').height()-260-topHeader;$('.rightpanelscroll .accord-list').css('height',rp-0+'px')}};function adjustProgressNoteRcpHeight(){let initAdjustRCPHeight=function(){let rcpScrollViewTop=$('.right-panel .right-wrap  .rightpanelscroll .accord-list').offset().top;if(rcpScrollViewTop>0){doAdjustHeight();return}setTimeout(initAdjustRCPHeight,200)};let doAdjustHeight=function(){let $contentView=$('.right-panel .right-wrap .rightpanelscroll');let $scrollView=$contentView.find(".accord-list");let bottomPanelTop=$("#bottomPanelApp").offset().top;let rcpScrollViewTop=$scrollView.offset().top;let scrollViewHgt=bottomPanelTop-rcpScrollViewTop;scrollViewHgt-=parseInt($contentView.css("border-bottom-width"),10);$scrollView.css('height',scrollViewHgt+'px');$contentView.css('height',"auto")};initAdjustRCPHeight()}function adjustRcpHeight(parentScreenSelector,rcpWrapperSelector,optHeightAdjustment){optHeightAdjustment=optHeightAdjustment?optHeightAdjustment:0;const $rcpWrapper=$(parentScreenSelector).find(rcpWrapperSelector);let initAdjustRCPHeight=function(){let rcpScrollViewTop=$rcpWrapper.find('.rightpanelscroll .accord-list').offset().top;if(rcpScrollViewTop>0){doAdjustHeight();return}setTimeout(initAdjustRCPHeight,200)};let doAdjustHeight=function(){let $contentView=$rcpWrapper.find('.rightpanelscroll');let $scrollView=$contentView.find(".accord-list");let wrapperHgt=$rcpWrapper.height();let rcpHeaderTop=$rcpWrapper.find('.right-panel .right-panel-header').offset().top;let scrollViewTop=$scrollView.offset().top;let spaceAboveScrollView=scrollViewTop-rcpHeaderTop;let scrollViewHgt=wrapperHgt-spaceAboveScrollView;scrollViewHgt-=parseInt($contentView.css("border-bottom-width"),10);scrollViewHgt=scrollViewHgt+optHeightAdjustment;if(scrollViewHgt<150){scrollViewHgt=150}$scrollView.css('height',scrollViewHgt+'px');$contentView.css('height',"auto")};initAdjustRCPHeight()}$scope.setHeightandScroll=function(){$('.right-panel').find('.prisma-btn-default span').css({"font-size":"12px"});$scope.setcontextbasedheight();$scope.assigncontexttodivs()};$scope.encounterid=encounterId;$scope.patientid=patientId;$scope.callFrom=callFrom;var isocchealth=false;$scope.setrightpaneltabstodisplay=function(strValue){var values=strValue.split(',');if(0 in values)$scope.showOverview=$.trim(values[0]);else $scope.showOverview='1';if(7 in values)$scope.showDRTLM=$.trim(values[7]);else $scope.showDRTLM='1';if(1 in values)$scope.showHistory=$.trim(values[1]);else $scope.showHistory='1';if(2 in values)$scope.showCDSS=$.trim(values[2]);else $scope.showCDSS='1';if(3 in values)$scope.showOS=$.trim(values[3]);else $scope.showOS='1';if(5 in values)$scope.showTemplates=$.trim(values[5]);else $scope.showTemplates='1';if(8 in values)$scope.showDental=$.trim(values[8]);else $scope.showDental='1';if(9 in values)$scope.showBehavioralHealth=$.trim(values[9]);else $scope.showBehavioralHealth='1';if(10 in values)$scope.showPopHealth=$.trim(values[10]);else $scope.showPopHealth='1';$scope.showEncTab=11 in values?$.trim(values[11]):'1';if($scope.context==='progressnotes'){var rpEncObj=EncDetailsService.getEncDetailsByEncId($scope.encounterid);if(getItemKeyValue('EnableOccHealth').toLowerCase()==='yes'&&rpEncObj&&rpEncObj.occHealthVisitFlag){$scope.tabs.push({tabId:11,title:'Detail',url:'details_rp.jsp'});$scope.encounterDate=rpEncObj.encDate;$scope.encObj_OccHealth=rpEncObj;isocchealth=true}}if($scope.showOverview=='1')$scope.tabs.push({tabId:0,title:'Overview',url:'overview_rp.jsp'});if($scope.showEncTab==='1'){$scope.tabs.push({tabId:13,title:'Enc',url:'rcpEncounter.jsp'})}if($scope.showDRTLM=='1')$scope.tabs.push({tabId:1,title:'DRTLA',url:'patientDRTLM.jsp'});if($scope.showHistory=='1')$scope.tabs.push({tabId:2,title:'History',url:'patientHistories.jsp'});if($scope.showCDSS=='1')$scope.tabs.push({tabId:3,title:'CDSS',url:'patientCDSS.jsp'});if($scope.showOS=='1'&&!$scope.isCalledFromEPrescription&&callFrom!=='ePA'){$scope.displayPNAsmt="1";$scope.tabs.push({tabId:5,title:'OS',url:'orderSets_rp.jsp'})}if($scope.showTemplates=='1'&&!$scope.isCalledFromEPrescription&&callFrom!=='ePA')$scope.tabs.push({tabId:8,title:'Templates',url:'templates_rp.jsp'});if(getItemKeyValue('EnableDentalEMR').trim().toLowerCase()==='yes'&&getItemKeyValue('EnableDentalEMR',true)==='2'){if($scope.showDental==='1'){$scope.tabs.push({tabId:10,title:'Dental',url:'rpDental.jsp'})}}if(getItemKeyValue('BehavioralHealthModule').trim().toLowerCase()==='yes'){if($scope.showBehavioralHealth==='1'&&getPermission("HasAccessToBhTab",global.TrUserId)){$scope.tabs.push({tabId:11,title:'BH',url:'/mobiledoc/jsp/webemr/behavioralhealth/progressnote/views/rightChartPanelBehavioralHealth.html'})}}if(getItemKeyValue('EnableCorrectionalFeatures').trim().toLowerCase()==='yes')$scope.tabs.push({tabId:6,title:'CHS',url:'chsRightPanel.jsp'});if(($scope.context==='progressnotes'||$scope.context==='patienthub')&&(getItemKeyValue('ca_enabled').trim().toLowerCase()==='yes'||getItemKeyValue('ca_enabled').trim().toLowerCase()==='1'||getItemKeyValue('ca_acg_risk_enabled').trim().toLowerCase()==='yes'||'yes'===getItemKeyValue('commToExternalRegistries').trim().toLowerCase()||'yes'===getNonCachedItemKeyValue('pophealth_hedis')||'yes'===getItemKeyValue('enableACGRiskScore').trim().toLowerCase()||'yes'===getItemKeyValue('EnableRPM').trim().toLowerCase())){var tabPopHealthId=9;var tabPopHealth={tabId:tabPopHealthId,title:'PopHealth',url:'rpPopHealthView.jsp'};if($scope.showPopHealth==='1'){$scope.tabs.push(tabPopHealth)}}};var toggleActiveClass=function(){$(this).toggleClass('active')};$scope.assigncontexttodivs=function(){var obj=$('.right-panel');if($scope.moduleid!=""){obj=$('#'+$scope.moduleid)}obj.find('.listhead').each(function(){$(this).next().attr("id",$(this).next().attr('id')+'_'+$scope.context);$(this).find('a').attr("data-target",$(this).find('a').attr('data-target')+'_'+$scope.context);$(this).find('.icon-downrrow-white').attr("data-target",$(this).find('.icon-downrrow-white').attr('data-target')+'_'+$scope.context);$(this).find('.rcpicon-add').attr("data-target",$(this).find('.rcpicon-add').attr('data-target')+'_'+$scope.context)});$(".right-panel").off("click",'.listhead a');$(".right-panel").on("click",'.listhead a',toggleActiveClass);obj.find('.inner-listhead').each(function(){$(this).next().attr("id",$(this).next().attr('id')+'_'+$scope.context);$(this).find('a').attr("data-target",$(this).find('a').attr('data-target')+'_'+$scope.context);try{if($(this).find('i').attr('data-target')){$(this).find('i').attr("data-target",$(this).find('i').attr('data-target')+'_'+$scope.context)}}catch(e){}$(this).find('.collicon').attr("data-target",$(this).find('.collicon').attr('data-target')+'_'+$scope.context)});$(".right-panel").off("click",'.inner-listhead a');$(".right-panel").on("click",'.inner-listhead a',toggleActiveClass)};var params='?ptId='+$scope.patientid+'&pnencid='+$scope.encounterid+'&context='+$scope.context+'&TrUserId='+global.TrUserId;if(EncDetailsService.getProviderId()){params=params+'&providerId='+EncDetailsService.getProviderId()}strValue=getUserProfile("RPaneTabs");if((strValue!=null||strValue!=undefined)&&$.trim(strValue).length>0){$scope.setrightpaneltabstodisplay(strValue)}else{strValue=getUserProfile("rpanetabs");if((strValue!=null||strValue!=undefined)&&$.trim(strValue).length>0){$scope.setrightpaneltabstodisplay(strValue)}}$scope.currentTab='';$scope.currentTabUrl='';$scope.currentTab='Overview';$scope.currentTabUrl='overview_rp.jsp';var defaultTab=getUserProfile("DefaultRightPanel");for(var i=0;i<$scope.tabs.length;i++){if($scope.tabs[i].tabId==defaultTab){$scope.currentTab=$scope.tabs[i].title;$scope.currentTabUrl=$scope.tabs[i].url;break}}if(isocchealth){$scope.currentTab='Detail';$scope.currentTabUrl='details_rp.jsp'}if($scope.context=='healowHub'){$scope.currentTab='History';$scope.currentTabUrl='patientHistories.jsp'}if(getItemKeyValue('EnableEMPI').trim().toLowerCase()==='yes'||getItemKeyValue('commToInteropHub').trim().toLowerCase()==='yes'){$scope.tabs.push({title:'eEHX',url:'ehxRightPanel.jsp',icon:$scope.ptHasNew,showTab:false});var eEHXTabId=0;for(var j=0;j<$scope.tabs.length;j++){if($scope.tabs[j].title=='eEHX'){eEHXTabId=j;break}}var promise=showEhxTab($scope.patientid,$scope.context);promise.then(function(result){if(result===true){$scope.ptHasNew=false;if(!$scope.$$phase){$scope.$apply(function(){$scope.tabs[eEHXTabId].showTab=true})}var promiseEhxData=getPromiseForPtEhxData($scope.patientid,global.TrUserId,'newDataEhx',"rightPanel");promiseEhxData.then(function(result){$scope.ptHasNew=result;$scope.tabs[eEHXTabId].icon=$scope.ptHasNew},function(errorMsg){console.log("req getPromiseForPtEhxData rejected from rpTabsCtrl")})}else{if(isSupportsLocalStorage()){if(containsKey("rpCurrentTab")&&containsKey("rpCurrentTabUrl")){if(get("rpCurrentTab")==='eEHX'&&get("rpCurrentTabUrl")==='ehxRightPanel.jsp'){remove("rpCurrentTab");remove("rpCurrentTabUrl")}}}for(var i=0;i<$scope.tabs.length;i++){if($scope.tabs[i].title=='eEHX'){$scope.tabs.splice(i,1);break}}}},function(errorMsg){console.log("req rejected")})}if(isSupportsLocalStorage()){if(containsKey("rpCurrentTab")&&containsKey("rpCurrentTabUrl")){$scope.currentTab=get("rpCurrentTab");$scope.currentTabUrl=get("rpCurrentTabUrl")}}$scope.$on('reloadDRTLATab',function(){let drtlaTab;for(let i=0;i<$scope.tabs.length;i++){if($scope.tabs[i]["tabId"]===1){drtlaTab=$scope.tabs[i];break}}if(drtlaTab){onClickTab(drtlaTab)}});if($scope.context==='progressnotes'&&isSupportsLocalStorage()){if(!containsKey("rpTemplateScrollPosition")&&!containsKey("rpTemplatesDisplayed")){put("rpTemplateScrollPosition",0);put("rpTemplatesDisplayed",200)}}function onClickTab(tab){if($scope.context==='progressnotes'&&isSupportsLocalStorage()){put("rpTemplateScrollPosition",0);put("rpTemplatesDisplayed",200)}$scope.currentTab=tab.title;$scope.currentTabUrl=tab.url;switch(tab.title){case'CHS':if(isItemKeyEnabled('EnableCorrectionalFeatures')){loadTab('chsRightPanelModule',['/mobiledoc/jsp/webemr/corrections/js/CorrectionService.js','/mobiledoc/jsp/webemr/rightpanel/js/chsRightPanelCtrl.js'])}break;case'CDSS':loadTab('cdssRightPanelModule',['/mobiledoc/jsp/webemr/alerts/alertsService.js','/mobiledoc/jsp/webemr/rightpanel/js/CdssController.js']);break;case'BH':loadTab('rpBehavioralHealthViewApp',['/mobiledoc/jsp/webemr/behavioralhealth/js/behavioralhealth-service.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/js/rightChartPanelBehavioralHealthController.js']);break;case'Enc':loadTab('rcpEncounter',['/mobiledoc/jsp/webemr/rightpanel/js/encDropDownDirective.js','/mobiledoc/jsp/webemr/rightpanel/js/rcpEncounterController.js']);break;case'Templates':loadTab('rightpanel.template',['/mobiledoc/jsp/webemr/rightpanel/js/rpTemplateController.js']);break;default:$scope.view.getView();break}}var reloadChsTab=false;if("YES"===getItemKeyValue("EnableCorrectionalFeatures").toUpperCase()){reloadChsTab=$scope.$on('reload-chs-tab',function(event,args){if($scope.currentTab==='CHS'){$scope.onClickTab({"title":$scope.currentTab,"url":$scope.currentTabUrl})}})}function loadTab(moduleName,dependencies){$ocLazyLoad.load({name:moduleName,files:dependencies}).then(function(){$scope.view.getView()},function(e){console.log('Error while loading tab for '+moduleName+': '+e)})}var getOverviewDependency=function(){var arrDependency=['/mobiledoc/jsp/webemr/rightpanel/js/overviewController.js'];if($scope.isCPOEnabled){arrDependency.push('/mobiledoc/jsp/webemr/cpo/js/cpoAddEditCertification-tpl.js');arrDependency.push('/mobiledoc/jsp/webemr/cpo/js/cpoHub-tpl.js')}if($scope.isCCMEnabled||$scope.isCPOEnabled||$scope.isRPMEnabled){arrDependency.push('/mobiledoc/jsp/webemr/ccmr/rpm/js/service/rpmUserServices.js');arrDependency.push('/mobiledoc/jsp/webemr/ccmr/rpm/timer/directive/rpmAddTime-tpl.js');arrDependency.push('/mobiledoc/jsp/webemr/ccmr/rpm/timer/directive/rpmStartStopTimer-tpl.js');arrDependency.push('/mobiledoc/jsp/webemr/ccmr/ccm/js/directive/phmTimerLogs-tpl.js')}if($scope.isCCMEnabled){arrDependency.push('/mobiledoc/jsp/webemr/ccm/userfacing/programenrollment/js/directive/ccmProgramEnrollment-tpl.js');arrDependency.push('/mobiledoc/jsp/resources/jslib/perfect-scrollbar/dist/perfect-scrollbar.js');arrDependency.push('/mobiledoc/jsp/resources/jslib/perfect-scrollbar/css/perfect-scrollbar.css');arrDependency.push('/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.min.js');arrDependency.push('/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/rpmPatientDisenrollment-tpl.js');arrDependency.push('/mobiledoc/jsp/webemr/ccm/userfacing/dashboard/enrolledpatients/components/ccm-mdm-modal.css');arrDependency.push('/mobiledoc/jsp/webemr/ccm/userfacing/dashboard/enrolledpatients/components/ccm-mdm-modal-service.js');arrDependency.push('/mobiledoc/jsp/webemr/ccm/userfacing/dashboard/enrolledpatients/components/ccm-mdm-modal-component.js')}return arrDependency};if($scope.currentTab=='Overview'){var arrDependency=getOverviewDependency();$ocLazyLoad.load({name:'overviewModule',files:arrDependency}).then(function(){$scope.srcPage="/mobiledoc/jsp/webemr/rightpanel/overview_rp.jsp"+params+"&rnd2="+Math.random()},function(e){console.log(e)})}else if($scope.currentTab==='CHS'){$scope.onClickTab({title:$scope.currentTab,url:$scope.currentTabUrl})}else if($scope.currentTab==='Templates'||$scope.currentTab==='CDSS'){$scope.onClickTab({title:$scope.currentTab,url:$scope.currentTabUrl})}else{$scope.srcPage="/mobiledoc/jsp/webemr/rightpanel/"+$scope.currentTabUrl+params}$scope.isActiveTab=function(title){return title==$scope.currentTab};$scope.view={getView:function(){if($scope.currentTab=='Overview'){var arrDependency=getOverviewDependency();$ocLazyLoad.load({name:'overviewModule',files:arrDependency}).then(function(){$scope.srcPage="/mobiledoc/jsp/webemr/rightpanel/overview_rp.jsp"+params+"&rnd2="+Math.random()},function(e){console.log(e)})}else if($scope.currentTab==='BH'){$scope.srcPage=$scope.currentTabUrl+params+"&rnd2="+Math.random()}else if($scope.currentTab==='Dental'){$ocLazyLoad.load({name:'rpDentalModule',files:['/mobiledoc/jsp/webemr/alerts/alertsService.js','/mobiledoc/jsp/webemr/rightpanel/js/rpDentalController.js']}).then(function(){$scope.srcPage="/mobiledoc/jsp/webemr/rightpanel/"+$scope.currentTabUrl+params+"&rnd2="+Math.random()},function(e){console.log(e)})}else{$scope.srcPage="/mobiledoc/jsp/webemr/rightpanel/"+$scope.currentTabUrl+params+"&rnd2="+Math.random()}isRightHandAlertPopupVisible=false;$scope.getRCPModifiedDateTime(patientId)}};$scope.removeUrl=function(){$templateCache.remove($scope.srcPage)};$scope.openChildLinks=function(url){$scope.rpanelPopupUrl=url};$scope.cancelDocumentView=function(){$scope.view.getView()};$scope.getsearchurl=function(){if($scope.context=='progressnotes'){var portalname=getItemKeyValue("uptodateportalname");$scope.isUpToDateEnabled=getItemKeyValue("UpToDate").toLowerCase()==='yes'&&getUserProfile("ShowUpToDate")==='1';var utdjson={};var utdurl='';let key="";let promiseList=[];promiseList.push(asyncUrlPost("/mobiledoc/jsp/webemr/menu/file/settings/getUptodateDetails.jsp",{userId:global.TrUserId}));promiseList.push(asyncUrlGet(makeURL("/mobiledoc/jsp/catalog/xml/getUserName.jsp?UserId="+global.TrUserId)));$q.all(promiseList).then(function([rpUtdDetails,userxml]){if(rpUtdDetails){utdjson=JSON.parse(rpUtdDetails);utdurl=utdjson.url;key=utdjson.key}$scope.uptodateURL=utdurl;var utdmodalObj=$("#utdmodal");var utdformObj=$("<form id='utdform'  target='rightPaneliFrm1' method='POST'>");utdmodalObj.append(utdformObj);var apuid=getItemKeyValue("AutoUpgradeKey");var srcsys="ECWS"+apuid;var userjson=x2js.xml_str2json(userxml);var uname='';if(userjson!=undefined){if(userjson.Envelope.Body['return'].resultset!=undefined&&userjson.Envelope.Body['return'].resultset.data!=undefined){if(userjson.Envelope.Body['return'].resultset.data.row!=undefined){uname=userjson.Envelope.Body['return'].resultset.data.row.uname}}}var unid="ECW_"+apuid+"_"+uname+"_"+global.TrUserId;var utdaddparams=$scope.uptodateURL.indexOf('?')>-1;if($scope.isUpToDateEnabled){if(portalname==null||portalname.length===0){if(utdaddparams)$scope.uptodateURL=$scope.uptodateURL+"&srcsys="+escapeHtml(srcsys)+"&unid="+escapeHtml(unid);else $scope.uptodateURL=$scope.uptodateURL+"?srcsys="+escapeHtml(srcsys)+"&unid="+escapeHtml(unid)}else{if(utdaddparams)$scope.uptodateURL=$scope.uptodateURL+"&srcsys="+escapeHtml(srcsys)+"&unid="+escapeHtml(unid)+"&portal="+escapeHtml(portalname);else $scope.uptodateURL=$scope.uptodateURL+"?srcsys="+escapeHtml(srcsys)+"&unid="+escapeHtml(unid)+"&portal="+escapeHtml(portalname)}if(key!=='')$scope.uptodateURL=$scope.uptodateURL+"&key="+escapeHtml(key)}})}};$scope.isUpToDateEnabled=false;$scope.getsearchurl();$scope.closeExternalLinkModal=function(){$("#externallink").modal('hide')};$scope.clickOnLaunchChadis=function(url,isExternalWindow){if(isExternalWindow){$('#ChadisFormFromDashboardRightPanel')[0].submit()}else{$scope.externalLinkUrl=$sce.trustAsResourceUrl(url);$("#externallink").modal()}};$scope.UpToDateclick=function(){var strsearch=$('#searchval').val();var uptodateURL='';uptodateURL=$scope.uptodateURL+"&search="+strsearch;if(getItemKeyValue('OpenUTDinNewWindow').trim().toLowerCase()==='yes'){$scope.popupWindow(uptodateURL,'',window,1100,550)}else{$('#utdform').attr('action',uptodateURL);$("#utdform").submit();$("#uptodatemodal").modal("show")}};$scope.popupWindow=function(url,windowName,win,w,h){const y=win.top.outerHeight/2+win.top.screenY-h/2;const x=win.top.outerWidth/2+win.top.screenX-w/2;return win.open(url,windowName,`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=${w}, height=${h}, top=${y}, left=${x}`)};$scope.triggerDataUpdateWarning=function(sectionName,callback){if(getItemKeyValue('EnableRightPanelUpdateWarning').trim().toLowerCase()==='yes'){var callbackWithLog=function(){logDataUpdate(sectionName);callback()};if(sectionName==='Social History'){ecwConfirm("Warning: Changes made to Social History will:<br/><br/>"+"<ul>"+"<li class= 'mb10'><b>NOT</b> be reflected in encounters occurring prior to the current date and time</li>"+"<li class= 'mb10'><b>NOT</b> be included in Flowsheets</li>"+"<li class= 'mb10'><b>NOT</b> satisfy criteria for MultiSatisfied Alerts</li>"+"</ul>If you would like the changes to be reflected, please make them from this patient’s Progress Note or Telephone Encounter.<br/> <br/>"+"Would you like to continue to access Social History?",'eClinicalWorks',callbackWithLog)}else{ecwConfirm("Warning: Any changes made to "+sectionName+" will not be reflected in encounters occurring prior to the current date and time. Proceed?",'eClinicalWorks',callbackWithLog)}}else{callback()}};var logDataUpdate=function(sectionName){urlPost("/mobiledoc/jsp/dashboard/logRightPanelUpdate.jsp?patientId="+patientId+"&TrUserId="+global.TrUserId+"&sectionName="+sectionName)};$scope.getRCPModifiedDateTime=function(ptId){if(isItemKeyEnabled('EnableRightPanelUpdateWarning')){$http({method:"POST",url:makeURL('/mobiledoc/jsp/webemr/rightpanel/getRCPModifiedDateTime.jsp'),data:$.param({patientId:ptId}),headers:{'Content-Type':'application/x-www-form-urlencoded'},cache:false}).success(function(response){if(response&&response.trim()!==''){$scope.hasLastModifiedDateTime=true;$scope.lastModifiedDTime=response.replace(" "," at ")}})}};$scope.refreshDocCount=function(count,docType){};$scope.openSnomed=function(){$ocLazyLoad.load({name:'snomedModule',files:[]}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/snomed/snomedContainer.jsp?encid='+$scope.encounterid+'&pid='+$scope.patientid+'&trUserId='+global.TrUserId+'&uniqueId='+$scope.rcpUniqueId);$scope.snomedPopupUrl=url},function(e){})};$scope.closeSnomed=function(){$scope.snomedPopupUrl=""};$scope.openUnreconciledPopup=function(){$ocLazyLoad.load({name:'unreconciledModule',files:['/mobiledoc/jsp/dashboard/unreconciledController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/dashboard/unreconciledContainer.jsp?encid='+$scope.encounterid+'&pid='+$scope.patientid+'&trUserId='+global.TrUserId);$scope.unreconciledPopupUrl=url},function(e){})};$scope.openMySettings=function(){if(!$scope.mySettingsPermission){return false}$ocLazyLoad.load({name:'mySettingsModule',files:["/mobiledoc/jsp/webemr/menu/file/settings/mySettings.js"]}).then(function(){$(document).one("show.bs.modal","ng-include[src='mySettingsPopupUrl'] .modal",function(){var modalElem=$("ng-include[src='mySettingsPopupUrl'] .modal")[0];$("#"+modalElem.id).on("hide.bs.modal removed",function(e){if(e!==undefined&&e.target===modalElem){let el=$("ng-include[src='mySettingsPopupUrl']").find("[ng-controller], [data-ng-controller]");if(angular.element(el).scope()!==undefined)angular.element(el).scope().$destroy();angular.element(el).remove();$("#"+modalElem.id).off("hide.bs.modal removed");angular.element("ng-include[src='mySettingsPopupUrl']").remove()}})});let url=makeURL("/mobiledoc/jsp/webemr/menu/file/settings/mySettings.jsp?defaultTab=show-hide");$scope.mySettingsPopupUrl=url},function(e){})};$scope.onLoadMySettingsPopup=function(){$("ng-include[src='mySettingsPopupUrl']").appendTo("body")};$scope.openIhubRefreshIcon=function(){if(getItemKeyValue('commToInteropHub').toLowerCase()==='yes'){$ocLazyLoad.load({name:'ihubRefreshIconModule',files:['/mobiledoc/jsp/interop/template/refresh-icon/refresh-icon-tpl.js']}).then(function(){rightPanelModule.requires.push('ihubRefreshIconModule')},function(e){ecwAlert("Something went wrong, please try again later.")})}};$scope.openIhubRefreshIcon();$scope.destroyScrollBasedonContext=function(){switch($scope.context){case"patienthub":if(callFrom==='ejellybean'){if($('#eRefill .modal-body .rightpanelscroll .accord-list').data('jsp')){$('#eRefill .modal-body .rightpanelscroll .accord-list').data('jsp').destroy()}}else if(callFrom==='RxChange'){if($('#RxChangeMain .modal-body .rightpanelscroll .accord-list').data('jsp')){$('#RxChangeMain .modal-body .rightpanelscroll .accord-list').data('jsp').destroy()}}else{if($('#patient_hub .modal-body .rightpanelscroll .accord-list').data('jsp')){$('#patient_hub .modal-body .rightpanelscroll .accord-list').data('jsp').destroy()}}break;case"dentalicw":if($('#dentalExammodal .modal-body .rightpanelscroll .accord-list').data('jsp')){$('#dentalExammodal .modal-body .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"telenc":if($('#TJellyDetailViewd .approve-wrap .rightpanelscroll .accord-list').data('jsp')){$('#TJellyDetailViewd .approve-wrap .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"Treatment":if($('#treatment-screen-popUp-FromPN .rightpanelscroll .accord-list').data('jsp')){$('#treatment-screen-popUp-FromPN .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"documents":if($('#documentViewControllerId .rightpanelscroll .accord-list').data('jsp')){$('#documentViewControllerId .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"LAB_RESULT_SCREEN":if($('#LabReportController .rightpanelscroll .accord-list').data('jsp')){$('#LabReportController .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"VIEW_ALL_REPORT":if($('#viewAllReport .rightpanelscroll .accord-list').data('jsp')){$('#viewAllReport .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"devicereportscreen":if($('#devicereports .rightpanelscroll .accord-list').data('jsp')){$('#devicereports .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"refillRequest":if($('#eRefill .modal-body .rightpanelscroll .accord-list').data('jsp')){$('#eRefill .modal-body .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"labapprovalscreen":if($('#lab_approval_screen .view-report-pane .rightpanelscroll .accord-list').data('jsp')){$('#lab_approval_screen .view-report-pane .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"aftercarescreen":if($('#right-inplace12 .rightpanelscroll .accord-list').data('jsp')){$('#right-inplace12 .rightpanelscroll .accord-list').data('jsp').destroy()}break;case"healowHub":if($('.rightpanelscroll .accord-list').data('jsp')){$('.rightpanelscroll .accord-list').data('jsp').destroy()}break;default:if($('.rightpanelscroll .accord-list').data('jsp')){$('.rightpanelscroll .accord-list').data('jsp').destroy()}}};function pushSnomedAlert(resultData){let $snomedElem=$("#SNOMEDTab"+$scope.rcpUniqueId);$snomedElem=$($snomedElem[0]);if($snomedElem.css("display")==="none"||resultData&&resultData.trim()==='0'){$scope.removeFromRcpAlert("snomed");return false}let len=$scope.rcpAlerts.filter(item=>item.type==="snomed").length;if($snomedElem.find("u").children().length>0){if(len===0){pushToRcpAlert("Missing SNOMED in Problem List","snomed")}}else{if(len>0){$scope.removeFromRcpAlert("snomed")}}}$scope.removeFromRcpAlert=function(type){$scope.rcpAlerts=$scope.rcpAlerts.filter(function(item){return item.type!==type})};function pushToRcpAlert(title,type){pushToRcpAlertTimeout=$timeout(function(){$scope.rcpAlerts.push({title:title,type:type})})}$scope.checkSnomed=function(callbackFn){if(!$scope.isAssignSNOMEDEnabled){return false}if(typeof checkSNOMED==='function'){checkSNOMED("SNOMEDTab"+$scope.rcpUniqueId,function(resultData){pushSnomedAlert(resultData);callbackFn&&callbackFn()})}};$scope.checkPSACPermissionAndopenMemberInsights=function(){PSACService.checkCommonStaffPermission($scope.patientid,$scope.openMemberInsights)};$scope.openMemberInsights=function(){if($scope.isPSACAuthorized($scope.patientid)){let loadReadOnlyView;loadReadOnlyView='0'===getMIViewSelection();if(loadReadOnlyView){$ocLazyLoad.load({name:'memberInsightsResources',files:['/mobiledoc/jsp/healowInsights/js/memberInsights.js','/mobiledoc/jsp/healowInsights/worklists/js/hiPrintExportLogsService.js','/mobiledoc/jsp/resources/jslib/pdfmake/build/pdfmake.min.js','/mobiledoc/jsp/healowInsights/vendor/pdfmake/vfs_fonts_times.min.js','/mobiledoc/jsp/webemr/js/jquery.mark.min.js']}).then(function(){$scope.himodalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/memberInsightsPanel.jsp?showProgressnote=false&source=rightpanel&patientId='+$scope.patientid+'&encounterId='+$scope.encounterid),windowClass:'member-insights-popup',backdrop:true,keyboard:true,scope:$scope,resolve:{}});$scope.himodalInstance.result.then(null,function(modalInstanceResponse){$scope.getMemberInsightsDataRefreshStatus()})["finally"](function(){$scope.himodalInstance.$destroy()})})}else{if($('.prisma-member-insight-wrapper').length>0){ecwAlert("One instance of Member Insights is already open. You cannot open another instance.","eClinicalWorks",null,"","bluetheme")}else{$ocLazyLoad.load({name:'memberInsightsResources',files:['/mobiledoc/jsp/healowInsights/components/js/cipc-info-icon-service.js','/mobiledoc/jsp/healowInsights/components/js/pd-info-icon-service.js','/mobiledoc/jsp/healowInsights/components/js/hcc-info-icon-service.js','/mobiledoc/jsp/healowInsights/components/js/hcc-dpc-info-icon-service.js','/mobiledoc/jsp/healowInsights/components/js/hcc-filter-service.js','/mobiledoc/jsp/healowInsights/components/js/hcc-disagree-action-service.js','/mobiledoc/jsp/healowInsights/memberinsights/js/prisma-member-insights.js','/mobiledoc/jsp/healowInsights/memberinsights/js/prisma-mi-dropdown-selection.js','/mobiledoc/jsp/healowInsights/memberinsights/css/prisma-member-insights.css','/mobiledoc/jsp/healowInsights/templates/pagination-tpl.js','/mobiledoc/jsp/webemr/js/jquery.mark.min.js'],serie:true,cache:true}).then(function(){$scope.himodalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/healowInsights/memberinsights/view/prisma-member-insights.jsp?patientId='+$scope.patientid+'&encounterId='+$scope.encounterid+'&source=rightpanel&isFromExe=false'),windowClass:'member-insights-popup',backdrop:true,keyboard:true,scope:$scope,resolve:{}});$scope.himodalInstance.result.then(null,function(modalInstanceResponse){$scope.getMemberInsightsDataRefreshStatus()})["finally"](function(){$scope.himodalInstance.$destroy()})})}}}};$scope.isPSACAuthorized=function(patientId){var result=false;$.ajax({url:makeHealowInsightsAPIURL('psac/verify'),type:"POST",data:{callingFrom:"MemberInsights",patientId:patientId},"async":false,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(data){if(data&&data.status&&data.status.trim().toUpperCase()==='SUCCESS'){result=true}else{ecwAlert(data&&data.message&&data.message!==''?data.message:"Unable to verify PSAC.","Member Insights")}}});return result};$scope.getMemberInsightsDataRefreshStatus=function(){$scope.isRefreshed=false;var params={};params.patientIdMI=$scope.patientid;params.encounterIdMI=$scope.encounterid;$http({method:"POST",url:makeURL('/mobiledoc/jsp/healowInsights/MemberInsightController.jsp'),data:$.param({action:'checkForNewPayorDataAvaiable',params:JSON.stringify(params)}),headers:{'Content-Type':'application/x-www-form-urlencoded'},cache:false}).success(function(response){if(response){$scope.isRefreshed=response.result}}).error(function(response){})};const getMIViewSelection=function(){let miViewSelection='0';try{miViewSelection=getHealowInsightsUserSettings("miViewSelection");if(!miViewSelection&&miViewSelection!==0){miViewSelection=getItemKeyValue("HealowInsightsMemberInsightsViewSelection");if(miViewSelection&&miViewSelection!=='0'&&miViewSelection!=='1'){miViewSelection=JSON.parse(miViewSelection);if(miViewSelection){if(global.loginUserType===1){miViewSelection=miViewSelection.allProvider}else if(global.loginUserType===2){miViewSelection=miViewSelection.allStaff}}}}else{miViewSelection=miViewSelection+''}}catch(err){notification.show('error','Member Insights',"Error while parsing the item key value.",5e3)}return miViewSelection};$scope.getRCPModifiedDateTime(patientId);$scope.isBhVisitsTab=true;$scope.checkBHCurrentTab=function(currentTab){$scope.isBhVisitsTab=currentTab==='Visits'};$scope.showMedicationCompoundRxTooltip=function(elem,className,title,id,context){if(context==='progressnotes'){var pnClassName='.pncurrentmed_compoundrx-tooltip';var custEle=$(pnClassName);var leftPos=$('#'+id).position().left;var topPos=$('#'+id).position().top;var width=$('#topMenuBoundary').width();if(width>1050){custEle.css("left",leftPos+450+"px")}else if(width>930){custEle.css("left",leftPos+260+"px")}else{custEle.css("left",leftPos+220+"px")}custEle.html(title);var tootipheight=custEle.height();custEle.css("top",topPos-(tootipheight-200)+"px");custEle.css("display","block")}else if(context==='patienthub'){var pnhubclassname='.pnhubcurrentmed_compoundrx-tooltip';var custEle=$(pnhubclassname);var leftPos=$('#'+id).position().left;var topPos=$('#'+id).position().top;custEle.css("left",leftPos+400+"px");custEle.html(title);var tootipheight=custEle.height();custEle.css("top",topPos-(tootipheight-30)+"px");custEle.css("display","block")}else{var custEle=$(className);var leftPos=$('#'+id).position().left;var topPos=$('#'+id).position().top;custEle.css("left",leftPos-660+"px");custEle.html(title);var tootipheight=custEle.height();custEle.css("top",topPos-tootipheight+"px");custEle.css("display","block")}};$scope.hideMedicationCompoundRxTooltip=function(elem,className){$(className).css("display","none");$('.pncurrentmed_compoundrx-tooltip').css("display","none");$('.pnhubcurrentmed_compoundrx-tooltip').css("display","none")};$scope.$on('resetRcpHeight',function(){$scope.setcontextbasedheight()});$scope.onRcpAlertClick=function(type){$("#rcpAlertsPopup").hide();if(type==='snomed'){if($scope.isActiveTab("Overview")){return}let overviewTab={};let len=$scope.tabs.length;for(let i=0;i<len;i++){if($scope.tabs[i]["title"]==="Overview"){overviewTab=$scope.tabs[i];break}}$scope.onClickTab(overviewTab)}};$scope.openLastModified=function($event){var $this=$($event.currentTarget);$this.parents(".right-panel").find('#refreshPopup').show().animate({},100,function(){$(this).position({of:$this[0],my:'right+1 top+29',at:'right top',collision:"flipfit"}).animate({"opacity":1},100)})};$scope.openRcpAlerts=function($event){if($scope.rcpAlerts.length===0)return;var $this=$($event.currentTarget);$this.parents(".right-panel").find('#rcpAlertsPopup').show().animate({},100,function(){$(this).position({of:$this[0],my:'right+1 top+29',at:'right top',collision:"flipfit"}).animate({"opacity":1},100)})};$scope.isRCPEncounterLocked=function(){if($scope.encounterid&&$scope.encounterid>0){let encounterDetails=EncDetailsService.getEncDetailsByEncId($scope.encounterid);return encounterDetails&&encounterDetails.encLock==='1'}else{return false}};var popupMouseUp=function(e){let $popup=$('#refreshPopup,#rcpAlertsPopup');if(!$popup.is(e.target)&&$popup.has(e.target).length===0){$popup.hide()}};var tabsMouseUp=function(e){var tabsListPopup=$('#tabsListPopup.rcp-popover');if(!tabsListPopup.is(e.target)&&tabsListPopup.has(e.target).length===0){tabsListPopup.hide()}};var openTabList=function(){var _that=this;$tabListPopup.show().animate({},100,function(){$(this).position({of:_that,my:'right+1 top+29',at:'right top',collision:"flipfit"}).animate({"opacity":1},100)})};function bindOpenPopupEvent(){$rcpTabsContainer.find('.show-tablist').on('mouseover',openTabList);$rcpTabsContainer.find('.show-tablist').on('focus',openTabList)}var onSecondaryTabClick=function(){$primaryTabs.find(".rcp-primary-tab-hidden").addClass("hidden");let primaryItem=$primaryTabs.children()[$(this).index()];$(primaryItem).removeClass("hidden").click();$(this).siblings().removeClass("rcp-secondary-tab-selected");$(this).addClass('rcp-secondary-tab-selected');$tabListPopup.hide()};function bindSelectSecondaryTabEvent(){$tabListPopup.find('.popuplist li').on('click',onSecondaryTabClick)}function doRCPTabsRestructure(){const $secondary=$rcpTabsContainer.parent().find('.rcp-secondary-tabs');const $secondaryItems=$secondary.find('li');const $allItems=$rcpTabsContainer.parent().find('li');const $moreLi=$primaryTabs.find('.rcp-more-li');const $moreBtn=$moreLi.find('button');const $primaryTabsItems=$rcpTabsContainer.find('.rcp-primary-tabs > li:not(.rcp-more-li)');let len=$allItems.length;for(let i=0;i<len;i++){let item=$allItems[i];$(item).removeClass('hidden')}let hiddenItems=[];const primaryWidth=$rcpTabsContainer.outerWidth();let dummySpace=40;let stopWidth=$moreBtn.outerWidth()+dummySpace;let $lastItem;len=$primaryTabsItems.length;for(let i=0;i<len;i++){let $item=$($primaryTabsItems[i]);if(primaryWidth>=stopWidth+$item.outerWidth()&&hiddenItems.length===0){stopWidth+=$item.outerWidth()}else{$item.addClass('hidden rcp-primary-tab-hidden');hiddenItems.push(i)}if(hiddenItems.length===1){$lastItem.addClass('rcp-primary-tab-hidden');hiddenItems.splice(0,0,$lastItem.index())}$lastItem=$item}if(!hiddenItems.length){$moreLi.addClass('hidden');$moreBtn.attr('aria-expanded',false)}else{len=$secondaryItems.length;for(let i=0;i<len;i++){let item=$secondaryItems[i];if(hiddenItems.indexOf(i)===-1){$(item).addClass('hidden')}}}defaultSelectSecondaryTab($secondary)}function defaultSelectSecondaryTab($secondary){if($secondary.find("li.active:not(.hidden)").length>0){$secondary.find("li.active:not(.hidden)").click()}else{$secondary.find("li:not(.hidden)").first().addClass("rcp-secondary-tab-selected")}}$scope.restructureRcpTabs=function(){if($primaryTabs.outerWidth()>0){bindOpenPopupEvent();bindSelectSecondaryTabEvent();doRCPTabsRestructure()}else{rcpTabsTimout=$timeout($scope.restructureRcpTabs,200)}};$scope.$on('$destroy',function(){if("YES"===getItemKeyValue("EnableCorrectionalFeatures").toUpperCase()&&reloadChsTab){reloadChsTab()}$scope.destroyScrollBasedonContext();$timeout.cancel(rcpTabsTimout);$timeout.cancel(pushToRcpAlertTimeout);$(document).off('mouseup',popupMouseUp);$(document).off('mouseup',tabsMouseUp);if($rcpTabsContainer){$rcpTabsContainer.closest(".right-panel").off("click",'.listhead a',toggleActiveClass);$rcpTabsContainer.closest(".right-panel").off("click",'.inner-listhead a',toggleActiveClass);$rcpTabsContainer.find('.show-tablist').off('mouseover',openTabList);$rcpTabsContainer.find('.show-tablist').off('focus',openTabList)}if($tabListPopup){$tabListPopup.find('.popuplist li').off('click',onSecondaryTabClick)}if(isSupportsLocalStorage()){if(containsKey("rpCurrentTab")&&containsKey("rpCurrentTabUrl")){remove("rpCurrentTab");remove("rpCurrentTabUrl")}}});$(document).ready(function(){$(document).on('mouseup',popupMouseUp);$(document).on('mouseup',tabsMouseUp);if(!$scope.isActiveTab("Overview")){$scope.checkSnomed()}$rcpTabsContainer=$('.rcp-tabs-nav-'+$scope.rcpUniqueId);$primaryTabs=$rcpTabsContainer.find('.rcp-primary-tabs');$tabListPopup=$rcpTabsContainer.parent().find("#tabsListPopup");rcpTabsTimout=$timeout($scope.restructureRcpTabs,200)})}).directive('elemReady',function($parse,$timeout){return{restrict:'A',link:function($scope,elem,attrs){elem.ready(function(){if(!$scope.$$phase){$timeout(function(){var func=$parse(attrs.elemReady);func($scope)})}else{var func=$parse(attrs.elemReady);func($scope)}})}}});function rputd_padding(strVal){if(strVal<10)strVal="0"+strVal;return strVal}function setActiveTab(activetab,taburl){if(isSupportsLocalStorage()){if(!containsKey("rpCurrentTab")&&!containsKey("rpCurrentTabUrl")){put("rpCurrentTab",activetab);put("rpCurrentTabUrl",taburl)}}}