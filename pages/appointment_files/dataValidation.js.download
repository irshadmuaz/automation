var dtValidation={maxlengthObj:function(fieldLabelName,supportedFieldLength,enteredFieldLength){this.fieldLabelName=fieldLabelName;this.supportedFieldLength=supportedFieldLength;this.enteredFieldLength=enteredFieldLength},minlengthObj:function(fieldLabelName,supportedFieldLength,enteredFieldLength){this.fieldLabelName=fieldLabelName;this.supportedMinFieldLength=supportedFieldLength;this.enteredMinFieldLength=enteredFieldLength},splcharObj:function(fieldLabelName,validCharacters,enteredCharacters){this.fieldLabelName=fieldLabelName;this.validCharacters=validCharacters;this.enteredCharacters=enteredCharacters},maxValueObj:function(fieldLabelName,validvalue,enteredvalue){this.fieldLabelName=fieldLabelName;this.validvalue=validvalue;this.enteredvalue=enteredvalue},minValueObj:function(fieldLabelName,validvalue,enteredvalue){this.fieldLabelName=fieldLabelName;this.validvalue=validvalue;this.enteredvalue=enteredvalue},businessDataTypeObj:function(fieldName,feildIdentifier,businessDataType,enteredValue){this.fieldName=fieldName;this.fieldId=feildIdentifier;this.businessDataType=businessDataType;this.enteredValue=enteredValue},getTextValidations:function(screenFieldWidthList,parentId,highlightErrorFields,isGlobalFrameworkCall,values,valuesHtml,isIDT){var isBufferIndicateMessage=false;var screenCollength=0;var promptcount=0;var exceedscreenfeildwidthlabel;var minscreenfeildwidthlistlabel;var minscreencollength;var exceedscreencollength;var unsupportedchars;var maxlengthArray=[];var minlengthArray=[];var splcharArray=[];var maxValueArray=[];var minValueArray=[];var businessDataTypeArray=[];var nnflag=0;var nDisablePatternId=0;var counter=0;for(var i=0;i<screenFieldWidthList.length;i++){screenCollength=0;var dbscreenfeildname=screenFieldWidthList[i].uiscreenfieldname;var dbcolmaxlength=screenFieldWidthList[i].ecw_col_max_length;var dbcolminlength=screenFieldWidthList[i].ecw_col_min_length;var fieldLabelName=screenFieldWidthList[i].fieldname;var enabled_SpecialCharPattern=screenFieldWidthList[i].SpecialCharPattern;var enabled_PatternDescription=screenFieldWidthList[i].PatternDescription;var SpecialCharPattern=screenFieldWidthList[i].SpecialCharPattern;var patternDescription=screenFieldWidthList[i].PatternDescription;var IntegerTypes_Max_Value=screenFieldWidthList[i].IntegerTypes_Max_Value;var IntegerTypes_Min_Value=screenFieldWidthList[i].IntegerTypes_Min_Value;var dbtbldatatype=screenFieldWidthList[i].dbdatatype;var businessDataType=screenFieldWidthList[i].BusinessDataType;var isGrid=screenFieldWidthList[i].isgrid;var isControlByName=false;var isControlByNgModel=false;var isControlByDataAttribute=false;nnflag=screenFieldWidthList[i].nnflag;nDisablePatternId=screenFieldWidthList[i].DISABLED_PATTERNID;var screenColval;var screenColvalHtml=undefined;try{screenColval=$('#'+dbscreenfeildname,'#'+parentId).val()}catch(e){screenColval=$("input[id='"+dbscreenfeildname+"']",'#'+parentId).val()}if(values!=null&&values.length>0){screenColval=values[i];screenColvalHtml=valuesHtml[i]}var elementCol=$('#'+parentId).find("[id='"+dbscreenfeildname+"']");if(elementCol.length===0){elementCol=$('#'+parentId).find("[name='"+dbscreenfeildname+"']");if(elementCol.length>0&&screenColval==null){isControlByName=true}else if(elementCol.length===0){elementCol=$('#'+parentId).find("[data-fieldname='"+dbscreenfeildname+"']");if(elementCol.length>0&&screenColval==null){isControlByDataAttribute=true}else if(elementCol.length===0){elementCol=$('#'+parentId).find("[ng-model='"+dbscreenfeildname+"']");if(elementCol.length>0&&screenColval==null){isControlByNgModel=true}}}}if(isIDT!==true&&typeof CKEDITOR!=="undefined"&&CKEDITOR.instances[$($(elementCol)).attr('id')]!==undefined){screenColval=CKEDITOR.instances[$(elementCol).attr('id')].getData()}if(nDisablePatternId>0&&($(elementCol).prop('readonly')||$(elementCol).prop('disable')||$(elementCol).prop('disabled'))){SpecialCharPattern=screenFieldWidthList[i].Disabled_SpecialCharPattern;patternDescription=screenFieldWidthList[i].Disabled_PatternDescription}var isBufferAdded=false;highlightErrorFields(dbscreenfeildname,parentId,"");if(screenColval!=null){screenCollength=screenColval.length;counter=0;counter=this.getCountOfKeywords(screenColval);if(counter&&counter>0){isBufferAdded=true;isBufferIndicateMessage=true;screenCollength+=counter}}var valueHtmlLength=0;if(screenColvalHtml!=null){valueHtmlLength=screenColvalHtml.length;if(isBufferAdded&&counter&&counter>0){valueHtmlLength+=counter}}if(isControlByName){for(var k=0;k<elementCol.length;k++){screenColval=$(elementCol)[k].value;if(screenColval!==null&&screenColval!==''){screenCollength=screenColval.length;counter=0;counter=this.getCountOfKeywords(screenColval);if(counter&&counter>0){isBufferAdded=true;isBufferIndicateMessage=true;screenCollength+=counter}}}}if(isGlobalFrameworkCall&&isGrid===1){var gridElementsLength=0;if(""===$.trim(parentId)){gridElementsLength=jQuery('[id^="'+dbscreenfeildname+'"]').length}else{gridElementsLength=jQuery("#"+parentId).find('[id^="'+dbscreenfeildname+'"]').length}for(var gridIndex=0;gridIndex<gridElementsLength;gridIndex++){var screenGridColval;if(""===$.trim(parentId)){screenGridColval=this.getValueOfElement(jQuery(jQuery('[id^="'+dbscreenfeildname+'"]')[gridIndex]))}else{screenGridColval=this.getValueOfElement(jQuery(jQuery("#"+parentId).find('[id^="'+dbscreenfeildname+'"]')[gridIndex]))}if(!screenGridColval){break}screenColval=screenGridColval;if(screenColval!=null){screenColval=screenColval.trim();screenCollength=screenColval.length;counter=0;counter=this.getCountOfKeywords(screenColval);if(counter&&counter>0){isBufferAdded=true;isBufferIndicateMessage=true;screenCollength+=counter}}if(screenCollength>0){var dataFieldLabel=fieldLabelName+"["+(gridIndex+1)+"]";if(dbcolmaxlength>0&&(screenCollength>dbcolmaxlength||valueHtmlLength>dbcolmaxlength)){promptcount=promptcount+1;if(promptcount>5)break;exceedscreencollength=dbcolmaxlength;if(isBufferAdded){exceedscreenfeildwidthlabel=dataFieldLabel+"*";isBufferAdded=false}else{exceedscreenfeildwidthlabel=dataFieldLabel}if(valueHtmlLength>0){maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,valueHtmlLength))}else{maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,screenCollength))}}if(screenCollength<dbcolminlength){promptcount=promptcount+1;if(promptcount>5)break;minscreencollength=dbcolminlength;minscreenfeildwidthlistlabel=dataFieldLabel;minlengthArray.push(new this.minlengthObj(minscreenfeildwidthlistlabel,minscreencollength,screenCollength))}if(SpecialCharPattern!=null&&""!==SpecialCharPattern.trim()){unsupportedchars=this.validatePattern(SpecialCharPattern,screenColval,nnflag,elementCol,isIDT);if(isIDT!==true&&!(unsupportedchars.trim().length===0&&encodeURIComponent(unsupportedchars).indexOf('A0')>-1)){unsupportedchars=unsupportedchars.trim()}if(unsupportedchars.length>0){promptcount=promptcount+1;if(promptcount>5)break;splcharArray.push(new this.splcharObj(dataFieldLabel,patternDescription,unsupportedchars))}}if(dbtbldatatype==='int'||dbtbldatatype==='tinyint'||dbtbldatatype==='smallint'||dbtbldatatype==='bigint'||dbtbldatatype==='mediumint'||dbtbldatatype==='decimal'||dbtbldatatype==='float'||dbtbldatatype==='double'){if(IntegerTypes_Max_Value!==undefined&&IntegerTypes_Max_Value!==0&&Number(screenColval)>Number(IntegerTypes_Max_Value)){promptcount=promptcount+1;if(promptcount>5)break;maxValueArray.push(new this.maxValueObj(dataFieldLabel,IntegerTypes_Max_Value,screenColval))}if(IntegerTypes_Min_Value!==undefined&&IntegerTypes_Min_Value!==0&&Number(screenColval)<Number(IntegerTypes_Min_Value)){promptcount=promptcount+1;if(promptcount>5)break;minValueArray.push(new this.minValueObj(dataFieldLabel,IntegerTypes_Min_Value,screenColval))}}}if(businessDataType!=null&&screenCollength>0){businessDataTypeArray.push(new this.businessDataTypeObj(dataFieldLabel,dbscreenfeildname,businessDataType,screenColval))}}}else{if(isControlByDataAttribute){for(var j=0;j<elementCol.length;j++){screenCollength=0;screenColval=this.getValueOfElement($(elementCol[j]));if(parentId==='pmtAdvisoryModal'){var drtRowCol=$('#'+parentId).find("[data-fieldname='cRowDirtyVal']");var drtRowFlagVal=this.getValueOfElement($(drtRowCol[j]));if(drtRowFlagVal!=='*'){continue}}if(screenColval!==null&&screenColval!==''){screenColval=screenColval.trim();screenCollength=screenColval.length;counter=0;counter=this.getCountOfKeywords(screenColval);if(counter&&counter>0){isBufferAdded=true;isBufferIndicateMessage=true;screenCollength+=counter}}if(screenCollength>0){var dataElement=$(elementCol[j]);var dataFieldLabel=this.getDatafieldLabelName(dataElement,fieldLabelName);if(dbcolmaxlength>0&&(screenCollength>dbcolmaxlength||valueHtmlLength>dbcolmaxlength)){promptcount=promptcount+1;if(promptcount>5)break;exceedscreencollength=dbcolmaxlength;if(isBufferAdded){exceedscreenfeildwidthlabel=dataFieldLabel+"*";isBufferAdded=false}else{exceedscreenfeildwidthlabel=dataFieldLabel}if(valueHtmlLength>0){maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,valueHtmlLength))}else{maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,screenCollength))}}if(screenCollength<dbcolminlength){promptcount=promptcount+1;if(promptcount>5)break;minscreencollength=dbcolminlength;minscreenfeildwidthlistlabel=dataFieldLabel;minlengthArray.push(new this.minlengthObj(minscreenfeildwidthlistlabel,minscreencollength,screenCollength))}if(nDisablePatternId>0&&($(dataElement).prop('readonly')||$(dataElement).prop('disable')||$(dataElement).prop('disabled'))){SpecialCharPattern=screenFieldWidthList[i].Disabled_SpecialCharPattern;patternDescription=screenFieldWidthList[i].Disabled_PatternDescription}else{SpecialCharPattern=enabled_SpecialCharPattern;patternDescription=enabled_PatternDescription}if(SpecialCharPattern!=null&&""!==SpecialCharPattern.trim()){unsupportedchars=this.validatePattern(SpecialCharPattern,screenColval,nnflag,elementCol,isIDT);if(isIDT!==true&&!(unsupportedchars.trim().length===0&&encodeURIComponent(unsupportedchars).indexOf('A0')>-1)){unsupportedchars=unsupportedchars.trim()}if(unsupportedchars.length>0){promptcount=promptcount+1;if(promptcount>5)break;splcharArray.push(new this.splcharObj(dataFieldLabel,patternDescription,unsupportedchars))}}if(dbtbldatatype==='int'||dbtbldatatype==='tinyint'||dbtbldatatype==='smallint'||dbtbldatatype==='bigint'||dbtbldatatype==='mediumint'||dbtbldatatype==='decimal'||dbtbldatatype==='float'||dbtbldatatype==='double'){if(IntegerTypes_Max_Value!==undefined&&IntegerTypes_Max_Value!==0&&Number(screenColval)>Number(IntegerTypes_Max_Value)){promptcount=promptcount+1;if(promptcount>5)break;maxValueArray.push(new this.maxValueObj(dataFieldLabel,IntegerTypes_Max_Value,screenColval))}if(IntegerTypes_Min_Value!==undefined&&IntegerTypes_Min_Value!==0&&Number(screenColval)<Number(IntegerTypes_Min_Value)){promptcount=promptcount+1;if(promptcount>5)break;minValueArray.push(new this.minValueObj(dataFieldLabel,IntegerTypes_Min_Value,screenColval))}}}if(businessDataType!=null&&screenCollength>0){businessDataTypeArray.push(new this.businessDataTypeObj(dataFieldLabel,dbscreenfeildname,businessDataType,screenColval))}}}else{if(isControlByNgModel){if(elementCol.length>0){screenColval=this.getValueOfElement($(elementCol));screenColval=screenColval.trim();if(screenColval!==null&&screenColval!==''){screenCollength=screenColval.length}}}if(screenCollength>0){if(dbcolmaxlength>0&&(screenCollength>dbcolmaxlength||valueHtmlLength>dbcolmaxlength)){promptcount=promptcount+1;if(promptcount>5)break;exceedscreencollength=dbcolmaxlength;if(isBufferAdded){exceedscreenfeildwidthlabel=fieldLabelName+"*";isBufferAdded=false}else{exceedscreenfeildwidthlabel=fieldLabelName}if(valueHtmlLength>0){maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,valueHtmlLength))}else{maxlengthArray.push(new this.maxlengthObj(exceedscreenfeildwidthlabel,exceedscreencollength,screenCollength))}highlightErrorFields(dbscreenfeildname,parentId,"MaxLengthError")}if(screenCollength<dbcolminlength){promptcount=promptcount+1;if(promptcount>5)break;minscreencollength=dbcolminlength;minscreenfeildwidthlistlabel=fieldLabelName;minlengthArray.push(new this.minlengthObj(minscreenfeildwidthlistlabel,minscreencollength,screenCollength));highlightErrorFields(dbscreenfeildname,parentId,"MinLengthError")}if(SpecialCharPattern!=null&&""!==SpecialCharPattern.trim()){unsupportedchars=this.validatePattern(SpecialCharPattern,screenColval,nnflag,elementCol,isIDT);if(isIDT!==true&&!(unsupportedchars.trim().length===0&&encodeURIComponent(unsupportedchars).indexOf('A0')>-1)){unsupportedchars=unsupportedchars.trim()}if(unsupportedchars.length>0){promptcount=promptcount+1;if(promptcount>5)break;splcharArray.push(new this.splcharObj(fieldLabelName,patternDescription,unsupportedchars));highlightErrorFields(dbscreenfeildname,parentId,"SplCharError")}}if(dbtbldatatype==='int'||dbtbldatatype==='tinyint'||dbtbldatatype==='smallint'||dbtbldatatype==='bigint'||dbtbldatatype==='mediumint'||dbtbldatatype==='decimal'||dbtbldatatype==='float'||dbtbldatatype==='double'){if(IntegerTypes_Max_Value!==undefined&&IntegerTypes_Max_Value!==0&&Number(screenColval)>Number(IntegerTypes_Max_Value)){promptcount=promptcount+1;if(promptcount>5)break;maxValueArray.push(new this.maxValueObj(fieldLabelName,IntegerTypes_Max_Value,screenColval));highlightErrorFields(dbscreenfeildname,parentId,"MaxValueError")}if(IntegerTypes_Min_Value!==undefined&&IntegerTypes_Min_Value!==0&&Number(screenColval)<Number(IntegerTypes_Min_Value)){promptcount=promptcount+1;if(promptcount>5)break;minValueArray.push(new this.minValueObj(fieldLabelName,IntegerTypes_Min_Value,screenColval));highlightErrorFields(dbscreenfeildname,parentId,"MinValueError")}}if(businessDataType!=null&&screenCollength>0){businessDataTypeArray.push(new this.businessDataTypeObj(fieldLabelName,dbscreenfeildname,businessDataType,screenColval))}}}}}var hasErrorItem=false;if(maxlengthArray.length>0||minlengthArray.length>0||splcharArray.length>0||maxValueArray.length>0||minValueArray.length>0||businessDataTypeArray.length>0){hasErrorItem=true}return{hasError:hasErrorItem,maxLength:maxlengthArray,minLength:minlengthArray,splChar:splcharArray,maxValue:maxValueArray,minValue:minValueArray,dataType:businessDataTypeArray,isBufferIndicate:isBufferIndicateMessage}},validatePattern:function(filter,inputValue,nnflag,element,returnArr){if(filter==null||filter.length===0||inputValue==null||inputValue.length===0){if(returnArr!=null){return[]}else{return""}}var matches1;var regmatch="";var matchesSet=new Set;var matchesList=[];var matchesArray=[];var regex1=RegExp(filter,'g');var bOnBlurCall=false;if(returnArr!=null){bOnBlurCall=true}if(!bOnBlurCall&&$(element)!==undefined&&($(element).data('wysihtml5')!==undefined||typeof CKEDITOR!=="undefined"&&CKEDITOR.instances[$($(element)).attr('id')]!==undefined)){inputValue=$("<div/>").html(inputValue).text()}inputValue=inputValue.trim();if(nnflag===1){if(!regex1.test(inputValue)){if(returnArr!=null){matchesArray.push({data:inputValue,index:0});return matchesArray}else{return inputValue}}}else{while((matches1=regex1.exec(inputValue))!==null){if(matches1.index===regex1.lastIndex){regex1.lastIndex++}if(regmatch.length===0&&matches1[0]!==""){if(matches1[0].length===1&&matches1[0]===" "){regmatch="<Space>";matchesSet.add("<Space>");matchesArray.push({data:"<Space>",index:matches1.index})}else{regmatch=matches1[0];matchesSet.add(matches1[0]);matchesArray.push({data:matches1[0],index:matches1.index})}}else if(regmatch.length>0&&matches1[0]!==""){if(matches1[0].length===1&&matches1[0]===" "){regmatch=regmatch+","+"<Space>";matchesSet.add("<Space>");matchesArray.push({data:"<Space>",index:matches1.index})}else{regmatch=regmatch+","+matches1[0];matchesSet.add(matches1[0]);matchesArray.push({data:matches1[0],index:matches1.index})}}}}if(returnArr!=null){return matchesArray}else{matchesArray=[];matchesSet.forEach(function(value1){matchesArray.push(value1)});return matchesArray.join(' ')}},getValueOfElement:function(element){if(element.attr('data-fieldname')&&element.attr('data-fieldname')==='report_writer_sentence'){return element.html()}if(element.is("input")||element.is("select")||element.is("textarea")){return element.val()}else if(element.is("span")||element.is("div")||element.is("td")){return element.text()}},initKeyword:function(){$.ajax({url:"/mobiledoc/jsp/webemr/security/?action=1049",type:"GET","async":false,success:function(result){var regEx=result.trim();var keywordAndSql=regEx.split(',');keywordRegex=keywordAndSql[0];isDbMSSqlServer=keywordAndSql[1]==="true"?true:false},error:function(request,textStatus,errorThrown){keywordRegex='';isDbMSSqlServer=false}})},getCountOfKeywords:function(value){var count=0;var matcher=new RegExp(this.getRegexOfKeywords(),"gi");var keywordMatch=value.match(matcher);if(keywordMatch!=null){count=keywordMatch.length}var matcherKeywordContains=new RegExp(this.getRegexOfKeywordContains(),"g");var keywordContainsMatch=value.match(matcherKeywordContains);if(keywordContainsMatch!=null){count=count+keywordContainsMatch.length}return count},getDatafieldLabelName:function(dataElement,fieldLabelName){var dataFieldLabel=dataElement.attr('data-fieldlabel');var dataFieldIndex=dataElement.attr('data-fieldindex');if(dataFieldLabel!=null&&dataFieldLabel!==""){return this.formatFieldLabelName(dataFieldLabel)}else if(dataFieldIndex!=null&&dataFieldIndex!==""){return fieldLabelName+"["+dataFieldIndex+"]"}else{return fieldLabelName}},formatFieldLabelName:function(labelName){var nMaxLength=30;if(labelName.length>nMaxLength){return labelName.substring(0,nMaxLength-3)+"..."}return labelName},getRegexOfKeywords:function(){if(keywordRegex){return"\\b(benchmark|delete|insert|update|select|exec|meta|eval|expression|onload|alert|prompt|confirm|write|open"+keywordRegex+")\\b"}else{return"\\b(benchmark|delete|insert|update|select|exec|meta|eval|expression|onload|alert|prompt|confirm|write|open)\\b"}},getRegexOfKeywordContains:function(){if(isDbMSSqlServer){return"(@@)"}else{return"(#|@@)"}},validateBusinessDataType:function(businessDataTypeArray){let response={isBusinessDataValid:false,data:[]};const onError=function(){response={isBusinessDataValid:true,data:[]}};$.ajax({url:"/mobiledoc/jsp/catalog/xml/edi/checkBusinessDataTypeValidation.jsp",type:"POST","async":false,data:{FormData:JSON.stringify(businessDataTypeArray),client:"WEB"},success:function(data){var dataTypeArray=JSON.parse($.trim(data));if(dataTypeArray.length>0){dataTypeArray=dtValidation.mapFiledWithBusinessDataValidation(dataTypeArray,businessDataTypeArray);response={isBusinessDataValid:false,data:dataTypeArray}}else{response={isBusinessDataValid:true,data:[]}}},error:onError,fail:onError});return response},mapFiledWithBusinessDataValidation:function(dataTypeArray,businessDataTypeArray){dataTypeArray.forEach(function(element){businessDataTypeArray.every(function(iptElements){if(element.fieldId===iptElements.fieldId){element.enteredValue=iptElements.enteredValue;return false}return true})});return dataTypeArray}};