(function(){var phmHubApp=angular.module('phmHubApp',[]);phmHubApp.directive('phmHub',function($modal,$ocLazyLoad,$http,PSACService){return{restrict:'AE',replace:'true',scope:{patientId:'=',encounterId:'=',callFrom:'=',visitType:'=',validationNoToCheckOnPhmHub:'=',data:'=',callbackFunction:'&'},link:function(scope,element){element.click(function(e){PSACService.checkCommonStaffPermission(scope.patientId,function(data){scope.isEdgeBrowser=false;scope.phmHubData={patientId:scope.patientId,encounterId:scope.encounterId,isEdgeBrowser:scope.isEdgeBrowser,callFrom:scope.callFrom,visitTypeId:scope.visitType,data:scope.data,callbackFunction:scope.callbackFunction};let phmHubModalCount=$("div[id*='phmHubView']").length;if(phmHubModalCount>0){ecwAlert("One instance of PHM Hub is already open. You cannot open another instance","eClinicalWorks",function(){return false})}else{$ocLazyLoad.load({name:'phmHub',files:['/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/healthassessment/js/common-directive.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/js/phmHubViewController.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/js/phmHubService.js','/mobiledoc/jsp/webemr/populationhealth/js/phmInterfaceService.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/toppanel/js/phmCalculatedScoresService.js','/mobiledoc/jsp/resources/jslib/angular-animate/angular-animate.min.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap.js','/mobiledoc/jsp/webemr/populationhealth/css/widget-wrapper.css','/mobiledoc/jsp/webemr/populationhealth/css/custom.css',"/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.min.js","/mobiledoc/jsp/resources/jslib/perfect-scrollbar/css/perfect-scrollbar.css","/mobiledoc/jsp/resources/jslib/perfect-scrollbar/dist/perfect-scrollbar.min.js","/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js",'/mobiledoc/jsp/webemr/ccm/userfacing/dashboard/enrollmentqueue/js/ccmPcmEnrollmentQueueService.js','/mobiledoc/jsp/webemr/phm/actionHub/js/actionHub-tpl.js','/mobiledoc/jsp/webemr/phm/actionHub/js/actionHubService.js','/mobiledoc/jsp/webemr/populationhealth/css/style.css','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/js/lookup.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/toppanel/js/phmCalculatedScoresController.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/js/notesDirective.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js','/mobiledoc/jsp/webemr/ecwspeech/js/evaspeech.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/css/notesDirective.css','/mobiledoc/jsp/webemr/js/ion.rangeSlider.min.js','/mobiledoc/jsp/webemr/populationhealth/css/jquery-ui-slider-pips.min.css','/mobiledoc/jsp/webemr/populationhealth/css/phmCommandCenterCommon.css','/mobiledoc/jsp/webemr/populationhealth/css/ion.rangeSlider.css','/mobiledoc/jsp/webemr/populationhealth/js/vendor/ion.rangeSlider.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/bhlogs/logsDirective.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/toppanel/js/phmCalcScoreGraph-tpl.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/toppanel/js/phmAcuityGraph-tpl.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/toppanel/js/phmGoalGraph-tpl.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/pgoi/js/phmPgoi-tpl.js','/mobiledoc/jsp/webemr/populationhealth/css/print.css','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/screening/js/printDirective.js','/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/careplanvisit/planofcare/js/phmCarePlanPgoi-tpl.js','/mobiledoc/jsp/webemr/behavioralhealth/utils/bh_utils.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/jquery-ui-draggable.js','/mobiledoc/jsp/webemr/actions/quickAction-tpl.js']}).then(function(){let url='/mobiledoc/populationhealth/phmHub/getPhmHubData/'+scope.patientId;postRequestCall(url,{}).success(function(data,status,headers,config){scope.phmHubData.email=data.patientDetials.email;if(data.patientDetials.facList.length>0)scope.phmHubData.defaultFacility=data.patientDetials.facList[0].name;if(data.patientDetials.insuranceList.length>0&&data.patientDetials.insuranceList[0]!==undefined){scope.phmHubData.insurancePrimary=data.patientDetials.insuranceList[0].insuranceName}if(data.patientDetials.insuranceList.length>0&&data.patientDetials.insuranceList[1]!==undefined){scope.phmHubData.insuranceSec=data.patientDetials.insuranceList[1].insuranceName}if(data.patientDetials.insuranceList.length>0&&data.patientDetials.insuranceList[2]!==undefined){scope.phmHubData.insuranceTer=data.patientDetials.insuranceList[2].insuranceName}if(data.patientDetials.contactList.length>0){scope.phmHubData.mobileNo=data.patientDetials.contactList[0].umobileno;scope.phmHubData.homeNo=data.patientDetials.contactList[0].upPhone}if(data.patientDetials.contactList.length>0){scope.phmHubData.ptFullAddress=data.patientDetials.contactList[0].upaddress+", "+data.patientDetials.contactList[0].upcity+", "+data.patientDetials.contactList[0].upstate+" "+data.patientDetials.contactList[0].zipcode;scope.phmHubData.ptIdentifier=data.patientDetials.ptIdentifier}if(data.patientDetials.facList.length>0){scope.phmHubData.defaultFacilityAddress="";if(angular.isDefined(data.patientDetials.facList[0].addressline1)&&data.patientDetials.facList[0].addressline1.length>0){scope.phmHubData.defaultFacilityAddress+=data.patientDetials.facList[0].addressline1}if(angular.isDefined(data.patientDetials.facList[0].addressline2)&&data.patientDetials.facList[0].addressline2.length>0){scope.phmHubData.defaultFacilityAddress+=" "+data.patientDetials.facList[0].addressline2}if(scope.phmHubData.defaultFacilityAddress.length>0){scope.phmHubData.defaultFacilityAddress+=", "}if(angular.isDefined(data.patientDetials.facList[0].city)&&data.patientDetials.facList[0].city.length>0){scope.phmHubData.defaultFacilityAddress+=" "+data.patientDetials.facList[0].city+", "}if(angular.isDefined(data.patientDetials.facList[0].state)&&data.patientDetials.facList[0].state.length>0){scope.phmHubData.defaultFacilityAddress+=" "+data.patientDetials.facList[0].state+" "}if(angular.isDefined(data.patientDetials.facList[0].zip)&&data.patientDetials.facList[0].zip.length>0){scope.phmHubData.defaultFacilityAddress+=" "+data.patientDetials.facList[0].zip}}scope.phmHubData.facilityLogo=data.patientDetials.facilityLogo;scope.isEdgeBrowser=data.isEdgeBrowser;scope.phmHubData.isEdgeBrowser=data.isEdgeBrowser;scope.phmHubData.ccmrId=data.ccmrId;scope.phmHubData.ptEthnicity=data.patientEthnicity;scope.phmHubData.ptlanguage=data.patientDetials.ptlanguage;scope.phmHubData.interpretationNeeded=data.patientDetials.interpretationNeeded;scope.phmHubData.picFileName=data.patientDetials.picFileName;scope.phmHubData.healowPlusAccess=data.healowPlusAccess;scope.phmHubData.frmVbClient=data.frmVbClient;scope.phmHubData.isWebEmr=data.isWebEmr;scope.phmHubData.strCCMRWebApp=data.strCCMRWebApp;if("progressNoteCurrentAppt"===scope.callFrom||"healthAssessment"===scope.callFrom||"createVirtualVisitFromPN"===scope.callFrom||"hubFromPN"===scope.callFrom){var pnscope=angular.element(document.getElementById('pnController')).scope();var validationNoToCheckOnPHMHub=pnscope.validationNoToCheckOnPHMHub;if(pnscope&&scope.validationNoToCheckOnPhmHub!==validationNoToCheckOnPHMHub.toString()){return}}if(scope.encounterId==undefined||scope.encounterId==0)scope.phmHubData.encounterId=0;else scope.phmHubData.encounterId=parseInt(scope.encounterId);var windowClass='fade custom-modal fluid-modal ';if(scope.isEdgeBrowser)windowClass+='phmhubExe-modal';else windowClass+='phmhubWeb-modal';var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/populationhealth/directives/phmhub/view/phmHubView.html'),controller:'phmHubViewController',controllerAs:'phvCtrl',backdrop:'static',keyboard:false,windowClass:windowClass,resolve:{phmHubData:function(){return scope.phmHubData}}});$('.action-hub-modal').remove();modalInstance.result.then(function(jsonEncDetails){},function(jsonEncDetails){if(scope.callFrom==='healthAssessment'||scope.callFrom==='progressNoteCurrentAppt'){$('.modal-backdrop').remove();if(typeof scope.$parent.$parent.cbCCMRFunc==="function"){scope.$parent.$parent.cbCCMRFunc(jsonEncDetails)}if(typeof scope.refreshSchedule==="function"){scope.refreshSchedule()}}if(jsonEncDetails.dirtyFlag&&jsonEncDetails.activeTab==='healthAssessment'){notification.show("success","","Assessment Updated Successfully",4e3)}modalInstance.close()})})})}function postRequestCall(url,requestParams){return $http({method:'POST',url:url,data:JSON.stringify(requestParams)})}})})}}})})();function onlyNumberKey(evt){var ASCIICode=evt.which?evt.which:evt.keyCode;if(ASCIICode>31&&(ASCIICode<48||ASCIICode>57))return false;return true}