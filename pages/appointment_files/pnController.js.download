(function(){var imported=document.createElement('script');imported.src='/mobiledoc/jsp/webemr/js/jsFunctions.js';var head=document.head||document.getElementsByTagName("head")[0];head.appendChild(imported)})();var nextData={},prevData={};var pnModule=angular.module('pnModule',['ecw.dir.dynamicContent','oc.lazyLoad','ecw.service.EncDetailsService','ecw.dir.centeredmodal','ecw.batchAjax','ecw.telemed.service','ecw.service.PSAC','cfp.hotkeys','ecw.dir.icdConversionServiceApp','QuickSearchDirective']);pnModule.service("PNService",function(){let popupParameters={};var PNService={};PNService.isPNTab=false;return{setParametersForScreen:function(screen,parameters){popupParameters[screen]=parameters},getParametersForScreen:function(screen){let data=popupParameters[screen];delete popupParameters[screen];return data},setIsPNTab:function(isPNTab){PNService.isPNTab=isPNTab;let sunohConversationController;if($(".sunohsummarymaindiv").length>0){sunohConversationController=angular.element(document.getElementsByClassName('sunohsummarymaindiv')[0]).scope()}if(sunohConversationController){if(isPNTab===true){sunohConversationController.isPNTab=true}else{sunohConversationController.isPNTab=false}}},getIsPNTab:function(){return PNService.isPNTab},showWindowLoader:function(){if(document.getElementById("mainPNContent")==null){return}let loadingOverlay=document.createElement("div");loadingOverlay.id="pn-loading-overlay";loadingOverlay.className="pn-loading-overlay";let spinner=document.createElement("div");spinner.className="loader-container";for(let i=0;i<3;i++){let loaderDot=document.createElement("span");loaderDot.innerText=".";spinner.appendChild(loaderDot)}loadingOverlay.appendChild(spinner);document.getElementById("mainPNContent").prepend(loadingOverlay)},hideWindowLoader:function(){if(document.getElementById("pn-loading-overlay")!=null){document.getElementById("pn-loading-overlay").remove()}}}});pnModule.controller('pnController',function($scope,$interval,$ocLazyLoad,EncDetailsService,$templateCache,$modal,mySharedService,$timeout,PSACService,$location,$http,hotkeys,$compile,icd10ConversionService,$attrs,$sce,PNService,$q){$scope.showLoadingImage=function(){document.getElementById("divPNScreenLoader").style.display="";$('[id=divPNScreenLoader]').each(function(index,element){element.style.display='none'})};var pn_content="";var showPNHeaderJS="";var nextXml="";var prevXml="";var encounterId="";var patientId="";var userId="";var sessionId="0";var examAccess10e="";var physicalExamAccess10e="";var assessmentAccess10e="";var procedureAccess10e="";var rosAccess10e="";var hpiAccess10e="";var treatmentAccess10e="";var virtualVisit="";var progressNotesXml="";var sectionAlreadyChanged="";var templateEditAccess="";var tobeMergedTemplate="";var tobeUnMergedTemplate="";var isGroupVisit="";var ImmunizationsAccess10e="";var vitalsAccess10e="";var visionUSEnable=false;var SkinTestAccess10e="";var billingAccess10e="";var therapyAssessmentAccess10e="";var homunculusAccess="";var pnAttrJson=$attrs.pnAttrJson;if(pnAttrJson){var pnAttrJsonObj=JSON.parse(pnAttrJson);showPNHeaderJS=pnAttrJsonObj.showPNHeaderJS?pnAttrJsonObj.showPNHeaderJS:"";nextXml=pnAttrJsonObj.nextXml?pnAttrJsonObj.nextXml:"";prevXml=pnAttrJsonObj.prevXml?pnAttrJsonObj.prevXml:"";encounterId=pnAttrJsonObj.encounterId?pnAttrJsonObj.encounterId:"";patientId=pnAttrJsonObj.patientId?pnAttrJsonObj.patientId:"";userId=pnAttrJsonObj.userId?pnAttrJsonObj.userId:"";examAccess10e=pnAttrJsonObj.examAccess10e?pnAttrJsonObj.examAccess10e:"";physicalExamAccess10e=pnAttrJsonObj.physicalExamAccess10e?pnAttrJsonObj.physicalExamAccess10e:"";rosAccess10e=pnAttrJsonObj.rosAccess10e?pnAttrJsonObj.rosAccess10e:"";hpiAccess10e=pnAttrJsonObj.hpiAccess10e?pnAttrJsonObj.hpiAccess10e:"";treatmentAccess10e=pnAttrJsonObj.treatmentAccess10e?pnAttrJsonObj.treatmentAccess10e:"";assessmentAccess10e=pnAttrJsonObj.assessmentAccess10e?pnAttrJsonObj.assessmentAccess10e:"";procedureAccess10e=pnAttrJsonObj.procedureAccess10e?pnAttrJsonObj.procedureAccess10e:"";virtualVisit=pnAttrJsonObj.virtualVisit?pnAttrJsonObj.virtualVisit:"";sectionAlreadyChanged=pnAttrJsonObj.sectionAlreadyChanged?pnAttrJsonObj.sectionAlreadyChanged:"";templateEditAccess=pnAttrJsonObj.templateEditAccess?pnAttrJsonObj.templateEditAccess:"";tobeMergedTemplate=pnAttrJsonObj.tobeMergedTemplate?pnAttrJsonObj.tobeMergedTemplate:"";tobeUnMergedTemplate=pnAttrJsonObj.tobeUnMergedTemplate?pnAttrJsonObj.tobeUnMergedTemplate:"";isGroupVisit=pnAttrJsonObj.isGroupVisit?pnAttrJsonObj.isGroupVisit:"";ImmunizationsAccess10e=pnAttrJsonObj.ImmunizationsAccess10e?pnAttrJsonObj.ImmunizationsAccess10e:"";vitalsAccess10e=pnAttrJsonObj.vitalsAccess10e?pnAttrJsonObj.vitalsAccess10e:"";SkinTestAccess10e=pnAttrJsonObj.SkinTestAccess10e?pnAttrJsonObj.SkinTestAccess10e:"";billingAccess10e=pnAttrJsonObj.billingAccess10e?pnAttrJsonObj.billingAccess10e:"";therapyAssessmentAccess10e=pnAttrJsonObj.therapyAssessmentAccess10e?pnAttrJsonObj.therapyAssessmentAccess10e:"";homunculusAccess=pnAttrJsonObj.homunculusAccess?pnAttrJsonObj.homunculusAccess:""}$scope.isOfficeVisitProgressNoteOpen=$location.absUrl().indexOf("webemr/progressnotes/physiciansdashboard/dashboard.jsp")>0;$scope.loadQSDxList=function(){$scope.$broadcast('loadQSDxList')};var encObj=EncDetailsService.getEncDetailsByEncId(encounterId);$scope.roomAndStatus={encounterId:encObj.encounterId,encDate:encObj.encDate,context:'PNscreen'};$scope.patientIdentifierDetails=encObj.patientIdentifierDetails;$scope.encLock=encObj.encLock;$scope.currentGlobalContext=currentGlobalContext;$scope.validationNoToCheckOnPHMHub=(new Date).valueOf();const LOAD_BY_DIRECTIVE="loadModuleByDirective";$scope.showQS=isPNTabView($scope.encLock,encObj.encType);if($scope.showQS){$scope.encDtForTreatmentScreen={sContext:'PNscreen',qsMarginTop:-2,nPatientId:patientId,nTrUserId:userId,nEncounterId:encounterId,nDoctorId:EncDetailsService.getProviderId()};$scope.PNQSDetailsReqObj=$scope.encDtForTreatmentScreen;$scope.PNQSDetailsReqObj.nDxItemId=0;$scope.PNQSDetailsReqObj.sActionType="";$scope.PNQSDetailsResponseObj=[];$scope.PNQSDetailsResponseObj.obj=[];$scope.setPNQSDetailsObj=[];$scope.setPNQSDetailsFromXSL=function(){let controller=angular.element("[ng-controller='tabspanelController']");if(controller&&controller.length!==0){let scopeParent=controller.scope();scopeParent.setPNQSDetailsFromPn($scope.PNQSDetailsResponseObj)}}}$scope.setGlobalVariables=setGlobalVariables;function setGlobalVariables(pnContent,pnXml){pn_content=pnContent;progressNotesXml=pnXml}$scope.initPnController=function(){$scope.unmergeTemplateList=$.parseJSON(tobeUnMergedTemplate);$scope.mergeTemplateList=$.parseJSON(tobeMergedTemplate);$scope.showLoadingImage();$scope.pn_content=pn_content;$scope.encounterId=encounterId;$scope.patientId=patientId;$scope.isBhEditable=false;$scope.userId=userId;$scope.sessionId=sessionId;$scope.extmodule={};$scope.popupurl={value:''};$scope.pnpanel={url:""};$scope.loadPNFlag={enable:true};$scope.xmlData=progressNotesXml;$scope.crePreview={url:''};$scope.TemplatePatientId=getItemKeyValue("TemplatePatientId",true);$scope.sectionToLoadByDirective={name:''};$scope.reportWriterObj={screenId:'web_visittype_category',enableReportWriterForEdit:true,keyName:'DynamicForms_VisitType_Category',modelTitle:'Dynamic Forms',isMappedByEnc:true,selectedTemplate:{},modernView:true,patientId:parseInt($scope.patientId,10),showClearDefaults:true,encounterId:parseInt($scope.encounterId,10),chartOptionName:'Dynamic Forms',isModal:false,scdtObj:{screenName:'web_dynamic_forms',parentId:'web_visittype_category',concurencyLockObj:{formName:'DynamicForms',uniqueKey:'DynamicForms'+$scope.encounterId,g_cancel:false,strKey:"",isOpenform:false}}};if(encObj.encLock==='0'){$scope.checkVerifyHistories($scope.xmlData)}$scope.rpm={rpmData:{additionalNotes:''}};if(encObj.visitType==='RPM Visit'){$scope.getRpmPNNotes()}var defaultSectionChanged={"medicalChanged":"false","surgicalChanged":"false","hospChanged":"false","familyChanged":"false","socialChanged":"false","allergyChanged":"false","implantChanged":"false","latestEncChanged":"0","ocularHistChanged":"false","ocularSurgChanged":"false","showOcularHxWarning":"false","showOcularSurgWarning":"false","obHxChanged":"false","gynHxChanged":"false","bhHistoryChanged":"false"};sectionAlreadyChanged=checkIfJSONEmpty(sectionAlreadyChanged)?defaultSectionChanged:JSON.parse(sectionAlreadyChanged);if(getUserProfile('donotshowUnReconciledWarning')!="1"){var warning="";if(sectionAlreadyChanged.surgicalChanged=="true"||sectionAlreadyChanged.showOcularSurgWarning=="true")warning="Surgical History";if(sectionAlreadyChanged.hospChanged=="true"){if(warning!="")warning+=", ";warning+="Hospitalization"}if(sectionAlreadyChanged.medicalChanged=="true"||sectionAlreadyChanged.showOcularHxWarning=="true"){if(warning!="")warning+=", ";warning+="Medical History"}if(sectionAlreadyChanged.allergyChanged=="true"){if(warning!="")warning+=", ";warning+="Allergies"}if(sectionAlreadyChanged.familyChanged=="true"){if(warning!="")warning+=", ";warning+="Family History"}if(sectionAlreadyChanged.socialChanged=="true"){if(warning!="")warning+=", ";warning+="Social History"}if(sectionAlreadyChanged.implantChanged=="true"){if(warning!="")warning+=", ";warning+="Implants"}if(sectionAlreadyChanged.dentalChanged=="true"){if(warning!="")warning+=", ";warning+="Dental History"}if(sectionAlreadyChanged.ocularHistChanged=="true"){if(warning!="")warning+=", ";warning+="Ocular History"}if(sectionAlreadyChanged.ocularSurgChanged=="true"){if(warning!="")warning+=", ";warning+="Ocular Surgical History"}if(sectionAlreadyChanged.obHxChanged==="true"){if(warning!=="")warning+=", ";warning+="OB History"}if(sectionAlreadyChanged.gynHxChanged==="true"){if(warning!=="")warning+=", ";warning+="Gyn History"}if(sectionAlreadyChanged.bhHistoryChanged==="true"&&encObj.dataAssessmentPlanFlag===true){if(warning!=="")warning+=", ";warning+="Behavioral History"}if(warning!=""){ecwConfirm(warning+' will not be updated in the right panel.',"eClinicalWorks",function(){var userProfileKeyValPair={};userProfileKeyValPair["donotshowUnReconciledWarning"]="1";updateUserProfileLocalCache("donotshowUnReconciledWarning","1");saveUserProfileSettings(userProfileKeyValPair)},function(){},"","",false,"Don't show this warning again.","Close",'tempClass in')}}function countProperties(obj){var keys=[];$.each(obj,function(key,value){keys.push(key)});var numberOfKeys=keys.length;return numberOfKeys}var unmergecount=countProperties($scope.unmergeTemplateList);var mergecount=countProperties($scope.mergeTemplateList);if(unmergecount>0){var valStr="The following templates which were merged previously, are now not linked with this encounter as services and packages were updated.<br/>";var count=0;var unmergeTemplateIds="";$.each($scope.unmergeTemplateList,function(key,value){valStr+=++count+". "+escapeHtml(value)+"<br/>";unmergeTemplateIds+=key+","});if(unmergeTemplateIds.length>0)unmergeTemplateIds=unmergeTemplateIds.substring(0,unmergeTemplateIds.length-1);valStr+="<br/>Please make necessary changes in the Progress Notes.<br/>";ecwConfirm(valStr,"eClinicalWorks",function(){if(mergecount>0){valStr="The following templates are linked with this encounter as there were services and packages added.<br/>";count=0;var mergeTemplateIds="";$.each($scope.mergeTemplateList,function(key,value){valStr+=++count+". "+escapeHtml(value)+"<br/>";mergeTemplateIds+=key+","});if(mergeTemplateIds.length>0)mergeTemplateIds=mergeTemplateIds.substring(0,mergeTemplateIds.length-1);valStr+="<br/>Are you sure you want to merge these templates?<br/>";ecwConfirm(valStr,"eClinicalWorks",function(){var url="/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/copymergeTemplate.jsp?encounterId="+encounterId+"&TrUserId="+userId+"&templateIds="+mergeTemplateIds+"&unmergeTemplateIds="+unmergeTemplateIds;url=makeURL(url);$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},method:'POST',url:url,"async":false}).success(function(response){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}).error(function(){})},function(){var url="/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/copymergeTemplate.jsp?encounterId="+encounterId+"&TrUserId="+userId+"&templateIds="+"&unmergeTemplateIds="+unmergeTemplateIds;url=makeURL(url);$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},method:'POST',url:url,"async":false}).success(function(response){}).error(function(){})},"","",false,"OK","Cancel",'tempClass in')}else{var url="/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/copymergeTemplate.jsp?encounterId="+encounterId+"&TrUserId="+userId+"&templateIds="+"&unmergeTemplateIds="+unmergeTemplateIds;url=makeURL(url);$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},method:'POST',url:url,"async":false}).success(function(response){}).error(function(){})}},function(){var url="/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/copymergeTemplate.jsp?encounterId="+encounterId+"&TrUserId="+userId+"&templateIds="+"&unmergeTemplateIds="+unmergeTemplateIds;url=makeURL(url);$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},method:'POST',url:url,"async":false}).success(function(response){}).error(function(){})},"","",false,"OK","Cancel",'tempClass in')}else if(mergecount>0){valStr="The following templates are linked with this encounter as there were services and packages added.<br/>";count=0;var mergeTemplateIds="";$.each($scope.mergeTemplateList,function(key,value){valStr+=++count+". "+escapeHtml(value)+"<br/>";mergeTemplateIds+=key+","});if(mergeTemplateIds.length>0)mergeTemplateIds=mergeTemplateIds.substring(0,mergeTemplateIds.length-1);valStr+="<br/>Are you sure you want to merge these templates?<br/>";ecwConfirm(valStr,"eClinicalWorks",function(){var url="/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/copymergeTemplate.jsp?encounterId="+encounterId+"&TrUserId="+userId+"&templateIds="+mergeTemplateIds+"&unmergeTemplateIds=";url=makeURL(url);$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},method:'POST',url:url,"async":false}).success(function(response){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}).error(function(){})},function(){},"","",false,"OK","Cancel",'tempClass in')}var televisitProviderID;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){televisitProviderID=EncDetailsService.getEncDetails().providerId}mySharedService.prepForBroadcast($scope.encounterId,$scope.patientId,$scope.userId,televisitProviderID);if(getItemKeyValue('visionUSEnable')&&getItemKeyValue('visionUSEnable').toLowerCase()=='yes'){visionUSEnable=true}$scope.customPopupSectionsArray=['Past Results:','Immunizations:','Therapeutic Injections:','Dental Examination/Plan:','Dermatology Examination:','Problems:','Operative Report:','Diagnostic studies:','Interventions:','Transition Care Management:'];$scope.customPopupClassesArray=['lablink','xraylink','aoeStatusLink','ProcedureReportlink','ImmLink','InjLink','assessmentlink','Referral','PastOrderLink','actionlink','AudiologyWorkFlow','aucStatusLink'];$scope.modalInstanceSectionArray=['Lab Reports:','Diagnostic Imaging:','Procedure Orders:','Disposition & Communication:','Allergy Test:','Warfarin Flowsheet:','Venous Examination:','Behavioral Health Treatment Plan:','RPM Data:','RPM Notes:'];function initializeNextPrevSections(){let url="/mobiledoc/jsp/webemr/common/getNextPrevSections.jsp?encounterId="+encObj.encounterId;$.ajax({method:"GET",url:makeURL(url),headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(response){let nextPrevSectionsJson=JSON.parse(response);let x2js=new X2JS;let nextJsonData=x2js.xml_str2json(nextPrevSectionsJson['nextXml']);let prevJsonData=x2js.xml_str2json(nextPrevSectionsJson['prevXml']);let nextArr=returnDataArray(nextJsonData.Envelope.Body["return"].section);let prevArr=returnDataArray(prevJsonData.Envelope.Body["return"].section);for(let i=0;i<nextArr.length;i++){nextData[nextArr[i].current]=nextArr[i].next}for(let i=0;i<prevArr.length;i++){prevData[prevArr[i].current]=prevArr[i].prev}})}initializeNextPrevSections();var isMUSearch=getItemKeyValue("MU2-SearchPN")!==''&&getItemKeyValue("MU2-SearchPN").toString().toLowerCase()==='yes'?true:false;$scope.patient_MUData={title:EncDetailsService.getCaption(patientId,encounterId),text:'',navigationEnabled:false,searchedElementIndex:-1,isItemKeyEnabled:isMUSearch,count:0};$scope.getKeyNameForSection=function(section){if(section=="Social")return"SocialHistory";else if(section=="Procedure")return"Procedures";else if(section=="Preventive")return"PreventiveMedicine";return section};var visionVisitFlag=false;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().visionVisitFlag){visionVisitFlag=EncDetailsService.getEncDetails().visionVisitFlag}let specialtiesVisibleInVV=(encObj.encType==='2'||encObj.encType===2)&&virtualVisit==='virtualVisit'&&isItemKeyEnabled("SpecialtiesInTelephoneEncounter");if(visionUSEnable&&(visionVisitFlag||specialtiesVisibleInVV)){$scope.progressnote={visionUSTemplate:"/mobiledoc/jsp/webemr/progressnotes/usvision/visionUSTemplate.jsp",pretestUrl:"/mobiledoc/jsp/webemr/progressnotes/usvision/pretest/pretestPN.jsp",specRxUrl:"/mobiledoc/jsp/webemr/progressnotes/usvision/spectaclerx/spectacleRxPN.jsp",contactlensUrl:"/mobiledoc/jsp/webemr/progressnotes/usvision/contactlens/contactlensPN.jsp",spclTestsUrl:"/mobiledoc/jsp/webemr/progressnotes/usvision/specialtests/specialTestsPN.jsp",visionExaminationUrl:"/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/visionExaminationPN.jsp",enableInplaceEdit:!specialtiesVisibleInVV};$scope.renderUnLockProgressNote=function(xmlData){let x2js=new X2JS;var xmlJson=x2js.xml_str2json(xmlData);try{$scope.visionItemsArr=[];var subItems=returnDataArray(xmlJson.Envelope.Body["return"].subItems);var globalSettings=returnDataArray(xmlJson.Envelope.Body["return"]);$scope.thumbNailHeight=globalSettings[0].ThumbNailHeight;$scope.showThumbNailsInProgressNotes=globalSettings[0].ShowThumbNailsInProgressNotes;$scope.fromProjectE=globalSettings[0].fromProjectE;$scope.randomVar=globalSettings[0].randomVar;for(index=0;index<subItems.length;index++){if(subItems[index].subItemsName=="Objective:"||subItems[index].subItemsName=="Data:"){var items=subItems[index].item;for(subindex=0;subindex<items.length;subindex++){if(items[subindex].itemName=="Vision:"){$scope.visionItemsArr=items[subindex].visionsubitems.item;if(items[subindex].visionsubitems.itemDrawing){$scope.visionItemsArr.push(items[subindex].visionsubitems.itemDrawing)}break}}}}}catch(err){}$scope.hpiCat=[];$scope.historyconsult=[];var m=0;try{for(m=0;m<$scope.visionItemsArr.length;m++){if($scope.visionItemsArr[m].itemName=="PreTest:"){if($scope.visionItemsArr[m].Refraction)$scope.refraction=$scope.visionItemsArr[m].Refraction;if($scope.visionItemsArr[m].Retinoscopy)$scope.retinoscopy=$scope.visionItemsArr[m].Retinoscopy;$scope.category=JSON.parse(unescapeHtmlForJsonString(JSON.stringify($scope.visionItemsArr[m].PreTestData)));$scope.category.IOPS.IOP=returnDataArray($scope.category.IOPS.IOP)}if($scope.visionItemsArr[m].itemName=="ContactLens:"){$scope.contactlens=$scope.visionItemsArr[m].ContactLensData;$scope.contactlens.PCRS.PCR=returnDataArray($scope.contactlens.PCRS.PCR);$scope.contactlens.FCRS.FCR=returnDataArray($scope.contactlens.FCRS.FCR);$scope.contactlens.TRXS.TRX=returnDataArray($scope.contactlens.TRXS.TRX)}if($scope.visionItemsArr[m].itemName=="SpectacleRx:"){$scope.spectaclerx=JSON.parse(unescapeHtmlForJsonString(JSON.stringify($scope.visionItemsArr[m].SpectacleRx)))}if($scope.visionItemsArr[m].itemName=="SpecialTests:"){$scope.spcltests=JSON.parse(unescapeHtmlForJsonString(JSON.stringify($scope.visionItemsArr[m].SpecialTests)));$scope.spcltests.AMSLER.r_eye=JSON.parse($scope.spcltests.AMSLER.r_eye);$scope.spcltests.AMSLER.l_eye=JSON.parse($scope.spcltests.AMSLER.l_eye)}if($scope.visionItemsArr[m].itemName==="VisionExamData:"){$scope.visionexamData=getVisionExamArray($scope.visionItemsArr[m].VisionExamData.visionExamData);handleHTMLContentForVisionExamScreen()}else if($scope.visionItemsArr[m].itemName==="MotilityData:"){$scope.motilityData=getMotilityArray(JSON.parse(unescapeHtmlForJsonString(JSON.stringify($scope.visionItemsArr[m].MotilityData))));$scope.ductionSectionEmpty=!checkIfDuctionEmpty($scope.motilityData.ductionsSection,false);$scope.ductionEmpty=!checkIfDuctionEmpty($scope.motilityData.ductionsSection,true);$scope.motilityData.examsData=checkEmptyAndReturnVersionData($scope.motilityData.motilitySection.examsData)}else if($scope.visionItemsArr[m].itemName==="VisionDrawing:"){$scope.obj={};if($scope.visionItemsArr[m].item.Drawing){if(globalSettings[0].ShowThumbNailsInProgressNotes==='yes'){$scope.obj.ShowThumbNailsInProgressNotes=true;$scope.obj.drawImageIframe="/mobiledoc/jsp/catalog/xml/imageInPN.jsp?section=Vision&encId="+globalSettings[0].EncounterId+"&catId=1&itemId=1&TrUserId="+globalSettings[0].TrUserId+"&webInking="+globalSettings[0].fromProjectE+"&random="+globalSettings[0].randomVar;$("#imageIframe").height(globalSettings[0].ThumbNailHeight)}else{$scope.obj.ShowThumbNailsInProgressNotes=false;$scope.obj.Drawing=[];if($.isArray($scope.visionItemsArr[m].item.Drawing)){$scope.obj.Drawing=$scope.visionItemsArr[m].item.Drawing}else{$scope.obj.Drawing.push($scope.visionItemsArr[m].item.Drawing)}}$scope.obj.showVisionDrawing=true}else{$scope.obj.showVisionDrawing=false}}}}catch(err){console.log(err)}};$scope.renderUnLockProgressNote(progressNotesXml)}function handleHTMLContentForVisionExamScreen(){if($scope.visionexamData){for(var index=0;index<$scope.visionexamData.length;index++){$scope.visionexamData[index].catname=unescapeHtml($scope.visionexamData[index].catname);if($scope.visionexamData[index].children){var visionExamCategoryData=$scope.visionexamData[index].children;for(var j=0;j<visionExamCategoryData.length;j++){visionExamCategoryData[j].fieldgroupname=unescapeHtml(visionExamCategoryData[j].fieldgroupname);makeHTMLSafeForVisionExam(visionExamCategoryData[j].children)}}}}}function makeHTMLSafeForVisionExam(observations){if(!observations)return;for(var observationIndex=0;observationIndex<observations.length;observationIndex++){observations[observationIndex].fieldname=unescapeHtml(observations[observationIndex].fieldname);var rightEyeObservations=angular.copy(observations[observationIndex].righteyeobservations.toString());if(rightEyeObservations)observations[observationIndex].righteyeobservations=$sce.trustAsHtml(rightEyeObservations);var leftEyeObservations=angular.copy(observations[observationIndex].lefteyeobservations.toString());if(leftEyeObservations)observations[observationIndex].lefteyeobservations=$sce.trustAsHtml(leftEyeObservations)}}if(encObj&&encObj.dataAssessmentPlanFlag===true){$scope.bh_TimerInit()}};$scope.isACOWorksheet=false;$scope.loadBiopsyPopup=function(procedure,procItemId,regionId){$scope.inkingUrl="";var data={};var enc={"name":encObj.name,"encFormattdDate":encObj.encFormattdDate,"encFormattdDate":encObj.encFormattdDate,"visitType":encObj.visitType};enc=escape(JSON.stringify(enc));module="dermatologyModal";url="/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.jsp?action=biopsydetails&encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&procItemId="+procItemId+"&regionId="+regionId+"&enc="+enc;var files=['/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.js'];data.url=url;data.dependencies=files;data.modulename=module;$scope.ocLazyLoadPopup(data,"custom")};$scope.showIHLabResultEntryScreen=function(reportId,userId){$ocLazyLoad.load({name:'InHouseLabResultsApp',files:getDependencies('InHouseLabResultsApp')}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/labs/INHouseLabResult/InHouseLabResult.html'),controller:'InHouseLabResultsController as IHLabController',windowClass:'app-modal-window1 bluetheme',backdrop:"static",keyboard:false,resolve:{reportId:function(){return reportId},TrUserId:function(){return userId}}});modalInstance.opened.then(function(){addAsyncScreeHtmlId('InhouseLabResultEntryScreen')});modalInstance.result.then(function(modalInstanceResponse){removeAsyncScreeHtmlId('InhouseLabResultEntryScreen');refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")},function(modalInstanceResponse){console.log(modalInstanceResponse);if(modalInstanceResponse=="success"){}removeAsyncScreeHtmlId('InhouseLabResultEntryScreen')})})};function addAsyncScreeHtmlId(screenHtmlId){if(typeof AsyncModule==='undefined'){return}else{AsyncModule.addModalId(screenHtmlId)}}function removeAsyncScreeHtmlId(screenHtmlId){if(typeof AsyncModule==='undefined'){return}else{AsyncModule.screenHtmlId=screenHtmlId;AsyncModule.removeModalId(AsyncModule.screenHtmlId)}}$scope.pnPinkPaperClipUrl='';$scope.openPNPinkPaperClip=function(reportId,labReportType){$ocLazyLoad.load({name:'PinkPaperClip',files:['/mobiledoc/jsp/webemr/labs/pinkpaperclip/js/pinkPaperClip.js']}).then(function(){$scope.pnPinkPaperClipUrl=makeURL('/mobiledoc/jsp/webemr/labs/pinkpaperclip/pinkPaperClipModal.jsp?Src=LabResultsScreenModal&encounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&reportId='+reportId+'&labType='+labReportType)},function(e){alert('An error occurred while loading Pink PaperClip.')})};$scope.removePNPinkPaperUrl=function(){$templateCache.remove($scope.pnPinkPaperClipUrl);$scope.pnPinkPaperClipUrl=null};let isClickEventInProgress=false;$scope.loadProgressNotePopup=function(pnSectionName,categoryId,notes,propId,propName,className){if(isClickEventInProgress){return}isClickEventInProgress=true;let timeoutId;timeoutId=$timeout(function(){isClickEventInProgress=false;clearTimeout(timeoutId)},1e3);if(event){event.preventDefault();event.stopPropagation()}EncDetailsService.getEncDetailsByEncId($scope.encounterId);var argumentVar={categoryId:categoryId,pnSectionName:pnSectionName,notes:notes,propId:propId,propName:propName,className:className};saveUnsavedAndLoad(argumentVar,loadPNPopupCallback)};$scope.showMedSummaryAlert=function(){var labType=0;var parentname="MedicationAlerts";var medicationAlertDataObject={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:global.TrUserId,parentName:parentname,requestedFrom:'frmPNRightPanel',context:'frmPNRightPanel',nDxId:""};$ocLazyLoad.load({name:'medicationSummAlertApp',files:['/mobiledoc/jsp/webemr/rightpanel/js/medicationAlerts.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/rightpanel/medicationAlerts.jsp"),controller:'medicationSummAlertController',windowClass:'app-modal-window bluetheme',backdrop:"static",resolve:{medicationAlertDataObject:function(){return medicationAlertDataObject}}});modalInstance.result.then(function(responseObj){},function(responseObj){if(responseObj=='success'){$scope.hasMedicationAlerts=false}})})};var loadPNPopupCallback=function(args){loadProgressNotePopupHandler(args.pnSectionName,args.categoryId,args.notes,args.propId,args.propName,args.className)};var saveUnsavedAndLoad=function(args,callback){var section=isAnyUnsavedSection();if($scope.unsavedSection[section.toLowerCase()]&&$scope.unsavedSection[section.toLowerCase()].length>0){$scope.unsavedSection[section.toLowerCase()]=[];$scope.$broadcast('saveInlineCategory',{callBack:callback,argumentVar:args})}else{callback(args,true)}};var loadProgressNotePopupHandler=function(pnSectionName,categoryId,notes,propId,propName,className){var isPermitted=checkPermissionForPNLinks(pnSectionName,categoryId);if(isPermitted){if(!($scope.TemplatePatientId==$scope.patientId)){var dt=EncDetailsService.getEncDetails().encDate;var providerid=EncDetailsService.getEncDetails().providerId;if(isLicenseValid(providerid,dt)==false){ecwAlert('License has expired');return}else{if(pnSectionName==="Surgical Posting:"){var surgicalPostingParentId=getItemKeyValue("SurgicalInterface",true);if(surgicalPostingParentId<=0){ecwAlert("Surgical Posting is not configured properly. Please contact eclinicalworks support.");return}}loadPNPopup(pnSectionName,categoryId,notes,propId,propName,className)}}else{if(templateEditAccess=='false'){ecwAlert("You do not have permission to modify this template.Contact Admin.","Template Permission");return}else{loadPNPopup(pnSectionName,categoryId,notes,propId,propName,className)}}}else{if(pnSectionName=="Current Medication:")showAlertMessage('<b>Current Medication - Security Setting</b><br/><br/>You do not have permission to access Current Medication. Access to this area is Controlled by security setting <b>Corrections - Allow access to Current Medication</b>.<br/><br/>Please contact your practice administrator to request access.','','SecurityMsg','','');else alert("Permission denied")}var isACOWorksheetFlg=getItemKeyValue("EnableACOWorksheet");var isCQWShowLinkInRHP=getItemKeyValue("CQWShowLinkInRHP");if(isACOWorksheetFlg.toLowerCase()=="yes"&&isCQWShowLinkInRHP.toLowerCase()=="no"){$scope.isACOWorksheet=true;$scope.checkForCQWUnAnsweredFound()}};var loadPNPopup=function(pnSectionName,categoryId,notes,propId,propName,className){$scope.popupurl={value:""};var encDate='';var encTime='';if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().encDate){encDate=EncDetailsService.getEncDetails().encDate;encTime=EncDetailsService.getEncDetails().encTime}encDate=convertDateInToFormat(encDate,"yyyy-mm-dd","mm-dd-yyyy");var diff=checkForFutureEncounter(encDate,encTime,'-');if(diff>0&&getUserConfiguration("ID_102")){let confirmMessage='The encounter is scheduled on future date: '+escapeHtml(encDate.replace(/-/g,"/"))+'. Are you sure you want to continue?';confirmMessage="<b>Progress Notes - Future Encounter Documentation</b></br></br>"+confirmMessage+"</br></br>Note: If the <b>encounter</b> is subsequently marked as a <b>no show, cancelled,</b> or <b>rescheduled,</b> any <b>Problem List, Diagnoses,</b> and <b>Orders</b> added in this encounter will <b>remain</b> in the <b>patient’s medical record.</b>";$scope.callBackForFutureEncounter=function(promptResponse){if(promptResponse&&promptResponse.toLowerCase()==='yes'){$scope.loadProgressNote(pnSectionName,categoryId,notes,propId,propName,className)}};showAlertMessage(confirmMessage,"","ConfirmMsg","callBackForFutureEncounter","pnController","700px","Continue","Cancel")}else{$scope.loadProgressNote(pnSectionName,categoryId,notes,propId,propName,className)}};$scope.cqwShowRedIcon=false;$scope.checkForCQWUnAnsweredFound=function(){$scope.cqwShowRedIcon=false;var url="/mobiledoc/jsp/webemr/sws/isUnansweredFound.jsp";url=makeURL(url);var param="encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;$.ajax({headers:{'Content-Type':'application/x-www-form-urlencoded'},dataType:'text',method:'POST',url:url,data:param}).success(function(response){$scope.$apply(function(){if($.trim(response)==='true'){$scope.cqwShowRedIcon=true}})})};$scope.loadPtedPrint=function(sUrl,sReleaseDate,sContentId,sLanguage){$ocLazyLoad.load({name:'PtEdLogModule',files:['/mobiledoc/jsp/webemr/pteducation/js/PtEdLog.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/pteducation/PtEdLog.jsp?contentId='+sContentId+'&language='+sLanguage),controller:'PtEdLogCtrl',windowClass:'app-modal-window bluetheme',backdrop:"static",resolve:{version:function(){return sReleaseDate},url:function(){return sUrl}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){console.log(modalInstanceResponse)})})};$scope.refreshBhSignature=function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")};$scope.confirmDeleteBhSignature=function(signatureId){commonWarningPopup({screenName:'Progress Notes',screenTitle:'Delete Signature',buttons:[{label:"Delete Signature",cssClass:'btn-blue',callbackEvent:function(){deleteBhSignature(signatureId)}},{label:'Cancel',cssClass:'btn-lgrey',callbackEvent:function(){}}],message:'Are you sure you want to <b>delete</b> signature?',isConfirmPopup:true,isKeyboardClose:true,screenSpecificClass:'bhSignatureCommonWarning'},$ocLazyLoad,$modal)};function deleteBhSignature(signatureId){let url='/mobiledoc/behavioralhealth/saveSiganature/deleteSignatureForBHProgressNotes';httpPostWithData(url,signatureId).then(function(response){if(response&&response.data&&response.data.success)refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");else ecwAlert('Error occurred while deleting signature.','','bluetheme')},function(e){ecwAlert('Error occurred while deleting signature','','bluetheme')})}var checkPermissionForPNLinks=function(pnSectionName,categoryId){var ispermittedlink=true;switch(pnSectionName){case"HPI:":case GetCaptionForSoapItem("HPI")+":":if(hpiAccess10e==="false"){ispermittedlink=false}break;case"ROS:":case GetCaptionForSoapItem("ROS")+":":if(rosAccess10e==="false"){ispermittedlink=false}break;case"Physical Examination:":case GetCaptionForSoapItem("Physical Examination")+":":if(physicalExamAccess10e==="false"){ispermittedlink=false}break;case"Procedures:":case GetCaptionForSoapItem("Procedures")+":":if(procedureAccess10e==="false"){ispermittedlink=false}break;case"Examination:":case GetCaptionForSoapItem("Examination")+":":if(examAccess10e==="false"){ispermittedlink=false}break;case"Assessment:":if(assessmentAccess10e==="false"){ispermittedlink=false}break;case"Immunizations:":if(ImmunizationsAccess10e==="false"){ispermittedlink=false}break;case"Therapeutic Injections:":if(ImmunizationsAccess10e==="false"){ispermittedlink=false}break;case"Vitals:":if(vitalsAccess10e==="false"){ispermittedlink=false}break;case"Treatment:":if(treatmentAccess10e==="false"){ispermittedlink=false}break;case"Allergy Test:":if(SkinTestAccess10e==="false"){ispermittedlink=false}break;case"Warfarin Flowsheet:":case"Next Appointment:":case"Visit Code:":case"Procedure Codes:":case"Billing:":case"Operative Report:":if(pnSectionName==="Operative Report:"&&(categoryId!="Visit Code:"&&categoryId!="Procedure Codes:")){ispermittedlink=true}else{if(billingAccess10e==="false"){ispermittedlink=false}}break;case"Physical Therapy Assessment:":if(therapyAssessmentAccess10e==="false"){ispermittedlink=false}break;case"Homunculus Examination:":case GetCaptionForSoapItem("Homunculus Examination")+":":if(homunculusAccess==="false"){ispermittedlink=false}break;case"Current Medication:":case"Current Medication(s):":if("yes"===getItemKeyValue("EnableCorrectionalFeatures",false)&&!getPermission("AllowAccessToMedRec",global.TrUserId)){ispermittedlink=false}break;default:ispermittedlink=true}return ispermittedlink};function loadPnModalByDirective(popupData,categoryId){if(popupData.modulename==='hpi'){let firstCatItem;let hpi_localstorage=getImprovedHPICategoryData();if(!categoryId){firstCatItem=getFirstTreeItem(hpi_localstorage)}firstCatItem=firstCatItem||{id:'',label:''};$scope.hpiModal=new HpiModalDetails;$scope.hpiModal.categoryId=categoryId||0;$scope.hpiModal.defaultCategoryId=firstCatItem.id;$scope.hpiModal.defaultCategoryLabel=firstCatItem.label;$scope.hpiModal.parentId=hpi_localstorage[0].parentId;$scope.sectionToLoadByDirective.name='HPI'}else if(popupData.modulename==='examination'){let firstCatItem;let defaultExamId;let exam_localstorage=getExaminationCategory();if(!categoryId){firstCatItem=getFirstTreeItem(exam_localstorage);defaultExamId=getItemKeyValue("DefaultExamId",true)}firstCatItem=firstCatItem||{id:'',label:''};defaultExamId=defaultExamId||0;$scope.examModal=new ExamModalDetails;$scope.examModal.categoryId=categoryId||0;$scope.examModal.defaultCategoryId=firstCatItem.id;$scope.examModal.defaultCategoryLabel=firstCatItem.label;$scope.examModal.parentId=exam_localstorage[0].parentId;$scope.examModal.defaultExamId=defaultExamId;$scope.examModal.virtualVisit=virtualVisit?virtualVisit:'';$scope.sectionToLoadByDirective.name='Exam'}}function HpiModalDetails(){this.categoryId=0;this.parentId=0;this.defaultCategoryId=0;this.defaultCategoryLabel=''}function ExamModalDetails(){this.categoryId=0;this.defaultCategoryId=0;this.defaultCategoryLabel='';this.parentId=0;this.defaultExamId=0;this.virtualVisit=''}function emptyHpiModalDetails(){$scope.hpiModal={}}function emptyExaminationModalDetails(){$scope.examModal={}}function emptyPnModalComponentDetails(){$scope.popupurl.value='';$scope.sectionToLoadByDirective.name='';emptyHpiModalDetails();emptyExaminationModalDetails()}$scope.loadProgressNote=function(pnSectionName,categoryId,notes,propId,propName,className){var isPermitted=checkPermissionForPNLinks(pnSectionName,categoryId);if(isPermitted){if(pnSectionName=="Callback History:")return;if(categoryId=='Visit Code:'||categoryId=='Procedure Codes:'||!$scope.requiresCustomModal(pnSectionName,className)&&!$scope.requiresModalInstance(pnSectionName,className)&&!$scope.isAdditionalNotes(pnSectionName,categoryId)){if(!$scope.loadPNFlag.enable){$scope.loadPNFlag.enable=true;return}if(pnSectionName=="Care Plan:"){$ocLazyLoad.load({name:'CcmrFuncs',files:['/mobiledoc/jsp/webemr/ccmr/js/ccmrFuncs.js']}).then(function(){$scope.cbCCMRFunc=function(encDetails){if(encDetails.action==="refreshDashboard")refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");else refreshFullDashboard($scope.encounterId,$scope.patientId,"progressNote",encDetails.lockStatus,encObj.encType)};CCMRFuncs($scope,$ocLazyLoad).pnCarePlanLink($scope.patientId,$scope.encounterId,$scope.userId)},function(e){console.log(e)});return}if(pnSectionName=="Health Risk Assessment:"){$ocLazyLoad.load({name:'CcmrFuncs',files:['/mobiledoc/jsp/webemr/ccmr/js/ccmrFuncs.js']}).then(function(){$scope.cbCCMRFunc=function(encDetails){if(encDetails.action==="refreshDashboard")refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");else refreshFullDashboard($scope.encounterId,$scope.patientId,"progressNote",encDetails.lockStatus,encObj.encType)};CCMRFuncs($scope,$ocLazyLoad).pnHRALink($scope.patientId,$scope.encounterId,$scope.userId)},function(e){console.log(e)});return}if(pnSectionName==="Super Bill:"){var d=new Date;$scope.specialtyformurl="";$ocLazyLoad.load({name:"SuperbillModule",cache:true,files:['/mobiledoc/jsp/webemr/superbill/SuperbillController.js']}).then(function(){var ht=$("#mainPNDialog").css("height");var wd=$("#mainPNDialog").css("width");if(ht===undefined){ht=""}if(wd===undefined){wd=""}var url="/mobiledoc/jsp/webemr/superbill/SuperbillContainer.jsp?isCallingFromNavPanel=true&encid="+$scope.encounterId+"&templateid=1&ICDAssign=One&sessionDID=0&TrUserId="+$scope.userId+"&pid="+$scope.patientId+"&ecwappprocessid=0&rnd2="+d.getMilliseconds()+"&timestamp="+d.getMilliseconds();url=url+"&ht="+ht+"&wd="+wd;$scope.specialtyformurl=makeURL(url)},function(e){ecwAlert("Could not load Super Bill module.")});return}if(pnSectionName=="Summary:"){$ocLazyLoad.load({name:'CcmrFuncs',files:['/mobiledoc/jsp/webemr/ccmr/js/ccmrFuncs.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js']}).then(function(){$scope.cbCCMRVsFunc=function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")};CCMRFuncs($scope,$ocLazyLoad).pnVisitSummary()},function(e){console.log(e)});return}if(pnSectionName==='Dynamic Forms:'){$scope.reportWriterObj.selectedTemplate={};if(categoryId){$scope.reportWriterObj.selectedTemplate.id=parseInt(categoryId.replace('DYNAMIC_FORM_',''),10)}}$scope.loadPNFlag.enable=true;var encDate='';var encTime='';if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().encDate){encDate=EncDetailsService.getEncDetails().encDate;encTime=EncDetailsService.getEncDetails().encTime}var popupData=$scope.getPopupData(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime);emptyPnModalComponentDetails();$scope.pnpanel.url="";if(popupData.url==''){ecwAlert(pnSectionName+"Its under development. Please contact eclinicalworks support for more details.");return}$scope.section=pnSectionName;$ocLazyLoad.load({name:'pnModalApp',files:['/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModalController.js'],cache:true}).then(function(){$scope.pnpanel.url='/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModal.jsp?source=pnController&encounterId='+$scope.encounterId+'&patientId='+$scope.patientId;if(popupData.url===LOAD_BY_DIRECTIVE){$ocLazyLoad.load({name:popupData.modulename,serie:popupData.seriesLoadFlag?popupData.seriesLoadFlag:false,files:popupData.dependencies}).then(function(){$timeout(function(){$("#pn").modal('show');$("#pnstyleloader").show();loadPnModalByDirective(popupData,categoryId)},0)},function(e){ecwAlert("Sorry! We could not load the requested module:"+popupData.modulename)})}else{$("#pn").modal('show');$("#pnstyleloader").show();$scope.ocLazyLoadPopup(popupData,"")}},function(e){alert(e);console.log(e)})}else if($scope.requiresModalInstance(pnSectionName,className)||$scope.isAdditionalNotes(pnSectionName,categoryId)){$scope.openModalInstance(pnSectionName,className)}else{var encDate='';if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().encDate){encDate=EncDetailsService.getEncDetails().encDate;encTime=EncDetailsService.getEncDetails().encTime}var popupData=$scope.getPopupData(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime);if(popupData.url==''){ecwAlert(pnSectionName+" Its under development. Please contact eclinicalworks support for more details.");return}if(pnSectionName=='Referral:'){PSACService.checkBothStaffAndChartPermission($scope.patientId,$scope.encounterId,"","",function(data){$scope.ocLazyLoadPopup(popupData,"custom")},function(data){})}else{$scope.ocLazyLoadPopup(popupData,"custom")}}}else{if(pnSectionName=="Current Medication:")showAlertMessage('<b>Current Medication - Security Setting</b><br/><br/>You do not have permission to access Current Medication. Access to this area is Controlled by security setting <b>Corrections - Allow access to Current Medication</b>.<br/><br/>Please contact your practice administrator to request access.','','SecurityMsg','','');else alert("Permission denied")}};$scope.requiresCustomModal=function(pnSectionName,pnClassName){for(var i=0;i<$scope.customPopupSectionsArray.length;i++){if($scope.customPopupSectionsArray[i]==pnSectionName){return true}}for(var i=0;i<$scope.customPopupClassesArray.length;i++){if($scope.customPopupClassesArray[i]==pnClassName){return true}}return false};$scope.requiresModalInstance=function(pnSectionName,pnClassName){for(var i=0;i<$scope.modalInstanceSectionArray.length;i++){if($scope.modalInstanceSectionArray[i]==pnSectionName){return true}}return false};$scope.isAdditionalNotes=function(pnSectionName,categoryId){if((pnSectionName==='HPI:'||pnSectionName==='Examination:')&&parseInt(categoryId)===0){return true}return false};function setRightChartPanelHeight(){var rightPanelCtrl=angular.element(document.getElementById('rightPanelCtrl')).scope();if(rightPanelCtrl.context==='progressnotes'||rightPanelCtrl.context==='Treatment'){var height=$("#mainPNDialog").css("height");$('#rightPanelCtrl').css('height',height+'px')}}$scope.openModalInstance=function(sectionName,className){if(className&&className.length>0){}else{var url;switch(sectionName){case'Lab Reports:':url=makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp");var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:0,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:url,controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url);$scope.$broadcast('refreshScreenAfterManageOrd');refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");setRightChartPanelHeight()})});break;case'Venous Examination:':var encProviderId=0;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){encProviderId=EncDetailsService.getEncDetails().providerId}$ocLazyLoad.load({name:'ecw.module.vascular',files:getDependencies("ecw.module.vascular")}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/vascular/view/vascularExam.html"),controller:'vascularModalController as vmc',windowClass:'vascular-modal',keyboard:false,backdrop:"static",resolve:{vascularParams:function(){return{"patientID":parseInt($scope.patientId),"encounterID":parseInt($scope.encounterId),"providerID":parseInt(encProviderId),"trUserID":parseInt(global.TrUserId)}}}});modalInstance.result.then(function(responseObj){},function(responseObj){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");console.log("..................vascular close callback....................")})});break;case'Diagnostic Imaging:':url=makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp");var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:1,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:url,controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url);$scope.$broadcast('refreshScreenAfterManageOrd');refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");setRightChartPanelHeight()})});break;case'Procedure Orders:':url=makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp");var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:3,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:url,controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url);$scope.$broadcast('refreshScreenAfterManageOrd');refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");setRightChartPanelHeight()})});break;case'Audiology':var url="/mobiledoc/jsp/webemr/devices/NewAudiologyWorkFlow.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;$ocLazyLoad.load({name:'audiologyModule',files:['/mobiledoc/jsp/webemr/devices/AudiologyWebController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'audiology',backdrop:"static"});modalInstance.result.then(function(){$templateCache.remove(url);console.log('Closed at: '+new Date)},function(e){$templateCache.remove(url);console.log(e)})});break;case'Disposition & Communication:':var dataObj={encId:$scope.encounterId,patientId:$scope.patientId};var url="/mobiledoc/jsp/webemr/progressnotes/dispositioncommunication/dispCommunication.jsp";$ocLazyLoad.load({name:'dispositionModule',files:['/mobiledoc/jsp/webemr/progressnotes/dispositioncommunication/dispCommController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'dispositionCtrl',backdrop:"static",keyboard:false,resolve:{dataObj:function(){return dataObj}}});modalInstance.result.then(function(){$templateCache.remove(url)},function(e){$templateCache.remove(url)})});break;case"Allergy Test:":var url="/mobiledoc/jsp/webemr/allergy/AllergySkinTest.jsp?encId="+$scope.encounterId+"&TrUserId="+global.TrUserId+"&facilityId="+global.facilityId+"&screen=webemr";$ocLazyLoad.load({name:'Allergy',files:['/mobiledoc/jsp/allergy/css/main.css','/mobiledoc/jsp/allergy/css/allergyskintest.css','/mobiledoc/jsp/allergy/css/numberpicker.css','/mobiledoc/jsp/resources/jslib/ng-tags-input/build/ng-tags-input.css','/mobiledoc/jsp/allergy/css/multi-select.css','/mobiledoc/jsp/resources/jslib/angular-ivh-treeview/dist/ivh-treeview.css','/mobiledoc/jsp/allergy/css/jquery.webui.to.allergy-popover.min.css','/mobiledoc/jsp/resources/jslib/angular-ivh-treeview/dist/ivh-treeview.js','/mobiledoc/jsp/resources/jslib/ng-tags-input/build/ng-tags-input.js','/mobiledoc/jsp/allergy/js/directive/dynamicContent-tpl.js','/mobiledoc/jsp/allergy/js/directive/numberpicker-directive.js','/mobiledoc/jsp/allergy/js/directive/multiselect-dropdown.js','/mobiledoc/jsp/allergy/js/angular/angular-ui.min.js','/mobiledoc/jsp/resources/jslib/moment/moment.js','/mobiledoc/jsp/allergy/templates/browseCommon-tpl.js','/mobiledoc/jsp/webemr/templates/category-tpl.js','/mobiledoc/jsp/allergy/js/directive/multiselect-dropdown.js','/mobiledoc/jsp/allergy/js/jquery/jquery.webui-popover_allergy_custom.min.js','/mobiledoc/jsp/resources/jslib/jquery-minicolors/jquery.minicolors.min.js','/mobiledoc/jsp/allergy/js/jquery/jquery.webui.to.allergy-popover.js','/mobiledoc/jsp/allergy/js/skintest/skintestservice.js','/mobiledoc/jsp/allergy/js/skintest/allergyskintest.js','/mobiledoc/jsp/allergy/js/main.js','/mobiledoc/jsp/allergy/js/common/commonUtils.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),windowClass:'app-modal-window bluetheme allergymodule',backdrop:"static",size:'lg'});modalInstance.result.then(function(){$templateCache.remove(url)},function(e){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","");$templateCache.remove(url)})},function(error){console.log(error)});break;case"Warfarin Flowsheet:":var urlWarfarin="/mobiledoc/jsp/webemr/warfarin/jsp/warfarinMain.jsp?encId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+global.TrUserId+"&screen=webemr";$ocLazyLoad.load({name:'Warfarin Flowsheet',reconfig:true,files:["/mobiledoc/jsp/webemr/warfarin/assets/css/warfarin.css",'/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.js',"/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js",'/mobiledoc/jsp/webemr/ccmr/rpm/css/perfect-scrollbar.css','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/perfect-scrollbar.min.js',"/mobiledoc/jsp/webemr/warfarin/modules/home-page/modals/warfarin-modal.controller.js",'/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js',"/mobiledoc/jsp/resources/jslib/highcharts/highstock.js",'/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/webemr/toppanel/toppanelController.js','/mobiledoc/jsp/webemr/js/commonFunctions.js',"/mobiledoc/jsp/allergy/js/common/localstorage.js"]}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(urlWarfarin),windowClass:"modal fade custom-modal w1240",backdrop:"static",keyboard:false});modalInstance.result.then(function(){$templateCache.remove(urlWarfarin);$('.modal-backdrop.fade').remove()},function(e){if(e==='success'){if(encObj.encType==="2"||encObj.encType==="6"){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}else{refreshFullDashboard($scope.encounterId,$scope.patientId,"progressNote",encObj.encLock,encObj.encType)}}$templateCache.remove(urlWarfarin);$('.modal-backdrop.fade').remove()})},function(error){console.log(error)});break;case"Behavioral Health Treatment Plan:":url="/mobiledoc/jsp/webemr/behavioralhealth/progressnote/importtreatmentplan/view/importTPModal.html";var bhPnTreatmentPlanObj={encounterId:$scope.encounterId,patientId:$scope.patientId};$ocLazyLoad.load({name:'behavioralHealthImportTP',files:['/mobiledoc/jsp/ascWeb/js/vendor/daterangepicker/bootstrapui-timepicker.js','/mobiledoc/jsp/webemr/behavioralhealth/js/vendor/daterangepicker/angular-daterangepicker.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/importtreatmentplan/js/importTPModalController.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/treatmentplan/css/bhAddEditTreatmentPlan.css','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/importtreatmentplan/css/import-tp-modal.css']}).then(function(){var modalInstance=$modal.open({templateUrl:url,controller:'importTPModalController',controllerAs:'bhTPImportModalCtrl',windowClass:'bh-module bluetheme importTpLargeWidth',backdrop:"static",resolve:{bhPnTreatmentPlanObj:function(){return bhPnTreatmentPlanObj}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url)})});break;case"HPI:":$scope.showHpiAdditionalNotesPopup();break;case"Examination:":$scope.showExamAdditionalNotesPopup();break;case"RPM Data:":var serverUrl='/mobiledoc/jsp/webemr/rightpanel/getOverviewData.jsp?patientId='+$scope.patientId+'&TrUserId='+global.TrUserId+'&context='+$scope.context+'&encounterId='+$scope.encounterId+'&trigger=rpmdata';var jsonRPM=JSON.parse(urlGet(serverUrl));var x2js=new X2JS;$scope.rpm={};$scope.rpm.data=x2js.xml_str2json(jsonRPM.rpm.data).Envelope.Body['return'].rpmRightPanel;if(!($scope.rpm.data===undefined||$scope.rpm.data===null)){$scope.rpm.ptacoid=$scope.rpm.data.PtEnrolledDetails.ptacoId;$scope.rpm.nPtacoid=parseInt($scope.rpm.ptacoid,10);$scope.rpm.nRpmEnrollmentId=parseInt($scope.rpm.data.PtEnrolledDetails.rpmEnrollmentId,10)}$scope.rpm.TimerStatus=0;$scope.rpm.StartTimer="00:00:00";var rpmDeviceMonitoringData={id:$scope.rpm.nRpmEnrollmentId,userId:parseInt($scope.patientId,10),ptaCoId:parseInt($scope.rpm.nPtacoid,10),enrollmentId:$scope.rpm.nRpmEnrollmentId,patientId:parseInt($scope.patientId,10),deceasedOrInactive:'',insurances:JSON.parse($scope.rpm.data.PtEnrolledDetails.insurances),staffFullName:$scope.rpm.primaryContact,timerDetails:{TimerStatus:$scope.rpm.TimerStatus,StartTimer:$scope.rpm.StartTimer},callFrom:'PN',encounterId:encounterId,healowLogin:true};url="/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/rpmDeviceMonitoringModal.html?";$ocLazyLoad.load({name:'rpmDeviceMonitoring',files:['/mobiledoc/jsp/js/jquery.inputmask/jquery.inputmask.date.extensions.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/datetime-picker.min.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-global-style.css','/mobiledoc/jsp/webemr/js/jquery-ui-timepicker-addon.js','/mobiledoc/jsp/webemr/ccmr/rpm/js/service/rpmUserServices.js','/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/css/rpm-device-monitoring.css','/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/js/rpmDeviceMonitoringController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/rpmDeviceMonitoringModal.html?'),controller:'rpmDeviceMonitoringController',controllerAs:'rpmDeviceMtrgCtrl',keyboard:false,backdrop:'static',windowClass:'bluetheme device-monitoring custom-modal w1240',size:'lg',animation:true,resolve:{rpmDeviceMonitoringData:function(){return rpmDeviceMonitoringData}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url)})});break;case"RPM Notes:":$scope.getRPMData();$scope.getRPMDisclaimerStatus();break}}};$scope.showHpiAdditionalNotesPopup=function(){var initHpiData={patientId:$scope.patientId,encounterId:$scope.encounterId};var hpiAdditionaNoteUrl="/mobiledoc/jsp/webemr/progressnotes/hpi/hpi-additionalnotes.html";$ocLazyLoad.load({name:"hpiAdditionalNoteApp",files:["/mobiledoc/jsp/webemr/progressnotes/hpi/hpi-additionalnotes.js"]}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(hpiAdditionaNoteUrl),controller:'hpiAdditionalNoteController',windowClass:'app-modal-window bluetheme additionalNoteModal',backdrop:"static",keyboard:false,resolve:{initData:function(){return initHpiData}}});modalInstance.result.then(function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","hpiAdditionalModal");$templateCache.remove(hpiAdditionaNoteUrl);$('.modal-backdrop.fade').remove()},function(e){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","hpiAdditionalModal");$templateCache.remove(hpiAdditionaNoteUrl);$('.modal-backdrop.fade').remove()})})};$scope.showExamAdditionalNotesPopup=function(){var initExamData={patientId:$scope.patientId,encounterId:$scope.encounterId};var examAdditionalNoteUrl="/mobiledoc/jsp/webemr/progressnotes/examination/exam-additionalnotes.html";$ocLazyLoad.load({name:"examAdditionalNoteApp",files:["/mobiledoc/jsp/webemr/progressnotes/examination/exam-additionalnotes.js"]}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(examAdditionalNoteUrl),controller:'examAdditionalNoteController',windowClass:'app-modal-window bluetheme additionalNoteModal',backdrop:"static",keyboard:false,resolve:{initData:function(){return initExamData}}});modalInstance.result.then(function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","examAdditionalModal");$templateCache.remove(examAdditionalNoteUrl);$('.modal-backdrop.fade').remove()},function(e){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","examAdditionalModal");$templateCache.remove(examAdditionalNoteUrl);$('.modal-backdrop.fade').remove()})})};$scope.getRpmPNNotes=function(openModal){if(!$scope.rpm)$scope.rpm={rpmData:{additionalNotes:''}};if(!$scope.rpm.rpmData)$scope.rpm.rpmData={additionalNotes:''};var obj={"encounterId":$scope.encounterId};httpPostWithData('/mobiledoc/phm/rpmPnNotes/retrieveRpmPNNotes',obj).then(function(response){if(response.data&&response.data.status==='success'){$scope.rpm.rpmData.additionalNotes=response.data.result.additionalNotes;$scope.rpm.rpmData.importedNotes=response.data.result.importedNotes;if(openModal){$scope.openRPMPnAdditionalNotesModal()}}else{ecwAlert("Exception occurred while retrieving RPM ProgressNotes Notes.")}})};$scope.getRPMData=function(patientId){if(!$scope.rpm){$scope.rpm={}}var serverUrl='/mobiledoc/jsp/webemr/rightpanel/getOverviewData.jsp?patientId='+$scope.patientId+'&TrUserId='+global.TrUserId+'&trigger=rpmdata';var overviewjson=urlGet(serverUrl);$scope.rpm.rpmData=escapeXml(JSON.parse(overviewjson));var jsonRPM=$scope.rpm.rpmData;var x2js=new X2JS;$scope.rpm.rpmData=x2js.xml_str2json(jsonRPM.rpm.data).Envelope.Body['return'].rpmRightPanel};function httpPostWithData(url,data){return $http({headers:{'Content-Type':'application/json; charset=UTF-8'},method:'POST',url:url,data:data})}$scope.getRPMDisclaimerStatus=function(){if(!$scope.isRPMDisclaimerAccepted){httpPostWithData('/mobiledoc/phm/rpm/getLoggedInUserMonitoringStatusDisclaimer').then(function(response){if(response.data&&response.data.success){var discalimerObject=response.data.disclaimerStatusMap;if(!discalimerObject.disclaimerStatus||discalimerObject.disclaimerStatus===0){var rpmDisclaimerMessage="<b>NOTICE:Provider and their staffs Understands that the healow RPM Monitoring status Dashboard is not intended as a substitute for professional medical judgment."+"Practice is solely responsible for its interpretation of the information generated by healow RPM monitoring Status Dashboard is connection with any diagnosis or treatment by the provider.</b>"+"<br>"+"<br>"+"By Clicking ACCEPT below you <b>acknowledge</b> that you reviewed and <b>accept</b> these terms and conditions";ecwAlert(rpmDisclaimerMessage,'healow RPM-Monitoring Status',function(){$scope.insertRPMMonitoringStatusDisclaimer(true)},"Accept")}else{$scope.isRPMDisclaimerAccepted=true;$scope.getRpmTimerDetails()}}else{ecwAlert("Exception occurred while retrieving rpm disclaimer")}})}else{$scope.getRpmTimerDetails()}};$scope.insertRPMMonitoringStatusDisclaimer=function(status){var obj={"disclaimerStatus":status};httpPostWithData('/mobiledoc/phm/rpm/insertLoggedInUserMonitoringStatusDisclaimer',obj).then(function(response){if(response.data&&response.data.success){if(response.data.isUpdated>0){$scope.isRPMDisclaimerAccepted=true;$scope.getRpmTimerDetails()}}else{ecwAlert("Exception occurred while updating rpm disclaimer")}})};$scope.getRpmTimerDetails=function(){var param={userId:global.TrUserId,patientId:$scope.patientId,ptacoId:$scope.rpm.rpmData.PtEnrolledDetails.ptacoId};$http({method:'POST',url:'/mobiledoc/phm/rpmTimer/getRpmTimerDetails',data:param}).success(function(response){if(response&&response.status==='success'){$scope.rpm.rpmData.timerStatus=parseInt(response.TimerStatus,10);$scope.rpm.rpmData.startTime=response.StartTimer;$scope.rpm.rpmData.timerAction="start";if(response.TimerStatus===1){$scope.rpm.rpmData.timerAction="stop"}$scope.getPatientDeceasedOrInactiveStatus()}}).error(function(error){ecwAlert("Exception occured while retrieving RPM Timer Details ")})};$scope.getPatientDeceasedOrInactiveStatus=function(){var param={patientId:$scope.patientId};$http({method:'POST',url:'/mobiledoc/phm/rpm/getPatientDeceasedOrInactiveStatus',data:param}).success(function(response){if(response&&!angular.equals(response,{})){$scope.rpm.rpmData.deceasedOrInactive=response.deceasedOrInactive.status;$scope.openRPMMonitoringStatusModal()}}).error(function(error){ecwAlert('Exception occured while retrieving RPM Total Device Details','')})};$scope.openRPMMonitoringStatusModal=function(){let rpmMonitoringStatusData=[];let monitoringData={id:parseInt($scope.rpm.rpmData.PtEnrolledDetails.rpmEnrollmentId,10),userId:parseInt($scope.patientId,10),ptaCoId:parseInt($scope.rpm.rpmData.PtEnrolledDetails.ptacoId,10),enrollmentId:parseInt($scope.rpm.rpmData.PtEnrolledDetails.rpmEnrollmentId,10),patientId:parseInt($scope.patientId,10),deceasedOrInactive:parseInt($scope.rpm.rpmData.deceasedOrInactive,10),insurances:JSON.parse($scope.rpm.rpmData.PtEnrolledDetails.insurances),staffFullName:$scope.rpm.rpmData.PtEnrolledDetails.primaryContactName,timerDetails:{TimerStatus:$scope.rpm.rpmData.timerStatus,StartTimer:$scope.rpm.rpmData.startTime}};rpmMonitoringStatusData.push(monitoringData);let deviceMonitoringData={patientId:parseInt($scope.patientId,10),enrollmentId:parseInt($scope.rpm.rpmData.PtEnrolledDetails.rpmEnrollmentId,10),enrollmentData:rpmMonitoringStatusData,callbackFunction:refreshPNDashBoard,source:'progressnote',encounterId:$scope.encounterId,healowLogin:true};$ocLazyLoad.load({name:'monitoringStatusModalController',files:['/mobiledoc/jsp/webemr/ccmr/rpm/devicemanagement/directive/rpmPrismaDeviceManagementService.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/controller/rpmDevicemonitoringStatusModalCtrl.js','/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/directive/rpmDeviceMonitoring-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/devicemanagement/directive/rpmDeviceManagement-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/devicemonitoring/directive/rpmThirdPartyPortal-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/smart-note-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-custom.css','/mobiledoc/jsp/webemr/ccmr/rpm/css/monitoring-status.css','/mobiledoc/jsp/resources/jslib/highcharts/modules/export-data.js','/mobiledoc/jsp/resources/jslib/highcharts/modules/exporting.js','/mobiledoc/jsp/resources/jslib/highcharts/highcharts.js','/mobiledoc/jsp/resources/jslib/highcharts/modules/xrange.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/line-chart-directive.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/milestone.css','/mobiledoc/jsp/webemr/ccmr/rpm/timer/directive/rpmViewFullNotes-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/timer/directive/rpmAddTime-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/timer/directive/rpmStartStopTimer-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/service/enrollmentService.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-global-style.css','/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/perfect-scrollbar.css','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/perfect-scrollbar.min.js','/mobiledoc/jsp/js/jquery.inputmask/jquery.inputmask.date.extensions.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/common-directive.js','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/datetime-picker.min.js','/mobiledoc/jsp/webemr/js/jquery-ui-timepicker-addon.js','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/angular-sanitize.js','/mobiledoc/jsp/webemr/js/vendor/ui-router.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/rpmPatientEnrollment-tpl.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-main.css','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/css/patient-enrollment.css']}).then(function(){var url='/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/views/monitoring-status-modal.html?';var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'monitoringStatusModalController',controllerAs:'monitoringStatusModalCtrl',keyboard:false,backdrop:'static',windowClass:'custom-modal monitoring-status w1280',size:'lg',animation:true,resolve:{deviceMonitoringData:function(){return deviceMonitoringData}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url)})})};$scope.CheckIfDeviceItemConfigured=function(reportId){var ChekcConfiguredFlag=false;$.ajax({url:makeURL('/mobiledoc/jsp/devices/IsDeviceItemConfigured.jsp?reportid='+reportId+"&itemid=0&context=webemr"),type:"POST",cache:false,dataType:"XML","async":false,success:function(xml){var DeviceDataXml=(new XMLSerializer).serializeToString(xml);var x2js=new X2JS;var jsonData=x2js.xml_str2json($.trim(DeviceDataXml));var DeviceData=jsonData.Envelope.Body['return'].DeviceConfig;if(!angular.isUndefined(DeviceData.DeviceName)&&DeviceData.DeviceName!=""){if(DeviceData.DeviceName.toLowerCase()=="clinitek"||DeviceData.DeviceName.toLowerCase()=="celldyn"){ChekcConfiguredFlag=false}else{ChekcConfiguredFlag=true}}else{ChekcConfiguredFlag=false}}});return ChekcConfiguredFlag};$scope.getPopupData=function(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime){var data=new popupData;var url="";var module="";if(className=='PastOrderLink'){if(propName=='0'){className='lablink'}else if(propName=='1'){className='xraylink'}else if(propName=='3'){className='ProcedureReportlink'}}if(className&&className.length>0){switch(className){case"lablink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=getDependencies(module);url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=0&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}break;case"xraylink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=getDependencies(module);url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=1&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}break;case"ProcedureReportlink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=getDependencies(module);url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=3&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module}break;case"ImmLink":module="addImmInj";url='/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationDetails.jsp?context=progressnotes&patientId='+$scope.patientId+'&nImmInjType=1&ImmId='+categoryId+'&nEncId='+$scope.encounterId+'&immSeriesId=0&ProviderId=0&TrUserId='+$scope.userId+'&rowIndex=0';var files=getDependencies('infoAlert').concat(['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/labs/immunizations/js/ImmunizationDetailsController.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js','/mobiledoc/jsp/webemr/layout/css/bootbox.css','/mobiledoc/jsp/webemr/labs/immunizations/js/LotNumberController.js','/mobiledoc/jsp/webemr/commonSendScreen/css/concurrencyAlerts.css','/mobiledoc/jsp/webemr/js/concurrency/concurrencyAlertProvider.js']);url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"InjLink":module="addImmInj";url='/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationDetails.jsp?context=progressnotes&patientId='+$scope.patientId+'&nImmInjType=2&ImmId='+categoryId+'&nEncId='+$scope.encounterId+'&immSeriesId=0&ProviderId=0&TrUserId='+$scope.userId+'&rowIndex=0';var files=getDependencies('infoAlert').concat(['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/labs/immunizations/js/ImmunizationDetailsController.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js','/mobiledoc/jsp/webemr/layout/css/bootbox.css','/mobiledoc/jsp/webemr/labs/immunizations/js/LotNumberController.js','/mobiledoc/jsp/webemr/commonSendScreen/css/concurrencyAlerts.css','/mobiledoc/jsp/webemr/js/concurrency/concurrencyAlertProvider.js']);url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"assessmentlink":var assessment=[];if(categoryId.indexOf(" - ")>0){assessment=categoryId.split(" - ");url="/mobiledoc/jsp/webemr/progressnotes/ecwrx/currMedWeb/getRecommendationRx.jsp?assmtName="+assessment[0]+"&icd="+assessment[1]+"&encounterId="+params.pnencid+"&TrUserId="+params.TrUserId+"&patientId="+params.ptId}break;case"Referral":var params={refId:categoryId,patientId:$scope.patientId,encounterId:$scope.encounterId,referralType:"Outgoing",callingFrom:'ProgressNote'};params=$.param(params);module="referralPopUpApp";var files=['/mobiledoc/jsp/webemr/jellybean/patientrecord/commanP2PService.js','/mobiledoc/jsp/webemr/jellybean/referral/referralPopupController.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/webemr/templates/cpt-tpl.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/ICD_Treatment.js'];url="/mobiledoc/jsp/webemr/jellybean/referral/referralPopup.jsp?"+params;data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"actionlink":var params={ActionId:categoryId,encounterId:$scope.encounterId,patientId:$scope.patientId,ms:(new Date).getTime(),context:"progressnotes"};params=$.param(params);module="actionsDetailViewApp";var files=['/mobiledoc/jsp/webemr/lookup/lookup.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js','/mobiledoc/jsp/webemr/templates/structuredata-tpl.js','/mobiledoc/jsp/webemr/js/xeditable.min.js','/mobiledoc/jsp/webemr/css/xeditable.css','/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.js'];url="/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.jsp?"+params;data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"aoeStatusLink":module="laborderdetails";url="/mobiledoc/jsp/webemr/labs/orderdetails/OrderDetails.jsp?encounterId="+$scope.encounterId+"&reportId=0&patientId="+$scope.patientId+"&enableLabInstructions="+getUserProfile("EnableLabInstruction")+"&selectSingleAssessment="+getUserProfile("selectSingleAssessment")+"&context=AOE_STATUS_LINK&trUserId="+$scope.userId;var files=getDependencies('laborderdetails');url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module;break;case"aucStatusLink":module="aucExeModalApp";url="/mobiledoc/jsp/pama/aucExeModal.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&screenContext=WEB_PN_AUC&context=LAUNCH_AUC&trUserId="+$scope.userId;var files=getDependencies('pama');url=makeURL(url);data.url=url;data.seriesLoadFlag=true;data.dependencies=files.concat('/mobiledoc/jsp/pama/js/aucExeModal.js');data.modulename=module;break}}else{if(pnSectionName!=='Dental Examination/Plan:'){$scope.pn_popup_width=960;$scope.pn_popup_height=630}switch(pnSectionName){case"HPI:":case GetCaptionForSoapItem("HPI")+":":var hpi_localstorage=getImprovedHPICategoryData();var files=[];if(propId){module="hpinotes";url="/mobiledoc/jsp/webemr/progressnotes/hpi/hpinotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=hpi_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js']}else{module="hpi";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.seriesLoadFlag=true;data.modulename=module;break;case"ROS:":case GetCaptionForSoapItem("ROS")+":":if(propId){module="rosproperties";url="/mobiledoc/jsp/webemr/progressnotes/ros/rosNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="ros";url="/mobiledoc/jsp/webemr/progressnotes/ros/ros.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var treeJSON=getROSCategory();var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}url=url+"&defaultCategoryId="+categoryIdValue+"&parentId="+parentIdValue}}var files=['/mobiledoc/jsp/webemr/progressnotes/ros/roscontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Surgical History:":module="hospitalization";url="/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/surgicalHistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&visionvisit="+encObj.visionVisitFlag;url=url+"&surgicalHxChanged="+sectionAlreadyChanged.surgicalChanged;url=url+"&hospHxChanged="+sectionAlreadyChanged.hospChanged;url=url+"&ocularSurgChanged="+sectionAlreadyChanged.ocularSurgChanged;url=url+"&showOcularSurgWarning="+sectionAlreadyChanged.showOcularSurgWarning;var files=['/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/hospitalizationController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Hospitalization:":module="hospitalization";url="/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/surgicalHistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&visionvisit="+encObj.visionVisitFlag;url=url+"&surgicalHxChanged="+sectionAlreadyChanged.surgicalChanged;url=url+"&hospHxChanged="+sectionAlreadyChanged.hospChanged;url=url+"&ocularSurgChanged="+sectionAlreadyChanged.ocularSurgChanged;url=url+"&showOcularSurgWarning="+sectionAlreadyChanged.showOcularSurgWarning;var files=['/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/hospitalizationController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Gyn History:":case GetCaptionForSoapItem("Gyn History")+":":module="gynob";url="/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobhistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=gyn&isGAchange=yes";if(sectionAlreadyChanged&&sectionAlreadyChanged.gynHxChanged){url=url+"&gynHxChanged="+sectionAlreadyChanged.gynHxChanged}if(sectionAlreadyChanged&&sectionAlreadyChanged.obHxChanged){url=url+"&obHxChanged="+sectionAlreadyChanged.obHxChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Physical Examination:":case GetCaptionForSoapItem("Physical Examination")+":":if(propId){module="notesAndProperties";url="/mobiledoc/jsp/webemr/progressnotes/common3/commonNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&section=PhysicalExamination";url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=PhysicalExamination";if(propName=='AudiologyWorkFlow'){url=url+"&AudiologyReadOnlyFlag=true"}var treeJSON=getCommonCategory("PhysicalExamination");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"OB History:":case GetCaptionForSoapItem("OB History")+":":module="gynob";url="/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobhistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=ob&isGAchange=yes";if(sectionAlreadyChanged&&sectionAlreadyChanged.obHxChanged){url=url+"&obHxChanged="+sectionAlreadyChanged.obHxChanged}if(sectionAlreadyChanged&&sectionAlreadyChanged.gynHxChanged){url=url+"&gynHxChanged="+sectionAlreadyChanged.gynHxChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Physical Therapy Assessment:":module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=physicaltherapy";var treeJSON=getCommonCategory("TherapyAssessment");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue;var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Preventive Medicine:":if(propId){module="notesAndProperties";url="/mobiledoc/jsp/webemr/progressnotes/common3/commonNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&section=PreventiveMedicine";url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=PreventiveMedecine";var treeJSON=getCommonCategory("PreventiveMedecine");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Procedures:":case GetCaptionForSoapItem("Procedures")+":":if(propId){module="notesAndProperties";url="/mobiledoc/jsp/webemr/progressnotes/common3/commonNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&section=Procedures";url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=Procedures&virtualVisit="+virtualVisit;var treeJSON=getCommonCategory("Procedure");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId;url=url+"&procedureLink="+true}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Social History:":case GetCaptionForSoapItem("Social History")+":":module="common";var catIds="";var isTreeEnabled=getItemKeyValue("ShowTreeInSocialHistory",true);url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=SocialHistory"+"&treeEnabled="+isTreeEnabled;if(isTreeEnabled==="1"){var treeJSON=getCommonCategory("SocialHistory");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}else{var categoryIdValue=getItemKeyValue("SocialHistory",true);url=url+"&categoryId="+categoryIdValue+"&parentId=0"}if(sectionAlreadyChanged&&sectionAlreadyChanged.socialChanged){url=url+"&socialhxChanged="+sectionAlreadyChanged.socialChanged}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Therapeutic Interventions:":case GetCaptionForSoapItem("Therapeutic")+":":module="therapeuticintervention";var tidata_localstorage=getTherapyInterventionCategory();var catItemId="";var firstCatItemid=getFirstTreeItem(tidata_localstorage);if(categoryId){catItemId=categoryId}else{catItemId=firstCatItemid.id}url="/mobiledoc/jsp/webemr/progressnotes/therapeutic/therapeuticlayout.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&Id="+catItemId;var files=['/mobiledoc/jsp/webemr/progressnotes/therapeutic/therapeuticlayoutcontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Dermatology Examination:":$scope.inkingUrl="";module="dermatologyModal";var enc={"name":encObj.name,"encFormattdDate":encObj.encFormattdDate,"encFormattdDate":encObj.encFormattdDate,"visitType":encObj.visitType};enc=escape(JSON.stringify(enc));url="/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.jsp?action=step1&encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&enc="+enc;var files=['/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Diagnostic studies:":module="imagingStudiesModule";url="/mobiledoc/jsp/webemr/progressnotes/imagingstudies/ImagingStudies.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/imagingstudies/js/imagingStudiesCtr.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Examination:":case GetCaptionForSoapItem("Examination")+":":var examination_localstorage=getExaminationCategory();var files=[];if(propId){module="examinationnotes";url="/mobiledoc/jsp/webemr/progressnotes/examination/examinationnotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=examination_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;if(virtualVisit){url=url+"&virtualVisit="+virtualVisit}files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js']}else{module="examination";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.seriesLoadFlag=true;data.modulename=module;break;case"Allergies/Intolerance:":case GetCaptionForSoapItem("Allergies")+":":module="medicalhistory";data=common_getPopupDatObj(module,$scope.encounterId,$scope.patientId,encObj,sectionAlreadyChanged,encDate);break;case"Medical History:":case GetCaptionForSoapItem("Medical History")+":":module="medicalhistory";data=common_getPopupDatObj(module,$scope.encounterId,$scope.patientId,encObj,sectionAlreadyChanged,encDate);break;case"Ocular History:":case GetCaptionForSoapItem("Ocular History")+":":case"Ocular Surgical History:":case GetCaptionForSoapItem("Ocular Surgery")+":":module="ocularhistory";url="/mobiledoc/jsp/webemr/progressnotes/ocularhistory/ocularhistory.jsp?encounterId="+$scope.encounterId;url=url+"&ocularHxChanged="+sectionAlreadyChanged.ocularHistChanged;url=url+"&ocularSurgChanged="+sectionAlreadyChanged.ocularSurgChanged;var files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ocularhistory/ocularhistorycontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;data.seriesLoadFlag=true;break;case"Vision:":case"Vision Examination:":if(visionUSEnable){module="visionModule";url="/mobiledoc/jsp/webemr/progressnotes/usvision/visionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&tabId="+categoryId;let strTab=''+categoryId;if(strTab.length>1&&strTab.charAt(0)==='3'){url="/mobiledoc/jsp/webemr/progressnotes/usvision/visionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&tabId=3&categoryId="+strTab.substr(1)}else if(strTab.length>1&&strTab.charAt(0)==='5'){url="/mobiledoc/jsp/webemr/progressnotes/usvision/visionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&tabId=5&categoryId="+strTab.substr(1)+"&fieldGroupId="+notes+"&propId="+propId}var files=['/mobiledoc/jsp/webemr/progressnotes/usvision/visionController.js','/mobiledoc/jsp/webemr/progressnotes/usvision/css/specsaver-pretest.css']}else{module="visionexamination";url="/mobiledoc/jsp/webemr/progressnotes/vision/VisionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/clickThrough/struct-keyword-tpl.js','/mobiledoc/jsp/webemr/progressnotes/vision/contactLensSelectionService.js','/mobiledoc/jsp/webemr/progressnotes/vision/pnvision.js']}data.url=url;data.dependencies=files;data.modulename=module;break;case"Family History:":module="familyhistory";url="/mobiledoc/jsp/webemr/progressnotes/familyhistory/familyHistory.jsp?encounterId="+$scope.encounterId+"&keyName=FamilyHistory&encLock=0&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;if(sectionAlreadyChanged&&sectionAlreadyChanged.familyChanged){url=url+"&familyHxChanged="+sectionAlreadyChanged.familyChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/progressnotes/familyhistory/familyHxCtrl.js','/mobiledoc/jsp/webemr/snomedmapservice/js/mapSnomedToIcdService.js'];data.url=url;data.dependencies=files;data.modulename=module;data.seriesLoadFlag=true;break;case"Chief Complaint(s):":case"CC":case GetCaptionForSoapItem("CC")+":":module="chiefcomplaints";url="/mobiledoc/jsp/webemr/progressnotes/chiefcomplaint/chiefComplaints.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&patientName="+encodeURIComponent(EncDetailsService.getEncDetails().name);var files=['/mobiledoc/jsp/webemr/progressnotes/chiefcomplaint/CCController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Current Medication:":case"Current Medication(s):":module="medRec";url="/mobiledoc/jsp/webemr/progressnotes/ecwrx/currMedWeb/medReconciliation.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/ecwrx/js/medRec.js','/mobiledoc/jsp/webemr/js/QuickOrderSearchDirective.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js','/mobiledoc/jsp/webemr/jellybean/refillrequest/showMessageBoxDirective.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/js/RxHelper.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Vitals:":case GetCaptionForSoapItem("Vitals")+":":module="vitals";url="/mobiledoc/jsp/webemr/progressnotes/vitals/vitals.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/js/confTimeline.js','/mobiledoc/jsp/webemr/progressnotes/vitals/vitalscontroller.js'];data.url=makeURL(url);data.seriesLoadFlag=true;data.dependencies=files;data.modulename=module;break;case"Treatments:":case"Treatment:":case GetCaptionForSoapItem("Treatment")+":":$scope.pn_popup_width=960;module="TreatmentApp";PNService.setParametersForScreen("treatment",{encounterId:$scope.encounterId,patientId:$scope.patientId,userId:global.TrUserId,normalView:1,CorrectionalEnabled:false});url="/mobiledoc/jsp/webemr/progressnotes/treatment/treatment.jsp?nts";var files=['/mobiledoc/jsp/pama/js/aucDirective.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.css','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.js','/mobiledoc/jsp/webemr/progressnotes/treatment/js/treatment.js','/mobiledoc/jsp/pdmp/js/PdmpCommonFunctions.js','/mobiledoc/jsp/webemr/progressnotes/treatment/css/treatment.css','/mobiledoc/jsp/webemr/compoundRx/css/compund-button-style.css','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js','/mobiledoc/jsp/webemr/templates/reason-tpl.js'].concat(getDependencies('pama'));data.url=url;data.dependencies=files;data.modulename=module;break;case"eMAR:":case GetCaptionForSoapItem("eMAR")+":":module="eMARApp";url="/mobiledoc/jsp/webemr/progressnotes/eMAR/opeMAR.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+global.TrUserId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime();var files=['/mobiledoc/jsp/webemr/progressnotes/eMAR/js/opeMAR.js','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Immunizations:":module="ImmInjHxApp";url="/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?contextVar=progressnote&nImmInjType=1&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+global.TrUserId+"&nd="+(new Date).getTime();var files=getDependencies('ImmInjHxApp');data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Therapeutic Injections:":module="ImmInjHxApp";url="/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?contextVar=progressnote&nImmInjType=2&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+global.TrUserId+"&nd="+(new Date).getTime();var files=getDependencies('ImmInjHxApp');data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Next Appointment:":case"Visit Code:":case"Procedure Codes:":case"Billing:":module="billing";url="/mobiledoc/jsp/webemr/progressnotes/billing/billing.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&encDate="+encDate;var files=['/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Dental History:":var encProviderId=null;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){encProviderId=EncDetailsService.getEncDetails().providerId}module="dentalHistory";url="/mobiledoc/jsp/webemr/progressnotes/dental/dentalHistory.jsp?patientId="+$scope.patientId+"&encId="+$scope.encounterId+"&encProviderId="+encProviderId;url=url+"&categoryId="+categoryId;if(sectionAlreadyChanged&&sectionAlreadyChanged.dentalChanged){url=url+"&dentalHistoryChanged="+sectionAlreadyChanged.dentalChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/dental/dentalHistoryController.js'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"Dental Examination/Plan:":var encProviderId=null;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){encProviderId=EncDetailsService.getEncDetails().providerId}module="dental";var files=['/mobiledoc/jsp/webemr/progressnotes/dental/dental.js'];url="/mobiledoc/jsp/webemr/progressnotes/dental/dental.jsp?action=dentalExam&patientId="+$scope.patientId+"&encId="+$scope.encounterId+"&encProviderId="+encProviderId;url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"Assessment:":module="assessment";PNService.setParametersForScreen("assessment",{encounterId:$scope.encounterId,patientId:$scope.patientId,userId:$scope.userId});url="/mobiledoc/jsp/webemr/progressnotes/assessment/assessment.jsp?nts";var files=['/mobiledoc/jsp/webemr/progressnotes/assessment/assessmentcontroller.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;if($(".sunohsummarymaindiv").length>0){let sunohScope=angular.element(document.getElementsByClassName("sunohsummarymaindiv")[0]).scope();if(sunohScope){sunohScope.removeAssessemnts()}}break;case"Past Results:":module="pastResults";url="/mobiledoc/jsp/webemr/progressnotes/pastresults/pastResults.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/pastresults/js/pastResults.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Operative Report:":if(categoryId==="Visit Code:"||categoryId==="Procedure Codes:"){var params={isOV:true,TrUserId:$scope.userId,encounterId:$scope.encounterId,patientId:$scope.patientId,ms:(new Date).getTime()};params=$.param(params);module="billing";url="/mobiledoc/jsp/webemr/progressnotes/billing/billing.jsp?"+params;var files=['/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/templates/cpt-tpl.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js']}else{module="operariveReportPNApp";url="/mobiledoc/jsp/webemr/progressnotes/operativeReport.jsp?encounterId="+$scope.encounterId+"&category="+categoryId;var files=['/mobiledoc/jsp/webemr/progressnotes/operativeReportController.js']}data.url=makeURL(url);data.dependencies=files;data.modulename=module;$scope.pn_popup_height=570;break;case"CDSS:":case"Recommended Wellness and Prevention Guidelines:":module="alertsMainApp";url='/mobiledoc/jsp/webemr/alerts/cdss/alertsMain.jsp?launchedFrom=progressNote&patientId='+$scope.patientId+'&encounterId='+$scope.encounterId;data.url=makeURL(url);data.dependencies=getDependencies('alertsMainApp');data.modulename=module;break;case"Surgical Posting:":surgicalposting_localstorage=getSurgicalPostingCategory();if(propId){module="surgicalpostingnotes";url="/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalpostingnotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;url=url+"&propName="+propName}else{module="surgicalposting";var firstSurgCatObj=getFirstTreeItem(surgicalposting_localstorage);url="/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalposting.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+global.TrUserId+"&nd="+(new Date).getTime();if(firstSurgCatObj.id){url=url+"&defaultCatId="+firstSurgCatObj.id+"&defaultCatName="+firstSurgCatObj.label}}parentIdValue=surgicalposting_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;var files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalpostingcontroller.js'];data.url=makeURL(url);data.dependencies=files;data.seriesLoadFlag=true;data.modulename=module;break;case"Care Management Assessment:":var cma_localstorage=getImprovedHPICategoryData();var files=[];if(propId){module="hpinotes";url="/mobiledoc/jsp/webemr/progressnotes/hpi/hpinotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=cma_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js']}else{module="hpi";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.seriesLoadFlag=true;data.modulename=module;break;case"Problems:":module="carePlan";url="/mobiledoc/jsp/webemr/progressnotes/careplan/careplan_sch.jsp?OpType=GETCAREPLANENCDATA&EncId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&PtId="+$scope.patientId+"&ICD=";var files=['/mobiledoc/jsp/webemr/progressnotes/careplan/carePlanController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Disposition:":module="disposition";url="/mobiledoc/jsp/webemr/progressnotes/disposition/disposition.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/disposition/dispositioncontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Pre-op. Diagnosis:":module="preOpDiagnosisApp";url="/mobiledoc/ascWeb/PnPanel.go/getPatPreOpDiagnosis/"+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/patPreOpDiagnosisCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Anesthesia Plan:":module="patAnesthesiaPlanApp";url="/mobiledoc/ascWeb/PnPanel.go/anesthesiaPlan/patAnesthesiaPlan/"+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/anesthesiaPlan/js/patAnesthesiaPlanController.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Anesthesia Details:":module="patAnesthesiaDetailsApp";var sectionName="Anesthesia Details";var sectionParams=buildParams(sectionName,categoryId);url="/mobiledoc/ascWeb/PnPanel.go/Anesthesia/patAnesthesiaDetails"+sectionParams;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/js/notesService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/ipOperativeService.js','/mobiledoc/jsp/ascWeb/templates/keywords-tpl.js','/mobiledoc/jsp/ascWeb/templates/ipCapturedBy.js','/mobiledoc/jsp/ascWeb/templates/notesData-tpl.js','/mobiledoc/jsp/ascWeb/templates/examnotes-tpl.js','/mobiledoc/jsp/ascWeb/templates/structuredata-tpl.js','/mobiledoc/jsp/ascWeb/css/xeditable.css','/mobiledoc/jsp/ascWeb/templates/customitem-tpl.js','/mobiledoc/jsp/ascWeb/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/patAnesthesiaDetailsCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Comments:":module="commentsApp";url="/mobiledoc/ascWeb/PnPanel.go/patComments?encounterId="+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/comments/js/patCommentsCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Preoperative Details:":module="patPreoperativeDetailsApp";sectionName="Preoperative Details";sectionParams=buildParams(sectionName,categoryId);url="/mobiledoc/ascWeb/PnPanel.go/Anesthesia/patPreoperativeDetails"+sectionParams;files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/js/notesService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/ipOperativeService.js','/mobiledoc/jsp/ascWeb/templates/keywords-tpl.js','/mobiledoc/jsp/ascWeb/templates/ipCapturedBy.js','/mobiledoc/jsp/ascWeb/templates/notesData-tpl.js','/mobiledoc/jsp/ascWeb/templates/examnotes-tpl.js','/mobiledoc/jsp/ascWeb/templates/structuredata-tpl.js','/mobiledoc/jsp/ascWeb/css/xeditable.css','/mobiledoc/jsp/ascWeb/templates/customitem-tpl.js','/mobiledoc/jsp/ascWeb/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/patAnesthesiaDetailsCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Interventions:":$scope.inkingUrl="";module="interventionModal";var enc={"name":encObj.name,"encFormattdDate":encObj.encFormattdDate,"encFormattdDate":encObj.encFormattdDate,"visitType":encObj.visitType};enc=escape(JSON.stringify(enc));url="/mobiledoc/jsp/webemr/progressnotes/interventions/interventions.jsp?action=step1&encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&enc="+enc;var files=['/mobiledoc/jsp/webemr/progressnotes/interventions/interventionsController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Implants:":module="implantsApp";url="/mobiledoc/ascWeb/PnPanel.go/implantsEmr/getImplants/"+sectionAlreadyChanged.implantChanged;let implants_files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/implantsEmr/js/implantsService.js','/mobiledoc/jsp/ascWeb/templates/category-tpl.js','/mobiledoc/jsp/ascWeb/templates/spellCheck-tpl.js','/mobiledoc/jsp/ascWeb/js/vendor/floatThead.js','/mobiledoc/jsp/ascWeb/templates/keywords-tpl.js','/mobiledoc/jsp/resources/jslib/moment/moment.js','/mobiledoc/jsp/ascWeb/js/vendor/perfect-scrollbar.jquery.min.js','/mobiledoc/jsp/ascWeb/js/angularjs/angular-perfect-scrollbar.js','/mobiledoc/jsp/ascWeb/templates/notesData-tpl.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/implantsEmr/js/implantsController.js',"/mobiledoc/jsp/ascWeb/css/perfect-scrollbar.min.css"];data.url=makeURL(url);data.dependencies=implants_files;data.modulename=module;break;case"Transition Care Management:":var patientid=null;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().patientId){patientid=EncDetailsService.getEncDetails().patientId}module="TMCNotesModule";url="/mobiledoc/jsp/TCM/modules/TCMDocumentModal/TCMNotes.jsp?nDeviceEmrFlag=1&isRequestFromPN=1&TrUserId="+$scope.userId+"&patientid="+patientid+"&encounterId="+$scope.encounterId;var files=['/mobiledoc/jsp/TCM/modules/TCMDocumentModal/js/tcmNotes.js'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"Screening:":case GetCaptionForSoapItem("Screening")+":":module="bhscreeningmodalApp";url="/mobiledoc/jsp/webemr/behavioralhealth/progressnote/screening/views/screening-modal.jsp?patientid="+$scope.patientId+"&encounterId="+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/js/vendor/daterangepicker/bootstrapui-timepicker.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/js/notesDirective.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/css/notesDirective.css','/mobiledoc/jsp/webemr/ecwspeech/js/evaspeech.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/screening/css/screening-modal.css','/mobiledoc/jsp/webemr/js/globalframeworkService.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/screening/js/screeningModalCtrl.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/screening/js/MonthPicker.js','/mobiledoc/jsp/ccmr/webPortal/dashBoard/ccm/js/Timer.js','/mobiledoc/jsp/webemr/ecwspeech/js/evaspeech.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;$scope.screeningParams={templateId:categoryId||'-1',entryId:propId||'-1'};break;case"Time Tracker:":case GetCaptionForSoapItem("TimeCapture")+":":module="timeCapture";url="/mobiledoc/behavioralhealth/ShowTimeCaptureController.go/getBhTimeCapture/"+$scope.encounterId+"/"+$scope.patientId+"/"+$scope.bh_OpenStopTimerModal;var files=['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/behavioralhealth/css/bh-timecapture.css','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/timecapture/js/bhTimeCaptureController.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/timecapture/showtimecapture/js/timeCaptureService.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/timecapture/showtimecapture/js/timeCaptureDir.js','/mobiledoc/jsp/webemr/behavioralhealth/utils/bh_utils.js','/mobiledoc/jsp/ascWeb/templates/notesData-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/js/notesDirective.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/css/notesDirective.css','/mobiledoc/jsp/webemr/ecwspeech/js/evaspeech.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Behavioral History:":case GetCaptionForSoapItem("BehavioralHistory")+":":module="BhHistory";url="/mobiledoc/behavioralhealth/pnBhHistory/getBhHistory/"+$scope.encounterId+"/"+$scope.patientId+"/"+$scope.isBhEditable+"/"+sectionAlreadyChanged.bhHistoryChanged;var files=['/mobiledoc/jsp/webemr/templates/structuredata-tpl.js','/mobiledoc/jsp/webemr/behavioralhealth/progressnote/behavioralhistory/js/bhHistoryCtrl.js','/mobiledoc/jsp/webemr/behavioralhealth/css/behavioural-health.css','/mobiledoc/jsp/webemr/ecwspeech/js/evaspeech.js','/mobiledoc/jsp/webemr/behavioralhealth/js/ui-bootstrap-tpls-1.3.2.min.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/js/notesDirective.js','/mobiledoc/jsp/webemr/behavioralhealth/directives/notesDirective/css/notesDirective.css','/mobiledoc/jsp/webemr/js/globalframeworkService.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Homunculus Examination:":case GetCaptionForSoapItem("Homunculus Examination")+":":$scope.pn_popup_width=1368;module="homunculusModule";url="/mobiledoc/jsp/homunculus/homunculus.jsp";var files=['/mobiledoc/jsp/homunculus/assets/css/homunculus-main.css','/mobiledoc/jsp/homunculus/assets/js/svg-drag-select.js','/mobiledoc/jsp/resources/jslib/@panzoom/panzoom/dist/panzoom.js','/mobiledoc/jsp/homunculus/controller/homunculusHelperService.js','/mobiledoc/jsp/homunculus/controller/homunculusController.js'];PNService.setParametersForScreen("homunculusExamination",{encounterId:$scope.encounterId,patientId:$scope.patientId});data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Dynamic Forms:":module="reportWriterLookup";url="/mobiledoc/jsp/webemr/lookup/report-writer-lookup-modal.html";var files=getDependencies('reportWriterDetailsConfig');data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;default:data.url=''}}setPnModuleName(data.modulename);return data};function setPnModuleName(moduleName){if(typeof AsyncModule==='undefined'){return}else{AsyncModule.pnModuleName=moduleName}}$scope.ocLazyLoadPopup=function(popupData,type){var bSerie=false;if(popupData.seriesLoadFlag){bSerie=true}if(type!="custom"){if(typeof ecwhelpProgressnotesPopup==="function"){ecwhelpProgressnotesPopup(popupData.url)}$ocLazyLoad.load({name:popupData.modulename,serie:bSerie,files:popupData.dependencies}).then(function(){let popupUrl=popupData.url;if(!popupUrl.endsWith("nts")){popupUrl+="&timestamp="+(new Date).getTime()}$scope.popupurl.value=popupUrl},function(e){alert(e);console.log(e)})}else{$ocLazyLoad.load({name:popupData.modulename,serie:bSerie,files:popupData.dependencies}).then(function(){if($scope.pncustompopupurl){$templateCache.remove($scope.pncustompopupurl)}$scope.pncustompopupurl="";$scope.pncustompopupurl=popupData.url+"&timestamp="+(new Date).getTime()},function(e){alert(e);console.log(e)})}};$scope.clsoeCarePlanDialog=function(){$scope.pncustompopupurl=""};$scope.closeDentalExaminationDialog=function(){$scope.pncustompopupurl=""};$scope.removeCustomPopup=function(){$scope.pncustompopupurl=""};$scope.showClickThroughVision=function(encId,catId,fieldGroupId,fieldId,eyeSide){var args={name:'Eye Examination',encId:encId,catId:fieldGroupId,parentCatId:catId,itemId:fieldId,eyeSide:eyeSide,woundId:-1,socialChangedFlag:true};saveUnsavedAndLoad(args,showClickThroughCallback)};$scope.showClickThrough=function(name,encId,catId,itemId,woundId,socialChangedFlag){var args={name:name,encId:encId,catId:catId,itemId:itemId,woundId:woundId,socialChangedFlag:socialChangedFlag};saveUnsavedAndLoad(args,showClickThroughCallback)};var showClickThroughCallback=function(args){if(isGroupVisit){return}if(templateEditAccess=='false'){ecwAlert("You do not have permission to modify this template.Contact Admin.","Template Permission");return}var isPermitted=checkPermissionForPNLinks(args.name+":");if(isPermitted){var url="/mobiledoc/jsp/webemr/progressnotes/clickThrough/clickThrough.jsp?encId="+args.encId+"&name="+args.name+"&catId="+args.catId+"&itemId="+args.itemId+"&ptId="+$scope.patientId+"&socialChangedFlag="+args.socialChangedFlag;if(args.woundId)url+="&woundId="+args.woundId;if(args.name==='Eye Examination'){url+="&parentCatId="+args.parentCatId+"&eyeSide="+args.eyeSide}url=makeURL(url);if($scope.caretspopupurl&&$scope.caretspopupurl.value){$templateCache.remove($scope.caretspopupurl.value)}$scope.caretspopupurl={};$ocLazyLoad.load({name:'clickThrough',files:['/mobiledoc/jsp/webemr/progressnotes/clickThrough/clickThrough.js']}).then(function(){$scope.caretspopupurl.value=url},function(e){alert(e);console.log(e)})}else{alert("Permission Denied")}};$scope.showEyeCaretPopUp=function(pnSectionName,categoryId){var encDate='';encDate=EncDetailsService.getEncDetails().encDate;$scope.caretspopupurl={};$ocLazyLoad.load({name:'visionModule',files:['/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/inlinepopup/js/visionExaminationPopUpService.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/inlinepopup/js/visionExaminationPopUpController.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/js/visionExamMainService.js','/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js']}).then(function(){var url="/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/inlinepopup/visionExaminationPopUp.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&sectionId="+categoryId+"&encDate="+encDate+"&sectionName="+pnSectionName;$scope.caretspopupurl.value=makeURL(url)},function(e){})};$scope.loadCaretsPopUp=function(url){var args={url:url};saveUnsavedAndLoad(args,loadCaretsPopUpCallback)};var loadCaretsPopUpCallback=function(args){if(isGroupVisit){return}if(templateEditAccess=='false'){ecwAlert("You do not have permission to modify this template.Contact Admin.","Template Permission");return}$scope.caretspopupurl={};$ocLazyLoad.load({name:'caretsApp',files:['/mobiledoc/jsp/webemr/progressnotes/carets/recentEnc.js']}).then(function(){$scope.caretspopupurl.value=makeURL(args.url)},function(e){alert(e);console.log(e)})};var popupData=function(modulename,dependencies,url){this.modulename=modulename;this.dependencies=dependencies;this.url=url};$scope.openManageOrderPopup=function(actionName){var labType=0;if(actionName=='Lab Reports:'){labType=0}else if(actionName=='Diagnostic Imaging:'){labType=1}var url=makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp");var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:labType,parentName:'AddNewOrder',requestedFrom:'PNHeader',context:"PNHeader",nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.js']}).then(function(){var modalInstance=$modal.open({templateUrl:url,controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url);try{if(chkForDxCall!=undefined){if(chkForDxCall=="true"){$scope.loadProgressNote('Assessment:')}}}catch(e){}console.log('Modal dismissed at: '+new Date)})})};$scope.openSpecialtyFormList=function(){$scope.specialtyformurl="";$ocLazyLoad.load({name:'SpecFormListModule',files:['/mobiledoc/jsp/webemr/specialtyforms/scripts/specialtyFrmListController.js'],cache:false}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/specialtyforms/specialtyFormList.jsp?encid='+$scope.encounterId+'&pid='+$scope.patientId);$scope.specialtyformurl=makeURL(url)},function(e){console.log('call funtiion :: '+e)});$(".modal-backdrop").css('position','relative')};$scope.openSpecialtyForms=function(){$scope.specialtyformurl="";$ocLazyLoad.load({name:"specialtyforms",cache:false,files:['/mobiledoc/jsp/webemr/specialtyforms/specialtyFormController.js']}).then(function(){var url="/mobiledoc/jsp/webemr/specialtyforms/specialtyFormContainer.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;$scope.specialtyformurl=makeURL(url)},function(e){console.log(e)})};$scope.opencqwmodal=function(){$scope.specialtyformurl="";$ocLazyLoad.load({name:"cqw",files:['/mobiledoc/jsp/webemr/sws/SWS_Controller.js']}).then(function(){var ht=$("#mainPNDialog").css("height");var wd=$("#mainPNDialog").css("width");var url="/mobiledoc/jsp/webemr/sws/SWS_Container.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;url=url+"&ht="+ht+"&wd="+wd;$scope.specialtyformurl=makeURL(url)},function(e){console.log(e)})};$scope.openSmartForm_PN=function(tName,formId,bFromClickThru){if(!bFromClickThru){var isPermitted=checkPermissionForPNLinks(tName+":");if(!isPermitted){ecwAlert("Permission Denied.");return false}}if(formId){try{formId=parseInt(formId)}catch(ex){}}if(formId>0){$templateCache.remove($scope.sfPopupurl);$ocLazyLoad.load({name:'smartFormModule',files:['/mobiledoc/jsp/webemr/specialtyforms/scripts/smartFormController.js']}).then(function(){var url='/mobiledoc/jsp/webemr/specialtyforms/smart-form-tpl.jsp';url+='?encid='+$scope.encounterId+'&pid='+$scope.patientId+'&frmid='+formId;url=makeURL(url);$scope.sfPopupurl=url},function(e){ecwAlert("An error occurred while loading Smart Form.")});openSmartFormModal($scope,$scope.encounterId,$scope.patientId,formId,refreshPNDashBoard)}};var refreshPNDashBoard=function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")};$scope.convertIcd9to10inPN=function(value){var str=value.split(",");if(str==null||str.length<2){ecwAlert("Invalid ICD-9 Code.");return}var asmtId=str[0];var asmtCode=str[1];asmtCode=asmtCode.replace(/\s+/g,'');$scope.icd9Data={code:asmtCode,name:"",itemId:asmtId};icd10ConversionService.autoMapICD9to10(asmtCode,"",asmtId,$scope.icdConverionCallBack)};$scope.icdConverionCallBack=function(action,data){if(action&&action==="close"){}else{if(data){if(data.status&&data.status=="success"){if(data.nodx&&data.nodx=="yes"){if($scope.icd9Data&&$scope.icd9Data){ecwAlert($scope.icd9Data.code+" : "+$scope.icd9Data.name+" has no ICD-10 Mapping.")}else{ecwAlert("Entered ICD-9 Code has no ICD-10 Mapping.")}return}var bCodeMapped=false;var icdArray=data.icdArray;if(icdArray){strXML="";strXML+="<S:Envelope xmlns:S='http://schemas.xmlsoap.org/soap/envelope/' ";strXML+=" xmlns:SOAP-ENC='http://schemas.xmlsoap.org/soap/encoding/' ";strXML+=" S:encodingStyle='http://schemas.xmlsoap.org/soap/encoding/' ";strXML+=" xmlns:xsd='http://www.w3.org/1999/XMLSchema' ";strXML+=" xmlns:xsi='http://www.w3.org/1999/XMLSchema-instance'>";strXML+="<S:Body>";strXML+="<return>";strXML+="<icd9code xsi:type='xsd:string'>"+$scope.icd9Data.code+"</icd9code>";strXML+="<icd9id xsi:type='xsd:string'>"+$scope.icd9Data.itemId+"</icd9id>";strXML+="<encounterid xsi:type='xsd:string'>"+$scope.encounterId+"</encounterid>";strXML+="<patientid xsi:type='xsd:string'>"+$scope.patientId+"</patientid>";$.each(icdArray,function(index,obj){var strIcd10Code=obj.code;var strShortDesc=obj.name;var strLongDesc=obj.name;bCodeMapped=true;strXML+="<icd10 xsi:type='xsd:string'>";strXML+="<code xsi:type='xsd:string'>"+strIcd10Code+"</code>";strXML+="<longdesc xsi:type='xsd:string'>"+escapeHtml(strLongDesc)+"</longdesc>";strXML+="<shortdesc xsi:type='xsd:string'>"+escapeHtml(strShortDesc)+"</shortdesc>";strXML+="</icd10>"});strXML+="</return>";strXML+="</S:Body></S:Envelope>";if(bCodeMapped){urlConv="/mobiledoc/jsp/catalog/xml/updateEncICD9ToICD10.jsp";xsrf={"FormData":strXML,"TrUserId":truserid,"timestamp":(new Date).getTime()};$.ajax({method:'POST',url:urlConv,data:xsrf,dataType:'xml',"async":false,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},success:function(responseText){if(responseText){$xml=$(responseText);var status=$xml.find('status').text();if(status){status=status.toUpperCase();if(status=='SUCCESS'){var duplicateAsmts=$xml.find('duplicateasmtcodes').text();if(duplicateAsmts){var msg;if(duplicateAsmts.indexOf(",")){msg="ICD Code '"+duplicateAsmts+"' is already in the selected list."}else{msg="ICD Codes '"+duplicateAsmts+"' are already in the selected list."}ecwAlert(msg);return}refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}else{alert("An error occurred while converting ICD9 to ICD10")}}}},error:function(xmlHttpRequest,textSts,err){ecwAlert("An error occurred while converting ICD9 to ICD10")}})}}}else{ecwAlert("An error occurred while performing ICD-9 to ICD-10 Mapping");return}}else{ecwAlert("An error occurred while Performing ICD-9 to ICD-10 Mapping");return}}$(".modal-backdrop").remove()};$scope.openTemplate=function(){let visitType="GEN";if(encObj.physicalFlag||encObj.dataAssessmentPlanFlag){visitType="ANNUAL"}else if(encObj.opProcFlag){visitType="OP"}else if(encObj.interventionsFlag){visitType="int"}$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:"templates",files:['/mobiledoc/jsp/webemr/progressnotes/templates/templatesController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/progressnotes/templates/template-select.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&visitType="+visitType+"&trUserId="+userId);$scope.extmodule.url=url;if(angular.element($("#pn"))&&angular.element($("#pn")).scope()){angular.element($("#pn")).scope().saveData(true)}},function(e){console.log(e)})};$scope.openChargeDetails=function(){$templateCache.remove($scope.sfPopupurl);$ocLazyLoad.load({name:'patientChargeDetailsApp',files:['/mobiledoc/jsp/webemr/webpm/js/patientChargeDetail.js','/mobiledoc/jsp/webemr/js/xml2json.min.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/webpm/patientChargeDetails.jsp?patientId="+$scope.patientId+"&encId="+$scope.encounterId+"&pvDate="+EncDetailsService.getEncDetails().encDate+"&altCoPay=false&altCoPayValue=&parentScreen=frmBilling");$scope.sfPopupurl=url},function(e){console.log(e)})};$scope.openBillingCommonSend=function(){$scope.$broadcast('openCommonSend',{})};$scope.onLoadingVV=function(){$('#virtualvisit div[id=progress_content]').addClass('vertical-scroll');$scope.showLoadingImage();if($('#smart-todo-panel').is(':visible')){updateprogressNotesContentMarginRight()}};$scope.onloadNgInclude=function(){adjustPNHeight();$scope.hideLoadingImage();$scope.displayPNPtHeader();updatePathForLogo();updatePathForSign();setTitleForVerifyHx();if($('#smart-todo-panel').is(':visible')){updateprogressNotesContentMarginRight()}};function setTitleForVerifyHx(){if(!$scope.enableVerifyHistories){$('#verifyhistories').attr({title:'The following sections can be verified only if the section is documented\n or the denial checkbox is checked: Current Medication, Medical\n History, Allergies/Intolerance, Surgical History, Hospitalization, Family\n History and Social History. In case of Family History, its Non-\nContributory checkbox.'})}}function updatePathForLogo(){var imageElement=$('#progress_content #logo');if(imageElement.length>0){for(var i=0;i<imageElement.length;i++){var path=imageElement[i].src;if(path.indexOf('mobiledoc/jsp/webemr/logo.JPG')>0){var newPath=path.substring(0,path.indexOf('mobiledoc/jsp/webemr/logo.JPG'))+"mobiledoc/jsp/catalog/xml/logo.JPG";imageElement[i].src=newPath}}}}function updatePathForSign(){var imageElement=$('#progress_content #signature');var providerSignaturePostFix=getItemKeyValue("ProviderSignaturePostFix");if(imageElement.length>0){for(var i=0;i<imageElement.length;i++){var path=imageElement[i].src;if(path.indexOf("/mobiledoc/jsp/catalog/xml/")<0){var newPath=path.substring(0,path.indexOf('mobiledoc'))+"mobiledoc/jsp/catalog/xml"+path.substring(path.lastIndexOf("/"),path.length)+"?providerSignaturePostFix="+providerSignaturePostFix;console.log(newPath);imageElement[i].src=newPath}}}}$scope.displayPNPtHeader=function(){if(showPNHeaderJS!=""){if(showPNHeaderJS=='0'){if($('div#collapseData').length){$('div#collapseData').hide()}if($('div#pnDetails').length&&$('#showHidePNDetails2').length){$('div#pnDetails > #showHidePNDetails2').attr({src:"/mobiledoc/jsp/images/cmQueuePlus.gif"})}}else if(showPNHeaderJS=='1'){if($('div#collapseData').length){$('div#collapseData').show()}if($('div#pnDetails').length&&$('#showHidePNDetails2').length){$('div#pnDetails > #showHidePNDetails2').attr({src:"/mobiledoc/jsp/images/cmQueueMinus.gif"})}}}};$scope.pnPopupOnLoad=function(){$(".modal-backdrop").css('position','relative');$('.scribe-wrap').css('z-index','0')};$scope.$on('$destroy',function(){mySharedService.outForBroadcast($scope.encounterId,$scope.patientId,$scope.userId);pn_content=null;showPNHeaderJS=null;nextXml=null;prevXml=null;encounterId=null;patientId=null;userId=null;sessionId=null;examAccess10e=null;physicalExamAccess10e=null;rosAccess10e=null;hpiAccess10e=null;treatmentAccess10e=null;assessmentAccess10e=null;procedureAccess10e=null;virtualVisit=null;progressNotesXml=null;sectionAlreadyChanged=null;templateEditAccess=null;tobeMergedTemplate=null;tobeUnMergedTemplate=null;isGroupVisit=null;ImmunizationsAccess10e=null;SkinTestAccess10e=null;vitalsAccess10e=null;if(pnPanelTextOnblurHandler&&typeof pnPanelTextOnblurHandler=='function'){$('input[type="text"]').off('blur',pnPanelTextOnblurHandler)}var isEnableReduceConcurrencyDeleteCall=getItemKeyValue("ReduceConcurrencyDeleteCall").toLowerCase()==="yes";if(isEnableReduceConcurrencyDeleteCall&&$scope.isOfficeVisitProgressNoteOpen&&$("#TJellyDetailViewid").length<=0&&$('.rpm-draggable-timer-modal').length===0){asyncReleaseFormLock()}try{if(!angular.isUndefined($scope.isClickedFromCCMRVisit)){$('.phmhubWeb-modal').remove();$scope.ccmrURL="";$scope.validationNoToCheckOnPHMHub=(new Date).valueOf();phmScope.phvCtrl.destory()}}catch(err){}});$scope.hideMenu=function(menuId){$("#"+menuId).removeClass("open")};$scope.loadPNPatientDocs=function(){var strFaxInboxUser=getItemKeyValue("FaxInboxUser");if(strFaxInboxUser==""){strFaxInboxUser=50}if(!($scope.patientId==strFaxInboxUser)){PSACService.checkCommonStaffPermission($scope.patientId,function(data){$scope.patientName="";try{if(EncDetailsService.getEncDetails().name){$scope.patientName=EncDetailsService.getEncDetails().name}}catch(err){}$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'PtDocsModule',files:['/mobiledoc/jsp/webemr/toppanel/patientdocs/js/patientdocs.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/toppanel/patientdocs/patientdocs.jsp?patientId="+$scope.patientId+"&patientName="+$scope.patientName+"&encounterId="+$scope.encounterId+"&nd="+(new Date).getTime());$scope.extmodule.url=url},function(e){console.log(e)})},function(){})}};$scope.loadPNPtReferral=function(referralType){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'ptReferralApp',files:['/mobiledoc/jsp/webemr/jellybean/referral/ptReferralController.js']}).then(function(){var url='/mobiledoc/jsp/webemr/jellybean/referral/ptReferrals.jsp?PatientId='+$scope.patientId+"&defultselecte="+referralType;$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNPatientInfo=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'NewInfo',files:['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/toppanel/patientInfo/ptInfoController.js','/mobiledoc/jsp/webemr/toppanel/patientInfo/miscController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/toppanel/patientInfo/patient-demographics.jsp?patientId='+$scope.patientId+'&nd='+(new Date).getTime());$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNPatientHub=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};PSACService.checkCommonStaffPermission($scope.patientId,function(){$ocLazyLoad.load({name:'NewHub',files:['/mobiledoc/jsp/webemr/toppanel/patientHub/patienthubController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/toppanel/patientHub/patient-hub.jsp?patientId='+$scope.patientId+'&encounterId='+$scope.encounterId+'&nd='+(new Date).getTime());$scope.extmodule.url=url},function(e){ecwAlert("Error opening Patient Hub, Please contact support.")})})};$scope.loadPNImmunization=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'ImmInjHxApp',files:getDependencies('ImmInjHxApp')}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?nImmInjType=1&context='progressnotes'&toppanelencounterId="+$scope.encounterId+"&patientId="+$scope.patientId);$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNNewTelEnc=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'TJellyDetailView',files:getDependencies('TJellyDetailView')}).then(function(){var url='/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-Telephone-Encounter-DetailView.jsp?&EncounterId=0&PatientId='+$scope.patientId+'&parentfunctionname=cmdNewTelEncClick&enctype=2&index=-1&context=patienthub';url=makeURL(url);$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNLab=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'LabHistoryApp',files:['/mobiledoc/jsp/webemr/labs/labhistory/js/LabDIProHistory.js','/mobiledoc/jsp/webemr/templates/pagination-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/labhistory/LabDIProHistory.jsp?nType=0&patientId="+$scope.patientId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime());$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNDI=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'LabHistoryApp',files:['/mobiledoc/jsp/webemr/labs/labhistory/js/LabDIProHistory.js','/mobiledoc/jsp/webemr/templates/pagination-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/labhistory/LabDIProHistory.jsp?nType=1&patientId="+$scope.patientId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime());$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNOrder=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'ptOrdersApp',files:['/mobiledoc/jsp/webemr/scheduling/patientorders/patientOrdersController.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/scheduling/patientorders/patientOrders.jsp?PatientId="+$scope.patientId+"&EncounterId="+$scope.encounterId);$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNLabRequest=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};$ocLazyLoad.load({name:'labRequestForm',files:['/mobiledoc/jsp/webemr/progressnotes/labRequestForm/labRequestFormController.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/progressnotes/labRequestForm/labRequestForm.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&context=PNHeader&nDxId=0");$scope.extmodule.url=url},function(e){console.log(e)})};$scope.loadPNClaim=function(){$scope.newPNCreatedClaim={Id:pn_Header_nClaimIdPN,Type:pn_Header_nClaimTypePN};viewPNClaimForOpenEMREnterprise($scope.encounterId,$scope.showClaimFromEncounter)};$scope.showClaimFromEncounter=function(bView){if(bView==false){ecwAlert("You do not have permission to view the Claim. Contact Admin.","eClinicalWorks");return false}else{checkPNClaimPermission($scope.showClaimFromEncounter1)}};$scope.showClaimFromEncounter1=function(){getPNClaimsDatFromEncounter($scope.encounterId,$scope.loadClaimScreen)};var getClaimDataFromEnc=function(){var strUrl=makeURL("/mobiledoc/jsp/catalog/xml/CheckClaimForEnc.jsp?encounterId="+$scope.encounterId);getAjaxSyncDataClaimBatch(null,"POST",strUrl,false).success(function(response){if(response){var x2js=new X2JS;var objJson=x2js.xml_str2json(response);objJson=objJson.Envelope.Body['return'];if(objJson.status&&objJson.status.toUpperCase()=="SUCCESS"){$scope.newPNCreatedClaim.Id=objJson.claimId;$scope.newPNCreatedClaim.Type=objJson.claimType}else{ecwAlert("An error occured while loading ecounter claim data.","eClinicalWorks");return false}}}).error(function(){})};var loadProgressNoteClaimData=function(claimType,claimId){var bottomPanelAppScopeObj=angular.element(document.getElementById('bottomPanelApp')).scope();if(bottomPanelAppScopeObj&&bottomPanelAppScopeObj!==null){bottomPanelAppScopeObj.setClaimDataForPN(claimId,claimType)}};$scope.resetClaimDataForPN=function(){$scope.newPNCreatedClaim.Id="0";$scope.newPNCreatedClaim.Type="0";loadProgressNoteClaimData($scope.newPNCreatedClaim.Type,$scope.newPNCreatedClaim.Id)};$scope.loadClaimScreen=function(){getClaimDataFromEnc();var nClaimId=$scope.newPNCreatedClaim.Id;var nClaimType=$scope.newPNCreatedClaim.Type;$templateCache.remove($scope.extmodule.url);$scope.extmodule={};if(nClaimId<=0){$scope.$apply(function(){var encId=$scope.encounterId;$scope.extmodule.url=makeURL("/mobiledoc/jsp/webemr/webpm/createEncounterClaim.jsp?encounterId="+encId)})}else if(nClaimId>0){$scope.openPNClaimFromPNHeader(nClaimType,nClaimId)}};$scope.sendResCreateNewClaim=function(args){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};if(args!=null&&args.nInvId!=undefined){$("#icon_ClaimNotes").css("display","");var nClaimType=args.nClaimType;var nClaimId=args.nInvId;loadProgressNoteClaimData(nClaimType,nClaimId);$scope.openPNClaimFromPNHeader(nClaimType,nClaimId)}};$scope.openPNClaimFromPNHeader=function(nClaimType,nClaimId){$templateCache.remove($scope.extmodule.url);$scope.extmodule={};var moduleName="";var files=[];var strUrl="";$scope.newPNCreatedClaim.Id=nClaimId;$scope.newPNCreatedClaim.Type=nClaimType;if(nClaimType==0){var param={claimId:nClaimId,parentScreen:'progressNotes',encounterId:$scope.encounterId,patientId:$scope.patientId};loadHCFAClaim($ocLazyLoad,$modal,param,$scope)}else if(nClaimType==1){var param={claimId:nClaimId,parentScreen:'progressNotes'};loadUBClaim($ocLazyLoad,param,$scope,'extmodule','url')}else if(nClaimType==2){var param={claimId:nClaimId,parentScreen:'progressNotes',prevClaim:0,nextClaim:0};loadDentalClaim($ocLazyLoad,param,$scope,'extmodule','url')}};$scope.closeBillingModal=function(){$templateCache.remove($scope.extmodule.url);$scope.extmodule={url:""}};$scope.launchInking=function(docId,customName,fileName,docType,inkFilePath,drawingId,section){var tempFileName=fileName;var lastIndx=tempFileName.lastIndexOf(".");var inkFileExt=tempFileName.substring(lastIndx+1,tempFileName.length);var context="eCFormShortCuts";if(section==="Dermatology"){context="DERM"}var isStreamOn=getItemKeyValue("EnableWebEditorStreaming",false);if(isStreamOn==="yes"){$ocLazyLoad.load({name:'webEditorModule',files:['/mobiledoc/jsp/webemr/webEditor/js/inkEditActions.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/webEditor/webEdit.jsp?fileName="+fileName+"&filePath="+inkFilePath+"&fileType="+inkFileExt+"&Stream="+isStreamOn+'&isDocumentIdHashed=false&printHandler=1&documentId='+docId+'&token='+csrfToken);$scope.inkingUrl=url},function(error){console.log(error)})}else{$.ajax({url:makeURL("/mobiledoc/jsp/webemr/webEditor/downloadFtpFileToLocal.jsp"),type:"POST",data:"nd="+(new Date).getTime()+"&downloadFileName="+fileName+"&downloadFilePath="+inkFilePath+"&uploadFileName="+fileName+"&fileType="+inkFileExt,"async":false,success:function(data){if(data!=null&&data.length>0){data=data.trim();if(data.toLowerCase().indexOf("file not found")>-1){showMessage("File is not available with Server.","")}else if(data.toLowerCase().indexOf("fail")>-1){showMessage("Unable To Load Document, Please Try After Some time.","")}else if(data.indexOf("UnableToLoadIMG")>-1){showMessage("Unable to Load Document/Image, Please Try After Some time.","")}else if(data.indexOf("UnableToLoadPDF")>-1){showMessage("Unable to Load Document/PDF, Please Try After Some time.","")}else{$scope.inkingUrl="";$ocLazyLoad.load({name:'webEditorModule',files:['/mobiledoc/jsp/webemr/webEditor/js/inkEditActions.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/webEditor/webEdit.jsp?xodFilePath="+encodeURIComponent(data)+"&fileName="+fileName+"&filePath="+inkFilePath+"&fileType="+inkFileExt+"&Stream="+isStreamOn+'&isDocumentIdHashed=false&printHandler=1&documentId='+docId+"&token="+csrfToken+"&isThumbnailCreation=true&context="+context+"&patId="+$scope.patientId+"&encId="+$scope.encounterId+"&docType="+docType);$scope.inkingUrl=url},function(error){console.log(error)})}}}})}};$scope.closeInking=function(){};$scope.removeFolderCreated=function(){$.ajax({url:makeURL("/mobiledoc/jsp/webemr/webEditor/cleanUpFiles.jsp?isView=no"),type:"POST",data:'',success:function(data){}})};$scope.hideLoadingImage=function(){$timeout(function(){document.getElementById("divPNScreenLoader").style.display="none"},500)};$scope.openMeaningfulUseScreen=function(){$ocLazyLoad.load({name:"musearchmodulemark",files:['/mobiledoc/jsp/webemr/js/jquery.mark.min.js'],cache:true}).then(function(){var url="/mobiledoc/jsp/catalog/xml/getSummaryView.jsp?encounterId="+$scope.encounterId+"&style=search&redirect=1&projectE=true";url=makeURL(url);$http.get(url).success(function(data){$('#muSearchData').html("");var htmlVal=removeStyleTag(data);$('#muSearchData').html(removeScriptTagsPN(htmlVal));$("#meaningFulUseSearchModal").modal('show')}).error(function(){$('#muSearchData').html("Internal Error Occurred.");$("#meaningFulUseSearchModal").modal('show')})},function(){$('#muSearchData').html("Internal Error Occurred.");$("#meaningFulUseSearchModal").modal('show')})};$scope.closeMUModal=function(){$("#meaningFulUseSearchModal").modal('hide');$('#muSearchData').html("");$scope.patient_MUData.text="";$scope.patient_MUData.navigationEnabled=false;$scope.patient_MUData.searchedElementIndex=-1;$scope.patient_MUData.count=0};$scope.markText=function(){$scope.patient_MUData.navigationEnabled=false;$scope.patient_MUData.searchedElementIndex=-1;$scope.patient_MUData.count=0;var keyword=$scope.patient_MUData.text;var options={"className":"matchHighlighted","separateWordSearch":false,"complete":function(){$scope.enableNavigation()}};$("#muSearchData").removeMark();$("#muSearchData").mark(keyword,options)};$scope.enableNavigation=function(){$scope.patient_MUData.navigationEnabled=true;if($("#muSearchData .matchHighlighted").length>0){$scope.patient_MUData.count=$("#muSearchData .matchHighlighted").length}};$scope.nextSearchedElement=function(){var currentIndex=$scope.patient_MUData.searchedElementIndex;if(!$scope.patient_MUData.navigationEnabled){return}else{var lengthOfElements=0;if($("#muSearchData .matchHighlighted").length>0){lengthOfElements=$("#muSearchData .matchHighlighted").length}if(currentIndex>=lengthOfElements-1){return}else if(currentIndex===-1){$scope.patient_MUData.searchedElementIndex=0;currentIndex=0}else{$scope.patient_MUData.searchedElementIndex=$scope.patient_MUData.searchedElementIndex+1;currentIndex=$scope.patient_MUData.searchedElementIndex}var container=$('#muSearchData');$("#muSearchData .matchHighlighted").each(function(index,element){if(currentIndex===index){let scrollTo=$(element);container.animate({scrollTop:scrollTo.offset().top-container.offset().top+container.scrollTop()});$(element).css("backgroundColor","orange")}else{$(element).css("backgroundColor","yellow")}})}};$scope.previousSearchedElement=function(){var currentIndex=$scope.patient_MUData.searchedElementIndex;if(!$scope.patient_MUData.navigationEnabled){return}else{if(currentIndex===0){return}else if(currentIndex===-1){$scope.patient_MUData.searchedElementIndex=0;currentIndex=0}else{$scope.patient_MUData.searchedElementIndex=$scope.patient_MUData.searchedElementIndex-1;currentIndex=$scope.patient_MUData.searchedElementIndex}var container=$('#muSearchData');$("#muSearchData .matchHighlighted").each(function(index,element){if(currentIndex===index){let scrollTo=$(element);container.animate({scrollTop:scrollTo.offset().top-container.offset().top+container.scrollTop()});$(element).css("backgroundColor","orange")}else{$(element).css("backgroundColor","yellow")}})}};$scope.printFromMUScreen=function(html){var windowContent="";windowContent+=$('#muSearchData').html();$('<iframe id="myFrameMU" name="myFrameMU">').appendTo('body');var doc=$("#myFrameMU")[0].contentWindow.document;doc.open();doc.write(windowContent);doc.close();onReadyState2PN()};$scope.showPtEducation=false;$scope.showPtEducation=getItemKeyValue("PtEducationLicense").toLowerCase()==="yes";$scope.patientEducationClicked=function(){var ptEducationArray=[];var ptEducationObj={};var promise=getAssessments($scope.encounterId);promise.then(function(response){var data=response.data;var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);try{if(typeof jsonobj!="undefined"&&getKeyLength(jsonobj.Envelope.Body['return'])>0){if(jsonobj.Envelope.Body['return'].assessment.hasOwnProperty("secondary")){if(jsonobj.Envelope.Body['return'].assessment.secondary.hasOwnProperty("code")){if(Array.isArray(jsonobj.Envelope.Body['return'].assessment.secondary.code)){ptEducationArray=jsonobj.Envelope.Body['return'].assessment.secondary.code}else{ptEducationArray.push(jsonobj.Envelope.Body['return'].assessment.secondary.code)}}}if(jsonobj.Envelope.Body['return'].assessment.hasOwnProperty("primary")){if(jsonobj.Envelope.Body['return'].assessment.primary.hasOwnProperty("code")){ptEducationArray.push(jsonobj.Envelope.Body['return'].assessment.primary.code)}}}$ocLazyLoad.load({name:'PtEducationModule',files:['/mobiledoc/jsp/webemr/pteducation/PtEducation.js']}).then(function(){var sICDName="";var sICDCode="";var bPostmessage=false;bPostmessage=getItemKeyValue("PtEdEnablePostmessage").toLowerCase();for(var i=0;i<ptEducationArray.length;i++){if(sICDName!="")sICDName=sICDName+","+ptEducationArray[i].id;else sICDName=ptEducationArray[i].id;if(sICDCode!="")sICDCode=sICDCode+","+ptEducationArray[i].medicalcode;else sICDCode=ptEducationArray[i].medicalcode}var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/pteducation/PtEducation.jsp'),controller:'PtEducationCtrl',windowClass:'app-modal-window2',backdrop:"static",resolve:{patientID:function(){return $scope.patientId},encounterID:function(){return $scope.encounterId},ICDName:function(){return sICDName},ICDCode:function(){return sICDCode},loginuserid:function(){return global.TrUserId},parentName:function(){return"ProgressNotesTreatment"}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){var sNotes="";var sPtEdNotes="";var sJsonTempObj;var ICD9List=[];var ICD10List=[];var sAsmtId="0";var index=-1;var sUrl="";var sReleaseDate="";var sLanguage="";var sContentId="";var sType="";var j;var strType="";if(bPostmessage=="yes"){if(modalInstanceResponse.length>0){for(var i=0;i<modalInstanceResponse.length;i++){var temp=modalInstanceResponse[i];sPtEdNotes=temp.Title;sNotes="";ICD9List=[];ICD10List=[];var trmtNotesObj={};trmtNotesObj=getTreatmentNotes(false,true,$scope.encounterId,0);sAsmtId="0";if(temp.hasOwnProperty('ICD9'))ICD9List=temp.ICD9;if(temp.hasOwnProperty('ICD10'))ICD10List=temp.ICD10;if(temp.hasOwnProperty('SearchCode')){var str=temp.SearchCode.Code;ICD9List.push(str);if(str.endsWith(".0")){ICD9List.push(str.substring(0,str.indexOf(".")))}}if(temp.hasOwnProperty('Url'))sUrl=temp.Url;if(temp.hasOwnProperty('ReleaseDate'))sReleaseDate=temp.ReleaseDate;if(temp.hasOwnProperty('Language'))sLanguage=temp.Language;if(temp.hasOwnProperty('contentId'))sContentId=temp.contentId;for(var j=0;j<ptEducationArray.length;j++){index=ICD9List.indexOf(String(ptEducationArray[j].medicalcode));if(index>-1){sAsmtId=ptEducationArray[j].id;trmtNotesObj=getTreatmentNotes(false,true,$scope.encounterId,sAsmtId);break}index=ICD10List.indexOf(String(ptEducationArray[j].medicalcode));if(index>-1){sAsmtId=ptEducationArray[j].id;trmtNotesObj=getTreatmentNotes(false,true,$scope.encounterId,sAsmtId);break}}if(typeof trmtNotesObj!='undefined'){sNotes=trmtNotesObj.notesHTML}if(temp.hasOwnProperty('type')&&temp.type=="send"){strType=' material was published';sType='send'}else{strType=' material was printed';sType='print'}if(sNotes==""||sNotes==undefined){sNotes=sPtEdNotes+strType}else{sNotes=sNotes+", "+sPtEdNotes+strType}sJsonTempObj={nEncounterId:$scope.encounterId,nTrUserId:$scope.userId,DxItemId:sAsmtId,strNotes:sNotes,strTitle:sPtEdNotes,strUrl:sUrl,strReleaseDate:sReleaseDate,strLanguage:sLanguage,strContentId:sContentId,strType:sType,bNotesType:false};logPtEdVersion(sJsonTempObj);saveNotesForAssessment(sJsonTempObj)}}}else{var trmtNotesObj=getTreatmentNotes(false,true,$scope.encounterId,0);if(sNotes==""||sNotes==undefined)sNotes="Patient Education was given.";else sNotes=sNotes+", "+"Patient Education was given.";if(typeof trmtNotesObj!='undefined'){sNotes=trmtNotesObj.notesHTML}if(sNotes!="")sNotes=sNotes+", "+"Patient Education was given.";else sNotes="Patient Education was given.";var sJsonTempObj={nEncounterId:$scope.encounterId,nTrUserId:$scope.nTrUserId,DxItemId:0,strNotes:sNotes,bNotesType:false};saveNotesForAssessment(sJsonTempObj)}})})}catch(e){alert("Error in launching Patient Education")}},function(errorResponse){throw"Internal Error occurred, Please try after some time"})};function getAssessments(encounterID){var url='/mobiledoc/jsp/catalog/xml/getAssessment.jsp?Id='+encounterID;var aPromise=$http.get(url);return aPromise}function URLDecode(psEncodeString){var lsRegExp=/\+/g;return unescape(String(psEncodeString).replace(lsRegExp," "))}function saveNotesForAssessment(jsonObjForNotes){var nEncounterId=jsonObjForNotes.nEncounterId;var nTrUserId=jsonObjForNotes.nTrUserId;var DxItemId=jsonObjForNotes.DxItemId;var strNotes=jsonObjForNotes.strNotes;var bNotesType=jsonObjForNotes.bNotesType;if(nEncounterId>0&&nTrUserId>0){strNotes=URLDecode(strNotes);var plainText=decodeHtml(strNotes.replace(new RegExp('<br>','g'),'\n').replace(new RegExp('&nbsp;','g'),' '));var strXMLContent="";var strXMLStart="<S:Envelope xmlns:S='http://schemas.xmlsoap.org/soap/envelope/' xmlns:SOAP-ENC='http://schemas.xmlsoap.org/soap/encoding/' "+"S:encodingStyle='http://schemas.xmlsoap.org/soap/encoding/' xmlns:xsd='http://www.w3.org/1999/XMLSchema' "+"xmlns:xsi='http://www.w3.org/1999/XMLSchema-instance'><S:Body><m:NOOP xmlns:m='NOOP'><return xsi:type='xsd:string'>";var strXMLEnd="</return></m:NOOP></S:Body></S:Envelope>";strXMLContent="<notes xsi:type='xsd:string'>"+escapeXml(plainText)+"</notes>"+"<notesHTML xsi:type='xsd:string'>"+escapeXml(strNotes)+"</notesHTML>";xmlData=strXMLStart+strXMLContent+strXMLEnd;var params=$.param({FormData:xmlData});$.ajax({url:"/mobiledoc/jsp/catalog/xml/setTreatmentNotes.jsp?EncounterId="+nEncounterId+"&TrUserId="+nTrUserId+"&AsmtId="+DxItemId+"&ptDiscussionTab="+bNotesType,type:"POST",data:params,cache:false,dataType:"text","async":false,success:function(text){}})}}function logPtEdVersion(jsonObj){var nEncounterId=jsonObj.nEncounterId;var nTrUserId=jsonObj.nTrUserId;var DxItemId=jsonObj.DxItemId;var strTitle=jsonObj.strTitle;var strUrl=jsonObj.strUrl;var strReleaseDate=jsonObj.strReleaseDate;var strLanguage=jsonObj.strLanguage;var strContentId=jsonObj.strContentId;var strType=jsonObj.strType;var strPteEdVersionLog=getItemKeyValue("PtEdVersionLogEnabled").toLowerCase();if(strPteEdVersionLog=="yes"){if(nEncounterId>0&&nTrUserId>0){$.ajax({url:"/mobiledoc/jsp/webemr/pteducation/logPtEdVersion.jsp",data:"EncounterId="+nEncounterId+"&TrUserId="+nTrUserId+"&AsmtId="+DxItemId+"&Title="+strTitle+"&Url="+strUrl+"&ReleaseDate="+strReleaseDate+"&Language="+strLanguage+"&ContentId="+strContentId+"&Type="+strType,type:"POST",cache:false,dataType:"text","async":false,success:function(text){}})}}}var timeOutPN=0;var onReadyState2PN=function(){try{$timeout(function(){if($('#myFrameMU').contents().find("body").html()){timeOutPN=0;window.frames["myFrameMU"].focus();window.frames["myFrameMU"].print()}else{timeOutPN++;if(timeOutPN>150){timeOutPN=0;alert("Could Not Load the Requested page,try again!");return false}onReadyState2PN()}},200)}catch(e){}};function buildParams(sectionName,categoryId){let sectionParams1="";let firstPreOpCatObj="";let defaultExamId="";switch(sectionName){case'Anesthesia Details':let anedetail_localstorage=getOROpCategory("asc_anest_preopdetails");firstPreOpCatObj=getFirstTreeItem(anedetail_localstorage);defaultExamId=getItemKeyValue("DefaultAnesPreOpDetId",true);sectionParams1="/"+$scope.encounterId;if(firstPreOpCatObj!==undefined){if(firstPreOpCatObj.id){sectionParams1+="?defaultCatId="+firstPreOpCatObj.id+"&defaultCatName="+firstPreOpCatObj.label+"&defaultExamId="+defaultExamId}let parentIdValue=firstPreOpCatObj.parentId;sectionParams1+="&parentId="+parentIdValue}if(categoryId){sectionParams1+="&categoryId="+categoryId}break;case'Preoperative Details':let preOp_localstorage=getOROpCategory("asc_orpreop");firstPreOpCatObj=getFirstTreeItem(preOp_localstorage);defaultExamId=getItemKeyValue("DefaultPreopId",true);sectionParams1="/"+$scope.encounterId;if(firstPreOpCatObj!==undefined){if(firstPreOpCatObj.id){sectionParams1+="?defaultCatId="+firstPreOpCatObj.id+"&defaultCatName="+firstPreOpCatObj.label+"&defaultExamId="+defaultExamId}let parentIdValue=firstPreOpCatObj.parentId;sectionParams1+="&parentId="+parentIdValue}if(categoryId){sectionParams1+="&categoryId="+categoryId}break}return sectionParams1}$scope.openASCProgressNote=function(nmasterEncounterId){var url="";if(nmasterEncounterId>0){var isCallFromPATAppt=1;url='#r=PnPanel.go/getPtDashboardView/'+nmasterEncounterId+'/'+$scope.patientId+'/'+$scope.userId+'/'+"1001"+'/'+isCallFromPATAppt;location.href=url}else{showMessage("No surgery linked with this PAT appointment.")}};$scope.isPDMPShowLoadingButton=false;$scope.showPdmpNarxScore=function(showNarxScoreRefreshIcon){var requestParam={patientId:$scope.patientId,userId:$scope.userId,encounterId:$scope.encounterId,showNarxScoreRefreshIcon:showNarxScoreRefreshIcon};$ocLazyLoad.load({name:"pdmpNarxLogs",files:['/mobiledoc/jsp/pdmp/js/PDMPNarxLogController.js','/mobiledoc/jsp/pdmp/js/PDMPNarxLogService.js','/mobiledoc/jsp/webemr/templates/pagination-tpl.js','/mobiledoc/jsp/pdmp/css/PDMPNarxLog.css'],cache:true}).then(function(){var modalInstance=$modal.open({templateUrl:'/mobiledoc/jsp/pdmp/pdmp-narx-log.jsp',windowClass:'app-modal-window bluetheme narxopoup-w720',backdrop:"static",keyboard:false,controller:'PDMPNarxLogController',size:'sm',resolve:{requestParam:function(){return requestParam}}});modalInstance.result.then(function(e){},function(e){if(e){$scope.setNarxScore(e)}})},function(e){})};$scope.refreshPdmpNarxScore=function(){var url='/mobiledoc/jsp/pdmp/PdmpLogServiceController.jsp';url=makeURL(url);var reqParam={action:"getLatestNarxScore",patinetId:$scope.patientId,encounterId:$scope.encounterId};var errorMessage="Error occurred getting Narx Score data from APPRISS.";$scope.isPDMPShowLoadingButton=true;$http({method:'POST',url:url,params:reqParam}).success(function(response){if(response){var objJson=response;if(objJson){$scope.setNarxScore(objJson.pdmpReportLogLatestRecord)}if(objJson&&objJson.status==="success"){$scope.isPDMPShowLoadingButton=false;return}ecwAlert(errorMessage,'Narx Score Error',null,'Close',null,null,false);$scope.isPDMPShowLoadingButton=false}}).error(function(message){ecwAlert(errorMessage,'Narx Score Error',null,'Close',null,null,false);$scope.isPDMPShowLoadingButton=false})};$scope.setNarxScore=function(objJson){if(objJson){$("#divIdForCallFailAlert").hide();$("#divIdForCallFailAlertNoVal").hide();if(objJson.status==="failed"){if($("#divIdForCallFailAlert").length){$("#divIdForCallFailAlert").show();$("#divIdForCallFailAlertNoVal").hide()}else{$("#divIdForCallFailAlert").hide();$("#divIdForCallFailAlertNoVal").show();$("#divIdForCallFailAlertNoVal").removeClass("hide")}}if(objJson.creationDateFormatted&&objJson.creationDateFormatted!==""){$("#divIdLastFetchTime").html(objJson.creationDateFormatted);$("#divIdLastFetchTime").removeClass("addvalue");$("#divIdLastFetchTimeNoVal").hide()}else{$("#divIdLastFetchTime").html("");$("#divIdLastFetchTime").append("&nbsp;");$("#divIdLastFetchTime").addClass("addvalue pull-left");$("#divIdLastFetchTimeNoVal").hide()}if(objJson.narcotic&&objJson.narcotic!==""){$("#divIdNarcotic").html(objJson.narcotic);$("#divIdNarcotic").removeClass("addvalue");$("#divIdNarcoticNoVal").hide()}else{$("#divIdNarcotic").html("");$("#divIdNarcotic").append("&nbsp;");$("#divIdNarcotic").addClass("addvalue pull-left");$("#divIdNarcoticNoVal").hide()}if(objJson.sedative&&objJson.sedative!==""){$("#divIdSedative").html(objJson.sedative);$("#divIdSedative").removeClass("addvalue");$("#divIdSedativeNoVal").hide()}else{$("#divIdSedative").html("");$("#divIdSedative").append("&nbsp;");$("#divIdSedative").addClass("addvalue pull-left");$("#divIdSedativeNoVal").hide()}if(objJson.stimulant&&objJson.stimulant!==""){$("#divIdStimulant").html(objJson.stimulant);$("#divIdStimulant").removeClass("addvalue");$("#divIdStimulantNoVal").hide()}else{$("#divIdStimulant").html("");$("#divIdStimulant").append("&nbsp;");$("#divIdStimulant").addClass("addvalue pull-left");$("#divIdStimulantNoVal").hide()}}};$scope.checkVerifyHistories=function(xmlData){$scope.enableVerifyHistories=false;if(getItemKeyValue('verifyHistory')&&getItemKeyValue('verifyHistory').toLowerCase()==='yes'){var x2js=new X2JS;var jsonData=[];$scope.verifyHxArr=[];$scope.verifyHxObj={};jsonData=x2js.xml_str2json(xmlData);try{$scope.webemrItemsArr=returnDataArray(jsonData.Envelope.Body["return"].subItems);for(var ii=0;ii<$scope.webemrItemsArr.length;ii++){var subItems=$scope.webemrItemsArr[ii].subItemsName;var subVar=$scope.webemrItemsArr[ii];if(subItems=="Subjective:"||subItems=="Data:"){for(var jj=0;jj<subVar.item.length;jj++){if(subVar.item[jj].itemName=="Social History:"&&jsonData.Envelope.Body["return"].socialVerifiedFlag!="Y"){if(subVar.item[jj].category&&subVar.item[jj].category!=""){$scope.verifyHxObj["SocialHistory"]=1;$scope.verifyHxArr.push("Social History")}else{$scope.verifyHxObj["SocialHistory"]=0}}else if(subVar.item[jj].itemName=="Family History:"&&jsonData.Envelope.Body["return"].familyVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""||subVar.item[jj].familyNotes&&subVar.item[jj].familyNotes!=""){$scope.verifyHxObj["FamilyHistory"]=1;$scope.verifyHxArr.push("Family History")}else{$scope.verifyHxObj["FamilyHistory"]=0}}else if(subVar.item[jj].itemName=="Hospitalization:"&&jsonData.Envelope.Body["return"].hospVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""){$scope.verifyHxObj["Hospitalization"]=1;$scope.verifyHxArr.push("Hospitalization")}else{$scope.verifyHxObj["Hospitalization"]=0}}else if(subVar.item[jj].itemName=="Surgical History:"&&jsonData.Envelope.Body["return"].surgicalVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""){$scope.verifyHxObj["SurgicalHistory"]=1;$scope.verifyHxArr.push("Surgical History")}else{$scope.verifyHxObj["SurgicalHistory"]=0}}else if(subVar.item[jj].itemName=="Medical History:"&&jsonData.Envelope.Body["return"].medicalVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""){$scope.verifyHxObj["MedicalHistory"]=1;$scope.verifyHxArr.push("Medical History")}else{$scope.verifyHxObj["MedicalHistory"]=0}}else if(subVar.item[jj].itemName=="Occular History:"&&jsonData.Envelope.Body["return"].medicalVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""){$scope.verifyHxObj["OccularHistory"]=1;$scope.verifyHxArr.push("Occular History")}else{$scope.verifyHxObj["OccularHistory"]=0}}else if(subVar.item[jj].itemName=="Current Medication:"&&jsonData.Envelope.Body["return"].medicationVerifiedFlag!="Y"){if(subVar.item[jj].category&&subVar.item[jj].category!=""){if(subVar.item[jj].category.categoryName!=''&&(subVar.item[jj].category.categoryValue&&subVar.item[jj].category.categoryValue.length>0||subVar.item[jj].category.categoryNotesBR)){$scope.verifyHxObj["CurrentMedication"]=1;$scope.verifyHxArr.push("Current Medication")}else if(subVar.item[jj].category.length>0){for(var cm=0;cm<subVar.item[jj].category.length;cm++){if(subVar.item[jj].category[cm].categoryName!=''&&subVar.item[jj].category[cm].categoryNotesBR){$scope.verifyHxObj["CurrentMedication"]=1;$scope.verifyHxArr.push("Current Medication");break}}}else $scope.verifyHxObj["CurrentMedication"]=0}else{$scope.verifyHxObj["CurrentMedication"]=0}}else if(subVar.item[jj].itemName=="Allergies/Intolerance:"&&jsonData.Envelope.Body["return"].allergyVerifiedFlag!="Y"){if(subVar.item[jj].itemValue&&subVar.item[jj].itemValue!=""){$scope.verifyHxObj["Allergies_Intolerance"]=1;$scope.verifyHxArr.push("Allergies/Intolerance")}else{$scope.verifyHxObj["Allergies_Intolerance"]=0}}}}}}catch(err){}if($scope.verifyHxArr.length>0){$scope.enableVerifyHistories=true}else{setTitleForVerifyHx()}}};$scope.verifyHistories=function(){if($scope.verifyHxArr.length>0){commonWarningPopup({screenName:'Verify Histories',screenTitle:'Confirmation',buttons:[{label:'Verify',cssClass:'btn-blue',callbackEvent:function(){var url="/mobiledoc/jsp/webemr/progressnotes/verifyHistoriesController.jsp?xmlData="+JSON.stringify($scope.verifyHxObj)+"&encounterId="+encounterId;url=makeURL(url);$.ajax({method:'POST',url:url,"async":false,data:''}).success(function(response){if(response){var objJson=JSON.parse(response);if(objJson&&objJson.status=="success"){notification.show('success','','Verify Histories - '+$scope.verifyHxArr.join(', ')+" has been verified successfully.",5e3);refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}else{notification.show('error','',"An error occurred while verifying "+$scope.verifyHxArr.join(', ')+".",5e3)}}}).error(function(message){notification.show('error','',"An error occurred while verifying "+$scope.verifyHxArr.join(', ')+".",5e3)})}},{label:'Cancel',cssClass:'btn-lgrey',callbackEvent:function(){}}],message:"This action will verify the "+$scope.verifyHxArr.join(', ')+".</br></br> Are you sure you want to <B>verify the history</B> for all listed sections?",isConfirmPopup:true,screenSpecificClass:'commonWarningPopupClass'},$ocLazyLoad,$modal)}};$scope.getInlineModuleScope=function(modulename){var scope={};if(modulename=='examination'||modulename=='Examination:'){scope=angular.element(document.getElementById('inlineexamination')).scope()}else if(modulename=='assessment'){scope=angular.element(document.getElementById('inlineassessment')).scope()}else if(modulename=='hpi'||modulename=='HPI:'){scope=angular.element(document.getElementById('inlinehpi')).scope()}else if(modulename=='treatment'){scope=angular.element(document.getElementById('inlinetreatment')).scope()}else if(modulename=='followup'){scope=angular.element(document.getElementById('inlinefollowup')).scope()}else if(modulename=='cpt'){scope=angular.element(document.getElementById('inlineCPT')).scope()}else if(modulename=='Vision Examination:'){scope=angular.element(document.getElementById('inlineVisionExaminationMain')).scope()}if(scope!=undefined||scope!=null){return scope}else{console.log('no inline module added')}};$scope.scrollToMinimalTop=function(placeholder,isFromCpt){var container=$('#progress_content');var newCatSection=$(placeholder);var nSpaceUp=50;if(isFromCpt){nSpaceUp=0}container.animate({scrollTop:newCatSection.offset().top-nSpaceUp-container.offset().top+container.scrollTop()})};$scope.isSectionLoaded=false;$scope.loadSource=function(type,catId,concurLockKey){var placeHolder="";var parentId=0;var url="";var firstCatItem="";var scope=$scope.getInlineModuleScope(type);var strHtml="";if(type=='Examination:'){var examination_localstorage=getExamCategoryFlatList();if(!$scope.isSectionLoaded){$scope.isSectionLoaded=true;$ocLazyLoad.load({name:'examination',serie:true,files:['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js']}).then(function(){url="/mobiledoc/jsp/webemr/progressnotes/templates/inlineexam.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;if(catId){url=url+"&categoryId="+catId;placeHolder="#editCategoryTpl"+catId}else{var defualtCatId=getUserProfile("defaultexamcategory");if(defualtCatId&&defualtCatId!=="0"){firstCatItem=findExamCategoryById(defualtCatId)}if(!firstCatItem){var defaultExamId=getItemKeyValue("DefaultExamId",true);firstCatItem=findExamCategoryById(defaultExamId)}if(!firstCatItem){firstCatItem=getFirstTreeItem(examination_localstorage)}url=url+"&defaultCatId="+firstCatItem.id+"&defaultCatName="+firstCatItem.label;catId=0;placeHolder="#newExamCategoryURL"}parentId=examination_localstorage[0].parentId;url=url+"&parentId="+parentId;if(virtualVisit){url=url+"&virtualVisit="+virtualVisit}addDynamicContent(placeHolder,url,type,catId)})}}else if(type=='Assessment:'){if($('#ICD10Modal').length===0){$ocLazyLoad.load({name:'assessment',files:['/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/progressnotes/assessment/assessmentcontroller.js']}).then(function(){placeHolder="#inlineAsmtURL";url="/mobiledoc/jsp/webemr/progressnotes/templates/inlineassessment.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&dc="+moment().toString();addDynamicContent(placeHolder,url,type,catId)})}else{alert("Close Sunoh summary window to access Assessment in-line edit feature.")}}else if(type=='HPI:'){var hpi_localstorage=getHPICategoryFlatList();if(!$scope.isSectionLoaded){$scope.isSectionLoaded=true;$ocLazyLoad.load({name:'hpi',serie:true,files:['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js']}).then(function(){url="/mobiledoc/jsp/webemr/progressnotes/templates/inlinehpi.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;if(catId){url+="&categoryId="+catId;placeHolder="#editCategoryTpl"+catId}else{var defualtCatId=getUserProfile("defaulthpicategory");if(defualtCatId&&defualtCatId!=="0"){firstCatItem=findHPICategoryById(defualtCatId)}if(!firstCatItem){firstCatItem=getFirstTreeItem(hpi_localstorage)}if(firstCatItem.id){url=url+"&defaultSelectedCategoryId="+firstCatItem.id;url=url+"&defaultSelectedCategoryLbl="+encodeURIComponent(firstCatItem.label)}catId=0;placeHolder="#newHPICategoryURL"}url+="&parentId="+hpi_localstorage[0].parentId;addDynamicContent(placeHolder,url,type,catId)},function(e){console.log(e)})}}else if(type=='Treatment:'){let concurrencyKey="";if(concurLockKey){concurrencyKey=concurLockKey}PNService.setParametersForScreen("treatment",{encounterId:$scope.encounterId,patientId:$scope.patientId,userId:global.TrUserId,normalView:1,CorrectionalEnabled:false,concurlockkey:concurrencyKey,inlineEdit:true});$ocLazyLoad.load({name:"TreatmentApp",files:['/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.css','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.js','/mobiledoc/jsp/webemr/progressnotes/treatment/js/treatment.js','/mobiledoc/jsp/webemr/progressnotes/treatment/css/treatment.css','/mobiledoc/jsp/pama/js/aucDirective.js'].concat(getDependencies('pama'))}).then(function(){placeHolder="#newTreatmentURL";url="/mobiledoc/jsp/webemr/progressnotes/templates/inlinetreatment.jsp?nts";addDynamicContent(placeHolder,url,type,catId)})}else if(type=='Next Appointment:'){strHtml=$("#newNextApptURL").html();if(strHtml===""){$ocLazyLoad.load({name:'billing',files:['/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js']}).then(function(){placeHolder="#newNextApptURL";url="/mobiledoc/jsp/webemr/progressnotes/templates/followup.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&dc="+moment().toString();addDynamicContent(placeHolder,url,type,type)})}}else if(type=='Procedure Codes:'){strHtml=$("#newCPTURL").html();if(strHtml===""){$ocLazyLoad.load({name:'inlineCPT',files:['/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js']}).then(function(){url="/mobiledoc/jsp/webemr/progressnotes/templates/inlineCPT.jsp?context=cptcodes&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&dc="+moment().toString();placeHolder="#newCPTURL";addDynamicContent(placeHolder,url,type,type)})}}else if(type=='Visit Code:'){strHtml=$("#newVisitCodeURL").html();if(strHtml===""){$ocLazyLoad.load({name:'inlineCPT',files:['/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js']}).then(function(){url="/mobiledoc/jsp/webemr/progressnotes/templates/inlineCPT.jsp?context=visitcodes&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&dc="+moment().toString();placeHolder="#newVisitCodeURL";addDynamicContent(placeHolder,url,type,type)})}}else if(type==='Vision Examination:'){strHtml=$("#visionExaminationURL").html();$ocLazyLoad.load({name:'visionExaminationApp',files:['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/js/visionExamMainService.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexamination/js/inlineVisionExaminationService.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexamination/js/inlineVisionExaminationController.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/inking/js/visionInkingUtilityService.js','/mobiledoc/jsp/webemr/progressnotes/usvision/visionexam/drawing/js/drawing-imageService.js']}).then(function(){url="/mobiledoc/jsp/webemr/progressnotes/usvision/visionexamination/inlineVisionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&dc="+moment().toString();placeHolder="#visionExaminationURL";if(catId){url=url+"&catId="+catId;placeHolder="#editCategoryTpl"+catId}addDynamicContent(placeHolder,url,type,type)})}else if(type==='RPM Notes:'){$scope.getRpmPNNotes(true)}};$scope.openRPMPnAdditionalNotesModal=function(){let rpmAdditionalNotesData={patientId:$scope.patientId,encounterId:$scope.encounterId,userId:global.TrUserId,notes:$scope.rpm.rpmData.additionalNotes,callbackFunction:refreshPNDashBoard};$ocLazyLoad.load({name:'monitoringStatusModalController',files:['/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/controller/rpmPNNotesCtrl.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/service/enrollmentService.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-global-style.css','/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/perfect-scrollbar.css','/mobiledoc/jsp/webemr/ccmr/rpm/js/vendorjs/perfect-scrollbar.min.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/directive/common-directive.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-main.css','/mobiledoc/jsp/webemr/ccmr/rpm/js/service/rpmUserServices.js','/mobiledoc/jsp/webemr/js/globalframeworkService.js']}).then(function(){var url='/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/views/rpmPNNotes.html?';var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'rpmPNNotesController',controllerAs:'rpmPNNotesCtrl',keyboard:false,backdrop:'static',windowClass:'custom-modal',size:'lg',animation:true,resolve:{rpmNotesData:function(){return rpmAdditionalNotesData}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url)})})};var addDynamicContent=function(placeHolder,url,type,catId){var inlineEditResponse=urlGet(makeURL(url));$(placeHolder).html(inlineEditResponse);$compile($(placeHolder))($scope);sectionName=type.substr(0,type.length-1);$scope.unsavedSection[sectionName.toLowerCase()].push(catId);$scope.scrollToMinimalTop(placeHolder)};var togglePreviousEditScreen=function(){$("div[id^='editCategoryTpl']").html('');$("div[id^='readOnlyCategory_']").show()};$scope.unsavedSection={'examination':[],'assessment':[],'hpi':[],'treatment':[],'next appointment':[],'procedure codes':[],'visit code':[],'vision examination':[]};var sections=['examination','assessment','hpi','treatment','next appointment','procedure codes','visit code','vision examination'];var isAnyUnsavedSection=function(){var sectionName='';var length=Object.keys($scope.unsavedSection).length;for(var i=0;i<length;i++){if($scope.unsavedSection[sections[i]]&&$scope.unsavedSection[sections[i]].length>0){sectionName=sections[i]}}return sectionName};$scope.saveInplaceEditData=function(){if(currentInlineEditSection!==""){currentInlineEditSection="";$scope.$broadcast('saveInlineCategory')}};$scope.$on('pnInlineEditSave',function(e,args){$scope.saveInplaceEditData()});$scope.isPlaceEditDataValid=true;$scope.$on("inlineEditSaveReturn",function(e,args){var isInlineSaveReturnEmitCalled=true;$scope.isPlaceEditDataValid=false;$scope.$on("$locationChangeStart",function(event,next,current){if(args&&currentInlineEditSection!==""&&isInlineSaveReturnEmitCalled){event.preventDefault()}isInlineSaveReturnEmitCalled=false})});var saveUnsavedCategory=function(catId,mainHeading,$event){var prevCatId=$scope.unsavedSection[mainHeading.toLowerCase()]?$scope.unsavedSection[mainHeading.toLowerCase()][0]:0;var argumentVar={catId:catId,section:mainHeading,event:$event,prevCatId:prevCatId};saveUnsavedAndLoad(argumentVar,addUpdateCategoryCallback)};var addUpdateCategoryCallback=function(args,isAlreadySaved){if(isAlreadySaved){if(args.catId==0){$scope.loadSource(args.section,args.catId)}else{editCurrentCategory(args.catId,args.section,args.event)}}else{callEditCategory(args)}};var callEditCategory=function(args){var eventSource="";if(args.catId==0){eventSource="button[id='"+args.section+"']"}else{eventSource='#readOnlyCategory_'+args.catId+' button.btnedit'}$timeout(function(){angular.element(eventSource).triggerHandler('click')})};var currentInlineEditSection="";$scope.loadNewCategory=function(mainHeading,isHotKeyCall){currentInlineEditSection=mainHeading;var args={mainHeading:mainHeading,isHotKeyCall:isHotKeyCall};saveUnsavedAndLoad(args,loadNewCatCallback)};$scope.removeAllRPMDataAndNotes=function(){$scope.openRemoveRPMDataAndNotesModal('','Remove All')};$scope.removeRPMDataForSelectedTracker=function(trackerType){$scope.openRemoveRPMDataAndNotesModal(trackerType,'Remove Selected Tracker')};$scope.openRemoveRPMDataAndNotesModal=function(trackerType,operation){let rpmPnRemoveData={patientId:$scope.patientId,encounterId:$scope.encounterId,userId:global.TrUserId,trackerType:trackerType,operation:operation,callbackFunction:refreshPNDashBoard};$ocLazyLoad.load({name:'rpmPNRemoveRpmDataController',files:['/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/controller/rpmPNRemoveRpmData.js','/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/js/service/enrollmentService.js','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-global-style.css','/mobiledoc/jsp/webemr/ccmr/rpm/css/rpm-main.css']}).then(function(){var url='/mobiledoc/jsp/webemr/ccmr/rpm/enrollment/views/rpmPNRemoveDataAndNotesModal.html?';var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'rpmPNRemoveRpmDataController',controllerAs:'rpmRemovePnDataCtrl',keyboard:false,backdrop:'static',windowClass:'custom-modal',size:'lg',animation:true,resolve:{rpmPnData:function(){return rpmPnRemoveData}}});modalInstance.result.then(function(responseObj){$templateCache.remove(url)},function(responseObj){$templateCache.remove(url)})})};var loadNewCatCallback=function(args){if(isInplaceEditEnabled&&isInplaceEditEnabled.toLowerCase()==='yes'){validatePNPermission(loadNewCatAfterValidate,args,false)}};var loadNewCatAfterValidate=function(mainHeading,isHotKeyCall){saveUnsavedCategory(0,mainHeading)};var validatePNPermission=function(callback,args,isEdit){EncDetailsService.getEncDetailsByEncId($scope.encounterId);var isPermitted=checkPermissionForPNLinks(args.mainHeading,args.catId);if(isPermitted){if(!($scope.TemplatePatientId==$scope.patientId)){var dt=EncDetailsService.getEncDetails().encDate;var providerid=EncDetailsService.getEncDetails().providerId;if(isLicenseValid(providerid,dt)==false){ecwAlert('License has expired');return}else{if(isEdit){callback(args.catId,args.mainHeading,args.event)}else{callback(args.mainHeading,args.isHotKeyCall)}}}else{if(templateEditAccess=='false'){ecwAlert("You do not have permission to modify this template.Contact Admin.","Template Permission");return}else{if(isEdit){callback(args.catId,args.mainHeading,args.event)}else{callback(args.mainHeading,args.isHotKeyCall)}}}}else{alert("Permission denied")}};var editCurrentCategory=function(catId,mainHeading,$event){togglePreviousEditScreen();var scope=$scope.getInlineModuleScope(mainHeading);if(typeof scope=='undefined'){$scope.loadSource(mainHeading,catId);if($event){$event.stopPropagation();$event.preventDefault()}}$timeout(function(){$('#readOnlyCategory_'+catId).hide()},0)};$scope.editCategory=function(catId,mainHeading,$event){currentInlineEditSection=mainHeading;if(event){event.stopPropagation()}var args={catId:catId,mainHeading:mainHeading,event:$event};validatePNPermission(editCategoryAfterValidate,args,true)};$scope.openRxEdit=function(itemId,oldRxId,rxOrderNo,ndcCode){$scope.rxObj={"RxItemId":itemId,"RxId":oldRxId,RxOrderNo:rxOrderNo,NDCCode:ndcCode};$ocLazyLoad.load({name:'RxEditModule',files:['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/js/RxEditController.js','/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.min.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/rx-editmodal.html'),controller:'RxEditCtrl',windowClass:'rxeditscreen bluetheme rx-topmargin',backdrop:"static",keyboard:false,resolve:{patientID:function(){return $scope.patientId},encounterID:function(){return $scope.encounterId},RxEditObject:function(){return $scope.rxObj},loginuserid:function(){return global.TrUserId},parentName:function(){return"ProgressNote"}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(modalInstanceResponse==='success'){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}else if(modalInstanceResponse&&modalInstanceResponse.isCancelledRx===true){let rxFullName=modalInstanceResponse.RxName;if(modalInstanceResponse.strengthValue){rxFullName=rxFullName+" "+modalInstanceResponse.strengthValue}if(modalInstanceResponse.formulationValue){rxFullName=rxFullName+" "+modalInstanceResponse.formulationValue}$scope.loadCancelRx(modalInstanceResponse.rxOrderNo,modalInstanceResponse.RxName,rxFullName);refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")}})})};$scope.eRxLogsURLPnPanel='';$scope.openCancelRx=function(rxOrderNo,drugName){$scope.eRxLogsURLPnPanel="";$ocLazyLoad.load({name:'myApp.Ejellybean.controllers',files:['/mobiledoc/jsp/webemr/jellybean/refillrequest/js/ejelly.js','/mobiledoc/jsp/webemr/jellybean/refillrequest/js/RxFillIndicator.js','/mobiledoc/jsp/webemr/jellybean/refillrequest/js/eRxMessageViewer.js','/mobiledoc/jsp/webemr/jellybean/refillrequest/js/commonRxRequest.js'],cache:false}).then(function(){let url='/mobiledoc/jsp/webemr/jellybean/ePrescription/ePrescriptionPtHub.jsp?pthub=yes&ptid='+$scope.patientId+'&rxOrderNo='+rxOrderNo+"&calledFrom=CancelRx&drugName="+drugName;url=makeURL(url);$scope.eRxLogsURLPnPanel=url},function(e){ecwAlert(e.message)})};let isCorrectionalFeaturesOn=getItemKeyValue("EnableCorrectionalFeatures").toLowerCase()=="yes";$scope.loadCancelRx=function(rxOrderNo,drugName,rxFullName){if(isCorrectionalFeaturesOn===true||getItemKeyValue("EnableCancelRxForStoppedRx").toLowerCase()==='yes'){if(getItemKeyValue("EnableCancelRx").toLowerCase()==='yes'||getItemKeyValue("EnablePICancelRx").toLowerCase()==='yes'){if(getUserProfile("cancelRxAlert")==='1'){var cancelRxMsg="To send a cancellation request to the pharmacy, please click CANCEL for this medication and the appropriate pharmacy in the ePrescription Logs.";cancelRxMsg+="\n\n Would you like to open the ePrescription Logs?";BootstrapDialog.show({title:"Cancel Rx Alert",message:cancelRxMsg,closable:true,draggable:false,closeByBackdrop:false,closeByKeyboard:false,buttons:[{label:'Yes',action:function(dialog){dialog.close();$scope.openCancelRx(rxOrderNo,drugName)}},{label:'No',action:function(dialog){dialog.close()}}]})}else{notification.show('success','Treatment Screen',''+escapeHtml(rxFullName)+' Stopped. To send a cancellation to the pharmacy go to Patient Hub > ePrescription Logs.',4e3)}}}};var editCategoryAfterValidate=function(catId,mainHeading,$event){saveUnsavedCategory(catId,mainHeading,$event)};$scope.hideInlineEdit=function(catId,mainHeading,isCancel,nextCatId,event,nextSection,concurLockKey){currentInlineEditSection="";var section=mainHeading.substr(0,mainHeading.length-1);$scope.unsavedSection[section.toLowerCase()]=[];if(mainHeading=='HPI:'){$("#newHPICategoryURL").html('');$scope.isSectionLoaded=false}else if(mainHeading=='Examination:'){$("#newExamCategoryURL").html('');$scope.isSectionLoaded=false}else if(mainHeading=='Treatment:'){$("#newTreatmentURL").html('')}else if(mainHeading=='Procedure Codes:'){$("#newCPTURL").html('')}else if(mainHeading=='Assessment:'){$("#inlineAsmtURL").html('')}else if(mainHeading=='Next Appointment:'){$("#newNextApptURL").html('');$("#readOnlyNextAppt").show()}else if(mainHeading=='Visit Code:'){$("#newVisitCodeURL").html('')}else if(mainHeading=='Vision Examination:'){$("#visionExaminationURL").html('')}$('#readOnlyCategory_'+catId).show();$('#editCategoryTpl'+catId).html('');if(!isCancel){saveUnsavedCategory(nextCatId,mainHeading,event)}if(nextSection){var isPermitted=checkPermissionForPNLinks(nextSection);if(isPermitted){$scope.loadSource(nextSection,0,concurLockKey)}else{ecwAlert("Permission Denied")}}};$scope.clickThroughForASC=function(encounterId,catID,itemID,itemName){var PATprogressNotes={};PATprogressNotes.encounterID=encounterId;PATprogressNotes.categoryID=catID;PATprogressNotes.itemID=itemID;var masterSectionName='';if(itemName&&itemName==='Anesthesia Details:')masterSectionName="Anesthesia_PreOpDetails";else if(itemName&&itemName==='Preoperative Details:')masterSectionName="Preoperative_Details";PATprogressNotes.moduleName=masterSectionName;PATprogressNotes.patientId=$scope.patientId;$ocLazyLoad.load({name:'clickThroughASC',files:['/mobiledoc/jsp/ascWeb/Views/progressnotes/clickThrough/clickThrough.js','/mobiledoc/jsp/ascWeb/templates/struct-keyword-tpl.js','/mobiledoc/jsp/resources/jslib/ckeditor4/ckeditor.js']}).then(function(){$modal.open({templateUrl:'/mobiledoc/ascWeb/pnPanel.go/clickThrough/loadClickThrough',windowClass:'project-10i app-modal-window clickThroughASC',backdrop:"static",keyboard:false,controller:'clickThroughControllerASC',size:'sm',resolve:{model:function(){return{progressNotes:PATprogressNotes}}}}).result.then(function(){refreshDashboard(encounterId,$scope.patientId,"progressNote","")})},function(e){console.debug(e)})};$scope.showHideDivElementForVisionExam=function(catId,event){if($scope.prevSelectedCatId!==catId){$('#visionExamination_'+$scope.prevSelectedCatId).css("display","block")}for(var i=0;i<$scope.visionexamData.length;i++){if($scope.visionexamData[i].catid===catId){$('#visionExamination_'+$scope.visionexamData[i].catid).css("display","none");$scope.prevSelectedCatId=catId}else{$('#visionExamination_'+$scope.visionexamData[i].catid).css("display","block")}}if(event){$scope.editCategory(catId,'Vision Examination:',event)}};$scope.prevSelectedCatId=0;$scope.$watch('visionexamData',function(visionExamData){$scope.imageUrls={};let i=0;if(visionExamData){for(i=0;i<visionExamData.length;i++){if(visionExamData[i].children){for(j=0;j<visionExamData[i].children.length;j++){$scope.imageUrls[visionExamData[i].children[j].fieldgroupid]=$sce.trustAsResourceUrl('/mobiledoc/jsp/catalog/xml/imageInPN.jsp?section=Vision Category Inking&encId='+encounterId+'&catId='+visionExamData[i].children[j].fieldgroupid+'&itemId=&TrUserId='+userId+'&webInking='+$scope.fromProjectE+'&random='+$scope.randomVar)}}}}});$scope.viewAllReports=function(){var strUrl="/mobiledoc/jsp/webemr/labs/viewallreports/viewAllReport.jsp?";strUrl+="encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&showUnreviewedOnly=1&webStatus=0";showViewAllReportScreen(makeURL(strUrl))};function showViewAllReportScreen(url){$ocLazyLoad.load({name:'viewAllReport',files:getDependencies('viewAllReport')}).then(function(){$scope.viewAllReportsPNPopupUrl=url})}$scope.reloadCurrentPage=function(){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")};$scope.clearViewAllReportsDiv=function(){$scope.viewAllReportsPNPopupUrl=null};if(encObj&&encObj.dataAssessmentPlanFlag===true){$scope.bh_Initialload=true;$scope.bh_IfTodaysAppt=false;$scope.bh_IsTimerRunning=false;$scope.bh_OpenStopTimerModal=false;$scope.bh_IsTimerStartedUser=false;$scope.bh_TimeCapTimerId=0;$scope.bh_LockObj={};$scope.bh_GetTimeCaptureSettings=function(){var data={'patientId':$scope.patientId,'uniqueId':$scope.encounterId,"moduleName":"BH"};var url="/mobiledoc/behavioralhealth/ShowTimeCaptureController.go/getTimeCaptureSettings";$http({method:'POST',url:url,data:JSON.stringify(data)}).success(function(response){if(response&&response.success&&response.data){$scope.bh_SetTimeCaptureSettings(response)}else{ecwAlert("Unable to get Time Capture Settings","eclinicalWorks",'','','bluetheme')}}).error(function(){ecwAlert("Unable to start timer","eclinicalWorks",'','','bluetheme')})};$scope.bh_SetTimeCaptureSettings=function(response){$scope.bh_OpenStopTimerModal=false;if(moment().startOf('day').diff(moment(response.data.apptDate).startOf('day'),'days')===0){$scope.bh_IfTodaysAppt=true;$scope.bh_validateIsTimerRunning(response);if($scope.bh_Initialload){$scope.bh_GetPatientEnrollData()}$scope.bh_Initialload=false}else{$scope.bh_IfTodaysAppt=false;$scope.bh_validateIsTimerRunning(response);if($scope.bh_Initialload){if(response.data.startTime&&response.data.startTime!=="null"){ecwConfirm("Timer has been running from Date:"+response.data.startTime+", do you want to reset the Timer now? New time can not be added unless the existing Timer is reset.","eClinicalWorks",function(){$scope.bh_ResetPastDateRunningTimer(response)},function(){$scope.bh_GetPatientEnrollData()},"",false,"","Reset Now")}else{$scope.bh_GetPatientEnrollData()}}$scope.bh_Initialload=false}};$scope.bh_validateIsTimerRunning=function(response){if(response.data.startTime&&response.data.startTime!=='null'&&response.data.startTime!==null){$scope.bh_IsTimerRunning=true;$scope.bh_TimeCapTimerId=response.data.timeCapTimerId;$scope.bh_IsTimerStartedUser=response.data.timerStartBy===parseInt(global.TrUserId,10);if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.isBhTimerRunning==='boolean'){$scope.bhVisitProgressNotes.isBhTimerRunning=true}}else{$scope.bh_IsTimerRunning=false;$scope.bh_IsTimerStartedUser=false;if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.isBhTimerRunning==='boolean'){$scope.bhVisitProgressNotes.isBhTimerRunning=false}}};$scope.bh_ResetPastDateRunningTimer=function(response){var params={'timeCapTimerId':response.data.timeCapTimerId,"moduleName":"BH"};var url="/mobiledoc/behavioralhealth/ShowTimeCaptureController.go/resetPastDateRunningTimer";$http({method:'POST',url:url,data:JSON.stringify(params)}).success(function(response){if(response.success){$scope.bh_IsTimerRunning=false;$scope.bh_TimeCapTimerId=0;$scope.bh_IsTimerStartedUser=false;if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.isBhTimerRunning==='boolean'){$scope.bhVisitProgressNotes.isBhTimerRunning=false}}else{ecwAlert("Unable to reset timer","eClinicalWorks",'','','bluetheme')}$scope.bh_GetPatientEnrollData()}).error(function(error){if(error&&error.errorMsg){ecwAlert(error.errorMsg,'','ErrorMsg')}else{ecwAlert("Unable to reset timer","eClinicalWorks",'','','bluetheme')}})};$scope.bh_GetPatientEnrollData=function(){if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.getPatientEnrollData==='function'){$scope.bhVisitProgressNotes.getPatientEnrollData()}};$scope.bh_StartStopTimer=function(){if($scope.bh_IsTimerRunning){$scope.bh_CheckIsTimerStillRunning()}else{$scope.bh_checkConcurrencyAndStartTimer()}};$scope.bh_CheckIsTimerStillRunning=function(){if($scope.bh_TimeCapTimerId>0){var data={'timeCapTimerId':$scope.bh_TimeCapTimerId,'uniqueId':$scope.encounterId,'moduleName':'BH'};var url="/mobiledoc/behavioralhealth/ShowTimeCaptureController.go/isTimerStopResetDetails";$http({method:'POST',url:url,data:JSON.stringify(data)}).success(function(response){$scope.bh_ValidateCheckIsTimerStillRunningResponse(response)}).error(function(){ecwAlert("Unable to start timer","eclinicalWorks",'','','bluetheme')})}else{$scope.bh_GetTimeCaptureSettings()}};$scope.bh_ValidateCheckIsTimerStillRunningResponse=function(timerAlreadyStopDetails){if(timerAlreadyStopDetails&&timerAlreadyStopDetails.success){if(timerAlreadyStopDetails.isStop&&timerAlreadyStopDetails.startTime&&timerAlreadyStopDetails.endTime&&timerAlreadyStopDetails.captureByName){var timerStopMsg="Timer has already stopped by <b>"+timerAlreadyStopDetails.captureByName+"</b>";timerStopMsg+="<br>Start Time: "+timerAlreadyStopDetails.startTime;timerStopMsg+="<br>End Time: "+timerAlreadyStopDetails.endTime;ecwAlert(timerStopMsg,"eclinicalWorks",'','','bluetheme');$scope.bh_SetTimeCaptureSettings(timerAlreadyStopDetails.bhTimeCaptureData)}else if(timerAlreadyStopDetails.isResetTimer){var timerStopMsg="Timer is already reset.";ecwAlert(timerStopMsg,"eclinicalWorks",'','','bluetheme');$scope.bh_GetTimeCaptureSettings()}else{$scope.bh_CheckIsTimerStartedUser()}}else{ecwAlert("Unable to check timer is already stop or not","eclinicalWorks",'','','bluetheme')}};$scope.bh_CheckIsTimerStartedUser=function(){if($scope.bh_IsTimerStartedUser){$scope.bh_StopTimer()}else{ecwConfirm('You have not started this timer.Do you really want to stop this timer?',"eClinicalWorks",function(){$scope.bh_StopTimer()},function(){return})}};$scope.bh_checkConcurrencyAndStartTimer=function(){$scope.bh_LockObj={formName:"bh_timecapture",uniqueKey:"bh_timecapture_"+$scope.encounterId,g_cancel:false,strKey:"",isOpenform:false,categoryId:"0"};acquireFormLock($scope.bh_LockObj,bh_AcquireFormLockCallBack)};function bh_AcquireFormLockCallBack(){if(!$scope.bh_LockObj.g_cancel){$scope.bh_StartTimer();releaseFormLock($scope.bh_LockObj)}}$scope.bh_StartTimer=function(){var data={'patientId':$scope.patientId,'uniqueId':$scope.encounterId,"userDate":getLocalDateTimeString(),"moduleName":"BH"};var url="/mobiledoc/behavioralhealth/ShowTimeCaptureController.go/startTimer";$http({method:'POST',url:url,data:JSON.stringify(data)}).success(function(response){if(response.success){$scope.bh_IsTimerRunning=true;$scope.bh_TimeCapTimerId=response.timeCapTimerId;$scope.bh_IsTimerStartedUser=true;if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.isBhTimerRunning==='boolean'){$scope.bhVisitProgressNotes.isBhTimerRunning=true}}else if(response.reason==="Timer_Started"){$scope.bh_IfTimerAlreadyStarted(response)}else{ecwAlert("Unable to start timer","eclinicalWorks",'','','bluetheme')}}).error(function(){ecwAlert("Unable to start timer","eclinicalWorks",'','','bluetheme')})};$scope.bh_IfTimerAlreadyStarted=function(response){$scope.bh_IsTimerRunning=true;if($scope.bhVisitProgressNotes&&typeof $scope.bhVisitProgressNotes.isBhTimerRunning==='boolean'){$scope.bhVisitProgressNotes.isBhTimerRunning=true}var timerAlreadyStartMsg="Timer Already Started";if(response.timerStartBy!==parseInt(global.TrUserId,10)){$scope.bh_IsTimerStartedUser=false;timerAlreadyStartMsg+=" By <b>"+response.timerStartByName+"</b>";timerAlreadyStartMsg+=" at <b>"+response.startTime+"</b>"}else{$scope.bh_IsTimerStartedUser=true}$scope.bh_TimeCapTimerId=response.timeCapTimerId;ecwAlert(timerAlreadyStartMsg,"eclinicalWorks",'','','bluetheme')};$scope.bh_StopTimer=function(){$scope.bh_OpenStopTimerModal=true;$scope.loadProgressNotePopup('Time Tracker:');$('#bhStopTimePopup').hide()};$scope.bh_TimerInit=function(){try{var x2jsBh=new X2JS;var xmlJson=x2jsBh.xml_str2json($scope.xmlData);var globalSettings=returnDataArray(xmlJson.Envelope.Body["return"]);let bhTimeCaptureData=JSON.parse(globalSettings[0].bhTimeCaptureData.data);if(bhTimeCaptureData){$scope.bh_SetTimeCaptureSettings(bhTimeCaptureData)}}catch(err){ecwAlert("Something Went wrong while loading time capture data","eclinicalWorks",'','','bluetheme')}};$scope.bh_hideStopTimerPopup=function(){$('#bhStopTimePopup').hide()};function getLocalDateTimeString(){var dateTime="";var today=new Date;var dd=today.getDate();var mm=today.getMonth()+1;var yyyy=today.getFullYear();if(dd<10){dd='0'+dd}if(mm<10){mm='0'+mm}var date=mm+'/'+dd+'/'+yyyy;var hour=today.getHours();var minute=today.getMinutes();var second=today.getSeconds();if(hour<10){hour='0'+hour}if(minute<10){minute='0'+minute}if(second<10){second='0'+second}var timeString=hour+':'+minute+':'+second;dateTime=date+" "+timeString;return dateTime}}$scope.setReportWriterDirtyFlag=function(flag){$scope.reportWriterObj.reportWriterDirtyFlag=flag};$scope.resetDirtyFlag=function(){$scope.reportWriterObj.isReportWriterEdited=false};$scope.loadPrismaHighlightsDependency=function(){$ocLazyLoad.load({name:'prismaPatientSummary',files:['/mobiledoc/jsp/webemr/progressnotes/prisma/highlights/prisma-highlights.js','/mobiledoc/jsp/webemr/progressnotes/prisma/highlights/css/prisma-highlights.css','/mobiledoc/jsp/webemr/toppanel/prisma/js/common-directive.js']}).then(function(){$scope.prismaHighlightsURL='/mobiledoc/jsp/webemr/progressnotes/prisma/highlights/prisma-highlights-container.html'},function(e){alert('An error occurred while loading Prisma Highlights data.')})}});var getLinkForSection=function(section){if(section=="ROS")return"ROS:";else if(section=="FamilyHistory")return"Family History:";else if(section=="PreventiveMedicine")return"Preventive Medicine:";else if(section=="CC")return"Chief Complaint(s):";else if(section=="HPI")return"HPI:";else if(section=="Therapeutic")return"Therapeutic Interventions:";else if(section=="Procedures")return"Procedures:";else if(section=="PhysicalExam")return"Physical Examination:";else if(section=="SocialHistory")return"Social History:";else if(section=="Examination")return"Examination:";else if(section=="VisionExamination"){var usVisionEnable=getItemKeyValue('visionUSEnable');if(usVisionEnable&&usVisionEnable.toLowerCase()=='yes')return"Vision:";else return"Vision Examination:"}else if(section=="Allergies")return"Allergies/Intolerance:";else if(section=="Assessments")return"Assessment:";else if(section=="CurrentMedication")return"Current Medication:";else if(section=="CDSS")return"CDSS:";else if(section=="Pre-Op Diagnosis")return"Pre-Op Diagnosis:";else if(section=="Anesthesia Plan")return"Anesthesia Plan:";else if(section=="Anesthesia Details")return"Anesthesia Details:";else if(section=="Comments")return"Comments:";else if(section=="Implants")return"Implants:";else if(section=="Ocular")return"Ocular History:";else if(section==="TimeCapture")return"Time Tracker:";else if(section==="BehavioralHistory")return"Behavioral History:";else if(section==="Screening")return"Screening:";else if(section==="GynHistory")return"Gyn History:";return section+":"};var getLabel=function(section){if(section=="CC")return"Chief Complaints";if(section=="PhysicalExam")return"Physical Examination";if(section=="Allergies")return"Past Medical History";if(section=="PreventiveMedicine")return"Preventive Medicine";if(section=="Hospitalization")return"Surgical History";if(section=="FamilyHistory")return"Family History";if(section=="SocialHistory")return"Social History";if(section=="VisionExamination"){var usVisionEnable=getItemKeyValue('visionUSEnable');if(usVisionEnable&&usVisionEnable.toLowerCase()=='yes')return"Vision";else return"Vision Examination"}if(section=="CareMgmt")return"Care Management Assessment";if(section=="GynHistory")return"OB/Gyn History";if(section=="CurrentMedication")return"Med Reconciliation";if(section=="Assessment")return"Assessments";if(section=="CDSS")return"CDSS";if(section=="Pre-Op Diagnosis")return"Pre-Op Diagnosis";if(section=="Anesthesia Plan")return"Anesthesia Plan";if(section=="Anesthesia Details")return"Anesthesia Details";if(section=="Comments")return"Comments";if(section=="Implants")return"Implants";if(section=="Ocular")return"Past Ocular History";if(section==="TimeCapture")return"Time Tracker";if(section==="BehavioralHistory")return"Behavioral History";if(section==="Screening")return"Screening";return section};var getNextLabel=function(secName){return nextData[secName]};var getPrevLabel=function(secName){return prevData[secName]};var removeScriptTagsPN=function(htmlValue){var html=$(htmlValue.bold());html.find('script').remove();return html.html()};var removeStyleTag=function(htmlValue){var html=$(htmlValue.bold());html.find('style[media="screen"]').remove();return html.html()};var checkIfJSONEmpty=function(obj){if(Object.keys(JSON.parse(obj)).length==0){return true}return false};function escapeHtmlMakeStringSafe(text){return escapeHtml(text)}function getArray(obj){var temp=[];if(obj&&!Array.isArray(obj)){temp.push(obj)}else{temp=obj}return temp}function getVisionExamArray(obj){if(obj){if(!Array.isArray(obj)){obj=getArray(obj)}for(var index=0;index<obj.length;index++){if(obj[index].children){obj[index].children=getArray(obj[index].children);for(var index_i=0;index_i<obj[index].children.length;index_i++){obj[index].children[index_i].children=getArray(obj[index].children[index_i].children)}}}}return obj}function getMotilityArray(obj){if(obj.motilitySection.examsData){obj.motilitySection.examsData=getArray(obj.motilitySection.examsData)}if(obj.motilitySection!==''){var len=obj.motilitySection.examsData.length;for(var i=0;i<len;i++){var flag=true;var gazeFlag=true;obj.motilitySection.examsData[i].isEmpty=true;obj.motilitySection.examsData[i].isGazeEmpty=true;$.each(obj.motilitySection.examsData[i],function(key,value){if(key==='gazeData'){gazeFlag=true;$.each(value,function(key,gazeArray){$.each(gazeArray,function(key,value){if(value!==''){gazeFlag=false;return false}});if(!gazeFlag){return false}obj.motilitySection.examsData[i].isGazeEmpty=gazeFlag})}else if((key==='comments'||key==='locationTargetName'||key==='locationTargetUnitName'||key==='rxOptionName'||key==='rxOtherOptionNotes'||key==='testTypeName')&&value!==''){flag=false;return false}});obj.motilitySection.examsData[i].isEmpty=gazeFlag&&flag}}return obj}function checkIfDuctionEmpty(motilityData,excludeComment){if(!motilityData){return true}var flag=true;if(excludeComment){$.each(motilityData,function(key,value){if(key!=='comments'&&value!==''){flag=false;return false}})}else{$.each(motilityData,function(key,value){if(value!==''){flag=false;return false}})}return flag}function checkEmptyAndReturnVersionData(examData){if(examData){$.each(examData,function(keyIndex,valueObj){$.each(valueObj,function(gazeDataKey,gazeDataObj){if(gazeDataKey==='gazeData'){$.each(gazeDataObj,function(gazeDataDirectionKey,gazeDataDirectionObj){$.each(gazeDataDirectionObj,function(gazeDataDirectionKey,gazeDataDirectionValue){if(gazeDataDirectionValue!==''){valueObj.isGazeEmpty=false;return}})})}})})}return examData}