var clickedEl=null;var selectedText;var input;var injectContextMenuKey=sessionStorage.getItem("injectContextMenuInIframe");onLoadContextMenuJS();function onLoadContextMenuJS(){var isIOS=/iPad|iPhone|iPod|MacIntel/.test(navigator.platform);var isWindows=navigator.platform=="Win32";var cutLabel=document.getElementById("cutControl");var copyLabel=document.getElementById("copyControl");var selectAllLabel=document.getElementById("selectAllControl");var pasteLabel=document.getElementById("pasteControl");if(isWindows){if(cutLabel)cutLabel.innerHTML="(Ctrl+X)";if(copyLabel)copyLabel.innerHTML="(Ctrl+C)";if(pasteLabel)pasteLabel.innerHTML+=" Ctrl+V";if(selectAllLabel)selectAllLabel.innerHTML="(Ctrl+A)"}else if(isIOS){if(cutLabel)cutLabel.innerHTML="(⌘X)";if(copyLabel)copyLabel.innerHTML="(⌘C)";if(pasteLabel)pasteLabel.innerHTML+=" ⌘V";if(selectAllLabel)selectAllLabel.innerHTML="(⌘A)"}input=document.querySelector("input.copyfrom");var ul=document.getElementById('customContextMenuItems');if(ul){ul.addEventListener('click',function(e){if(e.target.parentElement.tagName==='LI'){var menuItem=e.target.parentElement.id;switch(menuItem){case'cutMenu':contextMenuCutToClipboard();break;case'copyMenu':contextMenuCopyToClipboard();break;case'pasteMenu':break;case'selectallMenu':contextMenuSelectAllText();break}}})}}function contextMenuCopyToClipboard(){if(selectedText){input.value=selectedText.trim();navigator.clipboard.writeText(input.value);selectedText=""}else{var text=clickedEl.value.substr(clickedEl.selectionStart,clickedEl.selectionEnd-clickedEl.selectionStart);var sampleTextarea=document.createElement("textarea");document.body.appendChild(sampleTextarea);sampleTextarea.value=text;sampleTextarea.select();document.execCommand("copy");document.body.removeChild(sampleTextarea)}}function contextMenuCutToClipboard(){if(clickedEl.readOnly===false&&clickedEl.disabled===false){var text=clickedEl.value.substr(clickedEl.selectionStart,clickedEl.selectionEnd-clickedEl.selectionStart);var sampleTextarea=document.createElement("textarea");document.body.appendChild(sampleTextarea);sampleTextarea.value=text;sampleTextarea.select();document.execCommand("cut");document.body.removeChild(sampleTextarea);var cutText=clickedEl.value;cutText=cutText.slice(0,clickedEl.selectionStart)+cutText.slice(clickedEl.selectionEnd);clickedEl.value=cutText;if($&&angular&&angular.element(clickedEl).controller('ngModel')){angular.element(clickedEl).controller('ngModel').$setViewValue(cutText)}}}function contextMenuSelectAllText(){clickedEl.focus();document.execCommand('selectAll',false,null)}function isTextField(element){var tagName=element.tagName.toLowerCase();if(tagName==='textarea')return true;if(tagName!=='input')return false;var type=element.getAttribute('type');if(type==null){return true}inputTypes=['text','password','number','email','tel','url','search','date','datetime','datetime-local','time','month','week'];return inputTypes.indexOf(type)>=0}function injectContextMenu(iframe){var ajaxRequest=new XMLHttpRequest;var url="/mobiledoc/jsp/webemr/menu/contextMenuIframe.jsp";ajaxRequest.onreadystatechange=function(){if(this.readyState===4){iframe.contentDocument.body.insertAdjacentHTML('beforeend',this.responseText.trim())}};ajaxRequest.open("GET",url,false);ajaxRequest.send()}function isElementCopyOnly(clickedEL){return clickedEl.hasAttribute("ui-grid-editor")}function isElementIgnored(iframe){return this.isEditorIfame(iframe)||iframe.title==="webviewer"}function isEditorIfame(element){return element.className.split(' ').some(function(c){return/cke_.*|wysihtml5.*/.test(c)})}function Document_OnContextMenu(event){event.preventDefault();var editableField=isTextField(document.activeElement);var anchorNode=window.getSelection().anchorNode;if(anchorNode){selectedText=window.getSelection().toString();var iframe=window.frameElement;if('true'===injectContextMenuKey&&iframe&&!isElementIgnored(iframe)){var contextMenuAdded=iframe.contentDocument.body.innerHTML.includes("customContextMenu");if(!contextMenuAdded){injectContextMenu(iframe);onLoadContextMenuJS()}}var cutMenu=document.getElementById("cutMenu");var copyMenu=document.getElementById("copyMenu");var selectAllMenu=document.getElementById("selectallMenu");var customContextMenuPasteItem=document.getElementById("customContextMenuPasteItem");clickedEl=event.target;if(selectedText||editableField){cutMenu.style.display="block";selectAllMenu.style.display="block";customContextMenuPasteItem.style.display="block";cutMenu.classList.remove("disabled-menu");copyMenu.classList.remove("disabled-menu");selectAllMenu.classList.remove("disabled-menu")}if(selectedText&&!editableField){cutMenu.style.display="none";selectAllMenu.style.display="none";customContextMenuPasteItem.style.display="none"}if(editableField){if(!selectedText){if(isElementCopyOnly(clickedEl)){return}cutMenu.classList.add("disabled-menu");copyMenu.classList.add("disabled-menu");if(!clickedEl.value){selectAllMenu.classList.add("disabled-menu")}}else{if(document.activeElement.readOnly===true||document.activeElement.disabled===true){cutMenu.classList.add("disabled-menu")}if(isElementCopyOnly(clickedEl)){cutMenu.style.display="none";selectAllMenu.style.display="none";customContextMenuPasteItem.style.display="none"}}}if(selectedText||editableField){var customContextMenu=document.getElementsByClassName('customContextMenuClass')[0];customContextMenu.style.marginLeft=event.pageX+"px";customContextMenu.style.marginTop=event.pageY-40+"px";customContextMenu.style.zIndex=1051e3;fadeInElement(customContextMenu,startFocusOut)}}}document.oncontextmenu=Document_OnContextMenu;function Document_OnScroll(event){var scrolledElement=event.target;if((scrolledElement.closest('div')===null||scrolledElement.closest('div').id!=='customContextMenu')&&document.getElementById("customContextMenu")!=null){document.getElementById("customContextMenu").style.display='none'}}document.onwheel=Document_OnScroll;function fadeInElement(element,callbackFn){var op=.1;element.style.display='block';var timer=setInterval(function(){if(op>=1){clearInterval(timer)}element.style.opacity=op;element.style.filter='alpha(opacity='+op*100+")";op+=op*.1},10);callbackFn()}function startFocusOut(){document.addEventListener("click",function(event){if(clickedEl.closest('li')===null||clickedEl.closest('li').id!=='pasteMenu'){document.getElementById("customContextMenu").style.display='none'}})}