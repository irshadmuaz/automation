var windowChart="";var obflowmainx2js=null;var obpnModule=angular.module('obpnModule',['ecw.dir.dynamicContent','oc.lazyLoad','ecw.service.EncDetailsService','ecw.dir.centeredmodal','ecw.batchAjax','ecw.dir.datepicker','ngSanitize','ui.bootstrap','ecw.service.PregnancyDataServices','ecw.dir.savePrompt','ecw.service.PSAC','ecw.dir.keywords','ecw.dir.browsecommon','tabModule','rightPanelModule','webemrApp','pnModule','QuickOrderSearch','ecw.datatruncUtilityModule','ecw.dir.alertmessage','ecw.dir.onlyNumbers','ecw.spellchecker']);obpnModule.controller('obpnController',function($scope,$interval,$http,$templateCache,$sce,PregnancyDataServices,$ocLazyLoad,EncDetailsService,$window,$modal,PSACService,$timeout,dataTruncUtilityService,PNService,$q){$scope.className='username editable-disabled editable editable-click';obflowmainx2js=new X2JS;$scope.defalut=false;$scope.mergeDefalut=false;$scope.obClosedFlag=false;$scope.pregId=obflowmainpregId;$scope.userId=obflowmainuserId;$scope.patientId=obflowmainpatientId;$scope.encounterId=obflowmainencounterId;$scope.currpregId=obflowmaincurrpregId;$scope.FlwosheetHeaderItemList=[];$scope.totalPostPartumList=[];$scope.leftPhysicalItemlist=[];$scope.rightPhysicalItemlist=[];$scope.totalPreviousPregItemlist=[];$scope.totalMenstrualHistoryItemlist=[];$scope.totalDeliveryInfoList=[];$scope.totalDeliverydatesList=[];$scope.totalDischargeCompList=[];$scope.totalDischargeneonatalinfoList=[];$scope.totalDischargematernalinfoList=[];$scope.totalInfectionHistoryItemlist=[];$scope.totalPlansFirstTrimester=[];$scope.totalPlansSecondTrimester=[];$scope.totalPlansThirdTrimester=[];$scope.arrGenLeftItemId=[];$scope.arrGenRightItemId=[];$scope.arrMedHxLeftItemId=[];$scope.arrMedHxRightItemId=[];$scope.totalAtRisksList=[];$scope.totalHighRisksList=[];$scope.PPCloseFlag=false;$scope.chkLock=false;$scope.strLock=false;$scope.popupurl={value:''};$scope.loadPNFlag={enable:true};$scope.totalEthnicitylist=[];$scope.labAttributeDetails=[];$scope.arrProblem=['','Active','Resolved','Well-Controlled','Poorly-Controlled'];$scope.MedlabelName=['Size','Formulation','Take','Route','Frequency','Duration','Amount','Refills'];$scope.fatherDetails={strPregId:'',strItemId:'',strFatherFName:'',strFatherMName:'',strFatherLName:'',strFatherDob:'',strPhone:'',strCellPhone:'',strOccupation:'',strRace:'',strMBirth:'',strEthnicity:'',strEnable:'',strDischargedt:'',strNotes:'',strProviderId:'',strProviderName:''};$scope.QOSResultObj={};$scope.QOSFilterObj={isRx:"",isLab:"",isDI:"",isProc:"",isReferral:"",isAssessmentPanel:"false",searchType:"",widthClass:"w200",heightClass:"h230",favRxWidthClass:"w700",openSecondLevel:"pull-second-level-left",parentName:"OBFlowsheet",encounterID:$scope.encounterId,patientID:$scope.patientId,itemid:"",dupicateCheck:true,allergyCheck:false,sameDrugClassCheck:true,nRxListCount:14};$scope.pnpanel={url:""};$scope.modalForOB={url:""};$scope.crePreview={url:""};$scope.obSupplementDataPopUp={url:""};$scope.obProviderNumberurl={url:""};var defaultSectionChanged={"medicalChanged":"false","surgicalChanged":"false","hospChanged":"false","familyChanged":"false","socialChanged":"false","allergyChanged":"false"};sectionAlreadyChanged=checkIfJSONEmpty(sectionAlreadyChanged)?defaultSectionChanged:JSON.parse(sectionAlreadyChanged);$scope.showWarning=showWarning;$scope.medChanged=sectionAlreadyChanged.medicalChanged;$scope.surChanged=sectionAlreadyChanged.surgicalChanged;$scope.hosChanged=sectionAlreadyChanged.hospChanged;$scope.famChanged=sectionAlreadyChanged.familyChanged;$scope.socChanged=sectionAlreadyChanged.socialChanged;$scope.allerChanged=sectionAlreadyChanged.allergyChanged;$scope.gynChanged=sectionAlreadyChanged.gynHxChanged;$scope.obChanged=sectionAlreadyChanged.obHxChanged;$scope.sortOrder="DESC";$scope.sortedByColName="CommentDate";$scope.sortLabOrder="DESC";$scope.sortLabImagingOrder="DESC";$scope.sortTemplateLabOrder="DESC";$scope.sortedByOBLabColName="1";$scope.sectionToLoadByDirective={name:''};const LOAD_BY_DIRECTIVE="loadModuleByDirective";$scope.InteractionColor="btn-default";$scope.InteractionLabel="Interaction";$scope.rxInteractionSeverity=0;$scope.isPreOBWeightMOU={value:'lbs'};$scope.arrPreOBWeightMOU=['lbs','kgs'];var timer1,timer2,timer3;$scope.OBFatherRace="";$scope.setPtRace=function(ptRace){$scope.OBFatherRace=ptRace;$('#PtRaceModal').modal('hide');$('#PtRaceModal .det-view').remove()};$scope.loadSupplementPopUp=function(items){$templateCache.remove($scope.obSupplementDataPopUp.url);$scope.obSupplementDataPopUp={url:""};$scope.diagnosisForICDSupplementData=items;var url="/mobiledoc/jsp/webemr/progressnotes/assessment/icdsupplementdetails.jsp?itemid="+$scope.diagnosisForICDSupplementData.itemId+"&patientid="+$scope.patientId+"&name="+encodeURIComponent($scope.diagnosisForICDSupplementData.value+" "+$scope.diagnosisForICDSupplementData.name);$ocLazyLoad.load({name:"icdsupplementdata",files:['/mobiledoc/jsp/webemr/progressnotes/assessment/icdsupplementdetails.js']}).then(function(){url=makeURL(url);$scope.obSupplementDataPopUp.url=url},function(e){})};$scope.processAfterICDSupplementData=function(modalInstanceResponse){$scope.diagnosisForICDSupplementData.specify=modalInstanceResponse.specify;$scope.diagnosisForICDSupplementData.notes=modalInstanceResponse.notes;$scope.diagnosisForICDSupplementData.OnsetDate=modalInstanceResponse.OnsetDate;$scope.diagnosisForICDSupplementData.risk=modalInstanceResponse.risk};$scope.loadAssessmentPopup=function(){$templateCache.remove($scope.obPanelPopUrl);$scope.obPanelPopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPanelPopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=assessmentPopup"},function(e){$templateCache.remove($scope.obPanelPopUrl)})};$scope.loadPatientRace=function(){$templateCache.remove($scope.obPtRacePopUrl);$scope.obPtRacePopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPtRacePopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=OBPatientRace&randomId="+Math.random()},function(e){$templateCache.remove($scope.obPtRacePopUrl)})};$scope.PrintOBSummary=function(PregId){$scope.obSummaryPrint="";$ocLazyLoad.load({name:'pregnancysummary',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obSummary/obSummaryController.js']}).then(function(){$scope.obSummaryPrint="/mobiledoc/jsp/webemr/obFlowsheet/obSummary/OB-Summary.jsp?pregId="+PregId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId},function(e){})};$scope.updateEHXStatus=function(pregId,patientId,encId,uid){PregnancyDataServices.updateEhxStatusData(pregId,patientId,encId,uid).success(function(data){}).error(function(){ecwAlert("Internal Error occured while updating eHx status !")})};var nextJsonData=(new X2JS).xml_str2json(obflowmainnextXml);var prevJsonData=(new X2JS).xml_str2json(obflowmainprevXml);var nextArr=returnDataArray(nextJsonData.Envelope.Body["return"].section);var prevArr=returnDataArray(prevJsonData.Envelope.Body["return"].section);if(obflowmainencounterId&&(!EncDetailsService.getEncDetails()||EncDetailsService.getEncDetails().encounterId!=obflowmainencounterId)){EncDetailsService.setEncDetails(obflowmainencXml)}EncDetailsService.getEncDetailsByEncId($scope.encounterId);var encDate='';var encTime='';var vitalsRangeOBArr=[];var patientOBDOB='';var patientOBSex='';if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().encDate){encDate=EncDetailsService.getEncDetails().encDate;encTime=EncDetailsService.getEncDetails().encTime;patientOBDOB=EncDetailsService.getEncDetails().dob;patientOBSex=EncDetailsService.getEncDetails().sex;if(patientOBDOB!==''&&patientOBSex!==''){var patientData=new patientInfoOBDetails;populateOBPatientDataDetails(patientData,patientOBDOB,patientOBSex);PregnancyDataServices.loadOBVitalsRangeForAll(patientData.ageVar.age,patientData.ageVar.ageFlag,patientData.sex).success(function(jsonArray){vitalsRangeOBArr=processOBVitalRange(jsonArray)}).error(function(){var message="Internal Error occured with getting Vitals Range";showAlertMessage(message,'','AlertMsg','','obpnController')})}}for(var i=0;i<nextArr.length;i++){nextData[nextArr[i].current]=nextArr[i].next}for(var i=0;i<prevArr.length;i++){prevData[prevArr[i].current]=prevArr[i].prev}$scope.closePopup=function(obj,objLock){$('#'+obj).modal('hide');$('#'+obj+' .det-view').remove();if(obj==='obEditAddPopupWindow'||obj==='editPastPreg'||obj==='obEditproblem'||obj==='obfloedit'||obj==="obEditnotes"||obj==="obOrderLabModal"||obj==="obCareGraph"){if(objLock!==undefined){var lockObj=objLock;releaseFormLock(lockObj)}}if(obj==='PtRaceModal'){setDirtyPregListFalg()}};$scope.releaseLockPopup=function(objLock){if(objLock!==undefined){var lockObj=objLock;releaseFormLock(lockObj)}};$scope.changeCloseFlag=function(){$scope.PPCloseFlag=true};$scope.clearSelecteddatafromdropdown=function(obj){if(obj==='race'){$scope.OBFatherRace=""}else if(obj==='provider'){$scope.OBProviderName="";$scope.OBProviderId=""}};$scope.HideElements=function(fieldDetailId){$(".ob-drop-box").each(function(){if($(this).attr("id")!="dropbox"+fieldDetailId){$(this).css("display","none")}})};$scope.showAlert=function(){ecwAlert("No active pregnancy exists for this patient.")};var isPreOBWeight=false;$scope.openNumPad=function(fieldDetailId,itemName){var inputId="#dropbox"+fieldDetailId;if(itemName!==undefined&&itemName!==''){if(itemName.toLowerCase()==='pre-ob weight'){$scope.PreObWt=$('#'+fieldDetailId).text();$scope.fieldDetailId=fieldDetailId;if($scope.PreObWt!==''&&$scope.PreObWt!==undefined){$scope.numPadId=inputId;isPreOBWeight=true;$scope.setPreObWeightVal('Physical')}else{isPreOBWeight=false;$(inputId).removeClass("hide-menu-item");$(inputId).attr("style","display:block;z-index:10000;")}}else if(itemName.toLowerCase()!=='total wt gain'){isPreOBWeight=false;$(inputId).removeClass("hide-menu-item");$(inputId).attr("style","display:block;z-index:10000;");if(itemName.toLowerCase()==='next appt.'){$(inputId).attr("style","display:block;z-index:10000;width:220px;")}}else if(itemName.toLowerCase()==='total wt gain'){$(inputId).addClass("hide-menu-item");var message="Please enter Pre-OB weight (Physical tab) and Weight for the current visit (Flowsheet tab) to calculate Total Wt gain";showAlertMessage(message,'','AlertMsg','','obpnController')}else{$(inputId).addClass("hide-menu-item")}}$(".ob-drop-box").each(function(){if($(this).attr("id")!="dropbox"+fieldDetailId){$(this).css("display","none")}});if(!isPreOBWeight){$scope.setFocusAndCursorAtEnd(fieldDetailId)}};$scope.closeNumPad=function(fieldDetailId,fieldValue,strName,items){var inputId="#dropbox"+fieldDetailId;if(items!==undefined&&items.strMappedItemId!==undefined&&items.strMappedItemId!==''){$scope.validateOBVitalsRange(items)}else{$(inputId).addClass("hide-menu-item");$(inputId).attr("style","display:none;z-index:10000;")}if(strName!==undefined&&strName!==''){if(strName.toLowerCase()==='weight'){$scope.validateNumberFields(fieldDetailId,fieldValue,strName)}if(strName.toLowerCase()==='systolic bp'||strName.toLowerCase()==='diastolic bp'){var regexDigitComma=/^\d+(?:[\,\.]\d+)*$/;if(fieldValue!==""&&fieldValue!==undefined){if(regexDigitComma.test($.trim(fieldValue))){$scope.validateNumberWithCommaFields(fieldDetailId,fieldValue,strName)}}if($scope.visitEncId!=='0'&&$scope.newVisitId!=='0'&&$scope.isBPVitalMapped==='yes'){if(fieldValue===''){showAlertMessage("Clearing the Systolic or Diastolic BP from the fields and saving the pre-natal visit will clear the corresponding mapped vital value from the Progress Note",'','AlertMsg','','obpnController')}}}if(strName.toLowerCase()==='height'||strName.toLowerCase()==='weight'){$scope.totalBMI=calculateBmi()}}};$scope.validateNumberFields=function(id,val,name){var disit_regex=/^-?\d+\.?\d*$/;if(val!==''){if(disit_regex.test($.trim(val))){$('#hideTooltip'+id).remove()}}else if(val===''){$('#hideTooltip'+id).remove()}};$scope.validateNumberWithCommaFields=function(id,val,name){var regexDigitComma=/^-?\d+\,?\d*$/;if(val!==''){if(regexDigitComma.test($.trim(val))){$('#hideBPTooltip'+id).remove()}}else if(val===''){$('#hideBPTooltip'+id).remove()}};$scope.preventPaste=function(e){var message="Pasting data into this field not allowed.";showAlertMessage(message,'','AlertMsg','','obpnController');e.preventDefault();return false};$scope.displayWeeksGestmessageOnClcik=function(val){var message="Please fill out the EDD tab in order to calculate Weeks Gest.";showAlertMessage(message,'','AlertMsg','','obpnController')};$scope.displayBMImessageOnClcik=function(val){var message="Please fill out the Height and Weight in order to calculate BMI.";showAlertMessage(message,'','AlertMsg','','obpnController')};$scope.validateOBVitalsRange=function(items){if(items.strMappedItemId!==''&&items.strMappedItemId!==undefined){renderOBVitalRangeForAuto(items.strItemId,items.strName,items.strDate,vitalsRangeOBArr,items.strMappedItemId,items)}};$scope.numberClicked=function(rightItem,number){if(rightItem.strDate){rightItem.strDate=rightItem.strDate+""+number}else{rightItem.strDate=number}if(rightItem.strMBirth){rightItem.strMBirth=rightItem.strMBirth+""+number}else{rightItem.strMBirth=number}if(rightItem.strName==='Height'||rightItem.strName==='Weight'){$scope.totalBMI=calculateBmi()}$scope.changeCloseFlag()};$scope.clearLastDigit=function(rightItem){if(rightItem.strDate){rightItem.strDate=rightItem.strDate.substring(0,rightItem.strDate.length-1)}if(rightItem.strMBirth){rightItem.strMBirth=rightItem.strMBirth.substring(0,rightItem.strMBirth.length-1)}$scope.changeCloseFlag()};$scope.selectNxtAppt=function(cmbNxtAppt){if($scope.nextApptDate==undefined){$scope.nextApptDate=''}if($scope.nextApptDate.indexOf(cmbNxtAppt)==-1){if($scope.nextApptDate!=''){$scope.nextApptDate=$scope.nextApptDate+', '+cmbNxtAppt}else{$scope.nextApptDate=cmbNxtAppt}}};$scope.clearNxtAppt=function(){$scope.nextApptDate=''};$scope.loadPatientHeader=function(){var patientdashjson=(new X2JS).xml_str2json(obflowmainptdashboardxml);$scope.ptDashboard=patientdashjson.Envelope.Body["return"].encounter;PregnancyDataServices.getPatientDetails($scope.pregId,$scope.patientId,$scope.encounterId,$scope.userId).success(function(data){var patientDetailsJson=(new X2JS).xml_str2json(data);$scope.user=patientDetailsJson.Envelope.Body["return"].User;$scope.Race=$scope.user.strRace.split(",");$scope.lockFlag=$scope.user.lockFlag;$scope.sType=$scope.user.styleType;$scope.EnableModernViewLab=$scope.user.strEnableModernViewLab;$scope.userName=$scope.user.strUserName;$scope.Mbirth=$scope.user.strEnableMBirth;$scope.EnableAddICD=$scope.user.strEnablelAddICD;$scope.GA=$scope.user.ptGA;$scope.doctorId=$scope.user.strDocId;$scope.HtUOM=$scope.user.strHtUOM;$scope.WtUOM=$scope.user.strWtUOM;$scope.strLowWt=$scope.user.strLowWt;$scope.strHighWt=$scope.user.strHighWt;$scope.strLowBP=$scope.user.strLowBP;$scope.strHighBP=$scope.user.strHighBP;$scope.strTimeStampName=$scope.user.strTimeStampName;$scope.careTemplate=$scope.user.strOBCareTemplates.split(",");$scope.ptHighRisk=$sce.trustAsHtml($scope.user.ptHighRisk);$scope.ptAtRisk=$sce.trustAsHtml($scope.user.ptAtRisk);$scope.ptProblemList=$sce.trustAsHtml($scope.user.ptProblemList);$scope.ptGenetics=$sce.trustAsHtml($scope.user.ptGenetics);$scope.ptInfection=$sce.trustAsHtml($scope.user.ptInfection);$scope.ptAllergy=$sce.trustAsHtml($scope.user.ptAllergy);$scope.strPtEdd=$scope.user.ptEDD;$scope.bEnableUnlock=$scope.user.bEnableUnlock;if($scope.EnableModernViewLab=="1"){$('#labT').prop('checked',true)}else{$('#labC').prop('checked',true)}$scope.labgrayOut="0";if($scope.GA>=13&&$scope.GA<=26){$scope.labgrayOut="1"}else{$scope.labgrayOut="0"}$scope.patientIdentifiers={id:$scope.patientId,firstName:$scope.user.fname,lastName:$scope.user.lname,middleInitial:$scope.user.mname,suffix:$scope.user.suffix,dateOfBirth:$scope.user.ptDOB,sex:$scope.toLowerCaseCustom($scope.user.ptSex),accountNumber:$scope.user.ControlNo}}).error(function(){ecwAlert("Internal Error occured while loading patient dashboard data.!")});$scope.getOBTabOrderList();$scope.hideLoadingImage()};$scope.selectCheckBox=function(){$('input[type="checkbox"]').each(function(){if(this.id!=$("#chkEncAll").attr("id")){if($("#chkEncAll").is(':checked')){this.checked=true}else{this.checked=false}}})};$scope.$on('$routeChangeStart',function(event,current,previous){$('#dvLoading').show();$('#dvLoading').fadeOut('slow')});$scope.loadRxData=function(rxXML,objMode){if(objMode=='readMode'){var jsonData=obflowmainx2js.xml_str2json(rxXML);parseCurrentMed(jsonData)}else{PregnancyDataServices.getCurrentMendication($scope.encounterId,"medication").success(function(data){var medjson=(new X2JS).xml_str2json(data);parseCurrentMed(medjson)}).error(function(){ecwAlert("Internal Error occured while loading current medication data !")})}$scope.loadInteractionSeverity()};$scope.loadTreateMentData=function(treatmentXML,objMode){if(objMode=='readMode'){var jsonData=obflowmainx2js.xml_str2json(treatmentXML);parseTreatMent(jsonData)}else{PregnancyDataServices.getTreatMentData($scope.patientId,$scope.pregId,$scope.encounterId,"treatment").success(function(data){var treatmentjson=(new X2JS).xml_str2json(data);parseTreatMent(treatmentjson)}).error(function(){ecwAlert("Internal Error occured while loading rx data !")})}$scope.loadInteractionSeverity();$scope.loadReferralData(treatmentXML,objMode)};$scope.loadReferralData=function(referralXML,objMode){if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(referralXML);parseReferral(jsonData)}else{PregnancyDataServices.getTreatMentData($scope.patientId,$scope.pregId,$scope.encounterId,"referral").success(function(data){var referralJson=(new X2JS).xml_str2json(data);parseReferral(referralJson)}).error(function(){ecwAlert("Internal Error occured while loading rx referral data !")})}};$scope.loadFatherDetails=function(){PregnancyDataServices.getFatherDetails($scope.pregId,$scope.patientId).success(function(data){var fatherDetailsJson=(new X2JS).xml_str2json(data);if(fatherDetailsJson.Envelope.Body["return"].encounter!==undefined){$scope.fatherDetails=fatherDetailsJson.Envelope.Body["return"].encounter;if($scope.fatherDetails.strRace!=='0'){$scope.OBFatherRace=$scope.fatherDetails.strRace}}if($scope.fatherDetails.strProviderName!==''){$scope.OBProviderName=$scope.fatherDetails.strProviderName;$scope.OBProviderId=$scope.fatherDetails.strProviderId}$scope.pregListDischargeDate=$scope.fatherDetails.strDischargedt;$scope.pregListFOBDOB=$scope.fatherDetails.strFatherDob;$("#ptdob").val($scope.fatherDetails.strFatherDob)}).error(function(){ecwAlert("Internal Error occured while loading father details data !")})};$scope.editFatherDetails=function(){$scope.lockObj={};$scope.pregListLockObj={};var lockObjPregList={formName:"frmOBPregList",uniqueKey:"frmOBPregList"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjPregList.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjPregList);return}}acquireFormLock(lockObjPregList,acquireFormLockCallBack);$scope.lockObj=lockObjPregList;$scope.pregListLockObj=lockObjPregList;var jsonData=(new X2JS).xml_str2json(obflowmainethnicityXML);$scope.openId=123;var value=jsonData.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.totalEthnicitylist=value}else{$scope.totalEthnicitylist.push(value)}}};$scope.saveFatherInfo=function(onTabChange){if(!isLockMine2($scope.pregListLockObj)){$scope.loadPregListData("",'editMode');$scope.loadPatientHeader();$scope.loadDischargeData("","","","","","",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.pregListLockObj);$scope.OBFatherRace="";$scope.OBProviderName="";$scope.OBProviderId="";return false}var clsInvalidDateName=$("#ptdob").hasClass('ng-invalid-date');var clsInvalidName=$("#ptdob").hasClass('ng-invalid');if(clsInvalidDateName||clsInvalidName){return false}var dischargeDate=$("#disdate").val();var fatherDOB=$("#ptdob").val();$scope.fatherDetails.strRace=$scope.OBFatherRace;$scope.fatherDetails.strProviderId=$scope.OBProviderId;$scope.fatherDetails.strDischargedt=dischargeDate;$scope.fatherDetails.strFatherDob=fatherDOB;if(!$scope.isDate(dischargeDate))return false;if(!$scope.isDate(fatherDOB))return false;var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFatherInfo","obEditAddPopupWindow","bluetheme");if(!doCheck)return false;var phonePattern=/^(\d{3})[\-]?(\d{3})[\-]?(\d{4})$/g;if($scope.fatherDetails.strPhone!==undefined){if($scope.fatherDetails.strPhone.match(phonePattern)===null){$scope.fatherDetails.strPhone=''}}if($scope.fatherDetails.strCellPhone!==undefined){if($scope.fatherDetails.strCellPhone.match(phonePattern)===null){$scope.fatherDetails.strCellPhone=''}}var notes=$('#obpreglistnotes').val();$scope.fatherDetails.strNotes=notes;PregnancyDataServices.setFatherDetails($scope.pregId,$scope.patientId,$scope.encounterId,$scope.fatherDetails,$scope.userName).success(function(data){$scope.loadPregListData("",'editMode');$scope.loadPatientHeader();$scope.loadDischargeData("","","","","","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving Father Details, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.pregListLockObj)}else{$scope.releaseLockPopup($scope.pregListLockObj)}};$scope.OBProviderName="";$scope.OBProviderId="";$scope.loadProviderData=function(){$templateCache.remove($scope.obProviderNumberurl.url);$scope.obProviderNumberurl={url:""};$ocLazyLoad.load({name:'providerNumbersApp',cache:false,files:['/mobiledoc/jsp/webemr/webpm/billingmenu/js/ProviderNumbers.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/webpm/billingmenu/ProviderNumbers.jsp?callFrom=OB_FLOWSHEET&hideALLButton=true");$scope.obProviderNumberurl.url=url},function(e){$templateCache.remove($scope.obProviderNumberurl.url)})};$scope.setSelectedProvider=function(items){$scope.OBProviderName=items.Name;$scope.OBProviderId=items.Id};$scope.releasePregListConcurrLock=function(){$scope.releaseLockPopup($scope.pregListLockObj)};$scope.loadPhysicalItems=function(physicalXml,objMode){if(objMode==='readMode'){var physicalValJson=obflowmainx2js.xml_str2json(physicalXml);populatePhysicalData(physicalValJson)}else{PregnancyDataServices.getPhysicalValues($scope.pregId).success(function(data){var physicalValJson=(new X2JS).xml_str2json(data);populatePhysicalData(physicalValJson)}).error(function(){ecwAlert("Internal Error occured while loading physical data !")})}};$scope.editPhysicalData=function(){$scope.lockObj={};$scope.physicalLockObj={};var lockObjPhysical={formName:"frmOBPhysical",uniqueKey:"frmOBPhysical"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjPhysical.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjPhysical);return}}acquireFormLock(lockObjPhysical,acquireFormLockCallBack);$scope.lockObj=lockObjPhysical;$scope.physicalLockObj=lockObjPhysical;$scope.PPEditFlag=false;$scope.leftEditPhysicalItemlist=[];$scope.rightEditPhysicalItemlist=[];angular.copy($scope.leftPhysicalItemlist,$scope.leftEditPhysicalItemlist);angular.copy($scope.rightPhysicalItemlist,$scope.rightEditPhysicalItemlist);angular.forEach($scope.leftPhysicalItemlist,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultPhysical=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultPhysicalValue','obpnController');$scope.setDefaultPhysicalValue=function(result){if(result==='yes'){for(var i=0;i<$scope.leftEditPhysicalItemlist.length;i++){if($scope.leftEditPhysicalItemlist[i].strDef!==''){$scope.leftEditPhysicalItemlist[cnt].strDate=$scope.leftEditPhysicalItemlist[i].strDef}cnt++}for(var i=0;i<$scope.rightEditPhysicalItemlist.length;i++){if($scope.rightEditPhysicalItemlist[i].strDef!==''){$scope.rightEditPhysicalItemlist[cntRight].strDate=$scope.rightEditPhysicalItemlist[i].strDef}cntRight++}}}};$scope.mergeDefaultPhysical=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergDefaultPhysicalValue','obpnController');$scope.setMergDefaultPhysicalValue=function(result){for(var i=0;i<$scope.leftEditPhysicalItemlist.length;i++){if($scope.leftEditPhysicalItemlist[i].strDate.length<1){$scope.leftEditPhysicalItemlist[cnt].strDate=$scope.leftEditPhysicalItemlist[i].strDef}cnt++}for(var i=0;i<$scope.rightEditPhysicalItemlist.length;i++){if($scope.rightEditPhysicalItemlist[i].strDate.length<1){$scope.rightEditPhysicalItemlist[cntRight].strDate=$scope.rightEditPhysicalItemlist[i].strDef}cntRight++}}};$scope.saveInitilaPhysical=function(onTabChange){if(!isLockMine2($scope.physicalLockObj)){$scope.loadPhysicalItems("",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.physicalLockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBPhysical","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrLeftItemId=[];$scope.arrRightItemId=[];$scope.arrLeftItemValue=[];$scope.arrLeftItemComments=[];$scope.arrRightItemValue=[];$scope.arrRightItemComments=[];var eLeftId=document.getElementsByName("arPhyIdL");var eLeftval=document.getElementsByName("arPhyValueL");var eLeftcom=document.getElementsByName("arPhyComL");var eRightId=document.getElementsByName("arPhyIdR");var eRightval=document.getElementsByName("arPhyValueR");var eRightcom=document.getElementsByName("arPhyComR");for(var j=0;j<eLeftId.length;j++){$scope.arrLeftItemId[j]=eLeftId[j].value;$scope.arrLeftItemValue[j]=eLeftval[j].value;$scope.arrLeftItemComments[j]=eLeftcom[j].value}for(var k=0;k<eRightId.length;k++){$scope.arrRightItemId[k]=eRightId[k].value;$scope.arrRightItemValue[k]=eRightval[k].value;$scope.arrRightItemComments[k]=eRightcom[k].value}PregnancyDataServices.setPhysciaData($scope.pregId,$scope.encounterId,$scope.arrLeftItemId,$scope.arrLeftItemValue,$scope.arrLeftItemComments,$scope.arrRightItemId,$scope.arrRightItemValue,$scope.arrRightItemComments,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"OBF Initial Physical",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPhysicalItems("",'editMode');$scope.loadFlowSheetData("","",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking Physical, Please try after some time")})}else{$scope.loadPhysicalItems("",'editMode');$scope.loadFlowSheetData("","",'editMode')}$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName);$scope.chkLock=false}).error(function(){ecwAlert("Internal Error occured while saving Physical, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.physicalLockObj)}else{$scope.releaseLockPopup($scope.physicalLockObj)}};$scope.lockPhysical=function(){$scope.chkLock=true;$scope.saveInitilaPhysical()};$scope.unLockPhysical=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"OBF Initial Physical",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPhysicalItems("",'editMode');$scope.releaseLockPopup($scope.physicalLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking Physical, Please try after some time")})};$scope.releasePhysicalConcurLock=function(){if($scope.physicalLockObj){$scope.releaseLockPopup($scope.physicalLockObj)}};$scope.EnableEditMode=function(){$scope.isDefault=true};$scope.editOption=function(obj){$('#'+obj).css('display','none');$('#x'+obj).val($('#'+obj).text()).css('display','').focus()};$scope.resetOption=function(obj){$('#x'+obj).css('display','none');$('#'+obj).text($('#x'+obj).val()).css('display','')};$scope.customPopupSectionsArray=['Past Results:','Immunizations:','Therapeutic Injections:','Dental Examination/Plan:'];$scope.customPopupClassesArray=['lablink','xraylink','ProcedureReportlink','ImmLink','InjLink','assessmentlink','Referral'];$scope.modalInstanceSectionArray=['Lab Reports:','Diagnostic Imaging:'];$scope.loadProgressNotePopup=function(pnSectionName,categoryId,notes,propId,propName,className){$scope.popupurl={value:""};$scope.loadProgressNote(pnSectionName,categoryId,notes,propId,propName,className)};var checkPermissionForPNLinks=function(pnSectionName){var ispermittedlink=true;switch(pnSectionName){case"HPI:":case GetCaptionForSoapItem("HPI")+":":if(hpiAccess10e==="false"){ispermittedlink=false}break;case"ROS:":case GetCaptionForSoapItem("ROS")+":":if(rosAccess10e==="false"){ispermittedlink=false}break;case"Physical Examination:":case GetCaptionForSoapItem("Physical Examination")+":":if(physicalExamAccess10e==="false"){ispermittedlink=false}break;case"Procedures:":case GetCaptionForSoapItem("Procedures")+":":if(procedureAccess10e==="false"){ispermittedlink=false}break;case"Examination:":case GetCaptionForSoapItem("Examination")+":":if(examAccess10e==="false"){ispermittedlink=false}break;case"Assessment:":if(assessmentAccess10e==="false"){ispermittedlink=false}break;default:ispermittedlink=true}return ispermittedlink};function loadPnModalByDirective(popupData,categoryId){if(popupData.modulename==='hpi'){let firstCatItem;let hpi_localstorage=getImprovedHPICategoryData();if(!categoryId){firstCatItem=getFirstTreeItem(hpi_localstorage)}firstCatItem=firstCatItem||{id:'',label:''};$scope.hpiModal=new HpiModalDetails;$scope.hpiModal.categoryId=categoryId||0;$scope.hpiModal.defaultCategoryId=firstCatItem.id;$scope.hpiModal.defaultCategoryLabel=firstCatItem.label;$scope.hpiModal.parentId=hpi_localstorage[0].parentId;$scope.sectionToLoadByDirective.name='HPI'}else if(popupData.modulename==='examination'){let firstCatItem;let defaultExamId;let exam_localstorage=getExaminationCategory();if(!categoryId){firstCatItem=getFirstTreeItem(exam_localstorage);defaultExamId=getItemKeyValue("DefaultExamId",true)}firstCatItem=firstCatItem||{id:'',label:''};defaultExamId=defaultExamId||0;$scope.examModal=new ExamModalDetails;$scope.examModal.categoryId=categoryId||0;$scope.examModal.defaultCategoryId=firstCatItem.id;$scope.examModal.defaultCategoryLabel=firstCatItem.label;$scope.examModal.parentId=exam_localstorage[0].parentId;$scope.examModal.defaultExamId=defaultExamId;$scope.examModal.virtualVisit='';$scope.sectionToLoadByDirective.name='Exam'}}function HpiModalDetails(){this.categoryId=0;this.parentId=0;this.defaultCategoryId=0;this.defaultCategoryLabel=''}function ExamModalDetails(){this.categoryId=0;this.defaultCategoryId=0;this.defaultCategoryLabel='';this.parentId=0;this.defaultExamId=0;this.virtualVisit=''}function emptyHpiModalDetails(){$scope.hpiModal={}}function emptyExaminationModalDetails(){$scope.examModal={}}function emptyPnModalComponentDetails(){$scope.popupurl.value='';$scope.sectionToLoadByDirective.name='';emptyHpiModalDetails();emptyExaminationModalDetails()}$scope.loadProgressNote=function(pnSectionName,categoryId,notes,propId,propName,className){$scope.attribute=pnSectionName;$scope.clsName=className;var isPermitted=checkPermissionForPNLinks(pnSectionName);if(isPermitted){if(pnSectionName=="Callback History:"){return}if(categoryId=='Visit Code:'||categoryId=='Procedure Codes:'||!$scope.requiresCustomModal(pnSectionName,className)&&!$scope.requiresModalInstance(pnSectionName,className)){if(!$scope.loadPNFlag.enable){$scope.loadPNFlag.enable=true;return}$scope.loadPNFlag.enable=true;var popupData=$scope.getPopupData(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime);emptyPnModalComponentDetails();$scope.pnpanel.url="";if(popupData.url==''){ecwAlert(pnSectionName+"Its under development. Please contact eclinicalworks support for more details.");return}$ocLazyLoad.load({name:'pnModalApp',files:['/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModalController.js'],cache:true}).then(function(){$scope.pnpanel.url='/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModal.jsp?encounterId='+$scope.encounterId;if(popupData.url===LOAD_BY_DIRECTIVE){$ocLazyLoad.load({name:popupData.modulename,serie:true,files:popupData.dependencies}).then(function(){$timeout(function(){$("#pn").modal('show');$("#pnstyleloader").show();loadPnModalByDirective(popupData,categoryId)},0)},function(e){ecwAlert("Sorry! We could not load the requested module:"+popupData.modulename)})}else{$("#pn").modal('show');$("#pnstyleloader").show();$scope.ocLazyLoadPopup(popupData,"")}},function(e){ecwAlert(e)})}else if($scope.requiresModalInstance(pnSectionName,className)){$scope.openModalInstance(pnSectionName,className)}else{$scope.isReferralSection=pnSectionName==="Referral:"?true:false;var popupData=$scope.getPopupData(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime);if($scope.isReferralSection==true){PSACService.checkBothStaffAndChartPermission($scope.patientId,$scope.encounterId,"","",function(data){$scope.ocLazyLoadPopup(popupData,"Referral")},function(data){})}else{$scope.ocLazyLoadPopup(popupData,"custom")}}}else{ecwAlert("Permission denied")}};$scope.requiresCustomModal=function(pnSectionName,pnClassName){for(var i=0;i<$scope.customPopupSectionsArray.length;i++){if($scope.customPopupSectionsArray[i]==pnSectionName){return true}}for(var i=0;i<$scope.customPopupClassesArray.length;i++){if($scope.customPopupClassesArray[i]==pnClassName){return true}}return false};$scope.requiresModalInstance=function(pnSectionName,pnClassName){for(var i=0;i<$scope.modalInstanceSectionArray.length;i++){if($scope.modalInstanceSectionArray[i]==pnSectionName){return true}}return false};$scope.openModalInstance=function(sectionName,className){if(className&&className.length>0){}else{switch(sectionName){case'Lab Reports:':var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:0,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp"),controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){},function(responseObj){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")})});break;case'Diagnostic Imaging:':var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:1,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp"),controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){},function(responseObj){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")})});break;case'Procedure Orders:':var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:3,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp"),controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){},function(responseObj){refreshDashboard($scope.encounterId,$scope.patientId,"progressNote","")})});break;case'Audiology':var url="/mobiledoc/jsp/webemr/devices/NewAudiologyWorkFlow.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;$ocLazyLoad.load({name:'audiologyModule',files:['/mobiledoc/jsp/webemr/devices/AudiologyWebController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'audiology',backdrop:"static"});modalInstance.result.then(function(){$templateCache.remove(url)},function(e){$templateCache.remove(url);console.log(e)})});break;case'Disposition & Communication:':var dataObj={encId:$scope.encounterId,patientId:$scope.patientId};var url="/mobiledoc/jsp/webemr/progressnotes/dispositioncommunication/dispCommunication.jsp";$ocLazyLoad.load({name:'dispositionModule',files:['/mobiledoc/jsp/webemr/progressnotes/dispositioncommunication/dispCommController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'dispositionCtrl',backdrop:"static",resolve:{dataObj:function(){return dataObj}}});modalInstance.result.then(function(){$templateCache.remove(url)},function(e){$templateCache.remove(url)})})}}};$scope.CheckIfDeviceItemConfigured=function(reportId){var ChekcConfiguredFlag=false;$.ajax({url:makeURL('/mobiledoc/jsp/devices/IsDeviceItemConfigured.jsp?reportid='+reportId+"&itemid=0&context=webemr"),type:"POST",cache:false,dataType:"XML","async":false,success:function(xml){var DeviceDataXml=(new XMLSerializer).serializeToString(xml);var jsonData=obflowmainx2js.xml_str2json($.trim(DeviceDataXml));var DeviceData=jsonData.Envelope.Body['return'].DeviceConfig;if(!angular.isUndefined(DeviceData.DeviceName)&&DeviceData.DeviceName!=""){if(DeviceData.DeviceName.toLowerCase()=="clinitek"||DeviceData.DeviceName.toLowerCase()=="celldyn"){ChekcConfiguredFlag=false}else{ChekcConfiguredFlag=true}}else{ChekcConfiguredFlag=false}}});return ChekcConfiguredFlag};function popupData(modulename,dependencies,url){this.modulename=modulename;this.dependencies=dependencies;this.url=url}$scope.getPopupData=function(pnSectionName,categoryId,notes,propId,propName,className,encDate,encTime){var data=new popupData;var url="";var module="";if(className=='PastOrderLink'){if(propName=='0'){className='lablink'}else if(propName=='1'){className='xraylink'}else if(propName=='3'){className='ProcedureReportlink'}}if(className&&className.length>0){switch(className){case"lablink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=['/mobiledoc/jsp/webemr/devices/DeviceWebController.js','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/js/clearbutton/clearUndoButton.js','/mobiledoc/jsp/webemr/templates/notes-tpl.js','/mobiledoc/jsp/webemr/js/ui-grid.min.js','/mobiledoc/jsp/webemr/css/ui-grid.min.css','/mobiledoc/jsp/webemr/devices/css/deviceReportModule.css'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=0&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}break;case"xraylink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=['/mobiledoc/jsp/webemr/devices/DeviceWebController.js','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/js/clearbutton/clearUndoButton.js','/mobiledoc/jsp/webemr/templates/notes-tpl.js','/mobiledoc/jsp/webemr/js/ui-grid.min.js','/mobiledoc/jsp/webemr/css/ui-grid.min.css','/mobiledoc/jsp/webemr/devices/css/deviceReportModule.css'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=1&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}break;case"ProcedureReportlink":if($scope.CheckIfDeviceItemConfigured(categoryId)){module="devicemodule";url="/mobiledoc/jsp/webemr/devices/DeviceScreenNewWeb.jsp?TrUserId="+$scope.userId+"&encid="+$scope.encounterId+"&ReportID="+categoryId+"&PtId="+$scope.patientId+"&callingFrom=progressnotes";var files=['/mobiledoc/jsp/webemr/devices/DeviceWebController.js','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/js/clearbutton/clearUndoButton.js','/mobiledoc/jsp/webemr/templates/notes-tpl.js','/mobiledoc/jsp/webemr/js/ui-grid.min.js','/mobiledoc/jsp/webemr/css/ui-grid.min.css','/mobiledoc/jsp/webemr/devices/css/deviceReportModule.css'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}else{module="labreport";url='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+categoryId+'&Type=3&EncounterId='+$scope.encounterId+'&patientId='+$scope.patientId+'&ProviderId='+$scope.userId+"&context=PROGRESS_NOTES";var files=getDependencies('labreport');url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module}break;case"ImmLink":module="addImmInj";url='/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationDetails.jsp?context=progressnotes&patientId='+$scope.patientId+'&nImmInjType=1&ImmId='+categoryId+'&nEncId='+$scope.encounterId+'&immSeriesId=0&ProviderId=0&TrUserId='+$scope.userId+'&rowIndex=0';var files=getDependencies('infoAlert').concat(['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/labs/immunizations/js/ImmunizationDetailsController.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js','/mobiledoc/jsp/webemr/layout/css/bootbox.css','/mobiledoc/jsp/webemr/labs/immunizations/js/LotNumberController.js','/mobiledoc/jsp/webemr/commonSendScreen/css/concurrencyAlerts.css','/mobiledoc/jsp/webemr/js/concurrency/concurrencyAlertProvider.js']);url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"InjLink":module="addImmInj";url='/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationDetails.jsp?context=progressnotes&patientId='+$scope.patientId+'&nImmInjType=2&ImmId='+categoryId+'&nEncId='+$scope.encounterId+'&immSeriesId=0&ProviderId=0&TrUserId='+$scope.userId+'&rowIndex=0';var files=getDependencies('infoAlert').concat(['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/labs/immunizations/js/ImmunizationDetailsController.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js','/mobiledoc/jsp/webemr/commonSendScreen/css/concurrencyAlerts.css','/mobiledoc/jsp/webemr/js/concurrency/concurrencyAlertProvider.js']);url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"assessmentlink":var assessment=[];if(categoryId.indexOf(" - ")>0){assessment=categoryId.split(" - ");url="/mobiledoc/jsp/webemr/progressnotes/ecwrx/currMedWeb/getRecommendationRx.jsp?assmtName="+assessment[0]+"&icd="+assessment[1]+"&encounterId="+params.pnencid+"&TrUserId="+params.TrUserId+"&patientId="+params.ptId}break;case"Referral":var params={refId:categoryId,patientId:$scope.patientId,encounterId:$scope.encounterId,referralType:"Outgoing",callingFrom:'ProgressNote'};params=$.param(params);module="referralPopUpApp";var files=['/mobiledoc/jsp/webemr/jellybean/patientrecord/commanP2PService.js','/mobiledoc/jsp/webemr/jellybean/referral/referralPopupController.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/webemr/templates/cpt-tpl.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/ICD_Treatment.js'];url="/mobiledoc/jsp/webemr/jellybean/referral/referralPopup.jsp?"+params;data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"actionlink":var params={ActionId:categoryId,patientId:$scope.patientId,ms:(new Date).getTime()};params=$.param(params);module="actionsDetailViewApp";var files=['/mobiledoc/jsp/webemr/lookup/lookup.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js','/mobiledoc/jsp/webemr/templates/structuredata-tpl.js','/mobiledoc/jsp/webemr/js/xeditable.min.js','/mobiledoc/jsp/webemr/css/xeditable.css','/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.js'];url="/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.jsp?"+params;data.url=makeURL(url);data.dependencies=files;data.modulename=module;break}}else{$scope.pn_popup_width=960;$scope.pn_popup_height=630;switch(pnSectionName){case"HPI:":case GetCaptionForSoapItem("HPI")+":":var hpi_localstorage=getHPICategory();var files=[];if(propId){module="hpinotes";url="/mobiledoc/jsp/webemr/progressnotes/hpi/hpinotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=hpi_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;files=['/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js','/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js']}else{module="hpi";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.modulename=module;break;case"ROS:":case GetCaptionForSoapItem("ROS")+":":if(propId){module="rosproperties";url="/mobiledoc/jsp/webemr/progressnotes/ros/rosNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="ros";url="/mobiledoc/jsp/webemr/progressnotes/ros/ros.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var treeJSON=getROSCategory();var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}url=url+"&defaultCategoryId="+categoryIdValue+"&parentId="+parentIdValue}}var files=['/mobiledoc/jsp/webemr/progressnotes/ros/roscontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Surgical History:":module="hospitalization";url="/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/surgicalHistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;url=url+"&surgicalHxChanged="+sectionAlreadyChanged.surgicalChanged;url=url+"&hospHxChanged="+sectionAlreadyChanged.hospChanged;var files=['/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/hospitalizationController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Hospitalization:":module="hospitalization";url="/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/surgicalHistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;url=url+"&surgicalHxChanged="+sectionAlreadyChanged.surgicalChanged;url=url+"&hospHxChanged="+sectionAlreadyChanged.hospChanged;var files=['/mobiledoc/jsp/webemr/progressnotes/surgicalHistory/hospitalizationController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Gyn History:":case GetCaptionForSoapItem("Gyn History")+":":module="gynob";url="/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobhistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=gyn&isGAchange=yes";if(sectionAlreadyChanged&&sectionAlreadyChanged.obHxChanged){url=url+"&obHxChanged="+sectionAlreadyChanged.obHxChanged}if(sectionAlreadyChanged&&sectionAlreadyChanged.gynHxChanged){url=url+"&gynHxChanged="+sectionAlreadyChanged.gynHxChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Physical Examination:":case GetCaptionForSoapItem("Physical Examination")+":":if(propId){module="notesAndProperties";url="/mobiledoc/jsp/webemr/progressnotes/common3/commonNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&section=PhysicalExamination";url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=PhysicalExamination";var treeJSON=getCommonCategory("PhysicalExamination");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"OB History:":case GetCaptionForSoapItem("OB History")+":":module="gynob";url="/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobhistory.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=ob&isGAchange=yes";if(sectionAlreadyChanged&&sectionAlreadyChanged.obHxChanged){url=url+"&obHxChanged="+sectionAlreadyChanged.obHxChanged}if(sectionAlreadyChanged&&sectionAlreadyChanged.gynHxChanged){url=url+"&gynHxChanged="+sectionAlreadyChanged.gynHxChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/gynobhistory/gynobController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Physical Therapy Assessment:":module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=physicaltherapy";var treeJSON=getCommonCategory("TherapyAssessment");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue;var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Preventive Medicine:":module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=PreventiveMedecine";var treeJSON=getCommonCategory("PreventiveMedecine");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue;var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Procedures:":case GetCaptionForSoapItem("Procedures")+":":if(propId){module="notesAndProperties";url="/mobiledoc/jsp/webemr/progressnotes/common3/commonNotesAndProperties.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&section=Procedures";url=url+"&categoryId="+categoryId;url=url+"&itemId="+propId}else{module="common";url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=Procedures";var treeJSON=getCommonCategory("Procedure");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Social History:":case GetCaptionForSoapItem("Social History")+":":module="common";var isTreeEnabled=getItemKeyValue("ShowTreeInSocialHistory",true);url="/mobiledoc/jsp/webemr/progressnotes/common3/common.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId+"&section=SocialHistory"+"&treeEnabled="+isTreeEnabled;if(isTreeEnabled=="1"){var treeJSON=getCommonCategory("SocialHistory");var categoryIdValue='0';var parentIdValue='0';if(categoryId){categoryIdValue=categoryId;for(i in treeJSON){if(treeJSON[i].id==categoryId){parentIdValue=treeJSON[i].parentId;break}}}else{if(treeJSON&&treeJSON.length!==0){categoryIdValue=treeJSON[0].id;parentIdValue=treeJSON[0].parentId}}url=url+"&categoryId="+categoryIdValue+"&parentId="+parentIdValue}else{var categoryIdValue=getItemKeyValue("SocialHistory",true);url=url+"&categoryId="+categoryIdValue+"&parentId=0"}if(sectionAlreadyChanged&&sectionAlreadyChanged.socialChanged){url=url+"&socialhxChanged="+sectionAlreadyChanged.socialChanged}var files=getDependencies('reportWriterDetailsConfig').concat(['/mobiledoc/jsp/webemr/progressnotes/common3/commonController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/templates/spellCheck-tpl.js']);data.url=url;data.dependencies=files;data.modulename=module;break;case"Therapeutic Interventions:":case GetCaptionForSoapItem("Therapeutic")+":":module="therapeuticintervention";var tidata_localstorage=getTherapyInterventionCategory();var firstCatItemid=getFirstTreeItem(tidata_localstorage);url="/mobiledoc/jsp/webemr/progressnotes/therapeutic/therapeuticlayout.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&Id="+firstCatItemid.id;var files=['/mobiledoc/jsp/webemr/progressnotes/therapeutic/therapeuticlayoutcontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Dermatology Examination:":module="dermatologyModal";var enc={"name":encObj.name,"encFormattdDate":encObj.encFormattdDate,"encFormattdDate":encObj.encFormattdDate,"visitType":encObj.visitType};enc=escape(JSON.stringify(enc));url="/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.jsp?action=step1&encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&enc="+enc;var files=['/mobiledoc/jsp/webemr/progressnotes/derm/derm-container.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Imaging Studies:":module="imagingStudiesModule";url="/mobiledoc/jsp/webemr/progressnotes/imagingstudies/ImagingStudies.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/imagingstudies/js/imagingStudiesCtr.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Examination:":case GetCaptionForSoapItem("Examination")+":":var examination_localstorage=getExaminationCategory();var files=[];if(propId){module="examinationnotes";url="/mobiledoc/jsp/webemr/progressnotes/examination/examinationnotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=examination_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/examination/examinationcontroller.js']}else{module="examination";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.modulename=module;break;case"Allergies/Intolerance:":case GetCaptionForSoapItem("Allergies")+":":module="medicalhistory";url="/mobiledoc/jsp/webemr/progressnotes/medicalhistory/medicalhistory.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&encDate="+encDate+"&keyName=Rx"+"&parentName=frmHistory";url=url+"&medicalHxChanged="+sectionAlreadyChanged.medicalChanged;url=url+"&allergyHxChanged="+sectionAlreadyChanged.allergyChanged;var files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js','/mobiledoc/jsp/webemr/progressnotes/medicalhistory/medicalhistorycontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Medical History:":case GetCaptionForSoapItem("Medical History")+":":module="medicalhistory";url="/mobiledoc/jsp/webemr/progressnotes/medicalhistory/medicalhistory.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&encDate="+encDate+"&keyName=Rx"+"&parentName=frmHistory";url=url+"&medicalHxChanged="+sectionAlreadyChanged.medicalChanged;url=url+"&allergyHxChanged="+sectionAlreadyChanged.allergyChanged;var files=['/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js','/mobiledoc/jsp/webemr/progressnotes/medicalhistory/medicalhistorycontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Vision Examination:":if(visionUSEnable){module="visionModule";url="/mobiledoc/jsp/webemr/progressnotes/visionexam/visionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&tabId="+categoryId;var files=['/mobiledoc/jsp/webemr/progressnotes/visionexam/visionController.js'];data.url=url;data.dependencies=files;data.modulename=module}else{module="visionexamination";url="/mobiledoc/jsp/webemr/progressnotes/vision/VisionExamination.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/clickThrough/struct-keyword-tpl.js','/mobiledoc/jsp/webemr/progressnotes/vision/contactLensSelectionService.js','/mobiledoc/jsp/webemr/progressnotes/vision/pnvision.js'];data.url=url;data.dependencies=files;data.modulename=module}break;case"Family History:":module="familyhistory";url="/mobiledoc/jsp/webemr/progressnotes/familyhistory/familyHistory.jsp?encounterId="+$scope.encounterId+"&keyName=FamilyHistory&encLock=0&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;if(sectionAlreadyChanged&&sectionAlreadyChanged.familyChanged){url=url+"&familyHxChanged="+sectionAlreadyChanged.familyChanged}var files=['/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js','/mobiledoc/jsp/webemr/progressnotes/familyhistory/familyHxCtrl.js','/mobiledoc/jsp/webemr/snomedmapservice/js/mapSnomedToIcdService.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Chief Complaint(s):":case"CC":case GetCaptionForSoapItem("CC")+":":module="chiefcomplaints";url="/mobiledoc/jsp/webemr/progressnotes/chiefcomplaint/chiefComplaints.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/chiefcomplaint/CCController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Current Medication:":module="medRec";url="/mobiledoc/jsp/webemr/progressnotes/ecwrx/currMedWeb/medReconciliation.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/ecwrx/js/medRec.js','/mobiledoc/jsp/webemr/js/QuickOrderSearchDirective.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js','/mobiledoc/jsp/webemr/jellybean/refillrequest/showMessageBoxDirective.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/js/RxHelper.js','/mobiledoc/jsp/webemr/js/jquery-ui-timepicker-addon.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Vitals:":case GetCaptionForSoapItem("Vitals")+":":module="vitals";url="/mobiledoc/jsp/webemr/progressnotes/vitals/vitals.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/vitals/vitalscontroller.js','/mobiledoc/jsp/webemr/js/confTimeline.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Treatments:":case"Treatment:":case GetCaptionForSoapItem("Treatment")+":":module="TreatmentApp";PNService.setParametersForScreen("treatment",{encounterId:$scope.encounterId,patientId:$scope.patientId,userId:$scope.userId,normalView:1,CorrectionalEnabled:false});url="/mobiledoc/jsp/webemr/progressnotes/treatment/treatment.jsp?nts";var files=['/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.css','/mobiledoc/jsp/webemr/js/alertprompt/ordersAlertPrompt.js','/mobiledoc/jsp/pama/js/aucDirective.js','/mobiledoc/jsp/webemr/progressnotes/treatment/js/treatment.js','/mobiledoc/jsp/webemr/progressnotes/treatment/css/treatment.css','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js'].concat(getDependencies('pama'));data.url=url;data.dependencies=files;data.modulename=module;break;case"eMAR:":case GetCaptionForSoapItem("eMAR")+":":module="asceMARApp";url="/mobiledoc/jsp/webemr/progressnotes/eMAR/opeMAR.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+$scope.userId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime();var files=['/mobiledoc/jsp/webemr/progressnotes/eMAR/js/opeMAR.js','/mobiledoc/jsp/webemr/labs/util/LabUtilities.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Immunizations:":module="ImmInjHxApp";url="/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?contextVar=progressnote&nImmInjType=1&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+$scope.userId+"&nd="+(new Date).getTime();var files=getDependencies('ImmInjHxApp');data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Therapeutic Injections:":module="ImmInjHxApp";url="/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?contextVar=progressnote&nImmInjType=2&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+$scope.userId+"&nd="+(new Date).getTime();var files=getDependencies('ImmInjHxApp');data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Next Appointment:":case"Visit Code:":case"Procedure Codes:":case"Billing:":module="billing";url="/mobiledoc/jsp/webemr/progressnotes/billing/billing.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId+"&encDate="+encDate;var files=['/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Dental History:":var encProviderId=null;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){encProviderId=EncDetailsService.getEncDetails().providerId}module="dentalHistory";url="/mobiledoc/jsp/webemr/progressnotes/dental/dentalHistory.jsp?patientId="+$scope.patientId+"&encId="+$scope.encounterId+"&encProviderId="+encProviderId;url=url+"&categoryId="+categoryId;var files=['/mobiledoc/jsp/webemr/progressnotes/dental/dentalHistoryController.js'];url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"Dental Examination/Plan:":var encProviderId=null;if(EncDetailsService.getEncDetails&&EncDetailsService.getEncDetails().providerId){encProviderId=EncDetailsService.getEncDetails().providerId}module="dental";var files=['/mobiledoc/jsp/webemr/progressnotes/dental/dental.js'];url="/mobiledoc/jsp/webemr/progressnotes/dental/dental.jsp?action=dentalExam&patientId="+$scope.patientId+"&encId="+$scope.encounterId+"&encProviderId="+encProviderId;url=makeURL(url);data.url=url;data.dependencies=files;data.modulename=module;break;case"Assessment:":module="assessment";PNService.setParametersForScreen("assessment",{encounterId:$scope.encounterId,patientId:$scope.patientId,userId:$scope.userId});url="/mobiledoc/jsp/webemr/progressnotes/assessment/assessment.jsp?nts";var files=['/mobiledoc/jsp/webemr/progressnotes/assessment/assessmentcontroller.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Past Results:":module="pastResults";url="/mobiledoc/jsp/webemr/progressnotes/pastresults/pastResults.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/pastresults/js/pastResults.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Operative Report:":if(categoryId==="Visit Code:"||categoryId==="Procedure Codes:"){var params={TrUserId:$scope.userId,encounterId:$scope.encounterId,patientId:$scope.patientId,ms:(new Date).getTime()};params=$.param(params);module="billing";url="/mobiledoc/jsp/webemr/progressnotes/billing/billing.jsp?isOV=true&"+params;var files=['/mobiledoc/jsp/webemr/progressnotes/billing/billingController.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/webemr/templates/cpt-tpl.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js']}else{module="operariveReportPNApp";url="/mobiledoc/jsp/webemr/progressnotes/operativeReport.jsp?encounterId="+$scope.encounterId+"&category="+categoryId;var files=['/mobiledoc/jsp/webemr/progressnotes/operativeReportController.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js']}data.url=makeURL(url);data.dependencies=files;data.modulename=module;$scope.pn_popup_height=570;break;case"CDSS:":case"Recommended Wellness and Prevention Guidelines:":module="alertsMainApp";url='/mobiledoc/jsp/webemr/alerts/cdss/alertsMain.jsp?launchedFrom=progressNote&patientId='+$scope.patientId+'&encounterId='+$scope.encounterId;data.url=makeURL(url);data.dependencies=getDependencies('alertsMainApp');data.modulename=module;break;case"Surgical Posting:":surgicalposting_localstorage=getSurgicalPostingCategory();if(propId){module="surgicalpostingnotes";url="/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalpostingnotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;url=url+"&propName="+propName}else{module="surgicalposting";var firstSurgCatObj=getFirstTreeItem(surgicalposting_localstorage);url="/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalposting.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&userId="+$scope.userId+"&nd="+(new Date).getTime();if(firstSurgCatObj.id){url=url+"&defaultCatId="+firstSurgCatObj.id+"&defaultCatName="+firstSurgCatObj.label}}parentIdValue=surgicalposting_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;var files=['/mobiledoc/jsp/webemr/progressnotes/surgicalposting/surgicalpostingcontroller.js','/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Care Management Assessment:":var cma_localstorage=getHPICategory();var files=[];if(propId){module="hpinotes";url="/mobiledoc/jsp/webemr/progressnotes/hpi/hpinotes.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&TrUserId="+$scope.userId;url=url+"&categoryId="+categoryId;url=url+"&propId="+propId;parentIdValue=cma_localstorage[0].parentId;url=url+"&parentId="+parentIdValue;files=['/mobiledoc/jsp/webemr/progressnotes/hpi/hpicontroller.js','/mobiledoc/jsp/webemr/templates/customitem-tpl.js','/mobiledoc/jsp/webemr/templates/customproperties-tpl.js']}else{module="hpi";url=LOAD_BY_DIRECTIVE;files=getDependencies(module)}data.url=url;data.dependencies=files;data.modulename=module;break;case"Problems:":module="carePlan";url="/mobiledoc/jsp/webemr/progressnotes/careplan/careplan_sch.jsp?OpType=GETCAREPLANENCDATA&EncId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&PtId="+$scope.patientId+"&ICD=";var files=['/mobiledoc/jsp/webemr/progressnotes/careplan/carePlanController.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Disposition:":module="disposition";url="/mobiledoc/jsp/webemr/progressnotes/disposition/disposition.jsp?encounterId="+$scope.encounterId+"&TrUserId="+$scope.userId+"&patientId="+$scope.patientId;var files=['/mobiledoc/jsp/webemr/progressnotes/disposition/dispositioncontroller.js'];data.url=url;data.dependencies=files;data.modulename=module;break;case"Pre-op. Diagnosis:":module="preOpDiagnosisApp";url="/mobiledoc/ascWeb/PnPanel.go/getPatPreOpDiagnosis/"+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/patPreOpDiagnosisCtrl.js','/mobiledoc/jsp/resources/jslib/bootbox/dist/bootbox.min.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Anesthesia Plan:":module="patAnesthesiaPlanApp";url="/mobiledoc/ascWeb/PnPanel.go/anesthesiaPlan/patAnesthesiaPlan/"+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/anesthesiaPlan/js/patAnesthesiaPlanController.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Anesthesia Details:":module="patAnesthesiaDetailsApp";var sectionName="Anesthesia Details";var sectionParams=buildParams(sectionName);url="/mobiledoc/ascWeb/PnPanel.go/Anesthesia/patAnesthesiaDetails"+sectionParams;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/js/notesService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/ipOperativeService.js','/mobiledoc/jsp/ascWeb/templates/keywords-tpl.js','/mobiledoc/jsp/ascWeb/templates/ipCapturedBy.js','/mobiledoc/jsp/ascWeb/templates/notesData-tpl.js','/mobiledoc/jsp/ascWeb/templates/examnotes-tpl.js','/mobiledoc/jsp/ascWeb/templates/structuredata-tpl.js','/mobiledoc/jsp/ascWeb/css/xeditable.css','/mobiledoc/jsp/ascWeb/templates/customitem-tpl.js','/mobiledoc/jsp/ascWeb/templates/customproperties-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/ipOperativeType/js/patAnesthesiaDetailsCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;case"Comments:":module="commentsApp";url="/mobiledoc/ascWeb/PnPanel.go/patComments?encounterId="+$scope.encounterId;var files=['/mobiledoc/jsp/ascWeb/Views/progressnotes/pnpanel/comments/js/patCommentsCtrl.js'];data.url=makeURL(url);data.dependencies=files;data.modulename=module;break;default:data.url=''}}return data};$scope.ocLazyLoadPopup=function(popupData,sectionName){var bSerie=false;if(popupData.seriesLoadFlag){bSerie=true}$ocLazyLoad.load({name:popupData.modulename,serie:bSerie,files:popupData.dependencies}).then(function(){if($scope.obPanelPopUrl){$templateCache.remove($scope.obPanelPopUrl)}$scope.obPanelPopUrl="";if(sectionName==='Referral'){$scope.obPanelPopUrl=popupData.url+"&timestamp="+(new Date).getTime()}else if(sectionName==='custom'){$scope.obPanelPopUrl=popupData.url+"&timestamp="+(new Date).getTime()}else{let popupUrl=popupData.url;if(!popupUrl.endsWith("nts")){popupUrl+="&timestamp="+(new Date).getTime()}$scope.popupurl.value=popupUrl}},function(e){ecwAlert(e);console.log(e)})};$scope.loadPNModal=function(pnSectionName){emptyPnModalComponentDetails();$scope.pnpanel.url="";$scope.attribute=pnSectionName;var popupData=$scope.getPopupData(pnSectionName,0,'',0,'','',encDate,encTime);$ocLazyLoad.load({name:'pnModalApp',files:['/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModalController.js'],cache:false}).then(function(){$scope.pnpanel.url='/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/pnModal.jsp?encounterId='+$scope.encounterId;if(popupData.url===LOAD_BY_DIRECTIVE){$ocLazyLoad.load({name:popupData.modulename,serie:true,files:popupData.dependencies}).then(function(){$timeout(function(){loadPnModalByDirective(popupData,0)},0)},function(e){ecwAlert("Sorry! We could not load the requested module:"+popupData.modulename)})}else{$scope.ocLazyLoadPopup(popupData,"")}},function(e){ecwAlert(e);console.log(e)})};$scope.loadAllHistoryData=function(allHxXml,objMode){if(objMode==='readMode'){var allHxJson=obflowmainx2js.xml_str2json(allHxXml);populateAllHistoryData(allHxJson)}else{PregnancyDataServices.getAllHistoryData($scope.pregId,$scope.encounterId,$scope.patientId).success(function(data){if(data!='undefined'){var allHxJson=(new X2JS).xml_str2json(data);populateAllHistoryData(allHxJson)}}).error(function(){ecwAlert("Internal Error occured while loading history data !")})}};$scope.loadMedicalHxData=function(medicalHxXml,objMode){if(objMode==='readMode'){var medicalHxJson=obflowmainx2js.xml_str2json(medicalHxXml);populateMedicalHxlData(medicalHxJson)}else{PregnancyDataServices.getMedicalHxData($scope.pregId).success(function(data){var medicalHxJson=(new X2JS).xml_str2json(data);populateMedicalHxlData(medicalHxJson)}).error(function(){ecwAlert("Internal Error occured while loading OB flowsheet history data !")})}};$scope.editMedicalHx=function(){$scope.lockObj={};$scope.medHxlockObj={};var lockObjOBHistory={formName:"frmOBHistoryHx",uniqueKey:"frmOBHistoryHx"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjOBHistory.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjOBHistory);return}}acquireFormLock(lockObjOBHistory,acquireFormLockCallBack);$scope.lockObj=lockObjOBHistory;$scope.medHxlockObj=lockObjOBHistory;$scope.PPEditFlag=false;$scope.chkLock=false;$scope.arrMedHxEditLeftItemId=[];$scope.arrMedHxEditRightItemId=[];angular.copy($scope.arrMedHxLeftItemId,$scope.arrMedHxEditLeftItemId);angular.copy($scope.arrMedHxRightItemId,$scope.arrMedHxEditRightItemId);angular.forEach($scope.arrMedHxEditRightItemId,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultHistory=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultHxValue','obpnController');$scope.setDefaultHxValue=function(result){if(result==='yes'){for(var i=0;i<$scope.arrMedHxEditLeftItemId.length;i++){if($scope.arrMedHxEditLeftItemId[i].strDef!==''){$scope.arrMedHxEditLeftItemId[cnt].strDate=$scope.arrMedHxEditLeftItemId[i].strDef}cnt++}for(var i=0;i<$scope.arrMedHxEditRightItemId.length;i++){if($scope.arrMedHxEditRightItemId[i].strDef!==''){$scope.arrMedHxEditRightItemId[cntRight].strDate=$scope.arrMedHxEditRightItemId[i].strDef}cntRight++}}}};$scope.mergeDefaultHistory=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergDefaultHxValue','obpnController');$scope.setMergDefaultHxValue=function(result){if(result==='yes'){for(var i=0;i<$scope.arrMedHxEditLeftItemId.length;i++){if($scope.arrMedHxEditLeftItemId[i].strDate.length<1){$scope.arrMedHxEditLeftItemId[cnt].strDate=$scope.arrMedHxEditLeftItemId[i].strDef}cnt++}for(var i=0;i<$scope.arrMedHxEditRightItemId.length;i++){if($scope.arrMedHxEditRightItemId[i].strDate.length<1){$scope.arrMedHxEditRightItemId[cntRight].strDate=$scope.arrMedHxEditRightItemId[i].strDef}cntRight++}}}};$scope.saveMedicalHxData=function(onTabChange){if(!isLockMine2($scope.medHxlockObj)){$scope.loadMedicalHxData("",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.medHxlockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFlowHistory","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrLeftItemId=[];$scope.arrRightItemId=[];$scope.arrLeftItemValue=[];$scope.arrLeftItemComments=[];$scope.arrRightItemValue=[];$scope.arrRightItemComments=[];var eLeftId=document.getElementsByName("arMedHxIdL");var eLeftval=document.getElementsByName("arMedHxValueL");var eLeftcom=document.getElementsByName("arMedHxComL");var eRightId=document.getElementsByName("arMedHxIdR");var eRightval=document.getElementsByName("arMedHxValueR");var eRightcom=document.getElementsByName("arMedHxComR");for(var j=0;j<eLeftId.length;j++){$scope.arrLeftItemId[j]=eLeftId[j].value;$scope.arrLeftItemValue[j]=eLeftval[j].value;$scope.arrLeftItemComments[j]=eLeftcom[j].value}for(var k=0;k<eRightId.length;k++){$scope.arrRightItemId[k]=eRightId[k].value;$scope.arrRightItemValue[k]=eRightval[k].value;$scope.arrRightItemComments[k]=eRightcom[k].value}PregnancyDataServices.setMedHxData($scope.pregId,$scope.encounterId,$scope.arrLeftItemId,$scope.arrLeftItemValue,$scope.arrLeftItemComments,$scope.arrRightItemId,$scope.arrRightItemValue,$scope.arrRightItemComments,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"MedicalHistory",$scope.userId,$scope.encounterId).success(function(data){$scope.loadMedicalHxData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while saving OB flowsheet history, Please try after some time")})}else{$scope.loadMedicalHxData("",'editMode')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving OB flowsheet history, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.medHxlockObj)}else{$scope.releaseLockPopup($scope.medHxlockObj)}};$scope.lockMedicalHx=function(){$scope.chkLock=true;$scope.saveMedicalHxData()};$scope.unLockMedicalHx=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"MedicalHistory",$scope.userId,$scope.encounterId).success(function(data){$scope.loadMedicalHxData("",'editMode');$scope.releaseLockPopup($scope.medHxlockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking Medical History, Please try after some time")})};$scope.releaseMedHxConcurLock=function(){if($scope.medHxlockObj){$scope.releaseLockPopup($scope.medHxlockObj)}};$scope.loadGeneticsData=function(genScrXml,InfHxXml,objMode){if(objMode==='readMode'){var geneticsJson=obflowmainx2js.xml_str2json(genScrXml);populateGeneticsData(geneticsJson,'first');geneticsJson=obflowmainx2js.xml_str2json(InfHxXml);populateGeneticsData(geneticsJson,'second')}else{PregnancyDataServices.getGeneticsScreeningData($scope.pregId,$scope.patientId).success(function(data){var geneticsJson=(new X2JS).xml_str2json(data);populateGeneticsData(geneticsJson,'first')}).error(function(){ecwAlert("Internal Error occured while loading genetics screening data !")});PregnancyDataServices.getGeneticsInfectionHxData($scope.pregId).success(function(data){var geneticsJson=(new X2JS).xml_str2json(data);populateGeneticsData(geneticsJson,'second')}).error(function(){ecwAlert("Internal Error occured while loading genetics infection hx data !")})}};$scope.editGeneticsData=function(){$scope.lockObj={};$scope.geneticLockObj={};var lockObjGenetics={formName:"frmOBGenetics",uniqueKey:"frmOBGenetics"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjGenetics.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjGenetics);return}}acquireFormLock(lockObjGenetics,acquireFormLockCallBack);$scope.lockObj=lockObjGenetics;$scope.geneticLockObj=lockObjGenetics;$scope.totalEditGeneticScreeningItemlist=[];$scope.totalEditInfectionHistoryItemlist=[];angular.copy($scope.totalGeneticScreeningItemlist,$scope.totalEditGeneticScreeningItemlist);angular.copy($scope.totalInfectionHistoryItemlist,$scope.totalEditInfectionHistoryItemlist);angular.forEach($scope.totalGeneticScreeningItemlist,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultGenetics=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultGeneticsValue','obpnController');$scope.setDefaultGeneticsValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditGeneticScreeningItemlist.length;i++){if($scope.totalEditGeneticScreeningItemlist[i].strDef!==''){$scope.totalEditGeneticScreeningItemlist[cnt].strDate=$scope.totalEditGeneticScreeningItemlist[i].strDef}cnt++}for(var i=0;i<$scope.totalEditInfectionHistoryItemlist.length;i++){if($scope.totalEditInfectionHistoryItemlist[i].strDef!==''){$scope.totalEditInfectionHistoryItemlist[cntRight].strDate=$scope.totalEditInfectionHistoryItemlist[i].strDef}cntRight++}}}};$scope.mergeDefaultGenetics=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergeDefaultGeneticsValue','obpnController');$scope.setMergeDefaultGeneticsValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditGeneticScreeningItemlist.length;i++){if($scope.totalEditGeneticScreeningItemlist[i].strDate.length<1){$scope.totalEditGeneticScreeningItemlist[cnt].strDate=$scope.totalEditGeneticScreeningItemlist[i].strDef}cnt++}for(var i=0;i<$scope.totalEditInfectionHistoryItemlist.length;i++){if($scope.totalEditInfectionHistoryItemlist[i].strDate.length<1){$scope.totalEditInfectionHistoryItemlist[cntRight].strDate=$scope.totalEditInfectionHistoryItemlist[i].strDef}cntRight++}}}};$scope.saveGeneticsData=function(onTabChange){if(!isLockMine2($scope.geneticLockObj)){$scope.loadGeneticsData("","",'editMode');$scope.loadPatientHeader();$scope.closePopup('obEditAddPopupWindow',$scope.geneticLockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBGenetic","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrGenticsItemId=[];$scope.arrGenticsValue=[];$scope.arrGenticsComments=[];var eletId=document.getElementsByName("argentId");var eletval=document.getElementsByName("argentValue");var eletcom=document.getElementsByName("argentCom");for(var j=0;j<eletId.length;j++){$scope.arrGenticsItemId[j]=eletId[j].value;$scope.arrGenticsValue[j]=eletval[j].value;$scope.arrGenticsComments[j]=eletcom[j].value}PregnancyDataServices.setGenticsData($scope.pregId,$scope.encounterId,$scope.arrGenticsItemId,$scope.arrGenticsValue,$scope.arrGenticsComments,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"Genetics",$scope.userId,$scope.encounterId).success(function(data){$scope.loadGeneticsData("","",'editMode');$scope.loadPatientHeader()}).error(function(){ecwAlert("Internal Error occured while saving genetics, Please try after some time")})}else{$scope.loadGeneticsData("","",'editMode');$scope.loadPatientHeader()}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving genetics, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.geneticLockObj)}else{$scope.releaseLockPopup($scope.geneticLockObj)}};$scope.lockGenetics=function(){$scope.chkLock=true;$scope.saveGeneticsData()};$scope.unLockGenetics=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"Genetics",$scope.userId,$scope.encounterId).success(function(data){$scope.loadGeneticsData("","",'editMode');$scope.releaseLockPopup($scope.geneticLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking genetics, Please try after some time")})};$scope.releaseGeneticConcurLock=function(){if($scope.geneticLockObj){$scope.releaseLockPopup($scope.geneticLockObj)}};$scope.loadProblemListData=function(obproblemXml,objMode){if(objMode==='readMode'){var obproblemltJson=obflowmainx2js.xml_str2json(obproblemXml);populateProblemListData(obproblemltJson,'obproblem')}else{PregnancyDataServices.getOBProblemListData($scope.pregId,0).success(function(data){var obproblemltJson=(new X2JS).xml_str2json(data);populateProblemListData(obproblemltJson,'obproblem')}).error(function(){ecwAlert("Internal Error occured while loading OB problemlist data !")})}};$scope.loadPtProblemListData=function(ptproblemXml,objMode){if(objMode==='readMode'){var ptProblemltJson=obflowmainx2js.xml_str2json(ptproblemXml);populateProblemListData(ptProblemltJson,'ptproblem')}else{PregnancyDataServices.getPatientProblemListData($scope.pregId,$scope.patientId).success(function(data){var ptProblemltJson=(new X2JS).xml_str2json(data);populateProblemListData(ptProblemltJson,'ptproblem')}).error(function(){ecwAlert("Internal Error occured while loading patient problemlist data !")})}};$scope.loadProblemListModal=function(){var url="/mobiledoc/jsp/webemr/rightpanel/problemList.jsp?pid="+$scope.patientId+"&encId="+$scope.encounterId+"&callFrom=OBFlowsheet";$ocLazyLoad.load({name:'problemlist',files:['/mobiledoc/jsp/webemr/js/vendor/jscrollpane.js','/mobiledoc/jsp/webemr/rightpanel/js/plListController.js','/mobiledoc/jsp/webemr/progressnotes/billing/assessmentNotes-tpl.js','/mobiledoc/jsp/resources/jslib/angular-ui-bootstrap/dist/ui-bootstrap-tpls.js','/mobiledoc/jsp/webemr/progressnotes/assessment/assessment-import-module.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'problemListController',scope:$scope,backdrop:"static"});modalInstance.result.then(function(){$templateCache.remove(url);$scope.loadPtProblemListData("",'editMode');$scope.loadCareItems("","",'editMode')},function(e){$templateCache.remove(url);$scope.loadPtProblemListData("",'editMode');$scope.loadCareItems("","",'editMode')})})};$scope.getPtProblemList=function(){};$scope.upMove=function(fromIndexId,toIndexId){PregnancyDataServices.setProblemList($scope.pregId,fromIndexId,toIndexId,"UpdateProblem").success(function(data){$scope.loadProblemListData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while moving up problem list, Please try after some time")})};$scope.downMove=function(fromIndexId,toIndexId){PregnancyDataServices.setProblemList($scope.pregId,fromIndexId,toIndexId,"UpdateProblem").success(function(data){$scope.loadProblemListData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while moving down problem list, Please try after some time")})};$scope.setOBProblem=function(strProblem,strStatus,strICDCode){var todayDate=new Date;var date=todayDate.getDate();if(date<9)date="0"+date;var month=todayDate.getMonth()+1;if(month<9)month="0"+month;var year=todayDate.getFullYear();var hours=todayDate.getHours();var ampm=hours>=12?'PM':'AM';var timeZone=todayDate.getTimezoneOffset();var minutes=todayDate.getMinutes();var seconds=todayDate.getSeconds();var currentTimeandDate=month+"/"+date+"/"+year+" "+todayDate.toTimeString();currentTimeandDate=currentTimeandDate.split("GMT")[0];currentTimeandDate=currentTimeandDate+"EDT";var currentDate=month+"/"+date+"/"+year;var ptProblem=document.getElementsByName("strProblem");$scope.isFound=false;for(var j=0;j<ptProblem.length;j++){if(ptProblem[j].value!=null&&ptProblem[j].value!=undefined){if(strProblem!=null&&strProblem!=undefined&&ptProblem[j].value!=null&&ptProblem[j].value!=undefined&&ptProblem[j].value==strProblem){$scope.isFound=true;ecwAlert('Problem List already add in OB Problems');break}}}if($scope.isFound==false){$http({method:"GET",url:'/mobiledoc/jsp/obfacog/save_obf_care_Data.jsp',cache:false,params:{pregid:$scope.pregId,encid:$scope.encounterId,pid:$scope.patientId,txtPl:strProblem,txtPlStatus:strStatus,txtPlICD:strICDCode,currentTime:currentTimeandDate,currentDt:currentDate,hNA:11,TrUserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadProblemListData("",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName);$scope.loadPatientHeader()}).error(function(data,status,headers,config){ecwAlert("Error adding Problem to OB Problem")})}};$scope.setTimeStamp=function(eleId){var timeSt=$('#'+eleId).val();let timestampValue=getNotesTimeStamp();if(timeSt==''||timeSt==='undefined'){$('#'+eleId).val(timestampValue)}else{var total=timeSt+"\n"+timestampValue;$('#'+eleId).val(total)}};$scope.saveOBProblem=function(ProblemId){if(ProblemId>0&&!isLockMine2($scope.lockObjOBProblemList)){$scope.loadProblemListData("",'editMode');$scope.loadPatientHeader();$scope.closePopup('obEditproblem',$scope.lockObjOBProblemList);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBProblem","obEditproblem","bluetheme");if(!doCheck){$scope.chkLock=false;return false}var plans=$('#obflowsheettimestmp').val();var problem=$('#obflowsheetplproblems').val();$scope.totalEditProblemList.strPlan=plans;$scope.totalEditProblemList.strProblem=problem;PregnancyDataServices.setOBProblemData($scope.pregId,$scope.encounterId,ProblemId,$scope.totalEditProblemList,$scope.userName).success(function(data){$scope.loadProblemListData("",'editMode');$scope.loadPatientHeader();$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving problem, Please try after some time")});$scope.closePopup('obEditproblem',$scope.lockObjOBProblemList)};$scope.updateProblem=function(objId){$scope.lockObj={};$scope.lockObjOBProblemList={};var lockObjOBProblem="";if(objId>0){lockObjOBProblem={formName:"frmOBProblemList",uniqueKey:"frmOBProblemList"+$scope.pregId,g_cancel:false,strKey:"",categoryId:objId,isOpenform:false};function acquireFormLockCallBack(){if(lockObjOBProblem.g_cancel){$scope.closePopup('obEditproblem',lockObjOBProblem);return}}acquireFormLock(lockObjOBProblem,acquireFormLockCallBack)}$scope.lockObj=lockObjOBProblem;$scope.lockObjOBProblemList=lockObjOBProblem;if(objId<=0){$scope.totalEditProblemList={strProbId:'0',strCreatedDate:'',strProblem:'',strPlan:'',strCreatedBy:'',strStatus:'',strInitials:'',strLock:''};var today=new Date;var dd=today.getDate();var mm=today.getMonth()+1;var yyyy=today.getFullYear();if(dd<10){dd='0'+dd}if(mm<10){mm='0'+mm}var today=mm+'/'+dd+'/'+yyyy;$scope.totalEditProblemList.strCreatedDate=today}else{$scope.totalEditProblemList=[];PregnancyDataServices.getOBProblemListData($scope.pregId,objId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].encounter;$scope.totalEditProblemList=value}).error(function(){ecwAlert("Internal Error occured while saving OB problemlist data !")})}$scope.loadProblemsEditPopup()};$scope.loadProblemsEditPopup=function(){$templateCache.remove($scope.obPanelPopUrl);$scope.obPanelPopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPanelPopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=Problems"},function(e){console.log(e);$templateCache.remove($scope.obPanelPopUrl)})};$scope.deleteProblem=function(objId,index){if(!isLockMine2($scope.lockObjOBProblemList)){$scope.loadProblemListData("",'editMode');$scope.closePopup('obEditproblem',$scope.lockObjOBProblemList);return false}showAlertMessage("Are you sure you want to delete this problem ?",'','ConfirmMsg','setDeleteOBProblem','obpnController');$scope.setDeleteOBProblem=function(result){if(result==='yes'){PregnancyDataServices.deletePregnancyData($scope.pregId,$scope.patientId,objId,"Problem",$scope.userId,$scope.encounterId).success(function(data){$scope.closePopup('obEditproblem',$scope.lockObjOBProblemList);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName);$scope.loadProblemListData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while deleting problem, Please try after some time")})}}};$scope.lockUnlockProblem=function(objId,lvalue){var msg;if(lvalue==1){msg='Are you sure you want to lock this problem?'}else{msg='Are you sure you want to unLock this problem?'}showAlertMessage(msg,'','ConfirmMsg','setlockUnlockProblem','obpnController');$scope.setlockUnlockProblem=function(result){if(result==='yes'){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:objId,keyName:'OBF Problem',lockValue:lvalue,itemValue:'',ItemId:0,TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadProblemListData("",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){ecwAlert("Error in locking OB problem.")})}}};$scope.loadPastPregnancy=function(pastPregXml,pastPregDataXml,objMode){$scope.totalPastPreglist=[];if(objMode==='readMode'){var preglistItemJson=obflowmainx2js.xml_str2json(pastPregXml);$scope.totalPastPregItemlist=preglistItemJson.Envelope.Body["return"].encounter;var preglistDataJson=obflowmainx2js.xml_str2json(pastPregDataXml);populatePastPregnancyData(preglistDataJson)}else{PregnancyDataServices.getPastPregnancyItemlist($scope.pregId).success(function(data){var preglistItemJson=(new X2JS).xml_str2json(data);$scope.totalPastPregItemlist=preglistItemJson.Envelope.Body["return"].encounter}).error(function(){ecwAlert("Internal Error occured while loading pastpregnancy details data !")});PregnancyDataServices.getPastPregnancyData($scope.pregId,$scope.patientId,$scope.encounterId).success(function(data){var preglistDataJson=(new X2JS).xml_str2json(data);var value=preglistDataJson.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.totalPastPreglist=value}else{$scope.totalPastPreglist.push(value)}}}).error(function(){ecwAlert("Internal Error occured while loading pastpregnancy details data !")})}$scope.keys=function(obj){return obj?Object.keys(obj):[]}};$scope.editPastPregnancy=function(pastpregId){$scope.lockObj={};$scope.lockPastPreg={};var lockObjPastPreg={formName:"frmOBPastPregnancy",uniqueKey:"frmOBPastPregnancy"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjPastPreg.g_cancel){$scope.closePopup('editPastPreg',lockObjPastPreg);return}}acquireFormLock(lockObjPastPreg,acquireFormLockCallBack);$scope.lockObj=lockObjPastPreg;$scope.lockPastPreg=lockObjPastPreg;$templateCache.remove($scope.obPanelPopUrl);$scope.PPCloseFlag=false;$scope.ppId=pastpregId;$scope.obPanelPopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPanelPopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=PastPregnancy&randomId="+Math.random()},function(e){console.log(e);$templateCache.remove($scope.obPanelPopUrl)});$scope.totalEditPastPreglist=[];PregnancyDataServices.getPastPreg($scope.pregId,$scope.patientId,pastpregId).success(function(data){var ppJson=(new X2JS).xml_str2json(data);var value=ppJson.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.totalEditPastPreglist=value}else{$scope.totalEditPastPreglist.push(value)}}}).error(function(){ecwAlert("Internal Error occured while loading pastpregnancy details data !")})};$scope.savePastPreg=function(){if(!isLockMine2($scope.lockPastPreg)){$scope.loadPastPregnancy("","",'editMode');$scope.closePopup('editPastPreg',$scope.lockPastPreg);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBPastPregnancy","editPastPreg","bluetheme");if(!doCheck){return false}$scope.arrPastPregId=[];$scope.arrPastPregValue=[];var eletId=document.getElementsByName("arPPId");var eletval=document.getElementsByName("arPPValue");for(var j=0;j<eletId.length;j++){$scope.arrPastPregId[j]=eletId[j].value;$scope.arrPastPregValue[j]=eletval[j].value}PregnancyDataServices.setPastPregnancy($scope.pregId,$scope.patientId,$scope.encounterId,$scope.arrPastPregId,$scope.arrPastPregValue,$scope.ppId,$scope.userId).success(function(data){$scope.loadPastPregnancy("","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving past pregnancy, Please try after some time")});$scope.closePopup('editPastPreg',$scope.lockPastPreg)};$scope.deletePastPreg=function(ppId,index){var msg='Are you sure you want to delete this past pregnancy?';showAlertMessage(msg,'','ConfirmMsg','setDeletePastPreg','obpnController');$scope.setDeletePastPreg=function(result){if(result==='yes'){PregnancyDataServices.deletePregnancyData($scope.pregId,$scope.patientId,ppId,"PP",$scope.userId,$scope.encounterId).success(function(data){$scope.totalPastPreglist.splice(index,1);$scope.closePopup('editPastPreg',$scope.lockPastPreg);$scope.loadPastPregnancy("","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while deleting past pregnancy, Please try after some time")})}}};$scope.loadFormAData=function(prevPregXml,mensHxXml,objMode){if(objMode==='readMode'){var previousPregDataJson=obflowmainx2js.xml_str2json(prevPregXml);populateFormAPreviousPregData(previousPregDataJson);var mentrualhxDataJson=obflowmainx2js.xml_str2json(mensHxXml);populateFormAMenstrualHxData(mentrualhxDataJson)}else{PregnancyDataServices.getFormAPreviousPregnancyData($scope.pregId).success(function(data){var previousPregDataJson=(new X2JS).xml_str2json(data);populateFormAPreviousPregData(previousPregDataJson)}).error(function(){ecwAlert("Internal Error occured while loading previous pregnancy data !")});PregnancyDataServices.getFormAMenstrualHistoryData($scope.pregId).success(function(data){var mentrualhxDataJson=(new X2JS).xml_str2json(data);populateFormAMenstrualHxData(mentrualhxDataJson)}).error(function(){ecwAlert("Internal Error occured while loading mentrual history details data !")})}};$scope.editFormAData=function(){$scope.lockObj={};$scope.formALockObj={};var lockObjFormA={formName:"frmOBFormA",uniqueKey:"frmOBFormA"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjFormA.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjFormA);return}}acquireFormLock(lockObjFormA,acquireFormLockCallBack);$scope.lockObj=lockObjFormA;$scope.formALockObj=lockObjFormA;$scope.PPEditFlag=false;$scope.chkLock=false;$scope.FormAPrevPregItemList=[];$scope.FormAMenshxItemList=[];angular.copy($scope.totalPreviousPregItemlist,$scope.FormAPrevPregItemList);angular.copy($scope.totalMenstrualHistoryItemlist,$scope.FormAMenshxItemList);angular.forEach($scope.FormAPrevPregItemList,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultFormA=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultFormAValue','obpnController');$scope.setDefaultFormAValue=function(result){if(result==='yes'){for(var i=0;i<$scope.FormAPrevPregItemList.length;i++){if($scope.FormAPrevPregItemList[i].strDef!=''){$scope.FormAPrevPregItemList[cnt].strDate=$scope.FormAPrevPregItemList[i].strDef}cnt++}for(var i=0;i<$scope.FormAMenshxItemList.length;i++){if($scope.FormAMenshxItemList[i].strDef!=''){$scope.FormAMenshxItemList[cntRight].strDate=$scope.FormAMenshxItemList[i].strDef}cntRight++}}}};$scope.mergeDefaultFormA=function(){var cnt=0;var cntRight=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergeDefaultFormAValue','obpnController');$scope.setMergeDefaultFormAValue=function(result){if(result==='yes'){for(var i=0;i<$scope.FormAPrevPregItemList.length;i++){if($scope.FormAPrevPregItemList[i].strDate.length<1){$scope.FormAPrevPregItemList[cnt].strDate=$scope.FormAPrevPregItemList[i].strDef}cnt++}for(var i=0;i<$scope.FormAMenshxItemList.length;i++){if($scope.FormAMenshxItemList[i].strDate.length<1){$scope.FormAMenshxItemList[cntRight].strDate=$scope.FormAMenshxItemList[i].strDef}cntRight++}}}};$scope.lockFormA=function(){$scope.chkLock=true;$scope.saveFormAData()};$scope.unLockFormA=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"FormA",$scope.userId,$scope.encounterId).success(function(data){$scope.loadFormAData("","",'editMode');$scope.releaseLockPopup($scope.formALockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking Form A, Please try after some time")})};$scope.saveFormAData=function(onTabChange){if(!isLockMine2($scope.formALockObj)){$scope.loadFormAData("","",'editMode');$scope.loadEDDData("",'editMode');$scope.loadPatientHeader();$scope.closePopup('obEditAddPopupWindow',$scope.formALockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFormA","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrFormAItemId=[];$scope.arrFormAValue=[];var eletId=document.getElementsByName("arPregId");var eletval=document.getElementsByName("arMenHxvalue");var eletItemName=document.getElementsByName("arMenHxItemName");for(var j=0;j<eletId.length;j++){$scope.arrFormAItemId[j]=eletId[j].value;$scope.arrFormAValue[j]=eletval[j].value;if(eletItemName[j].value==='LMP'){if(eletval[j].value.length>0&&!$scope.isDate(eletval[j].value)){return false}}}PregnancyDataServices.setFormAData($scope.pregId,$scope.encounterId,$scope.arrFormAItemId,$scope.arrFormAValue,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"FormA",$scope.userId,$scope.encounterId).success(function(data){$scope.loadFormAData("","",'editMode');$scope.loadEDDData("",'editMode');$scope.loadPatientHeader();$scope.loadAllHistoryData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking Form A, Please try after some time")})}else{$scope.loadFormAData("","",'editMode');$scope.loadEDDData("",'editMode');$scope.loadPatientHeader();$scope.loadAllHistoryData("",'editMode')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving FormA, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.formALockObj)}else{$scope.releaseLockPopup($scope.formALockObj)}};$scope.releaseFormAConcurLock=function(){if($scope.formALockObj){$scope.releaseLockPopup($scope.formALockObj)}};$scope.saveStickyNotes=function(){var contents=$('.sticky').text();if(contents.length>250){ecwAlert("Maximum character length exceeded, Allowed: 250 - Entered - "+contents.length+"\n"+" Hence data entered will not be saved, please check the character limit and try again.");$scope.showDiv=1}else{$scope.showDiv=0}$('.sticky').text(contents);$http({method:"GET",url:'/mobiledoc/jsp/obfacog/save_obf_care_Data.jsp',cache:false,params:{pregid:$scope.pregId,encid:$scope.encounterId,eValue:contents,pid:$scope.patientId,hNA:335,TrUserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){}).error(function(data,status,headers,config){ecwAlert("Error saving sticky notes data.")})};$scope.showDiv=0;$scope.validateStickyNotesLength=function(e){var val=$('.sticky').text();if(val.length>=250){$scope.showDiv=1;e.preventDefault();return false}};$scope.loadPregListData=function(pregList,objMode){if(objMode=='readMode'){var jsonData=obflowmainx2js.xml_str2json(pregList);parsePregList(jsonData)}else{PregnancyDataServices.getPregnancyList($scope.patientId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);parsePregList(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading pregnancy list data !")})}$scope.pregListItems=[];$scope.PregnancyExist=false;if(obflowmainpregListFound!=''&&obflowmainpregListFound!=null){var jsonVal=(new X2JS).xml_str2json(obflowmainpregListFound);var value=jsonVal.Envelope.Body['return'].encounter;if(value){if(value.length>0){$scope.pregListItems=value}else{$scope.pregListItems.push(value)}$scope.PregnancyExist=true}}};$scope.createPregnancy=function(){$scope.arrAssessMent=[];$("#obListBtn1").remove();$("#obListBtn2").remove();$("#obListBtn3").remove();PregnancyDataServices.createPregnancy($scope.patientId,$scope.encounterId,$scope.strTimeStampName).success(function(data){var JsonIcd=obflowmainx2js.xml_str2json(obflowmainassessmentXML);var value=returnDataArray(JsonIcd.Envelope.Body["return"].encounter);if(value){if(value.length>0){$scope.arrAssessMent=value}}if($scope.EnableAddICD==='1'){$("#CreatePreg").modal('show')}else{$scope.selectCreatePreg('')}}).error(function(){ecwAlert("Internal Error occured while creating new pregnancy !")})};$scope.close=function(){var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:'',pregId:$scope.activePregId,action:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url;$scope.showLoadingImage()};$scope.showLoadingImage=function(){document.getElementById("divPregnancyLoading").style.display="";if($scope.obClosedFlag){document.getElementById("obPregClosing").style.display=""}$("#obpnController").css("pointer-events","none")};$scope.hideLoadingImage=function(){timer1=$timeout(function(){document.getElementById("divPregnancyLoading").style.display="none";document.getElementById("obPregClosing").style.display="none";$("#obpnController").css("pointer-events","auto")},500)};$scope.selectCreatePreg=function(icdId){$scope.showLoadingImage();PregnancyDataServices.getActivePregnancy($scope.patientId,$scope.encounterId).success(function(data){var jsonPregId=obflowmainx2js.xml_str2json(data);var value=jsonPregId.Envelope.Body["return"].encounter;$scope.activePregId=jsonPregId.Envelope.Body["return"].encounter.pregnancyId;if($scope.EnableAddICD==='1'){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/obaddtoproblemlist_iPad.jsp',cache:false,params:{encid:$scope.encounterId,PatientId:$scope.patientId,PregnancyId:$scope.activePregId,icditemid:icdId,patientId:$scope.patientId,uname:$scope.strTimeStampName,wustatus:'confirm',nd:(new Date).getTime()}}).success(function(data,status,headers,config){var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:'',pregId:$scope.activePregId,action:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url;$scope.closePopup('CreatePreg');$scope.updateEHXStatus($scope.activePregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){ecwAlert("Internal Error occured while updating assessment for pregnancy.")})}else{var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:'',pregId:$scope.activePregId,action:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url;$scope.updateEHXStatus($scope.activePregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}}).error(function(){ecwAlert("Internal Error occured while getting new pregnancy !")})};$scope.lockAllSelectedEncounters=function(){$scope.arrEncounterId=[];var encid=document.getElementsByName("chkEncId");for(var i=0;i<encid.length;i++){if(document.getElementsByName("chkEnc")[i].checked){$scope.arrEncounterId[i]=encid[i].value;if($scope.arrEncounterId[i]>0){var params="pid="+$scope.patientId;params+="&EncounterId="+$scope.arrEncounterId[i];params+="&style="+$scope.sType;params+="&UserId="+$scope.userId;params+="&session="+Math.random();$.ajax({type:"POST",url:"/mobiledoc/jsp/catalog/xml/lockEncounter.jsp",data:params,success:function(msg){msg=$.trim(msg)}})}}}$scope.ClosePregnancy(true)};$scope.ClosePregnancy=function(flag){$scope.obClosedFlag=true;$scope.showLoadingImage();try{if(flag===true&&$scope.patientId!==undefined&&$scope.pregId!==undefined&&$scope.encounterId!==undefined){$scope.callToInsertIntoTbl($scope.patientId,$scope.pregId,$scope.encounterId)}else{var eDate="";angular.forEach($scope.totalPreglist,function(obj){$scope.dischargeDate=obj.dischargeDate;$scope.FLastName=obj.FLastName;$scope.FFirstName=obj.FFirstName;$scope.FMiddleName=obj.FMiddleName;$scope.providerName=obj.providerName;$scope.providerId=obj.providerId});if($scope.dischargeDate==''){eDate=document.getElementById("disdate").value;$scope.dischargeDate=eDate}$http({method:"GET",url:'/mobiledoc/jsp/obfipad/closePregnancyforiPad.jsp',cache:false,params:{pregId:$scope.pregId,disChargeDate:$scope.dischargeDate,encId:$scope.encounterId,OB_ProviderId:$scope.providerId,ProviderName:$scope.providerName,patientId:$scope.patientId,webemrFlag:'No',FMname:$scope.FMiddleName,FLname:$scope.FLastName,FFname:$scope.FFirstName,UserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url;$scope.closePopup('obEditAddPopupWindow');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){$scope.hideLoadingImage();ecwAlert("Internal Error occured while closing pregnancy.")})}}catch(e){$scope.hideLoadingImage();ecwAlert("Error while closing pregnancy-"+e.message)}};$scope.getAllPregnancyEnc=function(obj){$scope.unLockOBEncList=[];var eDate="";var disMessage='Please enter discharge date.';var clsInvalidDateName=$("#ptdob").hasClass('ng-invalid-date');var clsInvalidName=$("#ptdob").hasClass('ng-invalid');if(clsInvalidDateName||clsInvalidName){return false}if(obj==='PregList'){angular.forEach($scope.totalPreglist,function(obj){$scope.disDate=obj.dischargeDate})}else{eDate=document.getElementById("disdate").value;$scope.disDate=eDate;PregnancyDataServices.setFatherDetails($scope.pregId,$scope.patientId,$scope.encounterId,$scope.fatherDetails,$scope.userName).success(function(data){$scope.loadPregListData("",'editMode');$scope.loadPatientHeader();$scope.loadDischargeData("","","","","","",'editMode')}).error(function(){ecwAlert("Internal Error occured while saving Father Details, Please try after some time")})}if($scope.disDate==''){showAlertMessage(disMessage,'','AlertMsg','','obpnController')}else{$("#obListBtn3").attr('disabled','disabled');$("#obListBtn4").attr('disabled','disabled');showAlertMessage("Are you sure you want to close this pregnancy?",'','ConfirmMsg','setToClosePregnancy','obpnController');$scope.setToClosePregnancy=function(result){if(result==='yes'){$("#obListBtn3").removeAttr('disabled');$("#obListBtn4").removeAttr('disabled');if($scope.lockFlag==1){$("#ClosePreg").modal('show');$scope.closePopup('obEditAddPopupWindow');$http({method:"GET",url:'/mobiledoc/jsp/obfipad/closePregnancyforiPad.jsp',cache:false,params:{pregId:$scope.pregId,encId:$scope.encounterId,patientId:$scope.patientId,webemrFlag:'Yes',nd:(new Date).getTime()}}).success(function(data,status,headers,config){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].Encounter;if(value){if(value.length>0){$scope.unLockOBEncList=value}else{$scope.unLockOBEncList.push(value)}}}).error(function(data,status,headers,config){ecwAlert("Internal Error occured while loading, all unlock OB encounters.")})}else{$scope.ClosePregnancy(true)}}else{$("#obListBtn3").removeAttr('disabled');$("#obListBtn4").removeAttr('disabled')}}}};$scope.nNoOfAttempts_classic=0;$scope.nNoOfAttempts_modern=0;$scope.callToInsertIntoTbl=function(pid,pregid,encid){try{if(pregid>0&&pid>0&&encid>0){var params="pid="+pid;params+="&encid="+encid;params+="&pregid="+pregid;params+="&FTPServer=null&FTPUser=null&FTPPass=null";params+="&dtype=Vertical&dnum=8&Preg%20List=1&History=1&Form%20A=1&Physical=1&Flow%20Sheet=1";params+="&EDD=1&Labs/Imaging=1&Notes=1&Genetics=1&Treatment=1&Risks=1";params+="&Problem%20List=1&Plans=1&Post%20Partum=1&Discharge=1&tStyle=Classic&isClosingPreg=true";$.ajax({type:"POST",url:"/mobiledoc/jsp/obf/obreport/obr_main.jsp",data:params,success:function(message){message=message.trim();document.getElementById("pregData").value=$scope.base64_encode(message);if(new String(message).length>0){var paramsCls="pid="+pid;paramsCls+="&encid="+encid;paramsCls+="&pregid="+pregid;paramsCls+="&FTPServer=null&FTPUser=null&FTPPass=null";paramsCls+="&dtype=Vertical&dnum=8&Preg%20List=1&History=1&Form%20A=1&Physical=1&Flow%20Sheet=1";paramsCls+="&EDD=1&Labs/Imaging=1&Notes=1&Genetics=1&Treatment=1&Risks=1";paramsCls+="&Problem%20List=1&Plans=1&Post%20Partum=1&Discharge=1&tStyle=Classic";$.post("/mobiledoc/jsp/obf/obreport/savePregData.jsp?"+paramsCls,$("#pregData").serialize(),function(data){data=data.trim();if(new String(data).indexOf("success")!=-1){$scope.nNoOfAttempts_classic++;var paramscheck="&pid="+pid;paramscheck+="&encid="+encid;paramscheck+="&pregid="+pregid;paramscheck+="&typetobeChecked=Classic";$.ajax({type:"POST",url:"/mobiledoc/jsp/obfacog/save_obf_care_Data.jsp",data:"hNA=100"+paramscheck,success:function(msg,event){if(new String(msg).indexOf('success')!=-1){temp=$scope.callToInsertIntoTblForModern(pid,pregid,encid);return temp}else{if($scope.nNoOfAttempts_classic>2){ecwAlert("Error occured while closing the pregnancy.");$scope.nNoOfAttempts_classic=0}else{$scope.callToInsertIntoTbl(pid,pregid,encid)}}}})}})}else{$scope.hideLoadingImage();temp=false}},error:function(XMLHttpRequest,textStatus,errorThrown){$scope.hideLoadingImage();ecwAlert("Error: "+errorThrown)}})}}catch(e){$scope.hideLoadingImage();ecwAlert("Error while closing pregnancy "+e.message)}return temp};$scope.callToInsertIntoTblForModern=function(pid,pregid,encid){var temp=false;var params="pid="+pid;params+="&encid="+encid;params+="&pregid="+pregid;params+="&FTPServer=null&FTPUser=null&FTPPass=null";params+="&dtype=Vertical&dnum=8&Preg%20List=1&History=1&Form%20A=1&Physical=1&Flow%20Sheet=1";params+="&EDD=1&Labs/Imaging=1&Notes=1&Genetics=1&Treatment=1&Risks=1";params+="&Problem%20List=1&Plans=1&Post%20Partum=1&Discharge=1&tStyle=Modern&isClosingPreg=true";$.ajax({type:"POST",url:"/mobiledoc/jsp/obf/obreport/acogobreport/obr_acog_main.jsp",data:params,success:function(msg){msg=msg.trim();document.getElementById("pregData").value=$scope.base64_encode(msg);if(new String(msg).length>0){var paramsMdn="pid="+pid;paramsMdn+="&encid="+encid;paramsMdn+="&pregid="+pregid;paramsMdn+="&FTPServer=null&FTPUser=null&FTPPass=null";paramsMdn+="&dtype=Vertical&dnum=8&Preg%20List=1&History=1&Form%20A=1&Physical=1&Flow%20Sheet=1";paramsMdn+="&EDD=1&Labs/Imaging=1&Notes=1&Genetics=1&Treatment=1&Risks=1";paramsMdn+="&Problem%20List=1&Plans=1&Post%20Partum=1&Discharge=1&tStyle=Modern";$.post("/mobiledoc/jsp/obf/obreport/savePregData.jsp?"+paramsMdn,$("#pregData").serialize(),function(data){data=data.trim();if(new String(data).indexOf("success")!=-1){$scope.nNoOfAttempts_modern++;var paramscheck="&pid="+pid;paramscheck+="&encid="+encid;paramscheck+="&pregid="+pregid;paramscheck+="&typetobeChecked=Modern";$.ajax({type:"POST",url:"/mobiledoc/jsp/obfacog/save_obf_care_Data.jsp",data:"hNA=100"+paramscheck,success:function(msg,event){if(new String(msg).indexOf('success')!=-1){$scope.ClosePregnancy(false)}else{if($scope.nNoOfAttempts_modern>2){ecwAlert("Error occured while closing the pregnancy.");$scope.nNoOfAttempts_modern=0}else{$scope.callToInsertIntoTblForModern(pid,pregid,encid)}}}})}})}else{$scope.hideLoadingImage();temp=false}},error:function(XMLHttpRequest,textStatus,errorThrown){$scope.hideLoadingImage();ecwAlert("Error: "+errorThrown)}});return temp};$scope.base64_encode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3)};$scope.getAllPregnancyPopupEnc=function(obj){var dischargeDate=$("#disdate").val();var fatherDOB=$("#ptdob").val();$scope.fatherDetails.strRace=$scope.OBFatherRace;$scope.fatherDetails.strProviderId=$scope.OBProviderId;if(!$scope.isDate(dischargeDate))return false;if(!$scope.isDate(fatherDOB))return false;var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFatherInfo","obEditAddPopupWindow","bluetheme");if(!doCheck)return false;$scope.getAllPregnancyEnc(obj)};$scope.unLockLastPregnancy=function(){var msg='Are you sure you want to unLock this pregnancy?';$("#obListBtn1").attr('disabled','disabled');showAlertMessage(msg,'','ConfirmMsg','setunLockLastPregnancy','obpnController');$scope.setunLockLastPregnancy=function(result){if(result==='yes'){$scope.showLoadingImage();$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:$scope.patientId,keyName:'OBPregList',lockValue:'0',itemValue:'',ItemId:'0',TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',nd:(new Date).getTime()}}).success(function(data,status,headers,config){var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:'',pregId:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url}).error(function(data,status,headers,config){ecwAlert("Error loading in patient dashboard data.")})}else{$("#obListBtn1").removeAttr('disabled')}}};$scope.loadEDDData=function(eddXml,objMode){$scope.totalEddlist=[];if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(eddXml);$scope.totalEddlist=jsonData.Envelope.Body["return"].encounter}else{PregnancyDataServices.getEddData($scope.pregId,$scope.patientId,$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);$scope.totalEddlist=jsonData.Envelope.Body["return"].encounter}).error(function(){ecwAlert("Internal Error occured while loading edd details data !")})}};$scope.editEddData=function(){$scope.lockObj={};$scope.eddLockObj={};var lockObjOBEdd={formName:"frmOBEDD",uniqueKey:"frmOBEDD"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjOBEdd.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjOBEdd);return}}acquireFormLock(lockObjOBEdd,acquireFormLockCallBack);$scope.lockObj=lockObjOBEdd;$scope.eddLockObj=lockObjOBEdd;$scope.PPEditFlag=false;$scope.totalEditEddlist=[];angular.copy($scope.totalEddlist,$scope.totalEditEddlist);PregnancyDataServices.getEddData($scope.pregId,$scope.patientId,$scope.encounterId).success(function(data){$scope.totalEditEddlist=[];var jsonData=(new X2JS).xml_str2json(data);$scope.totalEditEddlist=jsonData.Envelope.Body["return"].encounter}).error(function(){ecwAlert("Internal Error occured while loading edd details data !")});if($scope.totalEddlist!=undefined){if($scope.totalEddlist.strLock==='1'){$scope.strLock=true}else{$scope.strLock=false}}};$scope.saveEdd=function(onTabChange){if(!isLockMine2($scope.eddLockObj)){$scope.loadEDDData("",'editMode');$scope.loadPatientHeader();$scope.loadFormAData("","",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.eddLockObj);return false}if(!$scope.validateDateForm())return;var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBEdd","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}var dateA1=$('#dta1').val();var dateA2=$('#dta2').val();var dateA3=$('#dta3').val();var dateA4=$('#dta4').val();var weekA1=$('#wa1').val();var weekA2=$('#wa2').val();var weekA3=$('#wa3').val();var weekA4=$('#wa4').val();var daysA1=$('#da1').val();var daysA2=$('#da2').val();var daysA3=$('#da3').val();var daysA4=$('#da4').val();var eddA1=document.getElementById("ea1").value;var eddA2=document.getElementById("ea2").value;var eddA3=document.getElementById("ea3").value;var eddA4=document.getElementById("ea4").value;var initialEdd=$('#initalEdd').text();var initEddval=$('#initialeddval').val();var dateB1=$('#dtb1').val();var dateB2=$('#dtb2').val();var dateB3=$('#dtb3').val();var dateB4=$('#dtb4').val();var weekB1=$('#wb1').val();var weekB2=$('#wb2').val();var weekB3=$('#wb3').val();var weekB4=$('#wb4').val();var daysB1=$('#db1').val();var daysB2=$('#db2').val();var daysB3=$('#db3').val();var daysB4=$('#db4').val();var eddB1=document.getElementById("eb1").value;var eddB2=document.getElementById("eb2").value;var eddB3=document.getElementById("eb3").value;var eddB4=document.getElementById("eb4").value;var finalEdd=$('#finalEdd').text();var finalEddval=$('#finaleddval').val();var eddNotesval=$('#obflowsheeteddcomments').val();PregnancyDataServices.setEddData($scope.pregId,$scope.encounterId,dateA1,dateA2,dateA3,dateA4,weekA1,weekA2,weekA3,weekA4,daysA1,daysA2,daysA3,daysA4,eddA1,eddA2,eddA3,eddA4,initialEdd,initEddval,dateB1,dateB2,dateB3,dateB4,weekB1,weekB2,weekB3,weekB4,daysB1,daysB2,daysB3,daysB4,eddB1,eddB2,eddB3,eddB4,finalEdd,finalEddval,eddNotesval,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"OBEdd",$scope.userId,$scope.encounterId).success(function(data){$scope.loadEDDData("",'editMode');$scope.loadPatientHeader();$scope.loadFormAData("","",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking EDD, Please try after some time")})}else{$scope.loadFormAData("","",'editMode');$scope.loadEDDData("",'editMode');$scope.loadPatientHeader()}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName);$scope.loadModernLabData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while saving EDD, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.eddLockObj)}else{$scope.releaseLockPopup($scope.eddLockObj)}};$scope.lockEdd=function(){$scope.chkLock=true;$scope.saveEdd()};$scope.unLockEdd=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"OBEdd",$scope.userId,$scope.encounterId).success(function(data){$scope.loadEDDData("",'editMode');$scope.releaseLockPopup($scope.eddLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking EDD, Please try after some time")})};$scope.releaseEDDConcurLock=function(){if($scope.eddLockObj){$scope.releaseLockPopup($scope.eddLockObj)}};var obEddNotesClone;$scope.clearEDDNotes=function(){$scope.isUndoEDDButtonShow=true;var eddNotes=$("#obflowsheeteddcomments").val();obEddNotesClone=angular.copy(eddNotes);$("#obflowsheeteddcomments").val('');$scope.totalEditEddlist.strNotes=''};$scope.undoEDDNotes=function(){$scope.isUndoEDDButtonShow=false;$scope.totalEditEddlist.strNotes=angular.copy(obEddNotesClone)};$scope.isVertical=false;$scope.isHorizontal=true;$scope.changeView=function(mode){if(document.getElementById("v").checked){$scope.isHorizontal=false;$scope.isVertical=true}else{$scope.isHorizontal=true;$scope.isVertical=false}if($scope.isVertical&&mode==='readMode'){$scope.getOBFlowsheetVerticalData()}};$scope.loadFlowSheetData=function(flowsheetXml,flowsheetDataXml,objMode){$scope.changeView(objMode);$scope.noOfEnc=0;if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(flowsheetXml);populateFlowsheetHeaderData(jsonData);$scope.EnablePNVitalOBVisitMapping=jsonData.Envelope.Body["return"].strPNVitalOBVisitMapping;jsonData=obflowmainx2js.xml_str2json(flowsheetDataXml);populateFlowSheetData(jsonData)}else{PregnancyDataServices.getOBFlowSheetItems($scope.pregId,0,'NewVisit',$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateFlowsheetHeaderData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading flowsheet data !")});PregnancyDataServices.getOBFlowSheetValue($scope.pregId,$scope.patientId,$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateFlowSheetData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading flowsheet value data !")});$scope.getOBFlowsheetVerticalData()}$scope.keys=function(obj){return obj?Object.keys(obj):[]}};$scope.loadCareItems=function(careItemsXml,careItemsOrderSetXml,objMode){if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(careItemsXml);populateOBCareItems(jsonData);jsonData=obflowmainx2js.xml_str2json(careItemsOrderSetXml);populateOBCareOrderSetItems(jsonData)}else{PregnancyDataServices.getOBCareItems($scope.pregId,$scope.patientId,1).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateOBCareItems(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading flowsheet OB Care Items !")});PregnancyDataServices.getOBCareItems($scope.pregId,$scope.patientId,2).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateOBCareOrderSetItems(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading flowsheet OB Care Items !")})}};$scope.ordersetpopup="";$scope.openorderset=function(asmtids,orderSetEncId){$scope.AsmtIds=asmtids;$scope.encounterid=$scope.encounterId;$scope.patientid=$scope.patientId;$scope.rcpOrderSetEncId=orderSetEncId;$ocLazyLoad.load({name:'AssessmentList',files:['/mobiledoc/jsp/webemr/rightpanel/js/asmtController.js']}).then(function(){$scope.ordersetpopup=makeURL('/mobiledoc/jsp/webemr/rightpanel/assessmentlist.jsp')},function(e){console.log(e)})};$scope.openOBCareGraph=function(){$scope.lockObj={};$scope.lockFlowsheetCareObj={};var lockObjFlowsheetcare={formName:"frmOBFlowsheetCare",uniqueKey:"frmOBFlowsheetCare"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjFlowsheetcare.g_cancel){$scope.closePopup('obCareGraph',lockObjFlowsheetcare);return}}acquireFormLock(lockObjFlowsheetcare,acquireFormLockCallBack);$scope.lockObj=lockObjFlowsheetcare;$scope.lockFlowsheetCareObj=lockObjFlowsheetcare;$("#obCareGraph").modal('show');if($scope.tempName==='Default Template'){$scope.templateName=''}else{$scope.templateName=$scope.tempName}$scope.getOBCareGraph()};$scope.getOBCareGraph=function(){$scope.obCareHeaderItems=[];$scope.obCareHeaderValues=[];PregnancyDataServices.getOBCareGraphData($scope.pregId,$scope.patientId,'HeaderName',$scope.templateName).success(function(data){var obCareGraphHeaderjson=(new X2JS).xml_str2json(data);var value=obCareGraphHeaderjson.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.obCareHeaderItems=value}else{$scope.obCareHeaderItems.push(value)}}}).error(function(){ecwAlert("Internal Error occured while loading OB Care Item Header !")});PregnancyDataServices.getOBCareGraphData($scope.pregId,$scope.patientId,'HeaderValue',$scope.templateName).success(function(data){var obCareGraphValuejson=(new X2JS).xml_str2json(data);var value=obCareGraphValuejson.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.obCareHeaderValues=value}else{$scope.obCareHeaderValues.push(value)}}}).error(function(){ecwAlert("Internal Error occured while loading OB Care Item Values !")})};$scope.changeTemplate=function(){var strTempName=$("#tempId option:selected").text();if(strTempName==='Default Template'){$scope.templateName=''}else{$scope.templateName=strTempName}$scope.getOBCareGraph()};$scope.setOBCareTemplate=function(){if(!isLockMine2($scope.lockFlowsheetCareObj)){$scope.loadCareItems("","",'editMode');$scope.closePopup('obCareGraph',$scope.lockFlowsheetCareObj);return false}var strTempName=$("#tempId option:selected").text();$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setOBCareTemplate_iPad.jsp',cache:false,params:{patientId:$scope.patientId,tempName:strTempName,TrUserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadCareItems("","",'editMode');$scope.closePopup('obCareGraph',$scope.lockFlowsheetCareObj)}).error(function(data,status,headers,config){ecwAlert("Internal Error occured while applying OB care template");$scope.closePopup('obCareGraph',$scope.lockFlowsheetCareObj)})};$scope.orderLab=function(cid,lid,iCaretype){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setOBCareItems.jsp',cache:false,params:{PregId:$scope.pregId,encId:$scope.encounterId,careitemid:cid,carelabid:lid,caretype:iCaretype,TrUserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadCareItems("","",'editMode');if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}}).error(function(data,status,headers,config){ecwAlert("Internal Error occured while ordering OB care items")})};$scope.saveFlowsheetData=function(){if(!isLockMine2($scope.lockFlowhseetObj)){$scope.loadFlowSheetData("","",'editMode');$scope.closePopup('obfloedit',$scope.lockFlowhseetObj);return false}if($scope.isPastDateEntry.value){BootstrapDialog.show({title:"eClinicalWorks",message:"The values entered in this prenatal visit have been marked as Collected in the Past and will not be mapped to the Progress Note. Are you sure you want to save it?",buttons:[{label:'Yes',cssClass:'btn-lgrey btn-xs',action:function(dialog){$scope.saveOBVisitData();dialog.close();return}},{label:'No',cssClass:'btn-lgrey btn-xs',action:function(dialog){dialog.close();return}}]})}else{$scope.saveOBVisitData()}};$scope.saveOBVisitData=function(){var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFlowsheetVisit","obfloedit","bluetheme");if(!doCheck){$scope.chkLock=false;return false}if($scope.InvalidMessage!==''&&$scope.InvalidMessage!==undefined){showAlertMessage($scope.InvalidMessage,'','AlertMsg','','obpnController');return false}$scope.arrFlowLItemId=[];$scope.arrFlowLValue=[];$scope.arrFlowRItemId=[];$scope.arrFlowRValue=[];var preobweight=$("#preobweight").val();let isNonEditable=false;var clsInvalidName=$("#preobweight").hasClass('input-disabled');if(clsInvalidName){isNonEditable=true}var eLeftId=document.getElementsByName("arFlowsheetLId");var eLeftVal=document.getElementsByName("arFlowsheetLValue");var eRightId=document.getElementsByName("arFlowsheetRId");var eRightVal=document.getElementsByName("arFlowsheetRValue");for(var j=0;j<eLeftId.length;j++){$scope.arrFlowLItemId[j]=eLeftId[j].value;$scope.arrFlowLValue[j]=eLeftVal[j].value}for(var k=0;k<eRightId.length;k++){$scope.arrFlowRItemId[k]=eRightId[k].value;$scope.arrFlowRValue[k]=eRightVal[k].value}PregnancyDataServices.setFlowSheetData($scope.pregId,$scope.encounterId,$scope.arrFlowLItemId,$scope.arrFlowLValue,$scope.arrFlowRItemId,$scope.arrFlowRValue,$scope.userId,$scope.newVisitId,$scope.visitEncId,preobweight,isNonEditable).success(function(data){if($scope.chkLock==true){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:$scope.ivId,keyName:'obflowsheet',lockValue:1,itemValue:$scope.iitemValue,ItemId:$scope.iitemId,TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',perObWt:preobweight,preOBWtNonEditable:isNonEditable,nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadFlowSheetData("","",'editMode');$scope.loadPhysicalItems("",'editMode');$('#obfloedit').modal('hide')}).error(function(data,status,headers,config){ecwAlert("Error in locking visit.")})}else{$scope.loadFlowSheetData("","",'editMode');$scope.loadPhysicalItems("",'editMode');$('#obfloedit').modal('hide')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving flowsheet visit, Please try after some time")});$scope.closePopup('obfloedit',$scope.lockFlowhseetObj)};$scope.newVisits=function(vId,kName){$scope.lockObj={};$scope.lockFlowhseetObj={};var lockObjFlowsheet={formName:"frmOBFlowsheet",uniqueKey:"frmOBFlowsheet"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjFlowsheet.g_cancel){$scope.closePopup('obfloedit',lockObjFlowsheet);return}}acquireFormLock(lockObjFlowsheet,acquireFormLockCallBack);$scope.lockObj=lockObjFlowsheet;$scope.lockFlowhseetObj=lockObjFlowsheet;$scope.totWeighGain="";$scope.totalBMI="";$scope.totalFlowItemListLeft=[];$scope.totalFlowItemListRight=[];$scope.PPCloseFlag=false;$scope.newVisitId=vId;$scope.visitId=vId;$scope.visitEncStatus='';$scope.visitEncDtls='';$scope.visitEncId='0';$scope.visitEncIdCopy='';$scope.VisitExists='';$scope.InvalidMessage="";$scope.encDateTimeCopy='';$scope.isPastDateEntry={value:false};$scope.isDateDisabled=false;PregnancyDataServices.getOBFlowSheetItems($scope.pregId,$scope.newVisitId,kName,$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].encounter;$scope.PreObWt=jsonData.Envelope.Body["return"].PreOBWeight;$scope.VisitExists=jsonData.Envelope.Body["return"].visitExists;$scope.visitEncId=jsonData.Envelope.Body["return"].visitEncId;$scope.visitEncIdCopy=$scope.visitEncId;$scope.PreObWt=$scope.PreObWt==="0"?"":$scope.PreObWt;$scope.numPadId='';if($scope.visitEncId!=='0'){$scope.isDateDisabled=true}if($scope.VisitExists==='true'){$scope.isPastDateEntry.value=true}var cntleft=0;var cntright=0;$scope.FlowsheetHeaderItemList=[];if(value){if(value.length>0){for(var i=0;i<value.length;i++){if(value[i].strName!==undefined&&value[i].strName!==''){$scope.FlowsheetHeaderItemList.push(value[i])}}var len=$scope.FlowsheetHeaderItemList.length;var temp=true;angular.forEach($scope.FlowsheetHeaderItemList,function(obj){if(obj.strVisitId!=undefined&&temp){$scope.ivId=obj.strVisitId;temp=false}else{$scope.ivId="0"}if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}});for(var i=0;i<len;i++){if($scope.FlowsheetHeaderItemList[i].strName==="Date"){$scope.visitDate=$scope.FlowsheetHeaderItemList[i].strDate;$scope.visitDateId=$scope.FlowsheetHeaderItemList[i].strItemId}if($scope.FlowsheetHeaderItemList[i].strName==="Next Appt."){$scope.nextApptDate=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strName==="Weeks Gest."){$scope.GAWeeks=calculateGA($scope.strPtEdd,$scope.visitDate);$scope.LMPDate=$scope.FlowsheetHeaderItemList[i].strLMPDate}if($scope.FlowsheetHeaderItemList[i].strName==="Total Wt gain"){$scope.totWeighGain=$scope.FlowsheetHeaderItemList[i].strTotalWtgain}if($scope.FlowsheetHeaderItemList[i].strName==="Encounter Date and Time"){$scope.encDateTime=$scope.FlowsheetHeaderItemList[i].strDate;$scope.encDateTimeCopy=$scope.encDateTime}if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Albumin"){$scope.urineAlbuminCopy=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Glucose"){$scope.urineGlucoseCopy=$scope.FlowsheetHeaderItemList[i].strDate}if(i%2==0){$scope.totalFlowItemListLeft[cntleft]=$scope.FlowsheetHeaderItemList[i];cntleft++}else{$scope.totalFlowItemListRight[cntright]=$scope.FlowsheetHeaderItemList[i];cntright++}}}}}).error(function(){ecwAlert("Internal Error occured while loading flowsheet data !")});$scope.loadFlowsheetEditPopup()};$scope.loadFlowsheetEditPopup=function(){$templateCache.remove($scope.obPanelPopUrl);$scope.obPanelPopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPanelPopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=Flowsheet"},function(e){console.log(e);$templateCache.remove($scope.obPanelPopUrl)})};$scope.updateVisits=function(vId,kName){$scope.lockObj={};$scope.lockFlowhseetObj={};var lockObjFlowsheet={formName:"frmOBFlowsheet",uniqueKey:"frmOBFlowsheet"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjFlowsheet.g_cancel){$scope.closePopup('obfloedit',lockObjFlowsheet);return}}acquireFormLock(lockObjFlowsheet,acquireFormLockCallBack);$scope.lockObj=lockObjFlowsheet;$scope.lockFlowhseetObj=lockObjFlowsheet;$scope.totalFlowItemListLeft=[];$scope.totalFlowItemListRight=[];$scope.visitId=vId;$scope.PPCloseFlag=false;$scope.newVisitId=vId;$scope.visitEncStatus='';$scope.visitEncDtls='';$scope.visitEncId='0';$scope.visitEncIdCopy='';$scope.VisitExists='';$scope.InvalidMessage="";$scope.encDateTimeCopy='';$scope.isPastDateEntry={value:false};$scope.isDateDisabled=false;PregnancyDataServices.getOBFlowSheetItems($scope.pregId,vId,kName,$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].encounter;$scope.PreObWt=jsonData.Envelope.Body["return"].PreOBWeight;$scope.visitEncStatus=jsonData.Envelope.Body["return"].visitStatus;$scope.visitEncDtls=jsonData.Envelope.Body["return"].visitEncDtls;$scope.visitEncId=jsonData.Envelope.Body["return"].visitEncId;$scope.isBPVitalMapped=jsonData.Envelope.Body["return"].isBPVitalMapped;$scope.isInvalidRangeData=jsonData.Envelope.Body["return"].isInvalidVitalRangeData;$scope.isInvalidRangeItemName=jsonData.Envelope.Body["return"].isInvalidVitalRangeItemName;$scope.isAllowdVitalRange=jsonData.Envelope.Body["return"].isAllowdVitalRange;$scope.PreObWt=$scope.PreObWt==="0"?"":$scope.PreObWt;$scope.numPadId='';if($scope.visitEncStatus==='unmapped'){$scope.isPastDateEntry.value=true}if($scope.visitEncId!=='0'){$scope.isDateDisabled=true}var cntleft=0;var cntright=0;$scope.FlowsheetHeaderItemList=[];if(value){if(value.length>0){for(var i=0;i<value.length;i++){if(value[i].strName!==undefined&&value[i].strName!==''){$scope.FlowsheetHeaderItemList.push(value[i])}}var len=$scope.FlowsheetHeaderItemList.length;var temp=true;angular.forEach($scope.FlowsheetHeaderItemList,function(obj){if(obj.strLock=='1'&&temp){$scope.strLock=true;temp=false}else{$scope.strLock=false;temp=false}});for(var i=0;i<len;i++){if($scope.FlowsheetHeaderItemList[i].strName==="Date"){$scope.visitDate=$scope.FlowsheetHeaderItemList[i].strDate;$scope.PreObWt=$scope.FlowsheetHeaderItemList[i].strVisitPreWeight;$("#preobweight").val($scope.PreObWt)}if($scope.FlowsheetHeaderItemList[i].strName==="Weeks Gest."){var regexWeekGest=/^[0-9]{1,2}\sw\s[0-9]{1,1}\sd$/;var val=$scope.FlowsheetHeaderItemList[i].strDate;if(val!==''){if(!regexWeekGest.test($.trim(val))){$scope.GAWeeks=$scope.FlowsheetHeaderItemList[i].strDate}else{$scope.GAWeeks=calculateGA($scope.strPtEdd,$scope.visitDate)}}else{$scope.GAWeeks=val}$scope.LMPDate=$scope.FlowsheetHeaderItemList[i].strLMPDate}if($scope.FlowsheetHeaderItemList[i].strName==="Next Appt."){$scope.nextApptDate=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strName==="Total Wt gain"){$scope.totWeighGain=$scope.FlowsheetHeaderItemList[i].strTotalWtgain}if($scope.FlowsheetHeaderItemList[i].strName==="BMI"){$scope.totalBMI=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strName==="Encounter Date and Time"){$scope.encDateTime=$scope.FlowsheetHeaderItemList[i].strDate}if(i%2==0){$scope.totalFlowItemListLeft[cntleft]=$scope.FlowsheetHeaderItemList[i];cntleft++}else{$scope.totalFlowItemListRight[cntright]=$scope.FlowsheetHeaderItemList[i];cntright++}}}}$scope.loadFlowsheetEditPopup()}).error(function(){ecwAlert("Internal Error occured while loading flowsheet data !")})};$scope.defaultFlowsheet=function(){var cntl=0;var cntr=0;var len=$scope.FlowsheetHeaderItemList.length;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultValue','obpnController');$scope.setDefaultValue=function(result){if(result==='yes'){for(var i=0;i<len;i++){if(i%2==0){if($scope.FlowsheetHeaderItemList[i].strDef!==''&&$scope.FlowsheetHeaderItemList[i].strName!=='Time of Entry')$scope.totalFlowItemListLeft[cntl].strDate=$scope.FlowsheetHeaderItemList[i].strDef;cntl++}else{if($scope.FlowsheetHeaderItemList[i].strDef!==''&&$scope.FlowsheetHeaderItemList[i].strName!=='Time of Entry')$scope.totalFlowItemListRight[cntr].strDate=$scope.FlowsheetHeaderItemList[i].strDef;cntr++}}}}};$scope.lockFlowsheet=function(vId,lvalue){var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBFlowsheetVisit","obfloedit","bluetheme");if(!doCheck){$scope.chkLock=false;return false}if(vId!=0&&vId!=undefined){$scope.ivId=vId}angular.forEach($scope.FlowsheetHeaderItemList,function(obj){if(obj.strName==='Initials'){$scope.iitemId=obj.strItemId;$scope.iitemValue=obj.strDate}});if($scope.ivId>0){if($scope.iitemValue!=''&&$scope.iitemValue!=undefined){showAlertMessage("Are you sure you want to lock this visit ?",'','ConfirmMsg','setOBFlowLockVisitData','obpnController');$scope.setOBFlowLockVisitData=function(result){if(result==='yes'){$scope.chkLock=true;$scope.saveFlowsheetData()}}}else{showAlertMessage('Please enter initials.','','AlertMsg','','obpnController')}}};$scope.unLockVisits=function(vId,lvalue){showAlertMessage("Are you sure you want to unLock this visit ?",'','ConfirmMsg','setOBFlowUnLockVisitData','obpnController');$scope.setOBFlowUnLockVisitData=function(result){if(result==='yes'){if(vId>0){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:vId,keyName:'obflowsheet',lockValue:lvalue,itemValue:'',ItemId:0,TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadFlowSheetData("","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){ecwAlert("Error in unlocking visit.")})}}}};$scope.lockVisits=function(vId,lvalue){$scope.ItemList=[];PregnancyDataServices.getOBFlowSheetItems($scope.pregId,vId,"existVisit",$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].encounter;if(value){if(value.length>0){if(value.length>0){$scope.ItemList=value}else{$scope.ItemList.push(value)}}}angular.forEach($scope.ItemList,function(obj){if(obj.strName==='Initials'){$scope.iitemId=obj.strItemId;$scope.iitemValue=obj.strDate}});if($scope.iitemValue!=''&&$scope.iitemValue!=undefined){showAlertMessage("Are you sure you want to lock this visit ?",'','ConfirmMsg','setLockOBFlowsheetVisit','obpnController');$scope.setLockOBFlowsheetVisit=function(result){if(result==='yes'){if(vId>0){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:vId,keyName:'obflowsheet',lockValue:lvalue,itemValue:$scope.iitemValue,ItemId:$scope.iitemId,TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadFlowSheetData("","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){ecwAlert("Error in locking visit.")})}}}}else{showAlertMessage('Please enter initials.','','AlertMsg','','obpnController')}}).error(function(){ecwAlert("Internal Error occured while locking flowsheet data !")})};$scope.deleteFlowsheet=function(objId){if(!isLockMine2($scope.lockFlowhseetObj)){$scope.loadFlowSheetData("","",'editMode');$scope.closePopup('obfloedit',$scope.lockFlowhseetObj);return false}var msg='Are you sure you want to delete this visit?';if($scope.EnablePNVitalOBVisitMapping==1&&$scope.visitEncStatus){if($scope.visitEncStatus==='mismapped'||$scope.visitEncStatus==='unmapped'){if($scope.visitEncStatus==='mismapped'){var msg="You are trying to delete a prenatal visit that was linked to the encounter:"+$scope.visitEncDtls+". Deleting this prenatal visit will also delete the mapped values on the corresponding Progress Note. Are you sure you want to continue?"}else if($scope.visitEncStatus==='unmapped'){var msg="You are trying to delete a prenatal visit that was entered in the past. Deleting this prenatal visit will not affect the values on the Progress Note since they are not mapped. Are you sure you want to continue?"}}}showAlertMessage(msg,'','ConfirmMsg','setDeleteFlowsheetValue','obpnController');$scope.setDeleteFlowsheetValue=function(result){if(result==='yes'){PregnancyDataServices.deletePregnancyData($scope.pregId,$scope.patientId,objId,"OBVisit",$scope.userId,$scope.visitEncId).success(function(data){$scope.closePopup('obfloedit',$scope.lockFlowhseetObj);$scope.loadFlowSheetData("","",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while deleting visit, Please try after some time")})}}};$scope.calGA=function(objval){var ga=calculateGA($scope.strPtEdd,objval);$scope.GAWeeks=ga;$scope.visitDate=objval};$scope.calnextAppt=function(objval){$scope.nextApptDate=objval};$scope.calTotalWeightGain=function(selWeight){if(selWeight!==undefined&&selWeight!==''){var perweight=$("#preobweight").val();selWeight=selWeight.replace(/\s+/g,"");var prwt=parseFloat(perweight);var visitwt=parseFloat(selWeight);var visitwtgain;if(perweight!==''&&perweight!==undefined){visitwtgain=visitwt-prwt}else{visitwtgain=visitwt}if(!isNaN(visitwtgain)&&!isNaN(visitwt)){$scope.totWeighGain=Number(visitwtgain.toFixed(2))}else{$scope.totWeighGain=""}var disit_regex=/^-?\d+\.?\d*$/;if(visitwtgain!==''){if(disit_regex.test($.trim(visitwtgain))){$('#hideTooltipTotlaWtgain').remove()}}}else{$scope.totWeighGain=""}};$scope.reCalculatePreObWeight=function(){var perweight=$("#preobweight").val();var selWeight;for(var i=0;i<$scope.FlowsheetHeaderItemList.length;i++){if($scope.FlowsheetHeaderItemList[i].strName==='Weight'){selWeight=$scope.FlowsheetHeaderItemList[i].strDate}}if(selWeight===''&&$scope.visitId!=='0'&&$scope.visitId!=='undefined'){showAlertMessage('Please enter weight','','AlertMsg','','obpnController');return}selWeight=selWeight.replace(/\s+/g,"");var prwt=parseFloat(perweight);var visitwt=parseFloat(selWeight);var visitwtgain;if(perweight!==''&&perweight!=undefined){visitwtgain=visitwt-prwt}else{visitwtgain=visitwt}if(!isNaN(visitwtgain)&&!isNaN(visitwt)){$scope.totWeighGain=Number(visitwtgain.toFixed(2))}else{$scope.totWeighGain=""}};$scope.loadHPINotesData=function(allHPINotesXml,objMode){if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(allHPINotesXml);populateHPINotesData(jsonData)}};$scope.loadOBNotesEditPopup=function(){$templateCache.remove($scope.obPanelPopUrl);$scope.obPanelPopUrl="";$ocLazyLoad.load({name:'obPastPregAndFlowsheetEditModule',cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popupCltr.js']}).then(function(){$scope.obPanelPopUrl="/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheetPast_popup.jsp?flag=obnotes&randomId="+Math.random()},function(e){console.log(e);$templateCache.remove($scope.obPanelPopUrl)})};$scope.loadNotesData=function(allNotesXml,objMode){if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(allNotesXml);populateNotesData(jsonData)}else{PregnancyDataServices.getAllNotesData($scope.pregId,$scope.userId,0,$scope.sortOrder,$scope.sortedByColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateNotesData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading OB notes data !")})}};$scope.sortOBNOtes=function(columnName){if($scope.sortOrder=="DESC"){$scope.sortOrder="ASC"}else{$scope.sortOrder="DESC"}if(columnName==1){$scope.sortedByColName="CommentDate";$scope.sortBy=1}else{$scope.sortedByColName="Upd_Date";$scope.sortBy=2}$scope.loadNotesData("",'editMode')};var notesType="";$scope.Browse=function(fieldId){$scope.nfieldId=fieldId;$scope.nfieldVal=$("#"+fieldId).val();$scope.action="browseCommon";$scope.searchKey={value:''};$scope.keywords={items:[],module:'',maxcount:'',selectedItems:[],favorite:'',notes:''};if(fieldId==='obflowsheeteddcomments'){$scope.keywords.module='OB EDD'}else{$scope.keywords.module='OB Notes'}$scope.keywords.maxcount='20';$scope.keywords.currentIndex='1';$("#KeywordsModal").modal({backdrop:"static",keyboard:false})};$scope.KeywordsOk=function(){var notes='';for(i in $scope.keywords.selectedItems){if(notes===''){if($scope.keywords.selectedItems[i].notes===''){notes=$scope.keywords.selectedItems[i].name}else{notes=$scope.keywords.selectedItems[i].notes}}else{if($scope.keywords.selectedItems[i].notes===''){notes=notes+", "+$scope.keywords.selectedItems[i].name}else{notes=notes+", "+$scope.keywords.selectedItems[i].notes}}}$scope.searchKey={value:''};$scope.keywords={items:[],module:'',maxcount:'',selectedItems:[],favorite:'',notes:''};$scope.action="";$("#KeywordsModal").modal('hide');if($scope.nfieldVal!==''){$scope.nfieldVal=$scope.nfieldVal+", "+notes;$("#"+$scope.nfieldId).val($scope.nfieldVal)}else{$("#"+$scope.nfieldId).val(notes)}};$scope.KeywordsCancel=function(){$scope.searchKey={value:''};$scope.keywords={items:[],module:'',maxcount:'',selectedItems:[],favorite:'',notes:''};$scope.action="";$("#KeywordsModal").modal('hide')};$scope.saveNotes=function(NotesId){if(NotesId>0&&!isLockMine2($scope.lockNotesObj)){$scope.loadNotesData("",'editMode');$scope.closePopup('obEditnotes',$scope.lockNotesObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBNotes","obEditnotes","bluetheme");if(!doCheck){$scope.chkLock=false;return false}var notes=$('#obflowsheeteditnotes').val();$scope.totalEditNotesItemList.strNotes=notes;PregnancyDataServices.setNotesData($scope.pregId,$scope.encounterId,NotesId,$scope.totalEditNotesItemList,$scope.strTimeStampName).success(function(data){$scope.loadNotesData("",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving notes, Please try after some time")});$scope.closePopup('obEditnotes',$scope.lockNotesObj)};$scope.getTimeStamp=function(){var notes=$('#obflowsheeteditnotes').val();let timestampValue=getNotesTimeStamp();if(notes==''||notes==='undefined'){$('#obflowsheeteditnotes').val(timestampValue)}else{var totalNotes=notes+"\n "+timestampValue;$('#obflowsheeteditnotes').val(totalNotes)}};$scope.updateNotes=function(objId){$scope.lockObj={};$scope.lockNotesObj={};var lockObjNotes="";if(objId>0){lockObjNotes={formName:"frmOBNotes",uniqueKey:"frmOBNotes"+$scope.pregId,g_cancel:false,strKey:"",categoryId:objId,isOpenform:false};function acquireFormLockCallBack(){if(lockObjNotes.g_cancel){$scope.closePopup('obEditnotes',lockObjNotes);return}}acquireFormLock(lockObjNotes,acquireFormLockCallBack)}$scope.lockObj=lockObjNotes;$scope.lockNotesObj=lockObjNotes;$scope.loadOBNotesEditPopup();if(objId<=0){$scope.userLableName="Created by";$scope.totalEditNotesItemList={strVisitId:'0',CreatedDate:'',strNotes:'',CreatedBy:'',strInitial:'',strLock:''};var today=new Date;var dd=today.getDate();var mm=today.getMonth()+1;var yyyy=today.getFullYear();if(dd<10){dd='0'+dd}if(mm<10){mm='0'+mm}var today=mm+'/'+dd+'/'+yyyy;$scope.totalEditNotesItemList.CreatedDate=today;$scope.totalEditNotesItemList.CreatedBy=$scope.userName}else{$scope.totalEditNotesItemList=[];$scope.userLableName="Updated by";PregnancyDataServices.getAllNotesData($scope.pregId,$scope.userId,objId,$scope.sortOrder,$scope.sortedByColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);var value=jsonData.Envelope.Body["return"].encounter;$scope.totalEditNotesItemList=value;$scope.totalEditNotesItemList.CreatedBy=$scope.userName}).error(function(){ecwAlert("Internal Error occured while loading OB notes data !")})}};$scope.deleteNotes=function(objId,index){if(!isLockMine2($scope.lockNotesObj)){$scope.loadNotesData("",'editMode');$scope.closePopup('obEditnotes',$scope.lockNotesObj);return false}showAlertMessage("Are you sure you want to delete this notes ?",'','ConfirmMsg','setOBDeleteNotes','obpnController');$scope.setOBDeleteNotes=function(result){if(result==='yes'){PregnancyDataServices.deletePregnancyData($scope.pregId,$scope.patientId,objId,"Notes",$scope.userId,$scope.encounterId).success(function(data){$scope.totalNotesItemList.splice(index,1);$scope.closePopup('obEditnotes',$scope.lockNotesObj);$scope.loadNotesData("",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while deleting notes, Please try after some time")})}}};$scope.lockUnlockNotes=function(objId,lvalue){var msg;if(lvalue==1){msg='Are you sure you want to lock this notes?'}else{msg='Are you sure you want to unLock this notes?'}showAlertMessage(msg,'','ConfirmMsg','setLockUnlockNotes','obpnController');$scope.setLockUnlockNotes=function(result){if(result==='yes'){$http({method:"GET",url:'/mobiledoc/jsp/obfipad/setLockUnlockOB_iPad.jsp',cache:false,params:{PregId:$scope.pregId,patientId:objId,keyName:'OBF Notes',lockValue:lvalue,itemValue:'',ItemId:0,TrUserId:$scope.userId,encId:$scope.encounterId,device:'webEmr',nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadNotesData("",'editMode');$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(data,status,headers,config){ecwAlert("Error in locking notes.")})}}};$scope.BrowseLab=function(objType){$scope.attachedToUrl="";var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:objType,parentName:'AddNewOrder',requestedFrom:'progressNote',context:'progress_notes',nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:getDependencies("manageOrders")}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp"),controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){},function(responseObj){if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$scope.loadFlowSheetData("","",'editMode')})})};$scope.closeAbnDialog=function(){$('#abnselectionDialog').modal('hide');$('body').find('.modal-backdrop').last().remove()};$scope.newLabDIClick=function(nType,nReportId,componentIdIndex){$scope.nPatientId=$scope.patientId;$scope.attachedToUrl="";$ocLazyLoad.load({name:'labreport',serie:true,files:getDependencies('labreport')}).then(function(){$scope.attachedToUrl='/mobiledoc/jsp/webemr/labs/report/LabReport.jsp?ReportId='+nReportId+'&ccDoctorId=0&tabId=0&EncounterId='+$scope.encounterId+'&Type='+nType+'&ProviderId='+$scope.doctorId+'&TrUserId='+$scope.userId+'&patientId='+$scope.nPatientId+'&rowIndex=0&randomId='+Math.random()+'&context=LABDIPROC_HISTORY_SCREEN'},function(e){console.log(e)});var index=-1;for(var i=0;i<$scope.labAttributeDetails.length;i++){if(nReportId==$scope.labAttributeDetails[i].nReportId){index=i;break}}try{timer2=$timeout(function(){$("#obLabsDILink1ngR"+componentIdIndex).addClass("collapsed");$("#labAttributeopoup_"+nReportId).removeClass("in")},500)}catch(e){}if(index>=0){$scope.labAttributeDetails.splice(index,1)}};$scope.openNewLabDI=function(reportId){$scope.newLabDIClick($scope.iCareType,reportId)};$scope.refreshLabDIProcHxScreen=function(){$scope.loadFlowSheetData("","",'editMode');if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$scope.getProcedureOrdersData("","editMode")};$scope.showLabAttributeData=function(nReportId,nItemId){var bLabAttributeExists=checkLabAttribute(nReportId,$scope.labAttributeDetails);if(!bLabAttributeExists){var labAttDetails={nReportId:nReportId,nItemId:nItemId,nTrUserId:$scope.userId,nPatientId:$scope.patientId,nLabType:0,sPatientDOB:$scope.user.ptDOB};var aPromise=PregnancyDataServices.getLabAttributeDetails(labAttDetails);aPromise.then(function(object){$scope.appendLabAttribute(object,nReportId)},function errorCallback(error){ecwAlert(error)})}};$scope.appendLabAttribute=function(labAttJsonObj,nReportId){var sTempJsonObj=[];sTempJsonObj=$scope.labAttributeDetails;sTempJsonObj.push(labAttJsonObj);$scope.labAttributeDetails=sTempJsonObj};$scope.changeLabView=function(val){$scope.sortLabOrder="DESC";$scope.sortLabImagingOrder="DESC";$scope.sortTemplateLabOrder="DESC";$scope.sortedByOBLabColName="1";if(document.getElementById("labC").checked){$scope.EnableModernViewLab=0;$scope.loadLabsDIData("","",'editMode')}else{$scope.EnableModernViewLab=1;$scope.loadModernLabData("",'editMode')}};$scope.loadLabsDIData=function(labsXml,ImagingXml,objMode){if(objMode==='readMode'){$("#OBLabs1").addClass("OBClassiclabHeader");$("#OBImaging1").addClass("OBClassicDIHeader");var jsonData=obflowmainx2js.xml_str2json(labsXml);populateLabsData(jsonData);jsonData=obflowmainx2js.xml_str2json(ImagingXml);populateImagingData(jsonData)}else{PregnancyDataServices.getLabsImaging($scope.pregId,$scope.patientId,1,$scope.sortLabImagingOrder,$scope.sortedByOBLabColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateLabsData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading labs !")});PregnancyDataServices.getLabsImaging($scope.pregId,$scope.patientId,2,$scope.sortLabOrder,$scope.sortedByOBLabColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateImagingData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading Imaging !")})}};$scope.loadModernLabData=function(labtemplateXml,objMode){if(objMode==='readMode'){$("#labTrimester1").addClass("OBlabHeader");var jsonData=(new X2JS).xml_str2json(labtemplateXml);populateTrimesetrBasedLabData(jsonData)}else{PregnancyDataServices.getTrimesterBasedLabsImaging($scope.pregId,$scope.patientId,$scope.sortTemplateLabOrder,$scope.sortedByOBLabColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateTrimesetrBasedLabData(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading trimester based Labs/Imaging !")})}};$scope.showSaveMessage=function(message){$("#showDiv").css({display:'block'});$scope.alertMessage=message;$("#showDiv").css('background','#F0E68C');$("#showDiv").fadeIn('slow').delay(2e3).fadeOut('slow')};$scope.selectThisOrder=function(type,assmtid,temp){if(assmtid!=undefined&&assmtid!=0)$scope.asmtid=assmtid;else $scope.asmtid=0};$scope.orderLabModern=function(labId,cType,trimesterId,MapId,overdueFlag){var strimesterName;var currentTrimId="0";if($scope.GA<13){currentTrimId="1";strimesterName="first trimester"}else if($scope.GA>=13&&$scope.GA<=26){currentTrimId="2";strimesterName="second trimester"}else if($scope.GA>26){currentTrimId="3";strimesterName="third trimester"}if(currentTrimId!==trimesterId){var strShowMsg="Pregnancy is in "+strimesterName+". Order will be placed into "+strimesterName+". Do you want to order?";ecwConfirm(strShowMsg,"eClinicalWorks",function(){$scope.OrderModernLabAfterOverdueCheck(labId,cType,trimesterId,MapId)},function(){return},"",false,true,"Yes","No","",false)}else{$scope.OrderModernLabAfterOverdueCheck(labId,cType,trimesterId,MapId)}};$scope.OrderModernLabAfterOverdueCheck=function(labId,cType,trimesterId,MapId){$scope.labId=labId;$scope.cType=cType;$scope.trimesterId=trimesterId;$scope.MapId=MapId;$scope.loadAssessmentPopup();PregnancyDataServices.getPastAssessmentList($scope.patientId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populatePastAssessMentList(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading trimester based Labs/Imaging !")});PregnancyDataServices.getAssessmentListofEnc($scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateAssessmentListOfEnc(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading trimester based Labs/Imaging !")});PregnancyDataServices.getProblem($scope.patientId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateProblemList(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading trimester based Labs/Imaging !")})};$scope.saveLabData=function(){if($scope.diagnosisForICDSupplementData===undefined){$scope.diagnosisForICDSupplementData={specify:'',notes:'',OnsetDate:'',risk:''}}$http({method:"GET",url:'/mobiledoc/jsp/obfacog/save_obf_care_Data.jsp',cache:false,"async":true,params:{pregid:$scope.pregId,encid:$scope.encounterId,pid:$scope.patientId,hlabId:$scope.labId,hlabtype:$scope.cType,htrimId:$scope.trimesterId,hMapId:$scope.MapId,asmtid:$scope.asmtid,specify:$scope.diagnosisForICDSupplementData.specify,notes:$scope.diagnosisForICDSupplementData.notes,OnsetDate:$scope.diagnosisForICDSupplementData.OnsetDate,risk:$scope.diagnosisForICDSupplementData.risk,hNA:336,TrUserId:$scope.userId,nd:(new Date).getTime()}}).success(function(data,status,headers,config){$scope.loadModernLabData("",'editMode');$scope.closePopup('oblaborder')}).error(function(data,status,headers,config){ecwAlert("Internal Error occured while saving trimester based Labs/Imaging")})};$scope.OrderOBLab=function(careType){var lockObjOrderLabs={formName:"frmOBOrderLabs",uniqueKey:"frmOBOrderLabs"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};var lockObjOrderImaging={formName:"frmOBOrderImaging",uniqueKey:"frmOBOrderImaging"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};$scope.lockObj={};$scope.lockLabObj={};$scope.lockImgObj={};$scope.iCareType=careType;if(careType==='0'){$scope.Labtitle="Order Lab";function acquireFormLockCallBack(){if(lockObjOrderLabs.g_cancel){$scope.closePopup('obOrderLabModal',lockObjOrderLabs);return}}acquireFormLock(lockObjOrderLabs,acquireFormLockCallBack);$scope.lockObj=lockObjOrderLabs;$scope.lockLabObj=lockObjOrderLabs}else{$scope.Labtitle="Order Imaging";function acquireFormLockCallBack(){if(lockObjOrderImaging.g_cancel){$scope.closePopup('obOrderLabModal',lockObjOrderImaging);return}}acquireFormLock(lockObjOrderImaging,acquireFormLockCallBack);$scope.lockObj=lockObjOrderImaging;$scope.lockImgObj=lockObjOrderImaging}PregnancyDataServices.getOrderLabData($scope.pregId,$scope.patientId,careType,'','show lab',$scope.encounterId,'').success(function(data){var labjson=(new X2JS).xml_str2json(data);populateLabImagingData(labjson);$("#obOrderLabModal").modal('show')}).error(function(){ecwAlert("Internal Error occured while loading labs/Imaging !")})};$scope.openCumulativeReportFromLabDI=function(){$scope.attachedToUrl="";var nType;if($scope.iCareType!=undefined)nType=$scope.iCareType;else nType=0;var strUrl="/mobiledoc/jsp/webemr/labs/viewallreports/cumulativeReport.jsp?patientId="+$scope.patientId+'&nType='+nType+'&randomId='+Math.random();$ocLazyLoad.load({name:'CumulativeReport',files:getDependencies('cumuLativeReport')}).then(function(){$scope.attachedToUrl=makeURL(strUrl)},function(e){console.log(e)})};$scope.OrderSelectedOBLab=function(careT){var selectedCareId="";var type="";if(careT=='0'){if(!isLockMine2($scope.lockLabObj)){if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$scope.closePopup('obOrderLabModal',$scope.lockLabObj);return false}type="lab";$scope.closePopup('obOrderLabModal',$scope.lockLabObj)}else{if(!isLockMine2($scope.lockImgObj)){if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$scope.closePopup('obOrderLabModal',$scope.lockLabObj);return false}type="imaging";$scope.closePopup('obOrderLabModal',$scope.lockImgObj)}$('div#labsDiv input[type=checkbox]').each(function(){if($(this).is(":checked")&&$(this).is(":disabled")==false){if(selectedCareId==""){if($(this).attr('value')!=''){selectedCareId=$(this).attr('value')}}else{if($(this).attr('value')!=''){selectedCareId=selectedCareId+"|"+$(this).attr('value')}}}});if(selectedCareId!=""){var uName=$scope.userName;var ufName=uName.substring(uName.indexOf(',')+1,uName.lastIndexOf(','));PregnancyDataServices.getOrderLabData($scope.pregId,$scope.patientId,careT,selectedCareId,'order lab',$scope.encounterId,ufName).success(function(data){if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$("#obOrderLabModal").modal('hide')}).error(function(){ecwAlert("Internal Error occured while adding "+type+" !")})}else{var flagOfDis=false;$('div#labsDiv input[type=checkbox]').each(function(){if($(this).is(":disabled")==false){flagOfDis=true}});if(flagOfDis){var disMessage="Please select at least one "+type;BootstrapDialog.show({title:"eClinicalWorks",message:disMessage,buttons:[{label:'OK',cssClass:'btn-lgrey btn-xs okButtonFromDialog',action:function(dialog){dialog.close()}}]})}else{var disMessage="No "+type+" found";BootstrapDialog.show({title:"eClinicalWorks",message:disMessage,buttons:[{label:'OK',cssClass:'btn-lgrey btn-xs okButtonFromDialog',action:function(dialog){dialog.close();$("#obOrderLabModal").modal('hide')}}]})}}};$scope.setReportIdForLabDIPro=function(data){if(data!=null&&data!=undefined&&data.length>0){if(document.getElementById("labC").checked){$scope.loadLabsDIData("","",'editMode')}else{$scope.loadModernLabData("",'editMode')}$("#obOrderLabModal").modal('hide')}};$scope.loadRisksData=function(atRisksXml,hgRisksXml,objMode){if(objMode==='readMode'){var risksJson=obflowmainx2js.xml_str2json(atRisksXml);populateRisksData(risksJson,'atrisk');risksJson=obflowmainx2js.xml_str2json(hgRisksXml);populateRisksData(risksJson,'highrisk')}else{PregnancyDataServices.getAtRiskData($scope.pregId,$scope.patientId).success(function(data){var risksJson=(new X2JS).xml_str2json(data);populateRisksData(risksJson,'atrisk')}).error(function(){ecwAlert("Internal Error occured while loading at risks data !")});PregnancyDataServices.getHighRiskData($scope.pregId,$scope.patientId).success(function(data){var risksJson=(new X2JS).xml_str2json(data);populateRisksData(risksJson,'highrisk')}).error(function(){ecwAlert("Internal Error occured while loading high risks data !")})}};$scope.editRisksData=function(){$scope.lockObj={};$scope.riskLockObject={};var lockObjRisks={formName:"frmOBRisks",uniqueKey:"frmOBRisks"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};acquireFormLock(lockObjRisks,acquireFormLockCallBack);function acquireFormLockCallBack(){if(lockObjRisks.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjRisks);return}}$scope.lockObj=lockObjRisks;$scope.riskLockObject=lockObjRisks;$scope.totalEditAtRisksList=[];$scope.totalEditHighRisksList=[];angular.copy($scope.totalAtRisksList,$scope.totalEditAtRisksList);angular.copy($scope.totalHighRisksList,$scope.totalEditHighRisksList);angular.forEach($scope.totalAtRisksList,function(obj){if(obj.strLockInd=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.lockRisks=function(){$scope.chkLock=true;$scope.saveRisksData()};$scope.unLockRisks=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"OBrisk",$scope.userId,$scope.encounterId).success(function(data){$scope.loadRisksData("","",'editMode');$scope.releaseLockPopup($scope.riskLockObject);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while locking Risks, Please try after some time")})};$scope.saveRisksData=function(onTabChange){if(!isLockMine2($scope.riskLockObject)){$scope.loadRisksData("","",'editMode');$scope.loadProblemListData("",'editMode');$scope.loadPtProblemListData("",'editMode');$scope.loadPatientHeader();$scope.closePopup('obEditAddPopupWindow',$scope.riskLockObject);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBRisks","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrAtRistItemId=[];$scope.arrAtRiskValue=[];$scope.arrHgRiskId=[];$scope.arrHgRiskValue=[];$scope.arrAtRiskPL=[];$scope.arrHgRiskPL=[];$scope.arrAtPropId=[];$scope.arrHgPropId=[];var eletAtId=document.getElementsByName("arAtRiskId");var eletAtval=document.getElementsByName("arAtRiskValue");var eletAtPropId=document.getElementsByName("arAtRiskPropId");var eletHgId=document.getElementsByName("arHgRiskId");var eletHgval=document.getElementsByName("arHgRiskValue");var eletHgPropId=document.getElementsByName("arHgRiskPropId");for(var j=0;j<eletAtId.length;j++){$scope.arrAtRistItemId[j]=eletAtId[j].value;$scope.arrAtRiskValue[j]=eletAtval[j].value;$scope.arrAtPropId[j]=eletAtPropId[j].value;if($('#chk'+eletAtId[j].value).is(':checked')){$scope.arrAtRiskPL.push(1)}else{$scope.arrAtRiskPL.push(0)}}for(var j=0;j<eletHgId.length;j++){$scope.arrHgRiskId[j]=eletHgId[j].value;$scope.arrHgRiskValue[j]=eletHgval[j].value;$scope.arrHgPropId[j]=eletHgPropId[j].value;if($('#chk'+eletHgId[j].value).is(':checked')){$scope.arrHgRiskPL.push(1)}else{$scope.arrHgRiskPL.push(0)}}PregnancyDataServices.setAtRiskData($scope.pregId,$scope.encounterId,$scope.arrAtRistItemId,$scope.arrAtRiskValue,$scope.arrAtRiskPL,$scope.arrAtPropId,$scope.userId,$scope.patientId,$scope.userName).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"OBrisk",$scope.userId,$scope.encounterId).success(function(data){$scope.loadRisksData("","",'editMode');$scope.loadProblemListData("",'editMode');$scope.loadPtProblemListData("",'editMode');$scope.loadPatientHeader()}).error(function(){ecwAlert("Internal Error occured while locking risks, Please try after some time")})}else{$scope.loadRisksData("","",'editMode');$scope.loadProblemListData("",'editMode');$scope.loadPtProblemListData("",'editMode');$scope.loadPatientHeader()}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving risks, Please try after some time")});PregnancyDataServices.setHighRiskData($scope.pregId,$scope.encounterId,$scope.arrHgRiskId,$scope.arrHgRiskValue,$scope.arrHgRiskPL,$scope.arrHgPropId,$scope.userId,$scope.patientId,$scope.userName).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"OBrisk",$scope.userId,$scope.encounterId).success(function(data){$scope.loadRisksData("","",'editMode');$scope.loadProblemListData("",'editMode');$scope.loadPtProblemListData("",'editMode');$scope.loadPatientHeader()}).error(function(){ecwAlert("Internal Error occured while locking risks, Please try after some time")})}else{$scope.loadRisksData("","",'editMode');$scope.loadProblemListData("",'editMode');$scope.loadPtProblemListData("",'editMode');$scope.loadPatientHeader()}$scope.chkLock=false}).error(function(){ecwAlert("Internal Error occured while saving risks, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.riskLockObject)}else{$scope.releaseLockPopup($scope.riskLockObject)}};$scope.releaseRiskConcurrLock=function(){if($scope.riskLockObject){$scope.releaseLockPopup($scope.riskLockObject)}};$scope.loadPlansData=function(plasnFTXml,plansSTXml,palsnTTXml,objMode){if(objMode==='readMode'){var plansJson=obflowmainx2js.xml_str2json(plasnFTXml);populatePlansData(plansJson,'first');plansJson=obflowmainx2js.xml_str2json(plansSTXml);populatePlansData(plansJson,'second');plansJson=obflowmainx2js.xml_str2json(palsnTTXml);populatePlansData(plansJson,'third')}else{PregnancyDataServices.getPlansFirstTrimesterData($scope.pregId).success(function(data){var plansJson=(new X2JS).xml_str2json(data);populatePlansData(plansJson,'first')}).error(function(){ecwAlert("Internal Error occured while loading plans data !")});PregnancyDataServices.getPlansSecondTrimesterData($scope.pregId).success(function(data){var plansJson=(new X2JS).xml_str2json(data);populatePlansData(plansJson,'second')}).error(function(){ecwAlert("Internal Error occured while loading plans data !")});PregnancyDataServices.getPlansThirdTrimesterData($scope.pregId).success(function(data){var plansJson=(new X2JS).xml_str2json(data);populatePlansData(plansJson,'third')}).error(function(){ecwAlert("Internal Error occured while loading plans data !")})}};$scope.editPlansData=function(){$scope.lockObj={};$scope.plansLockObj={};var lockObjOBPlans={formName:"frmOBPlans",uniqueKey:"frmOBPlans"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjOBPlans.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjOBPlans);return}}acquireFormLock(lockObjOBPlans,acquireFormLockCallBack);$scope.lockObj=lockObjOBPlans;$scope.plansLockObj=lockObjOBPlans;$scope.PPEditFlag=false;$scope.totalEditPlansFirstTrimester=[];$scope.totalEditPlansSecondTrimester=[];$scope.totalEditPlansThirdTrimester=[];angular.copy($scope.totalPlansFirstTrimester,$scope.totalEditPlansFirstTrimester);angular.copy($scope.totalPlansSecondTrimester,$scope.totalEditPlansSecondTrimester);angular.copy($scope.totalPlansThirdTrimester,$scope.totalEditPlansThirdTrimester);angular.forEach($scope.totalPlansFirstTrimester,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultPlans=function(){var cntFT=0;var cntST=0;var cntTT=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setCopyDefaultPlansValue','obpnController');$scope.setCopyDefaultPlansValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditPlansFirstTrimester.length;i++){if($scope.totalEditPlansFirstTrimester[i].strDef!==''){$scope.totalEditPlansFirstTrimester[cntFT].strDate=$scope.totalEditPlansFirstTrimester[i].strDef}cntFT++}for(var i=0;i<$scope.totalEditPlansSecondTrimester.length;i++){if($scope.totalEditPlansSecondTrimester[i].strDef!==''){$scope.totalEditPlansSecondTrimester[cntST].strDate=$scope.totalEditPlansSecondTrimester[i].strDef}cntST++}for(var i=0;i<$scope.totalEditPlansThirdTrimester.length;i++){if($scope.totalEditPlansThirdTrimester[i].strDef!==''){$scope.totalEditPlansThirdTrimester[cntTT].strDate=$scope.totalEditPlansThirdTrimester[i].strDef}cntTT++}}}};$scope.DefaultPls=function(section){var cnt=0;if(section==='FT'){for(var i=0;i<$scope.totalEditPlansFirstTrimester.length;i++){if($scope.totalEditPlansFirstTrimester[i].strDef!==''){$scope.totalEditPlansFirstTrimester[cnt].strDate=$scope.totalEditPlansFirstTrimester[i].strDef}cnt++}}else if(section==='ST'){cnt=0;for(var i=0;i<$scope.totalEditPlansSecondTrimester.length;i++){if($scope.totalEditPlansSecondTrimester[i].strDef!==''){$scope.totalEditPlansSecondTrimester[cnt].strDate=$scope.totalEditPlansSecondTrimester[i].strDef}cnt++}}else{cnt=0;for(var i=0;i<$scope.totalEditPlansThirdTrimester.length;i++){if($scope.totalEditPlansThirdTrimester[i].strDef!==''){$scope.totalEditPlansThirdTrimester[cnt].strDate=$scope.totalEditPlansThirdTrimester[i].strDef}cnt++}}};$scope.ClearPlns=function(section){var cnt=0;if(section==='FT'){for(var i=0;i<$scope.totalEditPlansFirstTrimester.length;i++){$scope.totalEditPlansFirstTrimester[cnt].strDate="";cnt++}}else if(section==='ST'){cnt=0;for(var i=0;i<$scope.totalEditPlansSecondTrimester.length;i++){$scope.totalEditPlansSecondTrimester[cnt].strDate="";cnt++}}else{cnt=0;for(var i=0;i<$scope.totalEditPlansThirdTrimester.length;i++){$scope.totalEditPlansThirdTrimester[cnt].strDate="";cnt++}}};$scope.mergeDefaultPlans=function(){var cntFT=0;var cntST=0;var cntTT=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergeDefaultPlansValue','obpnController');$scope.setMergeDefaultPlansValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditPlansFirstTrimester.length;i++){if($scope.totalEditPlansFirstTrimester[i].strDate.length<1){$scope.totalEditPlansFirstTrimester[cntFT].strDate=$scope.totalEditPlansFirstTrimester[i].strDef}cntFT++}for(var i=0;i<$scope.totalEditPlansSecondTrimester.length;i++){if($scope.totalEditPlansSecondTrimester[i].strDate.length<1){$scope.totalEditPlansSecondTrimester[cntST].strDate=$scope.totalEditPlansSecondTrimester[i].strDef}cntST++}for(var i=0;i<$scope.totalEditPlansThirdTrimester.length;i++){if($scope.totalEditPlansThirdTrimester[i].strDate.length<1){$scope.totalEditPlansThirdTrimester[cntTT].strDate=$scope.totalEditPlansThirdTrimester[i].strDef}cntTT++}}}};$scope.savePlansData=function(onTabChange){if(!isLockMine2($scope.plansLockObj)){$scope.loadPlansData("","","",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.plansLockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBPlans","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrPlansItemId=[];$scope.arrPlansValue=[];$scope.arrPlansComments=[];var eletId=document.getElementsByName("arPlansId");var eletval=document.getElementsByName("arPlansValue");var eletcom=document.getElementsByName("arPlansCom");for(var j=0;j<eletId.length;j++){$scope.arrPlansItemId[j]=eletId[j].value;$scope.arrPlansValue[j]=eletval[j].value;$scope.arrPlansComments[j]=eletcom[j].value}PregnancyDataServices.setPlansData($scope.pregId,$scope.encounterId,$scope.arrPlansItemId,$scope.arrPlansValue,$scope.arrPlansComments,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"Plans",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPlansData("","","",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking plans, Please try after some time")})}else{$scope.loadPlansData("","","",'editMode')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving plans, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.plansLockObj)}else{$scope.releaseLockPopup($scope.plansLockObj)}};$scope.lockPlans=function(){$scope.chkLock=true;$scope.savePlansData()};$scope.unLockPlans=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"Plans",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPlansData("","","",'editMode');$scope.releaseLockPopup($scope.plansLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking plans, Please try after some time")})};$scope.releasePlanConcurLock=function(){if($scope.plansLockObj){$scope.releaseLockPopup($scope.plansLockObj)}};$scope.loadDischargeData=function(deldtXml,compXml,delInfoXml,neoInfoXml,matInfoXml,neoBabyInfoXml,objMode){if(objMode==="readMode"){var dischargeJson=obflowmainx2js.xml_str2json(deldtXml);populateDischargeData(dischargeJson,'deldates');dischargeJson=obflowmainx2js.xml_str2json(compXml);populateDischargeData(dischargeJson,'discomp');dischargeJson=obflowmainx2js.xml_str2json(delInfoXml);populateDischargeData(dischargeJson,'delinfo');dischargeJson=obflowmainx2js.xml_str2json(neoInfoXml);populateDischargeData(dischargeJson,'neoinfo');dischargeJson=obflowmainx2js.xml_str2json(matInfoXml);populateDischargeData(dischargeJson,'matinfo');dischargeJson=obflowmainx2js.xml_str2json(neoBabyInfoXml);populateMultipleBirthDischargeData(dischargeJson,'neobabyinfo')}else{PregnancyDataServices.getDischargeDeliveryDatesData($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateDischargeData(dischargeJson,'deldates')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")});PregnancyDataServices.getDischargeComplicationsData($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateDischargeData(dischargeJson,'discomp')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")});PregnancyDataServices.getDischargeDeliveryinfoData($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateDischargeData(dischargeJson,'delinfo')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")});PregnancyDataServices.getDischargeNeonatalinfoData($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateDischargeData(dischargeJson,'neoinfo')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")});PregnancyDataServices.getDischargeMaternalinfoData($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateDischargeData(dischargeJson,'matinfo')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")});PregnancyDataServices.getDischargeNeonatalBabyInfo($scope.pregId).success(function(data){var dischargeJson=(new X2JS).xml_str2json(data);populateMultipleBirthDischargeData(dischargeJson,'neobabyinfo')}).error(function(){ecwAlert("Internal Error occured while loading discharge data !")})}};$scope.editDischargeData=function(){$scope.lockObj={};$scope.dischageLockObj={};var lockObjDischarge={formName:"frmOBDischarge",uniqueKey:"frmOBDischarge"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjDischarge.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjDischarge);return}}acquireFormLock(lockObjDischarge,acquireFormLockCallBack);$scope.lockObj=lockObjDischarge;$scope.dischageLockObj=lockObjDischarge;$scope.PPEditFlag=false;$scope.totalEditDeliverydatesList=[];$scope.totalEditDischargeCompList=[];$scope.totalEditDeliveryInfoList=[];$scope.totalEditDischargeneonatalinfoList=[];$scope.totalEditDischargematernalinfoList=[];$scope.totalEditDischargeneonatalBabyinfoList=[];angular.copy($scope.totalDeliverydatesList,$scope.totalEditDeliverydatesList);angular.copy($scope.totalDischargeCompList,$scope.totalEditDischargeCompList);angular.copy($scope.totalDeliveryInfoList,$scope.totalEditDeliveryInfoList);angular.copy($scope.totalDischargeneonatalinfoList,$scope.totalEditDischargeneonatalinfoList);angular.copy($scope.totalDischargematernalinfoList,$scope.totalEditDischargematernalinfoList);angular.copy($scope.totalDischargeneonatalBabyinfoList,$scope.totalEditDischargeneonatalBabyinfoList);angular.forEach($scope.totalDeliverydatesList,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.defaultDischarge=function(){var cnt=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultDischargeValue','obpnController');$scope.setDefaultDischargeValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditDeliverydatesList.length;i++){if($scope.totalEditDeliverydatesList[i].strDef!==''){$scope.totalEditDeliverydatesList[cnt].strDate=$scope.totalEditDeliverydatesList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeCompList.length;i++){if($scope.totalEditDischargeCompList[i].strDef!==''){$scope.totalEditDischargeCompList[cnt].strDate=$scope.totalEditDischargeCompList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDeliveryInfoList.length;i++){if($scope.totalEditDeliveryInfoList[i].strDef!==''){$scope.totalEditDeliveryInfoList[cnt].strDate=$scope.totalEditDeliveryInfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeneonatalinfoList.length;i++){if($scope.totalEditDischargeneonatalinfoList[i].strDef!==''){$scope.totalEditDischargeneonatalinfoList[cnt].strDate=$scope.totalEditDischargeneonatalinfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargematernalinfoList.length;i++){if($scope.totalEditDischargematernalinfoList[i].strDef!==''){$scope.totalEditDischargematernalinfoList[cnt].strDate=$scope.totalEditDischargematernalinfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeneonatalBabyinfoList.length;i++){if($scope.totalEditDischargeneonatalBabyinfoList[i].strDef!==''){$scope.totalEditDischargeneonatalBabyinfoList[cnt].strDate=$scope.totalEditDischargeneonatalBabyinfoList[i].strDef}cnt++}}}};$scope.mergeDefaultDischarge=function(){var cnt=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergeDefaultDischargeValue','obpnController');$scope.setMergeDefaultDischargeValue=function(result){if(result==='yes'){for(var i=0;i<$scope.totalEditDeliverydatesList.length;i++){if($scope.totalEditDeliverydatesList[i].strDate.length<1){$scope.totalEditDeliverydatesList[cnt].strDate=$scope.totalEditDeliverydatesList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeCompList.length;i++){if($scope.totalEditDischargeCompList[i].strDate.length<1){$scope.totalEditDischargeCompList[cnt].strDate=$scope.totalEditDischargeCompList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDeliveryInfoList.length;i++){if($scope.totalEditDeliveryInfoList[i].strDate.length<1){$scope.totalEditDeliveryInfoList[cnt].strDate=$scope.totalEditDeliveryInfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeneonatalinfoList.length;i++){if($scope.totalEditDischargeneonatalinfoList[i].strDate.length<1){$scope.totalEditDischargeneonatalinfoList[cnt].strDate=$scope.totalEditDischargeneonatalinfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargematernalinfoList.length;i++){if($scope.totalEditDischargematernalinfoList[i].strDate.length<1){$scope.totalEditDischargematernalinfoList[cnt].strDate=$scope.totalEditDischargematernalinfoList[i].strDef}cnt++}cnt=0;for(var i=0;i<$scope.totalEditDischargeneonatalBabyinfoList.length;i++){if($scope.totalEditDischargeneonatalBabyinfoList[i].strDate.length<1){$scope.totalEditDischargeneonatalBabyinfoList[cnt].strDate=$scope.totalEditDischargeneonatalBabyinfoList[i].strDef}cnt++}}}};$scope.saveDischargeData=function(onTabChange){if(!isLockMine2($scope.dischageLockObj)){$scope.loadDischargeData("","","","","","",'editMode');$scope.loadPregListData("",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.dischageLockObj);return false}if(!$scope.validateDateForDischarge())return;var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBDischarge","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrDisItemId=[];$scope.arrDisValue=[];$scope.arrDisBabyItemId=[];$scope.arrDisBabyValue=[];$scope.arrDisBabyNo=[];var eletId=document.getElementsByName("ardisId");var eletval=document.getElementsByName("ardisValue");var eletBabyId=document.getElementsByName("ardisbabyId");var eletBabyval=document.getElementsByName("ardisbabyValue");var eletBabyNo=document.getElementsByName("ardisbabyNo");for(var j=0;j<eletId.length;j++){$scope.arrDisItemId[j]=eletId[j].value;$scope.arrDisValue[j]=eletval[j].value}for(var i=0;i<eletBabyId.length;i++){$scope.arrDisBabyItemId[i]=eletBabyId[i].value;$scope.arrDisBabyValue[i]=eletBabyval[i].value;$scope.arrDisBabyNo[i]=eletBabyNo[i].value}if($scope.babyId!='0'){PregnancyDataServices.setDischargeBabyData($scope.pregId,$scope.encounterId,$scope.arrDisBabyItemId,$scope.arrDisBabyValue,$scope.arrDisBabyNo,$scope.userId).success(function(data){}).error(function(){ecwAlert("Internal Error occured while saving discharge, Please try after some time")})}PregnancyDataServices.setDischargeData($scope.pregId,$scope.encounterId,$scope.arrDisItemId,$scope.arrDisValue,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"Discharge",$scope.userId,$scope.encounterId).success(function(data){$scope.loadDischargeData("","","","","","",'editMode');$scope.loadPregListData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking discharge, Please try after some time")})}else{$scope.loadDischargeData("","","","","","",'editMode');$scope.loadPregListData("",'editMode')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving discharge, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.dischageLockObj)}else{$scope.releaseLockPopup($scope.dischageLockObj)}};$scope.lockDischarge=function(){$scope.chkLock=true;$scope.saveDischargeData()};$scope.unLockDischarge=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"Discharge",$scope.userId,$scope.encounterId).success(function(data){$scope.loadDischargeData("","","","","","",'editMode');$scope.releaseLockPopup($scope.dischageLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking discharge, Please try after some time")})};$scope.releaseDischargeConcurLock=function(){if($scope.dischageLockObj){$scope.releaseLockPopup($scope.dischageLockObj)}};$scope.loadPostPartumData=function(postpartumXml,objMode){if(objMode==="readMode"){var postpartumValJson=obflowmainx2js.xml_str2json(postpartumXml);populatePostPartumData(postpartumValJson)}else{PregnancyDataServices.getPostPartumData($scope.pregId).success(function(data){var postpartumValJson=(new X2JS).xml_str2json(data);populatePostPartumData(postpartumValJson)}).error(function(){ecwAlert("Internal Error occured while loading post partum data !")})}};$scope.calculateBmiValue=function(obj){var weight=0;var height=0;var finalBmi;try{var len=$scope.FlowsheetHeaderItemList.length;for(var i=0;i<len;i++){if($scope.FlowsheetHeaderItemList[i].strName==="Weight"){weight=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strName==="Height"){height=$scope.FlowsheetHeaderItemList[i].strDate}}if(weight>0&&height>0){var d1=0;var d2=0;if($scope.WtUOM==="lbs"||$scope.WtUOM==="LBS"){d1=weight/2.2046}else{d1=weight}if($scope.HtUOM==="cm"||$scope.HtUOM==="CM"){d2=height}else{d2=height*2.54}d2=d2*d2;d2=d2/1e4;finalBmi=d1/d2}$scope.totalBMI=finalBmi.toFixed(3)}catch(e){}};$scope.editPostpartum=function(){$scope.lockObj={};$scope.postPartLockObj={};var lockObjPostpartum={formName:"frmOBPostPartum",uniqueKey:"frmOBPostPartum"+$scope.pregId,g_cancel:false,strKey:"",isOpenform:false};function acquireFormLockCallBack(){if(lockObjPostpartum.g_cancel){$scope.closePopup('obEditAddPopupWindow',lockObjPostpartum);return}}acquireFormLock(lockObjPostpartum,acquireFormLockCallBack);$scope.lockObj=lockObjPostpartum;$scope.postPartLockObj=lockObjPostpartum;$scope.PPEditFlag=false;$scope.PostPartumItemList=[];angular.copy($scope.totalPostPartumList,$scope.PostPartumItemList);angular.forEach($scope.PostPartumItemList,function(obj){if(obj.strLock=='1'){$scope.strLock=true}else{$scope.strLock=false}})};$scope.deafultPostPartum=function(){var cnt=0;showAlertMessage("Are you sure you want to set all defaults ?",'','ConfirmMsg','setDefaultPostPartumValue','obpnController');$scope.setDefaultPostPartumValue=function(result){if(result==='yes'){for(var i=0;i<$scope.PostPartumItemList.length;i++){if($scope.PostPartumItemList[i].strDef!==''){$scope.PostPartumItemList[cnt].strDate=$scope.PostPartumItemList[i].strDef}cnt++}}}};$scope.mergeDeafultPostPartum=function(){var cnt=0;showAlertMessage("Are you sure you want to merge defaults ?",'','ConfirmMsg','setMergeDefaultPostPartumValue','obpnController');$scope.setMergeDefaultPostPartumValue=function(result){if(result==='yes'){for(var i=0;i<$scope.PostPartumItemList.length;i++){if($scope.PostPartumItemList[i].strDate.length<1){$scope.PostPartumItemList[cnt].strDate=$scope.PostPartumItemList[i].strDef}cnt++}}}};$scope.savePostPartum=function(onTabChange){if(!isLockMine2($scope.postPartLockObj)){$scope.loadPostPartumData("",'editMode');$scope.closePopup('obEditAddPopupWindow',$scope.postPartLockObj);return false}var doCheck=dataTruncUtilityService.getTextFieldWidthsFromTable("web_OBPostPartum","obEditAddPopupWindow","bluetheme");if(!doCheck){$scope.chkLock=false;return false}$scope.arrPostItemId=[];$scope.arrPostValue=[];$scope.arrPostComment=[];var eletId=document.getElementsByName("arPostId");var eletval=document.getElementsByName("arPostValue");var eletcom=document.getElementsByName("arPostCom");for(var j=0;j<eletId.length;j++){$scope.arrPostItemId[j]=eletId[j].value;$scope.arrPostValue[j]=eletval[j].value;$scope.arrPostComment[j]=eletcom[j].value}PregnancyDataServices.setPostPartumData($scope.pregId,$scope.encounterId,$scope.arrPostItemId,$scope.arrPostValue,$scope.arrPostComment,$scope.userId).success(function(data){if($scope.chkLock==true){PregnancyDataServices.setLockOBData($scope.pregId,$scope.patientId,"Post Partum",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPostPartumData("",'editMode')}).error(function(){ecwAlert("Internal Error occured while locking Post Partum, Please try after some time")})}else{$scope.loadPostPartumData("",'editMode')}$scope.chkLock=false;$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while saving Post Partum, Please try after some time")});if(!onTabChange){$scope.closePopup('obEditAddPopupWindow',$scope.postPartLockObj)}else{$scope.releaseLockPopup($scope.postPartLockObj)}};$scope.lockPostPartum=function(){$scope.chkLock=true;$scope.savePostPartum()};$scope.unLockPostPartum=function(){$scope.chkLock=false;PregnancyDataServices.setUnlockOBData($scope.pregId,$scope.patientId,"Post Partum",$scope.userId,$scope.encounterId).success(function(data){$scope.loadPostPartumData("",'editMode');$scope.releaseLockPopup($scope.postPartLockObj);$scope.updateEHXStatus($scope.pregId,$scope.patientId,$scope.encounterId,$scope.strTimeStampName)}).error(function(){ecwAlert("Internal Error occured while unLocking Post Partum, Please try after some time")})};$scope.releasePostPartConcurLock=function(){if($scope.postPartLockObj){$scope.releaseLockPopup($scope.postPartLockObj)}};$scope.showHideGraph=function(){$scope.getOBGraphData('Weight|Systolic BP|Diastolic BP|Weeks Gest.|Fundal ht.(cm)|FHR |Dilation (cms)|Effacement|Total Wt gain');if($('#graphId').hasClass('plus_blue')){$('#graphs').attr("style","display:block");$('#graphId').removeClass('plus_blue');$('#graphId').addClass('minus_blue')}else if($('#graphId').hasClass('minus_blue')){$('#graphs').attr("style","display:none");$('#graphId').removeClass('minus_blue');$('#graphId').addClass('plus_blue')}};$scope.HideGraph=function(){$('#graphs').attr("style","display:none");$('#graphId').removeClass('minus_blue');$('#graphId').addClass('plus_blue');windowChart=null};$scope.toggleGraphSection=function(flag){if(flag=='1'){$('#customGraph').attr("style","display:block");$('#normalGraph').attr("style","display:none")}else{$('#customGraph').attr("style","display:none");$('#normalGraph').attr("style","display:block")}};$scope.commonSeries=[];$scope.addDataInCommonSeriesOfGraph=function(value,tempName){if(value!=undefined){var arrLen=value.length;var data=[];if(arrLen!=undefined){for(var i=0;i<arrLen;i++){var dt=parseStringToDate(value[i].strDate,"mm/dd/yyyy","/").getTime();var va=Number(value[i].strValue);var arr=[dt,va];data.push(arr)}}else{var dt=parseStringToDate(value.strDate,"mm/dd/yyyy","/").getTime();var va=Number(value.strValue);var arr=[dt,va];data.push(arr)}$scope.commonSeries.push({name:tempName,data:data})}};$scope.$on('$destroy',function(){windowChart=null;obflowmainpregId=null;obflowmainuserId=null;obflowmainpatientId=null;obflowmainencounterId=null;obflowmaincurrpregId=null;obflowmainx2js=null;obflowmainethnicityXML=null;obflowmainassessmentXML=null;obflowmainptdashboardxml=null;obflowmainpregListFound=null;obTabsXml=null;obflowmainnextXml=null;obflowmainprevXml=null;obflowmainencXml=null;obflowmainpregListFound=null;obEddNotesClone=null;angular.element($window).unbind('resize');$templateCache.remove($scope.popupurl.value);$templateCache.remove($scope.attachedToUrl);$templateCache.remove($scope.modalForOB.url);$templateCache.remove($scope.obSummaryPrint);$templateCache.remove($scope.obPanelPopUrl);$templateCache.remove($scope.obPtRacePopUrl);$templateCache.remove($scope.obSupplementDataPopUp.url);$templateCache.remove($scope.obProviderNumberurl.url);removeScopePropertyAndMethod($scope);$('#obPostPartumBtn1').off('click');$('#obDischargeBtn1').off('click');$('#obproblemlistBtn3').off('click');$('#obRisksBtn1').off('click');$('#obRxBtn1').off('click');$('#obPlansBtn1').off('click');$('#code').off('click');$('#obNotesBtn3').off('click');$('#obflowsheetBtn7').off('click');$('#obformaBtn1').off('click');$('#obgeneticsBtn1').off('click');$('#obhistoryBtn7').off('click');$('#obphysicalBtn1').off('click');$('#obListBtn1').off('click');$('#obListBtn2').off('click');$('#obListBtn3').off('click');$('#obListBtn4').off('click');$('#obpnController').remove();$('#preglist_viewtab').remove();$('#phy_viewtab').remove();$('#hist_viewtab').remove();$('#gen_viewtab').remove();$('#forma_viewtab').remove();$('#flowsheet_viewtab').remove();$('#notes_viewtab').remove();$('#edd_viewtab').remove();$('#plans_viewtab').remove();$('#graphs_viewtab').remove();$('#rx_viewtab').remove();$('#labs_viewtab').remove();$('#risks_viewtab').remove();$('#prob_viewtab').remove();$('#discharge_viewtab').remove();$('#postpartum_viewtab').remove();$timeout.cancel(timer1);$timeout.cancel(timer2);$timeout.cancel(timer3);try{$('#obpnController').data('jsp').destroy();$('.ob-topcont').jScrollPane({}).data('jsp').destroy();$('.ob-list').jScrollPane({}).data('jsp').destroy();$('.stk_cont').jScrollPane({}).data('jsp').destroy();$('.overflowauto').jScrollPane({}).data('jsp').destroy();$document.off('keyup',$event)}catch(err){}});$scope.getOBGraphData=function(keyName){if(keyName!=undefined&&keyName!=''){PregnancyDataServices.getOBGraphData($scope.pregId,keyName).success(function(data){var allGraphJson=(new X2JS).xml_str2json(data);var valueWeight=allGraphJson.Envelope.Body["return"].Weight;var valueSysBP=allGraphJson.Envelope.Body["return"].SystolicBP;var valueDiaBP=allGraphJson.Envelope.Body["return"].DiastolicBP;var valueWeek=allGraphJson.Envelope.Body["return"].WeeksGest;var valueFundal=allGraphJson.Envelope.Body["return"].FundalHt;var valueFhr=allGraphJson.Envelope.Body["return"].FHR;var valueDilation=allGraphJson.Envelope.Body["return"].Dilation;var valueEffacement=allGraphJson.Envelope.Body["return"].Effacement;var valueTotalWtGain=allGraphJson.Envelope.Body["return"].TotalWtGain;var refRangeWt=$scope.strLowWt+"-"+$scope.strHighWt;var refRangeBP=$scope.strLowBP+"-"+$scope.strHighBP;if(valueWeight!=undefined){$scope.addDataInCommonSeriesOfGraph(valueWeight,'Weight');graphPlotData(valueWeight,'Weight',refRangeWt)}if(valueSysBP!=undefined&&valueDiaBP!=undefined){$scope.addDataInCommonSeriesOfGraph(valueSysBP,'Systolic BP');$scope.addDataInCommonSeriesOfGraph(valueDiaBP,'Diastolic BP');graphPlotMulData(valueSysBP,'Systolic BP',valueDiaBP,'Diastolic BP',refRangeBP)}else{if(valueSysBP!=undefined){$scope.addDataInCommonSeriesOfGraph(valueSysBP,'Systolic BP');graphPlotData(valueSysBP,'Systolic BP',refRangeBP)}if(valueDiaBP!=undefined){$scope.addDataInCommonSeriesOfGraph(valueDiaBP,'Diastolic BP');graphPlotData(valueDiaBP,'Diastolic BP',refRangeBP)}}if(valueWeek!=undefined&&valueFundal!=undefined){$scope.addDataInCommonSeriesOfGraph(valueWeek,'Weeks Gest.');$scope.addDataInCommonSeriesOfGraph(valueFundal,'Fundal ht.(cm)');graphPlotMulData(valueWeek,'Weeks Gest.',valueFundal,'Fundal ht.(cm)')}else{if(valueWeek!=undefined){$scope.addDataInCommonSeriesOfGraph(valueWeek,'Weeks Gest.');graphPlotData(valueWeek,'Weeks Gest.')}if(valueFundal!=undefined){$scope.addDataInCommonSeriesOfGraph(valueFundal,'Fundal ht.(cm)');graphPlotData(valueFundal,'Fundal ht.(cm)')}}if(valueFhr!=undefined){$scope.addDataInCommonSeriesOfGraph(valueFhr,'FHR')}if(valueDilation!=undefined){$scope.addDataInCommonSeriesOfGraph(valueDilation,'Dilation (cms)')}if(valueEffacement!=undefined){$scope.addDataInCommonSeriesOfGraph(valueEffacement,'Effacement(%)')}if(valueTotalWtGain!=undefined){$scope.addDataInCommonSeriesOfGraph(valueTotalWtGain,'Total Wt gain')}}).error(function(){ecwAlert("Internal Error occured while loading weight graph data !")})}};$scope.customiseGraphSeries=function(len){var localSeries=[];for(var i=0;i<len;i++){if(document.getElementById('chk'+i).checked==true){var temName=document.getElementById('chk'+i).value;for(var k=0;k<len;k++){if($scope.commonSeries[k]!=undefined){if(temName==$scope.commonSeries[k].name){localSeries.push($scope.commonSeries[k])}}}}}createGarph(localSeries,"Pregnancy Graphs","Visit Dates","Units",'contCustGrp',10)};$scope.showAllGraphSeries=function(len){if(document.getElementById('chkShowAll').checked==true){for(var i=0;i<len;i++){document.getElementById('chk'+i).checked=true}createGarph($scope.commonSeries,"Pregnancy Graphs","Visit Dates","Units",'contCustGrp',10)}else{for(var i=0;i<len;i++){document.getElementById('chk'+i).checked=false}document.getElementById("contCustGrp").innerHTML=''}};$scope.showOBFlowsheetPopup=function(obTabName){$templateCache.remove($scope.obPanelPopUrl);$scope.obPanelPopUrl="";$ocLazyLoad.load({name:obTabName,cache:false,files:['/mobiledoc/jsp/webemr/obFlowsheet/popupController.js']}).then(function(){$scope.obPanelPopUrl=makeURL("/mobiledoc/jsp/webemr/obFlowsheet/obPopup_main.jsp?tabName="+obTabName+'&nd='+(new Date).getTime())},function(e){console.log(e);$templateCache.remove($scope.obPanelPopUrl)})};$scope.getPatientEncounters=function(patientId){var serverUrl='/mobiledoc/jsp/catalog/xml/getPtEncounters.jsp?PatientId='+$scope.patientId;var ptEncountersXML=getCachedData(serverUrl);var jsonData=obflowmainx2js.xml_str2json(ptEncountersXML);return jsonData.Envelope.Body['return'].resultset.data.row};$scope.patientEncounters=$scope.getPatientEncounters($scope.patientId);$scope.changeEncouunter=function(){$scope.loadDashboard($scope.encounterId,$scope.patientId)};$scope.loadDashboard=function(encounterId,patientId){var parameters={encounterId:$scope.encounterId,patientId:$scope.patientId,viewType:'',pregId:''};var obParams=getPerep(JSON.stringify(parameters));var url='#/mobiledoc/jsp/webemr/obFlowsheet/obFlowsheet_main.jsp/'+obParams;window.location=url};$scope.toLowerCaseCustom=function(data){if(data!=""){data=data.toLowerCase()}return data};function populatePhysicalData(JsonData,obj){var cntleft=0;var cntright=0;if(JsonData===null||JsonData==='')return;var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){if(value.length>0){$scope.totalItemlist=value;var len=$scope.totalItemlist.length;for(var i=0;i<len;i++){if(i%2==0){$scope.leftPhysicalItemlist[cntleft]=$scope.totalItemlist[i];cntleft++}else{$scope.rightPhysicalItemlist[cntright]=$scope.totalItemlist[i];cntright++}}}}}function populateAllHistoryData(jsonData){$scope.surgicalHistoryData=[];$scope.hospitalizationData=[];$scope.familyHistoryData=[];$scope.socialHistoryData=[];$scope.medicalHistoryData=[];$scope.gynHistoryData=[];$scope.obHistoryData=[];$scope.medicalHistAllergyData=[];$scope.medHistoryFlag=false;$scope.familyHistNonContriFlag=false;$scope.noReportedMedHx=false;var value=returnDataArray(jsonData.Envelope.Body["return"].SurgicalHist);if(value){$scope.surgicalHistoryData=value}value=returnDataArray(jsonData.Envelope.Body["return"].Hospitalization);if(value){$scope.hospitalizationData=value}value=returnDataArray(jsonData.Envelope.Body["return"].FamilyHist);if(value){$scope.familyHistoryData=value}$scope.sibLingData=jsonData.Envelope.Body["return"].siblingInfo;$scope.notesData=jsonData.Envelope.Body["return"].strFamilyNotes;$scope.strSocialHistNotes=jsonData.Envelope.Body["return"].strSocialHxNotes;value=returnDataArray(jsonData.Envelope.Body["return"].SocialHist);if(value){$scope.socialHistoryData=value}value=returnDataArray(jsonData.Envelope.Body["return"].MedicalHist);if(value){$scope.medicalHistoryData=value}value=returnDataArray(jsonData.Envelope.Body["return"].MedicalHistAllergy);if(value){$scope.medicalHistAllergyData=value;var len=$scope.medicalHistAllergyData.length;for(var i=0;i<len;i++){if($scope.medicalHistAllergyData[i].strDrug==undefined){$scope.AllergyNotFound="1"}else{$scope.AllergyNotFound="0"}}$scope.loadInteractionSeverity()}value=returnDataArray(jsonData.Envelope.Body["return"].GynHist);if(value){$scope.gynHistoryData=value}if(jsonData.Envelope.Body["return"].MedicalHistFlag!=undefined){value=jsonData.Envelope.Body["return"].MedicalHistFlag.HistFlag;if(value){$scope.medHistoryFlag=value}}if(jsonData){if(jsonData.Envelope.Body["return"].FamilyHistNonContriFlag){value=jsonData.Envelope.Body["return"].FamilyHistNonContriFlag.value;if(value){$scope.familyHistNonContriFlag=value}}}if(jsonData){if(jsonData.Envelope.Body["return"].DeniesPastMedHxFlag){value=jsonData.Envelope.Body["return"].DeniesPastMedHxFlag.value;if(value){$scope.noReportedMedHx=value}}}if(jsonData){if(jsonData.Envelope.Body["return"].OBHistory.item.category){value=returnDataArray(jsonData.Envelope.Body["return"].OBHistory.item.category);if(value){$scope.obHistoryData=value}}}}function populateMedicalHxlData(JsonData){$scope.totalMedicalHistoryItemlist=[];var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);var cntleft=0;var cntright=0;if(value){$scope.totalMedicalHistoryItemlist=value;var len=$scope.totalMedicalHistoryItemlist.length;for(var i=0;i<len;i++){if(i%2==0){$scope.arrMedHxLeftItemId[cntleft]=$scope.totalMedicalHistoryItemlist[i];cntleft++}else{$scope.arrMedHxRightItemId[cntright]=$scope.totalMedicalHistoryItemlist[i];cntright++}}}}function populateFormAPreviousPregData(JsonData){var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){$scope.totalPreviousPregItemlist=value}}function populateFormAMenstrualHxData(JsonData){var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){$scope.totalMenstrualHistoryItemlist=value}}function populateProblemListData(JsonData,obj){if(obj==="ptproblem"){$scope.totalPtProbleList=[];var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){$scope.totalPtProbleList=value}}else{if(JsonData!=null&&JsonData!=''){$scope.totalProblemList=[];var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){$scope.totalProblemList=value}$scope.count=$scope.totalProblemList.length}}}function populateRisksData(jsonData,objSection){if(jsonData===null||jsonData==='')return;var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){if(objSection==="atrisk"){$scope.totalAtRisksList=value}else if(objSection==="highrisk"){$scope.totalHighRisksList=value}}}function populateMultipleBirthDischargeData(JsonData,objSection){$scope.totalDischargeneonatalBabyinfoList=[];if(JsonData!=null&&JsonData!=undefined){if(objSection==="neobabyinfo"){var Mbirthvalue=returnDataArray(JsonData.Envelope.Body["return"].expNumberofbaby);if(Mbirthvalue){$scope.babyId=1}else{$scope.babyId=0}if(Mbirthvalue){if(Mbirthvalue!=undefined){if(Mbirthvalue.length!=undefined){for(var j=0;j<Mbirthvalue.length;j++){var va1=Mbirthvalue[j].babyId;var va3=returnDataArray(Mbirthvalue[j].encounter);var data2=[];if(va3.length!=undefined){for(var i=0;i<va3.length;i++){var va11=va3[i].strItemId;var va22=va3[i].strBabyId;var va33=va3[i].strName;var va44=va3[i].strDate;var va55=va3[i].strType;var va66=va3[i].strDef;var va77=va3[i].strLock;var va88=va3[i].strComments;var va99=va3[i].popupvals;data2.push({strItemId:va11,strBabyId:va22,strName:va33,strDate:va44,strType:va55,strDef:va66,strLock:va77,strComments:va88,popupvals:va99})}}$scope.totalDischargeneonatalBabyinfoList.push({babyId:va1,encounter:data2})}}else{var va1=Mbirthvalue.babyId;var va3=returnDataArray(Mbirthvalue.encounter);var data2=[];if(va3.length!=undefined){for(var k=0;k<va3.length;k++){var va11=va3[k].strItemId;var va22=va3[k].strBabyId;var va33=va3[k].strName;var va44=va3[k].strDate;var va55=va3[k].strType;var va66=va3[k].strDef;var va77=va3[k].strLock;var va88=va3[k].strComments;var va99=va3[k].popupvals;data2.push({strItemId:va11,strBabyId:va22,strName:va33,strDate:va44,strType:va55,strDef:va66,strLock:va77,strComments:va88,popupvals:va99})}$scope.totalDischargeneonatalBabyinfoList.push({babyId:va1,encounter:data2})}}}}}}}function populateDischargeData(JsonData,objSection){if(JsonData===null||JsonData==='')return;var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){if(value.length>0){if(objSection==="deldates"){$scope.totalDeliverydatesList=value}else if(objSection==="discomp"){$scope.totalDischargeCompList=value}else if(objSection==="delinfo"){$scope.totalDeliveryInfoList=value}else if(objSection==="neoinfo"){$scope.totalDischargeneonatalinfoList=value}else if(objSection==="matinfo"){$scope.totalDischargematernalinfoList=value}}}}function populatePlansData(JsonData,objSection){if(JsonData===null||JsonData==='')return;var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){if(objSection==="first"){$scope.totalPlansFirstTrimester=value}else if(objSection==="second"){$scope.totalPlansSecondTrimester=value}else if(objSection==="third"){$scope.totalPlansThirdTrimester=value}}}function populateGeneticsData(JsonData,objSection){if(JsonData===null||JsonData==='')return;var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);var cntleft=0;var cntright=0;if(value){if(objSection==="first"){$scope.totalGeneticScreeningItemlist=value;var len=$scope.totalGeneticScreeningItemlist.length;for(var i=0;i<len;i++){if(i%2==0){$scope.arrGenLeftItemId[cntleft]=$scope.totalGeneticScreeningItemlist[i];cntleft++}else{$scope.arrGenRightItemId[cntright]=$scope.totalGeneticScreeningItemlist[i];cntright++}}}else if(objSection==="second"){$scope.totalInfectionHistoryItemlist=value}}}function populatePostPartumData(JsonData){if(JsonData===null||JsonData==='')return;var value=returnDataArray(JsonData.Envelope.Body["return"].encounter);if(value){$scope.totalPostPartumList=value}}function populatePastPregnancyData(jsonData){if(jsonData!=null&&jsonData!=''){var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.totalPastPreglist=value}}}function populateNotesData(jsonData){var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);$scope.totalNotesItemList=[];$scope.sortBy=0;if(value){if(value.length>0){$scope.totalNotesItemList=value;$scope.sortBy=$scope.totalNotesItemList[0].sortBy;$scope.sortOrder=$scope.totalNotesItemList[0].sortOrder}}}function populateFlowSheetData(jsonData){var value=jsonData.Envelope.Body["return"].encounter;$scope.totalFlowItemList=[];$scope.noOfEnc=0;if(value){$scope.noOfEnc=value.length;if(value.length>0){$scope.totalFlowItemList=value}else{$scope.totalFlowItemList.push(value)}}}function populateFlowsheetHeaderData(jsonData){$scope.FlowsheetHeaderItemList=[];if(jsonData!==''&&jsonData!==undefined){$scope.PreObWt=jsonData.Envelope.Body["return"].PreOBWeight}var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);for(var i=0;i<value.length;i++){if(value[i].strName!==undefined&&value[i].strName!==''){$scope.FlowsheetHeaderItemList.push(value[i])}}}function populateOBCareItems(jsonData){$scope.totalCareItemList=[];var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.totalCareItemList=value}if($scope.totalCareItemList.length>0){$scope.CareItemsFound="1";angular.forEach($scope.totalCareItemList,function(obj){$scope.tempName=obj.tempName})}else{$scope.CareItemsFound="0"}}function populateOBCareOrderSetItems(jsonData){$scope.totalOrderSetCareItemList=[];var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.totalOrderSetCareItemList=value}if($scope.totalOrderSetCareItemList.length>0){$scope.OrderSetFound="1";angular.forEach($scope.totalOrderSetCareItemList,function(obj){$scope.tempName=obj.tempName})}else{$scope.OrderSetFound="0"}}function populateLabsData(jsonData){$scope.totalLabsList=[];var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);$scope.sortOBLabBy=0;if(value){if(value.length>0){$scope.totalLabsList=value}$scope.sortOBLabBy=$scope.totalLabsList[0].sortOBLabBy;$scope.sortLabImagingOrder=$scope.totalLabsList[0].sortLabImagingOrder}}function populateImagingData(jsonData){$scope.totalDIList=[];var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);$scope.sortOBDIBy=0;if(value){if(value.length>0){$scope.totalDIList=value}$scope.sortOBDIBy=$scope.totalDIList[0].sortOBDIBy;$scope.sortLabOrder=$scope.totalDIList[0].sortLabOrder}}function populateTrimesetrBasedLabData(jsonData){$scope.isFirstTrim=false;$scope.isSecondTrim=false;$scope.isThirdTrim=false;$scope.labsOrderListFirstTri=[];$scope.labsOrderListSecondTri=[];$scope.labsOrderListThirdTri=[];var value;$scope.sortOBLabBy=0;if(jsonData.Envelope.Body["return"].FirstTrimester!=undefined){$scope.isFirstTrim=true;value=returnDataArray(jsonData.Envelope.Body["return"].FirstTrimester.encounter);if(value){if(value.length>0){$scope.labsOrderListFirstTri=value}if($scope.labsOrderListFirstTri[0].sortOBLabBy!==''){$scope.sortOBLabBy=$scope.labsOrderListFirstTri[0].sortOBLabBy;$scope.sortTemplateLabOrder=$scope.labsOrderListFirstTri[0].sortLabOrder}}}if(jsonData.Envelope.Body["return"].SecondTrimester!=undefined){$scope.isSecondTrim=true;value=returnDataArray(jsonData.Envelope.Body["return"].SecondTrimester.encounter);if(value){if(value.length>0){$scope.labsOrderListSecondTri=value}if($scope.labsOrderListSecondTri[0].sortOBLabBy!==''){$scope.sortOBLabBy=$scope.labsOrderListSecondTri[0].sortOBLabBy;$scope.sortTemplateLabOrder=$scope.labsOrderListSecondTri[0].sortLabOrder}}}if(jsonData.Envelope.Body["return"].ThirdTrimester!=undefined){$scope.isThirdTrim=true;value=returnDataArray(jsonData.Envelope.Body["return"].ThirdTrimester.encounter);if(value){if(value.length>0){$scope.labsOrderListThirdTri=value}if($scope.labsOrderListThirdTri[0].sortOBLabBy!==''){$scope.sortOBLabBy=$scope.labsOrderListThirdTri[0].sortOBLabBy;$scope.sortTemplateLabOrder=$scope.labsOrderListThirdTri[0].sortLabOrder}}}}function populatePastAssessMentList(jsonData){$scope.isPastAssessmentList=false;$scope.pastAssessmentList=[];var value=jsonData.Envelope.Body["return"].encounters.encounter;if(value){$scope.isPastAssessmentList=true;if(value.length>0){$scope.pastAssessmentList=value}else{$scope.pastAssessmentList.push(value)}}}function populateAssessmentListOfEnc(jsonData){$scope.isAssessmentList=false;$scope.AssessmentListOfEnc=[];var value=jsonData.Envelope.Body["return"].encounters.encounter;if(value){$scope.isAssessmentList=true;if(value.length>0){$scope.AssessmentListOfEnc=value}else{$scope.AssessmentListOfEnc.push(value)}}}function populateProblemList(jsonData){$scope.isProblemList=false;$scope.problemList=[];var value=returnDataArray(jsonData.Envelope.Body["return"].FIELDS);if(value){$scope.isProblemList=true;$scope.problemList=value}}function populateLabImagingData(jsonData){$scope.InitialLabsdueASAPData=[];$scope.LabHeaderData=[];$scope.IndivisualHeaderData=[];$scope.OrderLabDataData=[];$scope.LabValueData=[];var value=jsonData.Envelope.Body["return"].encASAPData;if(value){if(value.length>0){$scope.InitialLabsdueASAPData=value}else{$scope.InitialLabsdueASAPData.push(value)}}var valueHead=jsonData.Envelope.Body["return"].encHeaderData;if(valueHead){if(valueHead!=undefined){if(valueHead.length!=undefined){for(var j=0;j<valueHead.length;j++){var va1=valueHead[j].sgaName;var va2=valueHead[j].strgafrom;var va3=valueHead[j].encounter;var data2=[];if(va3.length!=undefined){for(var i=0;i<va3.length;i++){var va11=va3[i].sName;var va22=va3[i].careId;var va33=va3[i].labId;var va44=va3[i].labName;var va55=va3[i].status;data2.push({sName:va11,careId:va22,labId:va33,labName:va44,status:va55})}}else{var va11=va3.sName;var va22=va3.careId;var va33=va3.labId;var va44=va3.labName;var va55=va3.status;data2.push({sName:va11,careId:va22,labId:va33,labName:va44,status:va55})}$scope.LabHeaderData.push({sgaName:va1,encounter:data2})}}else{var va1=valueHead.sgaName;var va2=valueHead.strgafrom;var va3=valueHead.encounter;if(va3.length!=undefined){for(var k=0;k<va3.length;k++){var data2=[];var va11=va3[k].sName;var va22=va3[k].careId;var va33=va3[k].labId;var va44=va3[k].labName;var va55=va3[k].status;data2.push({sName:va11,careId:va22,labId:va33,labName:va44,status:va55})}}else{var data2=[];var va11=va3.sName;var va22=va3.careId;var va33=va3.labId;var va44=va3.labName;var va55=va3.status;data2.push({sName:va11,careId:va22,labId:va33,labName:va44,status:va55})}$scope.LabHeaderData.push({sgaName:va1,encounter:data2})}}}var valueOrderLab=jsonData.Envelope.Body["return"].encOrderLabData;if(valueOrderLab){if(valueOrderLab.length>0){$scope.OrderLabDataData=valueOrderLab}else{$scope.OrderLabDataData.push(valueOrderLab)}}}function calculateGA(lmpdate,vDate){if(lmpdate!=null&&vDate!=null){try{if(isValidDate(lmpdate)){lmpdate=lmpdate.toDateTime(vkDateFormat);if(isValidDate(vDate)){vDate=vDate.toDateTime(vkDateFormat);var days=datediffFloor(lmpdate,vDate);days=parseInt(days);days+=280;var w=parseInt(days/7);var d=parseInt(days%7);var GA=w+" w "+d+" d";return GA}}}catch(e){}}}function calculateBmi(){var weight=0;var height=0;var finalBmi;try{var len=$scope.FlowsheetHeaderItemList.length;for(var i=0;i<len;i++){if($scope.FlowsheetHeaderItemList[i].strName==="Weight"){weight=$scope.FlowsheetHeaderItemList[i].strDate}if($scope.FlowsheetHeaderItemList[i].strName==="Height"){height=$scope.FlowsheetHeaderItemList[i].strDate}}if(weight>0&&height>0){var d1=0;var d2=0;if($scope.WtUOM==="lbs"||$scope.WtUOM==="LBS"){d1=weight/2.2046}else{d1=weight}if($scope.HtUOM==="cm"||$scope.HtUOM==="CM"){d2=height}else{d2=height*2.54}d2=d2*d2;d2=d2/1e4;finalBmi=d1/d2}return finalBmi.toFixed(3)}catch(e){}}function datediffFloor(dt1,dt2){var one_day=864e5;return Math.round((dt2.getTime()-dt1.getTime())/one_day)}function checkLabAttribute(nReportId,labAttributeJsonArray){var bLabAttributesExists=false;var nLen=labAttributeJsonArray.length;for(var i=0;i<nLen;i++){if(nReportId==labAttributeJsonArray[i].nReportId){bLabAttributesExists=true;break}}return bLabAttributesExists}function parsePregList(jsonData){$scope.totalPreglist=[];if(jsonData===null||jsonData===''){return}var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.totalPreglist=value}}function parseCurrentMed(jsonData){$scope.rxArray=[];if(jsonData===null||jsonData===''){return}var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.rxArray=value}}function parseTreatMent(jsonData){$scope.treatementArray=[];if(jsonData===null||jsonData===''){return}var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.treatementArray=value}}$scope.strStartDate="";function parseReferral(jsonData){$scope.referralArray=[];if(jsonData===null||jsonData===''){return}var value=returnDataArray(jsonData.Envelope.Body["return"].encounter);if(value){$scope.referralArray=value;$scope.strRefStartDate=jsonData.Envelope.Body["return"].sRefStartDate}}function populateHPINotesData(jsonData){$scope.hpiNotesArray=[];if(jsonData===null||jsonData===''){return}var value=jsonData.Envelope.Body["return"].encounters;if(value){if(value!=undefined){if(value.length!=undefined){for(var j=0;j<value.length;j++){var va1=value[j].strsDate;var va2=value[j].strsvType;var va3=value[j].strsReason;var va4=value[j].Items;var data2=[];if(va4.length!=undefined){for(var i=0;i<va4.length;i++){var va11=va4[i].strsName;var va22=va4[i].strhNotes;var va33=va4[i].strfNotes;var va44="";var va55="";var va66="";if(va4[i].str1!=undefined){va44=va4[i].str1}if(va4[i].str2!=undefined){va55=va4[i].str2}if(va4[i].str3!=undefined){va66=va4[i].str3}data2.push({sName:va11,hNotes:va22,fNotes:va33,str1:va44,str2:va55,str3:va66})}}else{var va11=va4.strsName;var va22=va4.strhNotes;var va33=va4.strfNotes;var va44="";var va55="";var va66="";if(va4.str1!=undefined){va44=va4.str1}if(va4.str2!=undefined){va55=va4.str2}if(va4.str3!=undefined){va66=va4.str3}data2.push({sName:va11,hNotes:va22,fNotes:va33,str1:va44,str2:va55,str3:va66})}$scope.hpiNotesArray.push({shName:va1,shDate:va2,shReason:va3,encounter:data2})}}else{var va1=value.strsDate;var va2=value.strsvType;var va3=value.strsReason;var va4=value.Items;var data2=[];if(va4.length!=undefined){for(var k=0;k<va4.length;k++){var va11=va4[k].strsName;var va22=va4[k].strhNotes;var va33=va4[k].strfNotes;var va44="";var va55="";var va66="";if(va4[k].str1!=undefined){va44=va4[k].str1}if(va4[k].str2!=undefined){va55=va4[k].str2}if(va4[k].str3!=undefined){va66=va4[k].str3}data2.push({sName:va11,hNotes:va22,fNotes:va33,str1:va44,str2:va55,str3:va66})}}else{var va11=va4.strsName;var va22=va4.strhNotes;var va33=va4.strfNotes;var va44="";var va55="";var va66="";if(va4.str1!=undefined){va44=va4.str1}if(va4.str2!=undefined){va55=va4.str2}if(va4.str3!=undefined){va66=va4.str3}data2.push({sName:va11,hNotes:va22,fNotes:va33,str1:va44,str2:va55,str3:va66})}$scope.hpiNotesArray.push({shName:va1,shDate:va2,shReason:va3,encounter:data2})}}}}$scope.openManageOrderPopup=function(actionName){var labType=0;if(actionName==='Lab Reports:'){labType=0}else if(actionName==='Diagnostic Imaging:'){labType=1}else if(actionName==='Procedure Orders:'){labType=3}var manageOrderDataObj={encounterId:$scope.encounterId,patientId:$scope.patientId,trUserId:$scope.userId,labType:labType,parentName:'AddNewOrder',requestedFrom:'PNHeader',context:"PNHeader",nDxId:0};$ocLazyLoad.load({name:'manageOrdersModule',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL("/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/manageOrders.jsp"),controller:'manageOrdersCtrl',windowClass:'app-modal-window bluetheme',keyboard:false,backdrop:"static",resolve:{manageOrderDataObject:function(){return manageOrderDataObj}}});modalInstance.result.then(function(responseObj){},function(responseObj){if(actionName==='Procedure Orders:'){$scope.getProcedureOrdersData("","editMode")}})})};$scope.loadPNOrder=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'ptOrdersApp',files:['/mobiledoc/jsp/webemr/scheduling/patientorders/patientOrdersController.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/scheduling/patientorders/patientOrders.jsp?PatientId="+$scope.patientId+"&EncounterId="+$scope.encounterId);$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNLabRequest=function(){$templateCache.remove($scope.modalForOB.url);if($('#labDIRequest')&&$('#labDIRequest').length>0){$('#labDIRequest').remove()}$scope.modalForOB={url:""};$ocLazyLoad.load({name:'labRequestForm',files:['/mobiledoc/jsp/webemr/progressnotes/labRequestForm/labRequestFormController.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/progressnotes/labRequestForm/labRequestForm.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&context=PNHeader&nDxId=0");$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.openSuperBillModalFromHeader=function(){var d=new Date;$scope.modalForOB={url:""};$ocLazyLoad.load({name:"SuperbillModule",cache:true,files:['/mobiledoc/jsp/webemr/superbill/SuperbillController.js']}).then(function(){var ht=$("#mainPNDialog").css("height");var wd=$("#mainPNDialog").css("width");var url="/mobiledoc/jsp/webemr/superbill/SuperbillContainer.jsp?encid="+$scope.encounterId+"&templateid=1&ICDAssign=One&sessionDID=0&TrUserId="+$scope.userId+"&pid="+$scope.patientId+"&ecwappprocessid=0&rnd2="+d.getMilliseconds()+"&timestamp="+d.getMilliseconds();url=url+"&ht="+ht+"&wd="+wd;$scope.modalForOB.url=makeURL(url)},function(e){console.log(e)})};$scope.openSpecialtyForms=function(){$scope.modalForOB={url:""};$ocLazyLoad.load({name:"specialtyforms",cache:false,files:['/mobiledoc/jsp/webemr/specialtyforms/specialtyFormController.js']}).then(function(){var url="/mobiledoc/jsp/webemr/specialtyforms/specialtyFormContainer.jsp?TrUserId="+$scope.userId+"&encounterId="+$scope.encounterId+"&patientId="+$scope.patientId;$scope.modalForOB.rul=makeURL(url)},function(e){console.log(e)})};$scope.openTemplate=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:"templates",files:['/mobiledoc/jsp/webemr/progressnotes/templates/templatesController.js','/mobiledoc/jsp/webemr/progressnotes/templates/copymerge-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/progressnotes/templates/template-select.jsp?encounterId="+$scope.encounterId+"&patientId="+$scope.patientId+"&visitType"+encObj.visitType+"&trUserId="+$scope.userId);$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNPatientInfo=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'NewInfo',files:['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/toppanel/patientInfo/ptInfoController.js','/mobiledoc/jsp/webemr/toppanel/patientInfo/miscController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/toppanel/patientInfo/patient-demographics.jsp?patientId='+$scope.patientId+'&nd='+(new Date).getTime());$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNImmunization=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'ImmInjHxApp',files:getDependencies('ImmInjHxApp')}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/immunizations/ImmunizationHx.jsp?nImmInjType=1&context='progressnotes'&toppanelencounterId="+$scope.encounterId+"&patientId="+$scope.patientId);$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNPatientDocs=function(){var strFaxInboxUser=getItemKeyValue("FaxInboxUser");if(strFaxInboxUser==""){strFaxInboxUser=50}if(!($scope.patientId==strFaxInboxUser)){PSACService.checkCommonStaffPermission($scope.patientId,function(data){$scope.patientName="";try{if(EncDetailsService.getEncDetails().name){$scope.patientName=EncDetailsService.getEncDetails().name}}catch(err){}$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'PtDocsModule',files:['/mobiledoc/jsp/webemr/toppanel/patientdocs/js/patientdocs.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/toppanel/patientdocs/patientdocs.jsp?patientId="+$scope.patientId+"&patientName="+$scope.patientName+"&encounterId="+$scope.encounterId+"&nd="+(new Date).getTime());$scope.modalForOB.url=url},function(e){console.log(e)})},function(){})}};$scope.loadPNPtReferral=function(referralType){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'ptReferralApp',files:['/mobiledoc/jsp/webemr/jellybean/referral/ptReferralController.js']}).then(function(){var url='/mobiledoc/jsp/webemr/jellybean/referral/ptReferrals.jsp?PatientId='+$scope.patientId+"&defultselecte="+referralType;$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNNewTelEnc=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'TJellyDetailView',files:getDependencies('TJellyDetailView')}).then(function(){var url='/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-Telephone-Encounter-DetailView.jsp?&EncounterId=0&PatientId='+$scope.patientId+'&parentfunctionname=cmdNewTelEncClick&enctype=6&index=-1&context=patienthub';url=makeURL(url);$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNPatientHub=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'NewHub',files:['/mobiledoc/jsp/webemr/toppanel/patientHub/patienthubController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/toppanel/patientHub/patient-hub.jsp?patientId='+$scope.patientId+'&encounterId='+$scope.encounterId+'&nd='+(new Date).getTime());$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNLab=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'LabHistoryApp',files:['/mobiledoc/jsp/webemr/labs/labhistory/js/LabDIProHistory.js','/mobiledoc/jsp/webemr/templates/pagination-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/labhistory/LabDIProHistory.jsp?nType=0&patientId="+$scope.patientId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime());$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNDI=function(){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};$ocLazyLoad.load({name:'LabHistoryApp',files:['/mobiledoc/jsp/webemr/labs/labhistory/js/LabDIProHistory.js','/mobiledoc/jsp/webemr/templates/pagination-tpl.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/labs/labhistory/LabDIProHistory.jsp?nType=1&patientId="+$scope.patientId+"&normalView=1&CorrectionalEnabled=false&nd="+(new Date).getTime());$scope.modalForOB.url=url},function(e){console.log(e)})};$scope.loadPNClaim=function(){$scope.newPNCreatedClaim={Id:nClaimIdPN,Type:nClaimTypePN};viewPNClaimForOpenEMREnterprise($scope.encounterId,$scope.showClaimFromEncounter)};$scope.showClaimFromEncounter=function(bView){if(bView==false){ecwAlert("You do not have permission to view the Claim. Contact Admin.","eClinicalWorks");return false}else{checkPNClaimPermission($scope.showClaimFromEncounter1)}};$scope.showClaimFromEncounter1=function(){getPNClaimsDatFromEncounter($scope.encounterId,$scope.loadClaimScreen)};var getClaimDataFromEnc=function(){var strUrl=makeURL("/jsp/catalog/xml/CheckClaimForEnc.jsp?encounterId="+$scope.encounterId);getAjaxSyncDataClaimBatch(null,"POST",strUrl,false).success(function(response){if(response){var x2js=new X2JS;var objJson=x2js.xml_str2json(response);objJson=objJson.Envelope.Body['return'];if(objJson.status&&objJson.status.toUpperCase()=="SUCCESS"){$scope.newPNCreatedClaim.Id=objJson.claimId;$scope.newPNCreatedClaim.Type=objJson.claimType}else{ecwAlert("An error occured while loading ecounter claim data.","eClinicalWorks");return false}}}).error(function(){})};$scope.loadClaimScreen=function(){getClaimDataFromEnc();var nClaimId=$scope.newPNCreatedClaim.Id;var nClaimType=$scope.newPNCreatedClaim.Type;$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};if(nClaimId<=0){$scope.$apply(function(){var encId=$scope.encounterId;$scope.modalForOB.url=makeURL("/mobiledoc/jsp/webemr/webpm/createEncounterClaim.jsp?encounterId="+encId)})}else if(nClaimId>0){$scope.openPNClaimFromPNHeader(nClaimType,nClaimId)}};$scope.openPNClaimFromPNHeader=function(nClaimType,nClaimId){$templateCache.remove($scope.modalForOB.url);$scope.modalForOB={url:""};var moduleName="";var files=[];var strUrl="";$scope.newPNCreatedClaim.Id=nClaimId;$scope.newPNCreatedClaim.Type=nClaimType;if(nClaimType==0){var param={claimId:nClaimId,parentScreen:'progressNotes',encounterId:$scope.encounterId,patientId:$scope.patientId};loadHCFAClaim($ocLazyLoad,$modal,param,$scope)}else if(nClaimType==1){moduleName="ubClaimModule";files=["/mobiledoc/jsp/webemr/webpm/js/UBClaim.js","/mobiledoc/jsp/webemr/webpm/js/vendor/jquery.inputmask.js","/mobiledoc/jsp/webemr/webpm/js/billingClaimXMLGen.js","/mobiledoc/jsp/webemr/webpm/js/UBClaimHelper.js","/mobiledoc/jsp/webemr/webpm/js/commonFunction.js"];strUrl=makeURL('/mobiledoc/jsp/webemr/webpm/UBClaim.jsp?claimId='+nClaimId)}else if(nClaimType==2){moduleName="dentalClaimModule";files=['/mobiledoc/jsp/webemr/webpm/dentalclaim/js/DentalClaim.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js','/mobiledoc/jsp/webemr/webpm/js/commonFunction.js'];strUrl=makeURL('/mobiledoc/jsp/webemr/webpm/dentalclaim/DentalClaim.jsp?claimId='+nClaimId)}if(moduleName!=""&&files.length>0&&strUrl!=""){$ocLazyLoad.load({name:moduleName,files:files,cache:true}).then(function(){$scope.modalForOB.url=strUrl},function(e){console.log(e)})}};$scope.drugInteraction=function(){if($scope.b_CIMSEnabled==="yes"){$scope.drugInteractionCIMS()}else{$ocLazyLoad.load({name:'drugInteraction',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/drugInteraction/drugInteractionController.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/drugInteraction/drugInteraction.jsp'),controller:'drugInteractionController',windowClass:'app-modal-window1 bluetheme',keyboard:false,backdrop:"static",resolve:{patientID:function(){return $scope.patientId},encounterID:function(){return $scope.encounterId},loginuserid:function(){return global.TrUserId},parentName:function(){return"Treatment"},itemIDNDCObj:function(){return{itemid:"",NDCCode:"",doctorsFlag:""}}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(modalInstanceResponse==="success"){$scope.loadInteractionSeverity()}})})}};$scope.drugInteractionCIMS=function(){$ocLazyLoad.load({name:'drugInteractionCIMS',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/drugInteraction/drugInteractionControllerCIMS.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/drugInteraction/drugInteractionCIMS.jsp'),controller:'drugInteractionControllerCIMS',windowClass:'app-modal-window1 bluetheme',backdrop:"static",resolve:{patientID:function(){return $scope.patientId},encounterID:function(){return $scope.encounterId},loginuserid:function(){return global.TrUserId},parentName:function(){return"Treatment"},itemIDNDCObj:function(){return{itemid:"",NDCCode:"",doctorsFlag:""}}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(modalInstanceResponse==="success"){}})})};$scope.loadInteractionSeverity=function(){var tempUrl="";if(getItemKeyValue("EnableMedispan").toLowerCase()==="yes"){tempUrl="/mobiledoc/jsp/ecwrx/getDrugInteractionSeverity.jsp"}else{tempUrl="/mobiledoc/jsp/catalog/xml/multum/DrugInteractionCheck.jsp"}var xsrf=$.param({TrUserId:global.TrUserId,encid:$scope.encounterId});$http({method:"POST",url:tempUrl,cache:false,headers:{'Content-Type':'application/x-www-form-urlencoded'},data:xsrf}).success(function(data,status,headers,config){var x2js=new X2JS;var jsonData=x2js.xml_str2json(data.trim());if(jsonData){$scope.rxInteractionSeverity=jsonData.Envelope.Body['return'].severity.severitycode;try{$scope.rxInteractionSeverity=parseInt($scope.rxInteractionSeverity)}catch(e){}if($scope.rxInteractionSeverity===3){$scope.InteractionColor="btn-danger";$scope.InteractionLabel="Major Interaction"}else if($scope.rxInteractionSeverity===2){$scope.InteractionColor="btn-warning";$scope.InteractionLabel="Moderate Interaction"}else if($scope.rxInteractionSeverity===1){$scope.InteractionColor="bg-yellow";$scope.InteractionLabel="Minor Interaction"}else if($scope.rxInteractionSeverity===0){$scope.InteractionColor="btn-primary";$scope.InteractionLabel="Food Interaction"}else{$scope.InteractionColor="btn-lgrey";$scope.InteractionLabel="Interaction"}}})};$scope.preventPaste=function(e,id,value){$("#"+id).val(value);var message="Pasting data into this field not allowed.";showAlertMessage(message,'','AlertMsg',function(){return false},'obpnController');e.preventDefault()};$scope.preventPasteForDischargeDate=function(e,value){$("#"+e.target.id).val(e.target.value);var message="Pasting data into this field not allowed.";showAlertMessage(message,'','AlertMsg',function(){return false},'obpnController');e.preventDefault()};$scope.validateDateFrmt=function(messageId){$("#"+messageId).css("display","none");$("#"+messageId).css("background-color","white")};$scope.preventPregListPaste=function(e,id,value){var message="Pasting data into this field not allowed.";showAlertMessage(message,'','AlertMsg',function(){return false},'obpnController');$timeout(function(){if("ptdob"===id){$("#"+id).val($scope.pregListFOBDOB)}else if("disdate"===id){$("#"+id).val($scope.pregListDischargeDate)}},10);e.stopImmediatePropagation()};var dtCh="/";var minYear=1900;var maxYear=2200;$scope.validateDateForm=function(){for(i=1;i<5;i++){var dt=$('#dta'+i).val();if(dt==null||dt.length<=0||dt==''||dt==""){}else{if($scope.isDate(dt)==false){dt.focus();return false;return}}}for(i=1;i<5;i++){var dt=$('#dtb'+i).val();if(dt==null||dt.length<=0||dt==''||dt==""){}else{if($scope.isDate(dt)==false){dt.focus();return false;return}}}return true};$scope.daysArray=function(n){for(var i=1;i<=n;i++){this[i]=31;if(i==4||i==6||i==9||i==11){this[i]=30}if(i==2){this[i]=29}}return this};$scope.isNumeric=function(input){var RE=/^-{0,1}\d*\.{0,1}\d+$/;return RE.test(input)};$scope.isDate=function(dtStr){var daysInMonth=$scope.daysArray(12);var pos1=dtStr.indexOf(dtCh);var pos2=dtStr.indexOf(dtCh,pos1+1);var strMonth=dtStr.substring(0,pos1);var strDay=dtStr.substring(pos1+1,pos2);var strYear=dtStr.substring(pos2+1);var strYr=strYear;if(strDay.charAt(0)=="0"&&strDay.length>1)strDay=strDay.substring(1);if(strMonth.charAt(0)=="0"&&strMonth.length>1)strMonth=strMonth.substring(1);for(var i=1;i<=3;i++){if(strYr.charAt(0)=="0"&&strYr.length>1)strYr=strYr.substring(1)}var month=$scope.isNumeric(strMonth)?parseInt(strMonth):"";var day=$scope.isNumeric(strDay)?parseInt(strDay):"";var year=$scope.isNumeric(strYr)?parseInt(strYr):"";if(null!==dtStr&&""!==dtStr){if(pos1==-1||pos2==-1){showAlertMessage("The date format should be : mm/dd/yyyy",'','AlertMsg','','obpnController');return false}if(strMonth.length<1||month<1||month>12){showAlertMessage("Please enter a valid month",'','AlertMsg','','obpnController');return false}if(strDay.length<1||day<1||day>31||month==2&&day>daysInFebruary(year)||day>daysInMonth[month]){showAlertMessage("Please enter a valid day",'','AlertMsg','','obpnController');return false}if(strYear.length!=4||year==0||year<minYear||year>maxYear){showAlertMessage("Please enter a valid 4 digit year between "+minYear+" and "+maxYear,'','AlertMsg','','obpnController');return false}if(dtStr.indexOf(dtCh,pos2+1)!=-1||isInteger(stripCharsInBag(dtStr,dtCh))==false){showAlertMessage("Please enter a valid date",'','AlertMsg','','obpnController');return false}}return true};$scope.validateDateForDischarge=function(){var dt=$('.dtPicker188226').val();if(dt==null||dt.length<=0||dt==''||dt==""){}else{if($scope.isDate(dt)==false){dt.focus();return false;return}}return true};$scope.getImmunizationInjectionData=function(data,strLmpDate,keyName,mode){$scope.obLMPDate=strLmpDate;var x2js=new X2JS;if(mode==='ReadMode'){if(data){var jsonData=x2js.xml_str2json(data.trim());if(jsonData){var dataValue=jsonData.Envelope.Body['return'].item.SubItems;if(dataValue){if(keyName==='Immunizations'){$scope.rxImmunizationData=[];if(dataValue.length>0){$scope.rxImmunizationData=dataValue}else{$scope.rxImmunizationData.push(dataValue)}}else if(keyName==='Injections'){$scope.rxInjectionData=[];if(dataValue.length>0){$scope.rxInjectionData=dataValue}else{$scope.rxInjectionData.push(dataValue)}}}}}}else{PregnancyDataServices.getImmunizationInjectionDetails($scope.encounterId,keyName,$scope.obLMPDate).success(function(data){if(data){var jsonData=x2js.xml_str2json(data.trim());if(jsonData){var dataValue=jsonData.Envelope.Body['return'].item.SubItems;if(dataValue){if(keyName==='Immunizations'){$scope.rxImmunizationData=[];if(dataValue.length>0){$scope.rxImmunizationData=dataValue}else{$scope.rxImmunizationData.push(dataValue)}}else if(keyName==='Injections'){$scope.rxInjectionData=[];if(dataValue.length>0){$scope.rxInjectionData=dataValue}else{$scope.rxInjectionData.push(dataValue)}}}else{if(keyName==='Immunizations'){$scope.rxImmunizationData=[]}else if(keyName==='Injections'){$scope.rxInjectionData=[]}}}}}).error(function(){ecwAlert("Internal Error occured while getting immunizations and injections data")})}};$scope.getProcedureOrdersData=function(procedureXML,objMode){if(objMode==='readMode'){var jsonData=obflowmainx2js.xml_str2json(procedureXML);populateProcedureOrders(jsonData)}else{PregnancyDataServices.getLabsImaging($scope.pregId,$scope.patientId,3,"","").success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateProcedureOrders(jsonData)}).error(function(){ecwAlert("Internal Error occured while loading Imaging !")})}};function populateProcedureOrders(jsonData){$scope.procedureArray=[];var value=jsonData.Envelope.Body["return"].encounter;if(value){if(value.length>0){$scope.procedureArray=value}else{$scope.procedureArray.push(value)}}}$scope.getOBFlowsheetVerticalData=function(){PregnancyDataServices.getOBFlowSheetVerticalViewData($scope.pregId,$scope.patientId,$scope.encounterId).success(function(data){var jsonData=(new X2JS).xml_str2json(data);loadOBFlowsheetVerticalData(jsonData)})};function loadOBFlowsheetVerticalData(jsonData){$scope.flowsheetVerticalData=[];if(jsonData){var value=jsonData.Envelope.Body["return"].visitGroup;if(value){if(value.length>0){$scope.flowsheetVerticalData=value}else{$scope.flowsheetVerticalData.push(value)}}}}$scope.albuminGlucoseUpdateValue=function(obj){var length=$scope.FlowsheetHeaderItemList.length;if(obj==="Add"){for(var i=0;i<length;i++){if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Albumin"){$scope.FlowsheetHeaderItemList[i].strDate=$scope.urineAlbuminCopy}if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Glucose"){$scope.FlowsheetHeaderItemList[i].strDate=$scope.urineGlucoseCopy}}}else{for(var i=0;i<length;i++){if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Albumin"){$scope.FlowsheetHeaderItemList[i].strDate=""}if($scope.FlowsheetHeaderItemList[i].strNameDesc==="Urine Glucose"){$scope.FlowsheetHeaderItemList[i].strDate=""}}}};$scope.setPastOBVisit=function(){if($scope.isPastDateEntry.value){$scope.encDateTime='';$scope.visitEncId='0';$scope.isDateDisabled=false;$scope.albuminGlucoseUpdateValue("Remove")}else{$scope.encDateTime=$scope.encDateTimeCopy;$scope.visitEncId=$scope.visitEncIdCopy;$scope.isDateDisabled=true;var newDate=moment().format('MM/DD/YYYY');$("#"+$scope.visitDateId).val(newDate);$scope.albuminGlucoseUpdateValue("Add")}};$scope.showObTreatmentCompoundRxTooltip=function(className,title,id,context){$('#'+id).parent().css("position","relative");let parentOffSetTop=$('#'+id).parent().offset().top;var custEle=$('#'+id).parent().children(className);custEle.html(title);if(parentOffSetTop>710){custEle.css("top",'-15px')}else{custEle.css("top",'15px')}custEle.css("left",'20px');custEle.css("right",'auto');custEle.css("display","block")};$scope.hideObTreatmentCompoundRxTooltip=function(id,context){$('#'+id).parent().css("position","");$('#'+id).parent().children('.obtreatment_compoundrx-tooltip').css("display","none")};function renderOBVitalRangeForAuto(itemId,vitalName,vitalValue,vitalsRangeArr,vitalId,items){var vitalRange='';if(vitalsRangeArr[vitalId+""]){vitalRange=vitalsRangeArr[vitalId+""]}var res=true;if(vitalRange!==''){res=checkOBVitalRange(itemId,vitalName,vitalValue,vitalRange,'ff0000',items)}if(res){var inputId="#dropbox"+itemId;$scope.InvalidMessage="";$(inputId).addClass("hide-menu-item");$(inputId).attr("style","display:none;z-index:10000;")}if(!res)return}function checkOBVitalRange(fieldDetailId,vitalName,vitalValue,vitalRangeData,strColor,items){var temp=vitalValue;if(temp!==''&&isOutOfOBVitalRange(temp,vitalRangeData,vitalName)){var message="";var invalidLow="";var invalidHigh="";if(vitalName==="Systolic BP"){if(vitalRangeData.invalidLow.indexOf("/")>0){var low=vitalRangeData.invalidLow.toString().split("/");invalidLow=low[0].trim()}if(vitalRangeData.invalidHigh.indexOf("/")>0){var high=vitalRangeData.invalidHigh.toString().split("/");invalidHigh=high[0].trim()}message="The value entered for "+vitalName+" is not valid: "+vitalValue;message=message+"<br>Only numeric values from "+invalidLow+" to "+invalidHigh;message=message+" can be entered.<br>To configure the BP range, go to eCW Menu > EMR > Vitals > Configure Vitals Range"}else if(vitalName==="Diastolic BP"){if(vitalRangeData.lowRange.indexOf("/")>0){var low=vitalRangeData.invalidLow.toString().split("/");invalidLow=low[1].trim()}if(vitalRangeData.highRange.indexOf("/")>0){var high=vitalRangeData.invalidHigh.toString().split("/");invalidHigh=high[1].trim()}message="The value entered for "+vitalName+" is not valid: "+vitalValue;message=message+"<br>Only numeric values from "+invalidLow+" to "+invalidHigh;message=message+" can be entered.<br>To configure the BP range, go to eCW Menu > EMR > Vitals > Configure Vitals Range"}else{message="The value entered for "+vitalName+" is not valid: "+vitalValue;message=message+"<br>Only numeric values from "+vitalRangeData.invalidLow+" to "+vitalRangeData.invalidHigh;message=message+" can be entered.<br>To configure the "+vitalName+" range, go to eCW Menu > EMR > Vitals > Configure Vitals Range"}showAlertMessage(message,'','AlertMsg','','obpnController');$scope.InvalidMessage=message;if(vitalName!==undefined&&vitalName!==''&&vitalName.toLowerCase()==="weight"){$scope.calTotalWeightGain()}return false}else{return true}}function isOutOfOBVitalRange(value,vitalRangeData,vitalName){if(value){var invalidHigh=vitalRangeData.invalidHigh;var invalidLow=vitalRangeData.invalidLow;var invalidSysHigh="";var invalidSysLow="";var invalidDiaHigh="";var invalidDiaLow="";if(!invalidHigh||!invalidLow){return false}if(vitalName==="Systolic BP"){if(invalidLow.indexOf("/")>0){var low=invalidLow.toString().split("/");invalidSysLow=low[0].trim()}if(invalidHigh.indexOf("/")>0){var high=invalidHigh.toString().split("/");invalidSysHigh=high[0].trim()}if(validateHigherInvalidValue(value,invalidSysHigh,invalidSysLow))return true}else if(vitalName==="Diastolic BP"){if(invalidLow.indexOf("/")>0){var low=invalidLow.toString().split("/");invalidDiaLow=low[1].trim()}if(invalidHigh.indexOf("/")>0){var high=invalidHigh.toString().split("/");invalidDiaHigh=high[1].trim()}if(validateLowerInvalidValue(value,invalidDiaHigh,invalidDiaLow))return true}else{if(IsNumericData(value)&&IsNumericData(invalidLow)&&IsNumericData(invalidHigh)){if(parseFloatVal(invalidLow)>0&&parseFloatVal(invalidHigh)>0){if(parseFloatVal(value)<parseFloatVal(invalidLow)||parseFloatVal(value)>parseFloatVal(invalidHigh)){return true}}}if(!IsNumericData(value)&&IsNumericData(invalidLow)&&IsNumericData(invalidHigh)){return true}}}return false}function validateLowerInvalidValue(bpValue,invalidHigh,invalidLow){var res=bpValue.toString().split(",");for(var i=0;i<res.length;i++){res[i]=res[i].trim();if(IsNumericData(res[i])&&IsNumericData(invalidLow)&&IsNumericData(invalidHigh)){if(parseFloatVal(invalidLow)>0&&parseFloatVal(invalidHigh)>0){if(parseFloatVal(res[i])<parseFloatVal(invalidLow)||parseFloatVal(res[i])>parseFloatVal(invalidHigh)){return true}}}}return false}function validateHigherInvalidValue(bpValue,invalidHigh,invalidLow){var res=bpValue.toString().split(",");for(var i=0;i<res.length;i++){res[i]=res[i].trim();if(IsNumericData(res[i])&&IsNumericData(invalidLow)&&IsNumericData(invalidHigh)){if(parseFloatVal(invalidLow)>0&&parseFloatVal(invalidHigh)>0){if(parseFloatVal(res[i])<parseFloatVal(invalidLow)||parseFloatVal(res[i])>parseFloatVal(invalidHigh)){return true}}}}return false}function processOBVitalRange(jsonArr){var vitalsRangearray={};for(var index=0;index<jsonArr.length;index++){if(!vitalsRangearray[jsonArr[index].Id+""]){vitalsRangearray[jsonArr[index].Id+""]=jsonArr[index]}}return vitalsRangearray}function populateOBPatientDataDetails(patient,ptdob,ptSex){patient.dob=ptdob;patient.age='0';if(patient.dob&&patient.dob!==''){var birthDate=parseStringToDate(patient.dob,'mm/dd/yyyy','/');patient.age=calculateAgeFrom(birthDate)}if(ptSex.toString().toLowerCase()==='male'){patient.sex='M'}else{patient.sex='F'}patient.ageVar=getAgeBasedFlag(patient.dob)}function patientInfoOBDetails(){this.dob='';this.age='';this.patientName='';this.sex='';this.gestAge='';this.ageVar={age:'',ageFlag:''}}function getAgeBasedFlag(dob){var ageVar={age:'',ageFlag:''};var ageInYr=0;var ageInMonth=0;var birthDate=parseStringToDate(dob,'mm/dd/yyyy','/');var actualAge=calculateExactAgeInMY(birthDate,'12');if(actualAge!==''||actualAge!==0){if(actualAge.indexOf('Y')>0){ageInYr=actualAge.substring(0,actualAge.indexOf('Y'));ageVar.ageFlag='Y'}else if(actualAge.indexOf('M')>0){ageInMonth=actualAge.substring(0,actualAge.indexOf('M'));ageVar.ageFlag='M'}if(actualAge.indexOf('M')>0&&actualAge.indexOf('Y')>0){ageInYr=actualAge.substring(0,actualAge.indexOf('Y'));ageInMonth=actualAge.substring(actualAge.indexOf('Y')+1,actualAge.length-1)}ageVar.age=parseInt(ageInYr*12)+parseInt(ageInMonth);ageVar.ageFlag='M'}return ageVar}$scope.getOBItemLockUnlockStatus=function(nPregnancyId,nVisitId,flagVal){PregnancyDataServices.getLockUnlockStatus(nPregnancyId,nVisitId,'obflowsheet').success(function(data){var islockUnlockStatus=$.trim(data);if(islockUnlockStatus==='false'){if(flagVal==='lock'){$scope.lockFlowsheet(nVisitId,'1')}else if(flagVal==='delete'){$scope.deleteFlowsheet(nVisitId)}else if(flagVal==='save'){$scope.saveFlowsheetData()}}else{$scope.loadFlowSheetData("","",'editMode');$scope.closePopup('obfloedit',$scope.lockFlowhseetObj);var message="This visit has already been locked by another user. Please unlock this visit and then make the necessary changes.";showAlertMessage(message,'','AlertMsg','','obpnController')}})};$scope.getOBTabOrderList=function(){$scope.obTabsList=[];if(obTabsXml){var xmlToJsonData=(new X2JS).xml_str2json(obTabsXml);if(xmlToJsonData){var obTabItems=xmlToJsonData.Envelope.Body["return"].TabOrderingItems;if(obTabItems){obTabItems.forEach(function(item){if(item.strItemName==='History'){$scope.obTabsList.push({displayName:'History',linkName:'#hist_viewtab',iconClass:'hist_icn'})}else if(item.strItemName==='Physical'){$scope.obTabsList.push({displayName:'Physical',linkName:'#phy_viewtab',iconClass:'phy_icn'})}else if(item.strItemName==='Preg List'){$scope.obTabsList.push({displayName:'Preg List',linkName:'#preglist_viewtab',iconClass:'PregLt_icn'})}else if(item.strItemName==='EDD'){$scope.obTabsList.push({displayName:'EDD',linkName:'#edd_viewtab',iconClass:'edd_icn'})}else if(item.strItemName==='Flow Sheet'){$scope.obTabsList.push({displayName:'Flowsheets',linkName:'#flowsheet_viewtab',iconClass:'flow_icn'})}else if(item.strItemName==='Labs/Imaging'){$scope.obTabsList.push({displayName:'Labs/Imaging',linkName:'#labs_viewtab',iconClass:'lab_icn'})}else if(item.strItemName==='Genetics'){$scope.obTabsList.push({displayName:'Genetics',linkName:'#gen_viewtab',iconClass:'gen_icn'})}else if(item.strItemName==='Risks'){$scope.obTabsList.push({displayName:'Risks',linkName:'#risks_viewtab',iconClass:'risk_icn'})}else if(item.strItemName==='Graphs'){$scope.obTabsList.push({displayName:'Graphs',linkName:'#graphs_viewtab',iconClass:'graph_icn'})}else if(item.strItemName==='Notes'){$scope.obTabsList.push({displayName:'Notes',linkName:'#notes_viewtab',iconClass:'plan_icn'})}else if(item.strItemName==='Treatment'){$scope.obTabsList.push({displayName:'Treatment',linkName:'#rx_viewtab',iconClass:'rx_icn'})}else if(item.strItemName==='Form A'){$scope.obTabsList.push({displayName:'Form A',linkName:'#forma_viewtab',iconClass:'form_icn'})}else if(item.strItemName==='Plans'){$scope.obTabsList.push({displayName:'Plans',linkName:'#plans_viewtab',iconClass:'plan_icn'})}else if(item.strItemName==='Discharge'){$scope.obTabsList.push({displayName:'Discharge',linkName:'#discharge_viewtab',iconClass:'plan_icn'})}else if(item.strItemName==='Problem List'){$scope.obTabsList.push({displayName:'Problems',linkName:'#prob_viewtab',iconClass:'prob_icn'})}else if(item.strItemName==='Post Partum'){$scope.obTabsList.push({displayName:'Post Partum',linkName:'#postpartum_viewtab',iconClass:'pp_icn'})}})}}}};$scope.obTabClicked=function(tabName){if(tabName==='Graphs'){$scope.showHideGraph()}else if(tabName==='Problem List'){$scope.HideGraph();$scope.loadProblemListData('','editMode')}else{$scope.HideGraph()}};$scope.sortOBLabsImaging=function(columnName,labType){$scope.sortedOrderOBLabsType=labType;if(labType===0){if($scope.sortLabImagingOrder=="DESC"){$scope.sortLabImagingOrder="ASC"}else{$scope.sortLabImagingOrder="DESC"}var elementId="#OBLabs"+columnName;if(columnName===1){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs2').removeClass('OBClassiclabHeader');$('#OBLabs3').removeClass('OBClassiclabHeader');$('#OBLabs4').removeClass('OBClassiclabHeader');$('#OBLabs5').removeClass('OBClassiclabHeader');$('#OBLabs6').removeClass('OBClassiclabHeader')}else if(columnName===2){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs1').removeClass('OBClassiclabHeader');$('#OBLabs3').removeClass('OBClassiclabHeader');$('#OBLabs4').removeClass('OBClassiclabHeader');$('#OBLabs5').removeClass('OBClassiclabHeader');$('#OBLabs6').removeClass('OBClassiclabHeader')}else if(columnName===3){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs1').removeClass('OBClassiclabHeader');$('#OBLabs2').removeClass('OBClassiclabHeader');$('#OBLabs4').removeClass('OBClassiclabHeader');$('#OBLabs5').removeClass('OBClassiclabHeader');$('#OBLabs6').removeClass('OBClassiclabHeader')}else if(columnName===4){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs1').removeClass('OBClassiclabHeader');$('#OBLabs2').removeClass('OBClassiclabHeader');$('#OBLabs3').removeClass('OBClassiclabHeader');$('#OBLabs5').removeClass('OBClassiclabHeader');$('#OBLabs6').removeClass('OBClassiclabHeader')}else if(columnName===5){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs1').removeClass('OBClassiclabHeader');$('#OBLabs2').removeClass('OBClassiclabHeader');$('#OBLabs3').removeClass('OBClassiclabHeader');$('#OBLabs4').removeClass('OBClassiclabHeader');$('#OBLabs6').removeClass('OBClassiclabHeader')}else if(columnName===6){$(elementId).addClass("OBClassiclabHeader");$('#OBLabs1').removeClass('OBClassiclabHeader');$('#OBLabs2').removeClass('OBClassiclabHeader');$('#OBLabs3').removeClass('OBClassiclabHeader');$('#OBLabs4').removeClass('OBClassiclabHeader');$('#OBLabs5').removeClass('OBClassiclabHeader')}$scope.sortOBLabBy=columnName}else if(labType===1){if($scope.sortLabOrder=="DESC"){$scope.sortLabOrder="ASC"}else{$scope.sortLabOrder="DESC"}var elementId="#OBImaging"+columnName;if(columnName===1){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging2').removeClass('OBClassicDIHeader');$('#OBImaging3').removeClass('OBClassicDIHeader');$('#OBImaging4').removeClass('OBClassicDIHeader');$('#OBImaging5').removeClass('OBClassicDIHeader');$('#OBImaging6').removeClass('OBClassicDIHeader')}else if(columnName===2){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging1').removeClass('OBClassicDIHeader');$('#OBImaging3').removeClass('OBClassicDIHeader');$('#OBImaging4').removeClass('OBClassicDIHeader');$('#OBImaging5').removeClass('OBClassicDIHeader');$('#OBImaging6').removeClass('OBClassicDIHeader')}else if(columnName===3){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging1').removeClass('OBClassicDIHeader');$('#OBImaging2').removeClass('OBClassicDIHeader');$('#OBImaging4').removeClass('OBClassicDIHeader');$('#OBImaging5').removeClass('OBClassicDIHeader');$('#OBImaging6').removeClass('OBClassicDIHeader')}else if(columnName===4){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging1').removeClass('OBClassicDIHeader');$('#OBImaging2').removeClass('OBClassicDIHeader');$('#OBImaging3').removeClass('OBClassicDIHeader');$('#OBImaging5').removeClass('OBClassicDIHeader');$('#OBImaging6').removeClass('OBClassicDIHeader')}else if(columnName===5){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging1').removeClass('OBClassicDIHeader');$('#OBImaging2').removeClass('OBClassicDIHeader');$('#OBImaging3').removeClass('OBClassicDIHeader');$('#OBImaging4').removeClass('OBClassicDIHeader');$('#OBImaging6').removeClass('OBClassicDIHeader')}else if(columnName===6){$(elementId).addClass("OBClassicDIHeader");$('#OBImaging1').removeClass('OBClassicDIHeader');$('#OBImaging2').removeClass('OBClassicDIHeader');$('#OBImaging3').removeClass('OBClassicDIHeader');$('#OBImaging4').removeClass('OBClassicDIHeader');$('#OBImaging5').removeClass('OBClassicDIHeader')}$scope.sortOBDIBy=columnName}else{if($scope.sortTemplateLabOrder=="DESC"){$scope.sortTemplateLabOrder="ASC"}else{$scope.sortTemplateLabOrder="DESC"}var elementId="#labTrimester"+columnName;if(columnName===1){$(elementId).addClass("OBlabHeader");$('#labTrimester2').removeClass('OBlabHeader');$('#labTrimester3').removeClass('OBlabHeader');$('#labTrimester4').removeClass('OBlabHeader');$('#labTrimester5').removeClass('OBlabHeader')}else if(columnName===2){$(elementId).addClass("OBlabHeader");$('#labTrimester1').removeClass('OBlabHeader');$('#labTrimester3').removeClass('OBlabHeader');$('#labTrimester4').removeClass('OBlabHeader');$('#labTrimester5').removeClass('OBlabHeader')}else if(columnName===3){$(elementId).addClass("OBlabHeader");$('#labTrimester1').removeClass('OBlabHeader');$('#labTrimester2').removeClass('OBlabHeader');$('#labTrimester4').removeClass('OBlabHeader');$('#labTrimester5').removeClass('OBlabHeader')}else if(columnName===4){$(elementId).addClass("OBlabHeader");$('#labTrimester1').removeClass('OBlabHeader');$('#labTrimester2').removeClass('OBlabHeader');$('#labTrimester3').removeClass('OBlabHeader');$('#labTrimester5').removeClass('OBlabHeader')}else if(columnName===5){$(elementId).addClass("OBlabHeader");$('#labTrimester1').removeClass('OBlabHeader');$('#labTrimester2').removeClass('OBlabHeader');$('#labTrimester3').removeClass('OBlabHeader');$('#labTrimester4').removeClass('OBlabHeader')}$scope.sortOBLabBy=columnName}$scope.sortedByOBLabColName=columnName;if(labType===0){PregnancyDataServices.getLabsImaging($scope.pregId,$scope.patientId,1,$scope.sortLabImagingOrder,$scope.sortedByOBLabColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateLabsData(jsonData)}).error(function(){ecwAlert("Internal Error occurred while loading labs !")})}else if(labType===1){PregnancyDataServices.getLabsImaging($scope.pregId,$scope.patientId,2,$scope.sortLabOrder,$scope.sortedByOBLabColName).success(function(data){var jsonData=(new X2JS).xml_str2json(data);populateImagingData(jsonData)}).error(function(){ecwAlert("Internal Error occurred while loading Imaging !")})}else if(labType===3){$scope.loadModernLabData("",'editMode')}};$scope.setPreObWeightVal=function(title){let warningMsg="<b>"+title+" – Confirmation</b></br></br>";if(title==='Physical'){warningMsg+="<b>Changing</b> this value will result in the <b>Total Weight Gain</b> being <b>re-calculated</b> in the Prenatal Visit section.</br></br>"}else{warningMsg+="<b>Changing</b> this value will result in the <b>Total Weight Gain</b> being <b>re-calculated.</b></br></br>"}warningMsg+="Total Weight Gain = Weight - Pre-OB Weight</br></br>";warningMsg+="Are you sure you want to edit this value?";if($scope.PreObWt!==''&&$scope.PreObWt!==undefined&&$scope.numPadId!==''&&$scope.numPadId!==undefined){displayConfirmationPreOBWtPopUp(warningMsg,'')}else if($scope.PreObWt!==''&&$scope.PreObWt!==undefined&&($scope.visitEncStatus===''||$scope.visitEncStatus==='mapped')){if($("#preobweight").hasClass("input-disabled")){displayConfirmationPreOBWtPopUp(warningMsg,'')}}};let displayConfirmationPreOBWtPopUp=function(msg,screenTitle){commonWarningPopup({screenName:'',screenTitle:screenTitle,buttons:[{label:"Edit Anyway",cssClass:'btn-blue',callbackEvent:function(){$scope.preObWtVerifiedCallback()}},{label:"Cancel",cssClass:'btn-lgrey',callbackEvent:function(){$scope.preObWtVerifiedCallbackCancel()}}],message:msg,isConfirmPopup:true,isKeyboardClose:false,screenSpecificClass:'obFlowsheetConfirmMsg'},$ocLazyLoad,$modal)};$scope.preObWtVerifiedCallback=function(){$('#preobweight').removeClass('input-disabled');$($scope.numPadId).removeClass("hide-menu-item");$("#phyPreObWt").removeClass("input-disabled");$($scope.numPadId).attr("style","display:block;z-index:10000;");if($scope.fieldDetailId!==undefined){try{timer3=$timeout(function(){$scope.setFocusAndCursorAtEnd($scope.fieldDetailId)},500)}catch(e){}}};$scope.preObWtVerifiedCallbackCancel=function(){$('#preobweight').addClass('input-disabled')};$scope.setFocusAndCursorAtEnd=function(fieldDetailId){var setFocusId="#obFlowsheetPast_popupIpt10ngR"+fieldDetailId;var strLength=$(setFocusId).val().length*2;$(setFocusId).focus();$(setFocusId)[0].setSelectionRange(strLength,strLength)};$(document).on("keyup",function(e){var code=e.keyCode||e.which;if($("#obListBtn3")||$("#obListBtn4")||$("#obListBtn1")){if(code==27){$("#obListBtn3").removeAttr('disabled');$("#obListBtn4").removeAttr('disabled');$("#obListBtn1").removeAttr('disabled')}}})});obpnModule.filter('slice',function(){return function(arr,start,end){return arr.slice(start,end)}});