function getPlainData(pastedData){if(!pastedData||pastedData.trim().length===0){return pastedData}return strip(pastedData)}function getSanitizedData(pastedData){if(!pastedData||pastedData.trim().length===0||isPlainText(pastedData)){return pastedData}var sanitizedData="";try{pastedData=pastedData.replace(/<p[^>]*>/gi,"");pastedData=pastedData.replace(/<\/?p>/gi,"<br>");var encodedPastedData=encodeSupportedTags(pastedData);var encodedDataWithSupportedTags=encodedPastedData.replace(/(<\/?(?:ecw-span|ecw-b|ecw-strong|ecw-i|ecw-em|ecw-u|ecw-font|ecw-br)[^>]*>)|<[^>]+>/gi,'$1');var decodedDataWithSupportedTags=decodeSupportedTags(encodedDataWithSupportedTags);sanitizedData=sanitize(decodedDataWithSupportedTags)}catch(err){alert(err);sanitizedData=strip(pastedData)}return sanitizedData.trim()}function convertRTFToPlain(rtfText){rtfText=rtfText.replace(/\\par[d]?/g,"");let plainText=rtfText.replace(/\{\*?\\[^{}]+}|[{}]|\\\n?[A-Za-z]+\n?(?:-?\d+)?[ ]?/g,"").trim();return convertMultilineBreaksToSingle(plainText)}function convertMultilineBreaksToSingle(plainText){while(plainText&&plainText.match(/\n\r\n*/g)){plainText=plainText.replace(/\r\n\r\n*/g,'\r\n')}return plainText.replace(/\n{2,}/g,'\n')}function strip(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||""}function isPlainText(pastedData){var output=$($.parseHTML('<div>'+pastedData+'</div>',null,false));return output.text()===pastedData}function encodeSupportedTags(pastedData){if(!pastedData){return pastedData}return pastedData.replace(/<span>/gi,'<ecw-span>').replace(/<\/span>/gi,'</ecw-span>').replace(/<span /gi,'<ecw-span ').replace(/<\/span>/gi,'</ecw-span>').replace(/<b>/gi,'<ecw-b>').replace(/<\/b>/gi,'</ecw-b>').replace(/<b /gi,'<ecw-b ').replace(/<\/b>/gi,'</ecw-b>').replace(/<strong>/gi,'<ecw-strong>').replace(/<\/strong>/gi,'</ecw-strong>').replace(/<strong /gi,'<ecw-strong ').replace(/<\/strong>/gi,'</ecw-strong>').replace(/<i>/gi,'<ecw-i>').replace(/<\/i>/gi,'</ecw-i>').replace(/<i /gi,'<ecw-i ').replace(/<\/i>/gi,'</ecw-i>').replace(/<em>/gi,'<ecw-em>').replace(/<\/em>/gi,'</ecw-em>').replace(/<em /gi,'<ecw-em ').replace(/<\/em>/gi,'</ecw-em>').replace(/<u>/gi,'<ecw-u>').replace(/<\/u>/gi,'</ecw-u>').replace(/<u /gi,'<ecw-u ').replace(/<\/u>/gi,'</ecw-u>').replace(/<font>/gi,'<ecw-font>').replace(/<\/font>/gi,'</ecw-font>').replace(/<font /gi,'<ecw-font ').replace(/<\/font>/gi,'</ecw-font>').replace(/<br>/gi,'<ecw-br>').replace(/<\/br>/gi,'</ecw-br>').replace(/<br /gi,'<ecw-br ').replace(/<\/br>/gi,'</ecw-br>')}function decodeSupportedTags(encodedSanitisedHtml){if(!encodedSanitisedHtml){return encodedSanitisedHtml}return encodedSanitisedHtml.replace(/<ecw-span>/gi,'<span>').replace(/<\/ecw-span>/gi,'</span>').replace(/<ecw-span /gi,'<span ').replace(/<\/ecw-span>/gi,'</span>').replace(/<ecw-b>/gi,'<b>').replace(/<\/ecw-b>/gi,'</b>').replace(/<ecw-b /gi,'<b ').replace(/<\/ecw-b>/gi,'</b>').replace(/<ecw-strong>/gi,'<strong>').replace(/<\/ecw-strong>/gi,'</strong>').replace(/<ecw-strong /gi,'<strong ').replace(/<\/ecw-strong>/gi,'</strong>').replace(/<ecw-i>/gi,'<i>').replace(/<\/ecw-i>/gi,'</i>').replace(/<ecw-i /gi,'<i ').replace(/<\/ecw-i>/gi,'</i>').replace(/<ecw-em>/gi,'<em>').replace(/<\/ecw-em>/gi,'</em>').replace(/<ecw-em /gi,'<em ').replace(/<\/ecw-em>/gi,'</em>').replace(/<ecw-u>/gi,'<u>').replace(/<\/ecw-u>/gi,'</u>').replace(/<ecw-u /gi,'<u ').replace(/<\/ecw-u>/gi,'</u>').replace(/<ecw-font>/gi,'<font>').replace(/<\/ecw-font>/gi,'</font>').replace(/<ecw-font /gi,'<font ').replace(/<\/ecw-font>/gi,'</font>').replace(/<ecw-br>/gi,'<br>').replace(/<\/ecw-br>/gi,'</br>').replace(/<ecw-br /gi,'<br ').replace(/<\/ecw-br>/gi,'</br>')}function sanitize(html){var output=$($.parseHTML('<div>'+html+'</div>',null,false));output.find('*').each(function(){trimAttributes(this)});return output.html().replace(/http/gi,'http_')}function trimAttributes(node){var copiedNode=angular.copy(node);if(!copiedNode||!copiedNode.attributes||copiedNode.attributes.length===0){return}if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){return this.substr(position||0,searchString.length)===searchString}}$.each(copiedNode.attributes,function(index,attribute){var attrName=attribute.name;var attrValue=attribute.value;if('font'===node.nodeName.toLowerCase()&&"size"===attrName){$(node).removeAttr(attrName);$(node).css('size','2')}else if("style"===attrName){var parts=attrValue.split(";");var sanitizedStyle='';$.each(parts,function(index,part){if(part.length>0&&!sanitizedStyle){var keyValue=part.split(':');if(keyValue[0].trim()==='color'){sanitizedStyle=keyValue[1]}}});$(node).removeAttr(attrName);if(sanitizedStyle){$(node).css('color',sanitizedStyle.trim())}}else if("color"!==attrName&&!("class"===attrName&&attrValue.startsWith("wysiwyg-color-"))){$(node).removeAttr(attrName)}})}