(function(){let favoritesApp=angular.module('ecw.favorites',[]);favoritesApp.component('favoritesComponent',{bindings:{favorites:'=',formularyInfo:'=',requestParam:'=',context:'=',selectCallBack:'&',favRefreshCallback:'&'},controller:['$http','$ocLazyLoad','$modal',favoritesController],controllerAs:'vm',templateUrl:"/mobiledoc/jsp/webemr/progressnotes/ecwrx/patientCentricDosing/favorites/html/favorites-tpl.html",transclude:true});function favoritesController($http,$ocLazyLoad,$modal){var vm=this;vm.selectDose=function(index){let doseObj=vm.favorites[index];vm.selectCallBack({arg0:convertToResponseObj(doseObj)})};vm.openRxEdit=function(index,isRtbcButtonClicked){let doseObj=vm.favorites[index];if(isRtbcButtonClicked===true)doseObj.isRtbcButtonClicked=true;else doseObj.isRtbcButtonClicked=false;doseObj.DispensableItemId=0;vm.openRxEditModal(convertToResponseObj(doseObj))};vm.openRxEditModal=function(doseObj){doseObj.context=vm.context;$ocLazyLoad.load({name:'RxEditModule',files:['/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/js/RxEditController.js','/mobiledoc/jsp/resources/jslib/angular-perfect-scrollbar/src/angular-perfect-scrollbar.min.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/RxEdit/rx-editmodal.html'),controller:'RxEditCtrl',windowClass:'rxeditscreen bluetheme rx-topmargin',backdrop:"static",keyboard:false,resolve:{patientID:function(){return vm.requestParam.patientId},encounterID:function(){return vm.requestParam.encounterId},RxEditObject:function(){return doseObj},loginuserid:function(){return global.TrUserId},parentName:function(){return"RxQuickSearch"}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(!angular.isUndefined(modalInstanceResponse)&&typeof modalInstanceResponse==='object'){vm.selectCallBack({arg0:modalInstanceResponse})}else if(vm.favRefreshCallback){vm.favRefreshCallback()}})})};vm.launchFormulary=function(index){var rxObj=vm.favorites[index];var sSynonymId=vm.favorites[index].drugNameId;$ocLazyLoad.load({name:'launchFormulary',files:['/mobiledoc/jsp/webemr/progressnotes/ecwrx/formularyInfo/launchFormulary.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/progressnotes/ecwrx/formularyInfo/launchFormulary.jsp'),controller:'launchFormularyController',backdrop:"static",resolve:{patientID:function(){return vm.requestParam.patientId},encounterID:function(){return vm.requestParam.encounterId},RxEditObject:function(){return rxObj},loginuserid:function(){return global.TrUserId},parentName:function(){return"AddRxTreatment"},formularyInfo:function(){return vm.formularyInfo},SynonymId:function(){return sSynonymId}}});modalInstance.result.then(function(modalInstanceResponse){},function(modalInstanceResponse){if(modalInstanceResponse!=null){vm.LoadAlternativeDrug(modalInstanceResponse)}})})};vm.LoadAlternativeDrug=function(item){var obj=getItemIdFromNDCCode(item.NDC_Code,true,false,true);if(obj.itemId>0){vm.qosResultObj={};vm.qosResultObj.resultSet={};vm.qosResultObj.resultSet.sItemName=obj.itemName;vm.qosResultObj.resultSet.nItemId=obj.itemId;vm.qosResultObj.resultSet.sDrugNameId=item.Synonym_id;vm.qosResultObj.resultSet.sSupplierId=item.Synonym_id;vm.qosResultObj.resultSet.sKeyname=vm.requestParam.sKeyname;vm.qosResultObj.resultSet.nParentID=vm.requestParam.parentId;vm.qosResultObj.resultSet.NDCCode=item.NDC_Code;vm.qosResultObj.resultSet.loadAlternativeDrug=true;vm.qosResultObj.resultSet.isCompound='false';let scope=getAddRxControllerScope('[ng-controller=AddRxCtrl_1]');scope.rowClicked(vm.qosResultObj.resultSet);$('#AddRxSearch').val(obj.itemName);setFocusOnSearchBoxForAddRx()}else{ecwAlert("Not able to properly map selected drug. Please try selecting this drug manually from drug lookup screen. ")}};function getAddRxControllerScope(selecter){let appElement=document.querySelector(selecter);if(appElement){return angular.element(appElement).scope()}else{return undefined}}function setFocusOnSearchBoxForAddRx(){var id='AddRxSearch';setTimeout(function(){document.getElementById(id).focus()},1);jQuery('#'+id).trigger("focus");document.getElementById(id).focus();var sValue=jQuery('#'+id).val();if(sValue&&sValue.length>0){$('#'+id).trigger("select")}}function convertToResponseObj(doseObj){var newObj={};newObj.isRtbcButtonClicked=doseObj.isRtbcButtonClicked;newObj.AdministerFlag="0";newObj.DispenseFlag="0";newObj.DrugNameId=doseObj.drugNameId;newObj.IVHydration="0";newObj.IsRxSupplies=doseObj.rxSupplies||"NO";newObj.ItemId=doseObj.itemId;newObj.RxItemId=doseObj.itemId;newObj.drugName=doseObj.description;newObj.sItemName=doseObj.description;newObj.MMDCode=doseObj.mmdcode||"";newObj.ObsoleteDate=doseObj.obsoleteDate||"";newObj.awup="";newObj.controlled=doseObj.controlled||"";newObj.controlledCode=doseObj.controlledSubstanceCode||"";newObj.description=doseObj.description;newObj.dispense=doseObj.dispense||"";newObj.doseunit="";newObj.drugNameType=doseObj.drugNameType||"";newObj.drugOTC=doseObj.drugOTC||"";newObj.duration=doseObj.duration;newObj.favorite="0";newObj.formulation=doseObj.formulation;newObj.freq=doseObj.frequency;newObj.isCompound="0";if(doseObj.ndc==null){newObj.ndc='';newObj.NDC=''}else{newObj.ndc=doseObj.ndc;newObj.NDC=doseObj.ndc}newObj.refills=doseObj.refills||"";newObj.route=doseObj.route;newObj.rxFormulary="";newObj.rxFormularyId="";newObj.strength=doseObj.strength;newObj.take=doseObj.take;newObj.AddInstructions="";if(vm.requestParam.dxId){newObj.assessId=vm.requestParam.dxId}else{newObj.assessId="0"}return newObj}vm.validateDurationDispense=function(value){var pattern=/^([^0-9]*)$/;if(value){if(!pattern.test(value)){return true}}return false}}})();