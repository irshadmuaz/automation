angular.module('NewBillingAlert',['oc.lazyLoad','ecw.batchAjax','ecw.dir.iframeonload','ecw.dir.savePrompt','ecw.dir.macros','ecw.spellchecker','ecw.datatruncUtilityModule','ecw.dir.spellCheckText']).controller('billingAlertController',['$scope','$http','$ocLazyLoad','batchAjaxService','$timeout','$modal','dataTruncUtilityService',function($scope,$http,$ocLazyLoad,batchAjaxService,$timeout,$modal,dataTruncUtilityService){$scope.AlertTypes={APPT:'1',CLINICAL:'2',BOTH:'3'};$scope.Priority={PRIORITY:'1',NOT_PRIORITY:'2',INSURANCE:'3'};$scope.patientId=billingAlertPatientId;$scope.MUParticipate=getItemKeyValue('MUParticipate').toLowerCase()=='yes';$scope.EnableClaimCollection=getItemKeyValue('EnableClaimCollection').toLowerCase()=='yes';$scope.EnablePaymentPlan=getItemKeyValue('EnablePaymentPlans').toLowerCase()=='yes';$scope.EnableStatementHold=getItemKeyValue('EnableExcludeClmFromStmt').toLowerCase()=='yes';$scope.insuranceAlert='';$scope.billingAlert={};$scope.globalAlerts=[];$scope.MUAlert='';$scope.isPatientInCollections=false;$scope.iHubConsentCheck=getItemKeyValue("commToInteropHub").toLowerCase()==="yes"||getItemKeyValue("enableExternalRegistries").toLowerCase()==="yes";$scope.IsEMPIEnabled="YES"===getItemKeyValue("EnableEMPI").toUpperCase();var strVmId="";var lockObj={formName:"frmPatientIHubConsent",uniqueKey:"frmPatientIHubConsent"+$scope.patientId,g_cancel:false,strKey:"",isOpenform:false};$scope.collectionBalance='';$scope.isLockAcquired=false;$scope.userInputChecked=false;$scope.isVendorActivated=false;$scope.showPtCollBalance=false;$scope.strEnableExtColl=getItemKeyValue("EnableExternalCollections");if($scope.strEnableExtColl.toUpperCase()=='YES'){$scope.showPtCollBalance=true}$scope.patientIdentifiers=$scope.patientId;$scope.dirtyFlag=false;$scope.globallinkurl='';$scope.setDirtyFlag=function(){$scope.dirtyFlag=true};$scope.initBillingAlert=function(isTotalWriteOffPresent,callFrom){$scope.isTotalWriteOffPresent=isTotalWriteOffPresent==="true"?true:false;$scope.billingAlertContext=callFrom==="floatingToolbar"?true:false};document.addEventListener('keydown',KeyCombinationEventBillingAlert,false);function KeyCombinationEventBillingAlert(e){var evtobj=window.event?event:e;if(!isModalCurrentlyActive("billingalert")){return}if(evtobj.keyCode===76&&evtobj.altKey){$scope.closeModal();e.stopPropagation()}}$scope.closeModal=function(){if($scope.iHubConsentCheck&&!$scope.IsEMPIEnabled&&$scope.interopConsent_showConsentQue&&$scope.isLockAcquired){releaseLock()}try{$scope.$parent.$parent.iHubConsentIconShow=true}catch(e){}$("#billingalert .scrollable, #billingalert .billingtable").each(function(){var jScrollPaneInstance=$(this).data('jsp');jScrollPaneInstance&&jScrollPaneInstance.destroy()});var elem=$('#billingalert');var controllerScope=angular.element(elem).scope();controllerScope.$destroy();$('#billingalert').modal('hide');angular.element(elem).remove();$('.modal-backdrop.fade').last().remove();if($scope.getPtDemographicHub)$scope.getPtDemographicHub();if($scope.setIsAfterAlertCheck)$scope.setIsAfterAlertCheck(true);document.removeEventListener('keydown',KeyCombinationEventBillingAlert,false);if(typeof $scope.openDentalAnnotationAlert=='function'){openDentalAnnotationAlert()}if($scope.billingAlertContext===true){angular.element('#smart-panel').scope().vm.showMainWindow()}};$scope.saveChanges=function(){var isValidInput=dataTruncUtilityService.getTextFieldWidthsFromTable("web_billingalert","billingalert","bluetheme");if(!isValidInput){return false}var xw=new XMLWriter;startSoapPacket(xw);xw.writeStartElement('BillingAlert');addElement(xw,'AlertStatus',$scope.billingAlert.AlertNotes?'1':'0','xsi:type','xsd:string');addElement(xw,'GlobalAlertStatus',$scope.globalAlerts.length>0?'1':'0','xsi:type','xsd:string');addElement(xw,'AlertNotes',escapeXml($scope.billingAlert.AlertNotes),'xsi:type','xsd:string');xw.writeEndElement();endSoapPacket(xw);var xmlData=xw.flush();try{var serverUrl=makeURL('/mobiledoc/jsp/catalog/xml/saveBillingAlertDetail.jsp?PatientId='+$scope.patientId);var xsrf=$.param({FormData:xmlData});urlPost(serverUrl,xsrf)}catch(err){console.log("Error in saving: "+err)}$scope.saveConsentQueestion();if(typeof $scope.$parent.billingAlertReturn=='function'){$scope.$parent.billingAlertReturn()}if(typeof $scope.$parent.$dental_clinical_alert=='function'){$scope.$parent.$dental_clinical_alert($scope.globalAlerts)}if(billingAlertStrParentScreen==="vascular"&&$vascularGlobalAPI&&$vascularGlobalAPI.setClinicalAlertResponse){$vascularGlobalAPI.setClinicalAlertResponse($scope.globalAlerts)}if(typeof $scope.$parent.playerhub_alerts=='function'&&getItemKeyValue("NFL").toLowerCase()=='yes'){$scope.$parent.playerhub_alerts()}$scope.closeModal()};$scope.updateGlobalAlerts=function(){$ocLazyLoad.load({name:'NewBillingGlobalAlert',files:['/mobiledoc/jsp/webemr/billingalert/billingGlobalalert.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/billingalert/billingGlobalDetails.jsp?patientId='+$scope.patientId+'&Patientname='+billingAlertPatientName);$scope.globallinkurl=url},function(e){console.log(e)})};$scope.setBillingData=function(billingData){if(billingData){$scope.billingAlert=billingData;$scope.isPatientInCollections=$scope.billingAlert.GivenToColl=='1';setTimeout(function(){$('#billing-alert-txtarea')[0].setSelectionRange(0,0);$('#billing-alert-txtarea').focus()},0)}};$scope.isInsuranceAlert=function(alert){return alert.Priority==$scope.Priority.INSURANCE};$scope.setAlertData=function(alertData){if(alertData){if(alertData.length>0){$scope.globalAlerts=alertData}else{$scope.globalAlerts.push(alertData)}if(angular.isFunction($scope.$parent.setGlobalAlertDetails))$scope.$parent.setGlobalAlertDetails('','#e1e1e1');for(var i=0;i<$scope.globalAlerts.length;i++){if($scope.isInsuranceAlert($scope.globalAlerts[i])){$scope.insuranceAlert=$scope.globalAlerts[i].Notes;$scope.globalAlerts.splice(i,1)}else if($scope.globalAlerts[i].Priority==$scope.Priority.PRIORITY&&$scope.globalAlerts[i].AlertType!=$scope.AlertTypes.CLINICAL&&angular.isFunction($scope.$parent.setGlobalAlertDetails)){$scope.$parent.setGlobalAlertDetails($scope.globalAlerts[i].Name,decimalColorToHTMLcolor($scope.globalAlerts[i].ColorCode))}}}else if(angular.isFunction($scope.$parent.setGlobalAlertDetails)){$scope.$parent.setGlobalAlertDetails('','#e1e1e1')}};$scope.onload=function(){if($scope.EnableClaimCollection){$http({url:makeURL('/mobiledoc/jsp/catalog/xml/edi/getAccCollBal.jsp?PtId='+$scope.patientId),method:'post',headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(data){var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var balance=jsonobj.Envelope.Body['return'].CollBal;$scope.collectionBalance=balance||''}).error(function(data){console.log("Error getting collection balance.")})}$scope.isBillingAlertLoaded=false;$scope.isGlobalAlertLoaded=false;var batchAjax=[];batchAjax.push({url:makeURL('/jsp/catalog/xml/loadBillingAlertDetail.jsp?PatientId='+$scope.patientId),success:function(data){var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var value=jsonobj.Envelope.Body['return'];$scope.setBillingData(value);$scope.isBillingAlertLoaded=true},error:function(){$scope.isBillingAlertLoaded=true}});batchAjax.push({url:makeURL('/jsp/catalog/xml/getGlobalAlertDetail.jsp?PatientId='+$scope.patientId),success:function(data){var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var value=jsonobj.Envelope.Body['return'].resultset.data.row;$scope.setAlertData(value);$scope.isGlobalAlertLoaded=true},error:function(){$scope.isGlobalAlertLoaded=true}});if($scope.iHubConsentCheck&&!$scope.IsEMPIEnabled){batchAjax.push({url:makeURL('/jsp/interop/consent/iHubConsentCheck.jsp?patientId='+$scope.patientId),success:function(response){response=$.trim(response);if(""!==response&&response.length>0){var jsonObj=JSON.parse(response);try{$scope.$parent.$parent.iHubConsentIconShow=false}catch(e){}$scope.userInputChecked=false;$scope.interopConsent_showConsentQue=jsonObj.showConsentQue;if($scope.interopConsent_showConsentQue){acquireLock()}$scope.interopConsent_consentCommId=jsonObj.consentCommId;$scope.interopConsent_localQueId=jsonObj.localQueId;$scope.interopConsent_options=jsonObj.options;$scope.interopConsent_sendCommId=$scope.interopConsent_options.send.commId;$scope.interopConsent_sendLocalId=$scope.interopConsent_options.send.localId;$scope.interopConsent_sendName=$scope.interopConsent_options.send.name;$scope.interopConsent_sendAnswer=$scope.interopConsent_options.send.answer;$scope.interopConsent_receiveCommId=$scope.interopConsent_options.receive.commId;$scope.interopConsent_receiveLocalId=$scope.interopConsent_options.receive.localId;$scope.interopConsent_receiveName=$scope.interopConsent_options.receive.name;$scope.interopConsent_receiveAnswer=$scope.interopConsent_options.receive.answer;$scope.interopConsent_optoutCommId=$scope.interopConsent_options.optout.commId;$scope.interopConsent_optoutLocalId=$scope.interopConsent_options.optout.localId;$scope.interopConsent_optoutName=$scope.interopConsent_options.optout.name;$scope.interopConsent_optoutAnswer=$scope.interopConsent_options.optout.answer}},error:function(){ecwAlert("Unable to load patient's data exchange consent status.")}})}if($scope.MUParticipate){batchAjax.push({url:makeURL('/jsp/webemr/billingalert/getMUAlertText.jsp?patientId='+$scope.patientId),success:function(data){$scope.MUAlert=data?data.trim():''}})}batchAjaxService.batchAjax(batchAjax);if($scope.EnablePaymentPlan){$scope.hasPmtPlan=false;var strUrl=makeURL('/mobiledoc/jsp/catalog/xml/edi/paymentplan/checkPtHasOpenPmtPlan.jsp?Type=BillingAlert&PatientId='+$scope.patientId);var HasOpenPmtPlan=urlPost(strUrl).trim();if(HasOpenPmtPlan=="true"){$scope.hasPmtPlan=true;var url=makeURL('/mobiledoc/jsp/webemr/webpm/paymentplan/intermidPaymentPlan.jsp?action=ppInstallments&PatientId='+$scope.patientId);var data=urlGet(url).trim();setPaymentPlanData(data)}else{$scope.hasPmtPlan=false}}$scope.accStmtMsg='';if($scope.EnableStatementHold){$scope.hasStmtHold=false;var strUrl=makeURL('/mobiledoc/jsp/catalog/xml/IsBillingAlertExist.jsp?PatientId='+$scope.patientId);var data=urlPost(strUrl).trim();var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var value=jsonobj.Envelope.Body['return'];if(value&&'success'==value.status){if(value.StmtHoldAlert==1){var HasOpenStmtHold=true;$scope.hasStmtHold=true;if(value.noStatements==1){$scope.accStmtMsg='Account Level Statement Hold On'}}}if(HasOpenStmtHold==true){var url=makeURL('/mobiledoc/jsp/webemr/webpm/billingmenu/codes/statementholdreason/getStmtHoldForBillingAlert.jsp?PatId='+$scope.patientId);var data=urlGet(url).trim();setStatementHoldData(data)}else{$scope.hasStmtHold=false}}};function getVendorAddlDataValue($http,dataName){return $http({method:"POST",url:"/mobiledoc/jsp/catalog/xml/getVendorAddlDataValue.jsp",headers:{'Content-Type':'application/x-www-form-urlencoded'},data:"dataname="+dataName})}function setStatementHoldData(data){if(data!=null&&data!=""){$scope.stmtHoldData=[];var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var value=jsonobj.Envelope.Body['return'].data.row;if(value){if(value instanceof Array){$scope.stmtHoldData=value}else{$scope.stmtHoldData.push(value)}}}}$scope.onload();function setPaymentPlanData(data){if(data!=null&&data!=""){$scope.installmentData=[];var str=$.parseJSON(data);$scope.installmentData=str.installments;var colorFlag=true;$scope.totalAmount=0;var currentDate=new Date;var count=0;$scope.dueAmount=0;for(var i=0;i<$scope.installmentData.length;i++){var dueDate=new Date($scope.installmentData[i].duedate);var dueAmount1=parseFloat($scope.installmentData[i].dueamount);$scope.totalAmount=$scope.totalAmount+parseFloat($scope.installmentData[i].dueamount);if(dueAmount1>0&&currentDate.getTime()>=dueDate.getTime()){count++;$scope.installmentData[i].color=true}else if(dueAmount1>0&&count===0&&currentDate.getTime()<=dueDate.getTime()){$scope.installmentData[i].color=true;count++}else{$scope.installmentData[i].color=false}if($scope.installmentData[i].color){$scope.dueDate=$scope.installmentData[i].duedate;$scope.dueAmount=$scope.dueAmount+parseFloat($scope.installmentData[i].dueamount)}}if($scope.installmentData.length>0&&count===0&&$scope.dueAmount>0){$scope.installmentData[$scope.installmentData.length-1].color=true}if($scope.dueAmount<=0&&$scope.installmentData.length>0){$scope.installmentData[$scope.installmentData.length-1].color=false;$scope.dueDate=""}var stsId=str.statusId;var opnDt=str.OpenDate;if(opnDt!=null&&opnDt!=''&&stsId==3){$scope.StatusMessage='Payment plan is open from '+opnDt}else{if(stsId==1){$scope.StatusMessage='Payment plan is pending.'}else if(stsId==2){$scope.StatusMessage='Payment plan is pending for approval.'}else if(stsId==4){$scope.StatusMessage='Payment plan is approved but not yet open.'}}}}function setFixedHeaderBillingAlert(table,pareClass){var $headerFreezeClaimErrors=$('#'+table);$headerFreezeClaimErrors.floatThead({scrollContainer:function($table){return $table.closest('.'+pareClass)}});$headerFreezeClaimErrors.trigger('reflow')}$scope.refreshalerts=function(){strUrl=makeURL('/mobiledoc/jsp/catalog/xml/getGlobalAlertDetail.jsp?PatientId='+$scope.patientId);var data=urlPost(strUrl).trim();var x2js=new X2JS;var jsonobj=x2js.xml_str2json(data);var value=jsonobj.Envelope.Body['return'].resultset.data.row;$scope.globalAlerts=[];$scope.setAlertData(value)};$scope.getTimeStamp=function(){var serverUrl=makeURL("/mobiledoc/jsp/webemr/common/getServerTimeStamp.jsp");var timestamp=urlPost(serverUrl);if($scope.billingAlert.AlertNotes)$scope.billingAlert.AlertNotes+=timestamp;else $scope.billingAlert.AlertNotes=timestamp.trim();$('#billing-alert-txtarea').focus();$scope.setDirtyFlag()};$scope.confirmRemovePatientFromCollections=function(){var fixDialogCSS=function(dialog){dialog.$modal.find('.modal-header').css({'background':'#e88842','border-top':'0px','border-bottom':'1px solid #e5e5e5'});dialog.$modal.find('.modal-body').css({'padding':'20px'});dialog.$modal.find('.modal-content').addClass('orangetheme')};BootstrapDialog.show({title:"eClinicalWorks",closable:false,message:"Are you sure you want to remove "+escapeHtml(billingAlertPatientName)+" from collection?",buttons:[{label:'Yes',cssClass:'btn-blue btn-sm btn-xs',action:function(dialog){dialog.close();$scope.$apply(function(){$scope.removePatientFromCollections()})}},{label:'No',cssClass:'btn-lgrey btn-sm btn-xs',action:function(dialog){dialog.close()}}],onshow:fixDialogCSS})};function isVendorActivated(){$http({method:"POST",url:"/mobiledoc/jsp/catalog/xml/getIsVendorActivated.jsp",headers:{'Content-Type':'application/x-www-form-urlencoded'}}).success(function(response){var x2js=new X2JS;var objJson=x2js.xml_str2json(response);if(!angular.isUndefined(objJson)&&!angular.isUndefined(objJson.Envelope.Body['return'].status)&&objJson.Envelope.Body['return'].status=="success"){if(!angular.isUndefined(objJson.Envelope.Body['return'].isVendorActivated)){if(objJson.Envelope.Body['return'].isVendorActivated==1){$scope.isVendorActivated=true;$scope.showPtCollBalance=true}}}})}isVendorActivated();$scope.removePatientFromCollections=function(){var strFtpTransFolder=getItemKeyValue("TransworldFtpFolder");var m_strClientNumber=getItemKeyValue("TransWorldId");var bool=true;$scope.collServiceTypeSelected={};$scope.collServiceTypeSelected.dataValue=$scope.billingAlert.DemandType;if($scope.billingAlert.CurrentCollStatus){if($scope.billingAlert.CollectionAgencyStatus=='UPDATE'||$scope.billingAlert.CollectionAgencyStatus=='START'||$scope.billingAlert.CollectionAgencyStatus=='STOP'){bool=false}if(!($scope.strEnableExtColl.toUpperCase()=='YES'||$scope.isVendorActivated)){bool=true}if(bool){var serverUrl=makeURL('/mobiledoc/jsp/catalog/xml/RemovePtFromCollection.jsp?userId='+global.TrUserId+'&ptId='+$scope.patientId);var responseXML=urlPost(serverUrl);if(responseXML&&~responseXML.indexOf('SUCCESS'))$scope.isPatientInCollections=false;return}$scope.removeCollection={parentScreen:"billingalert",clientNo:m_strClientNumber,sendNewTransworld:"No",transFolder:strFtpTransFolder,TrUserId:global.TrUserId,patIds:$scope.patientId,isRemoveFromCln:"true"};$ocLazyLoad.load({files:['/mobiledoc/jsp/webemr/webpm/collection/js/listOfStopPatientCtrl.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/webpm/collection/listOfStopPatient.jsp'),controller:'stopPatientListController',windowClass:'app-modal-window bluetheme  large-width',backdrop:"static",resolve:{updatePatientCollection:function(){return $scope.removeCollection}}});modalInstance.result.then(function(response){},function(response){if(response=="SUCCESS"){var serverUrl=makeURL('/mobiledoc/jsp/catalog/xml/RemovePtFromCollection.jsp?userId='+global.TrUserId+'&ptId='+$scope.patientId);var responseXML=urlPost(serverUrl);if(responseXML&&~responseXML.indexOf('SUCCESS'))$scope.isPatientInCollections=false}else{console.log("File not uploaded successfully!")}})},function(e){console.log(e)})}};$scope.getGlobalAlertStyle=function(galert){var colorCode=galert.ColorCode;colorCode=decimalColorToHTMLcolor(colorCode);return{"background-color":colorCode}};$scope.spellChecking=function(elementId){var val=$('#'+elementId).val();$scope.spellCheckObj={misSpelledText:val,correctedSpellText:'',spellCheckOnElement:elementId};$scope.spellCheckFlag=true};$scope.applySpellChecking=function(){$scope.spellCheckFlag=false;var spellCheckElement=$('#'+$scope.spellCheckObj.spellCheckOnElement);spellCheckElement.val($scope.spellCheckObj.correctedSpellText);spellCheckElement.trigger('input')};$scope.loadGuarantorBalBillAlert=function(){if($scope.setIsAfterAlertCheck&&billingAlertStrParentScreen.toLowerCase()=="guarantoracc"){$scope.setIsAfterAlertCheck(false);$('#billingalert').css('z-index','1049')}else{$ocLazyLoad.load({name:'guarantorAccountApp',files:['/mobiledoc/jsp/webemr/webpm/js/guarantorAccount.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/webpm/guarantorAccount.jsp?patientId="+$scope.patientId+"&userType=3&parentScreen=billingAlertLink");$scope.grInquirylinkurlBillAlert=url},function(e){console.log(e)})}};$scope.openCollectionBalanceDetails=function(){let strEnableBadDebtColl=getItemKeyValue("EnableBadDebtCollCycle");if(strEnableBadDebtColl.toUpperCase()!=="YES"){return}let stripBillingEnable=getItemKeyValue("EnableIPBilling");if(stripBillingEnable.toUpperCase()!=="YES"){return}let strEnableClaimColl=getItemKeyValue("EnableClaimCollection");if(strEnableClaimColl.toUpperCase()!=="YES"){return}$ocLazyLoad.load({name:'CollectionCycleBalance',files:['/mobiledoc/jsp/webemr/webpm/collection/js/CollectionCycleBalanceDetailsCtrl.js']}).then(function(){var modalInstance=$modal.open({templateUrl:makeURL('/mobiledoc/jsp/webemr/webpm/collection/CollectionCycleBalanceDetails.html'),controller:'CollectionCycleBalanceController',controllerAs:'collectionCycle',windowClass:'app-modal-window bluetheme  medium-width',backdrop:"static",resolve:{patient:function(){return $scope.patientId}}});modalInstance.result.then(function(response){},function(response){})})};$scope.saveConsentQueestion=function(){if($scope.iHubConsentCheck&&!$scope.IsEMPIEnabled&&$scope.interopConsent_showConsentQue&&$scope.userInputChecked){if($scope.patientId===0){ecwAlert("Unable to save patient's data exchange consent status.");return}let valueId="";let value="";let option12Checked=$('#sendReceiveOption:radio:checked').length>0;let option1Checked=$('#sendOption:radio:checked').length>0;let option2Checked=$('#receiveOption:radio:checked').length>0;let option3Checked=$('#optoutOption:radio:checked').length>0;if(option12Checked){valueId+=$scope.interopConsent_sendLocalId+","+$scope.interopConsent_receiveLocalId+",";value+=$scope.interopConsent_sendName+","+$scope.interopConsent_receiveName+","}else if(option1Checked){valueId+=$scope.interopConsent_sendLocalId+",";value+=$scope.interopConsent_sendName+","}else if(option2Checked){valueId+=$scope.interopConsent_receiveLocalId+",";value+=$scope.interopConsent_receiveName+","}else if(option3Checked){valueId+=$scope.interopConsent_optoutLocalId+",";value+=$scope.interopConsent_optoutName+","}valueId=valueId.replace(/,\s*$/,"");value=value.replace(/,\s*$/,"");var soapData="<S:Envelope xmlns:S='http://schemas.xmlsoap.org/soap/envelope/' xmlns:SOAP-ENC='http://schemas.xmlsoap.org/soap/encoding/' S:encodingStyle='http://schemas.xmlsoap.org/soap/encoding/' xmlns:xsd='http://www.w3.org/1999/XMLSchema' xmlns:xsi='http://www.w3.org/1999/XMLSchema-instance'>";soapData+="<S:Body><m:NOOP xmlns:m='NOOP'>";soapData+="<item xsi:type='xsd:string'><detailId xsi:type='xsd:string'>"+$scope.interopConsent_localQueId+"</detailId><value xsi:type='xsd:string'>"+value+"</value>";soapData+="<notes xsi:type='xsd:string'></notes><valueId xsi:type='xsd:string'>"+valueId+"</valueId><fromScreen xsi:type='xsd:string'>1</fromScreen></item>";soapData+="</m:NOOP></S:Body></S:Envelope>";$.ajax({type:"POST",url:"/mobiledoc/jsp/catalog/xml/setStructData.jsp",data:"encId="+$scope.patientId+"&catId=0&itemId=0&table=structDemographics&sessionDID=0&TrUserId="+global.TrUserId+"&FormData="+soapData,"async":false,cache:false,success:function(response){releaseLock();$scope.saveResponse=$.trim(response)},error:function(xhr,ajaxOptions,thrownError){ecwAlert("Unable to save patient's data exchange consent status.")}})}};function acquireLock(){$scope.isLockAcquired=true;acquireFormLock(lockObj,function(){if(lockObj.g_cancel){$scope.isLockAcquired=false;$scope.closeModal();return}})}function releaseLock(){releaseFormLock(lockObj)}$scope.changeSendOption=function(){$scope.userInputChecked=true;if($('#sendOption').prop('checked')){$('#optoutOption').prop('checked',false)}};$scope.changeReceiveOption=function(){$scope.userInputChecked=true;if($('#receiveOption').prop('checked')){$('#optoutOption').prop('checked',false)}};$scope.changeOptOutOption=function(){if($('#optoutOption').prop('checked')){$('#sendOption').prop('checked',false);$('#receiveOption').prop('checked',false)}}}]);