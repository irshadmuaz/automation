class CursorDefaultsHandler{isEnabled=false;observer=undefined;configuredItems=[];setup(){if(!this.isEnabled){return}this.observer=new IntersectionObserver(this.onVisibilityChange);this.getConfigurations().then(x=>{this.configuredItems=this.getValidMappings(x.data);this.addStylesheet(document);this.registerFieldHandlers(document)})}setEnabled(value){this.isEnabled=value.toLowerCase()==="yes"}async getConfigurations(){return await $.ajax({url:"/mobiledoc/emr/cursordefaults/configuration",type:"GET"})}addStylesheet(document){const cdStyle=document.createElement("style");cdStyle.type="text/css";cdStyle.innerHTML='@keyframes cdTrigger {\n'+'\tfrom { opacity: 0.99; }\n'+'\tto { opacity: 1; }\n'+'}\n'+'input[type="text"],input[type="textbox"],input:not([type]), textarea, select, iframe, [contenteditable] {\n'+'\tanimation-duration: 0.001s;\n'+'\tanimation-name: cdTrigger;\n'+'}';document.getElementsByTagName("head")[0].appendChild(cdStyle)}onVisibilityChange(intersections){const visibleBoxes=intersections.filter(x=>x.isIntersecting);if(visibleBoxes.length>0){this.focusElement(visibleBoxes[0].target)}}focusElement(field,fieldContainer){field.classList.add("cd-focus");field.focus();let container=fieldContainer;if(container==null){container=field}container.defaultStyle={borderStyle:container.style.borderStyle,borderWidth:container.style.borderWidth,borderColor:container.style.borderColor};container.style.borderStyle="solid";container.style.borderWidth="1px";container.style.borderColor=this.getThemeColor(container);const onLostFocus=()=>{container.style.borderStyle=container.defaultStyle.borderStyle;container.style.borderWidth=container.defaultStyle.borderWidth;container.style.borderColor=container.defaultStyle.borderColor};container.addEventListener("blur",onLostFocus,{once:true})}focusTarget(target){if(target.classList.contains("cke_editable")||target.classList.contains("wysihtml5-editor")||target.classList.contains("wysihtml5-sandbox")){const clazz=this;setTimeout(function(targetElement){clazz.focusElement(targetElement.contentDocument.body,targetElement)},800,target)}else{this.focusElement(target)}}focusOnFieldIfVisible(field,clazz){setTimeout(function(element,clazzRef){if($(element).is(":visible")){clazzRef.focusTarget(element)}else{clazzRef.observer.observe(element)}},0,field,clazz)}setupIframeHandler(document){const clazz=this;$(document).on("animationstart","iframe",e=>this.initializeIframe(e,clazz))}initializeIframe(e,clazz){const iframe=e.target;if(this.isElementIgnored(iframe)){return}$(iframe).on("load",function(ei){const doc=ei.target.contentWindow.document;clazz.addStylesheet(doc);clazz.registerFieldHandlers(doc)});setTimeout(frame=>{if(frame.contentWindow.document.readyState==="complete"){clazz.addStylesheet(frame.contentWindow.document);clazz.registerFieldHandlers(frame.contentWindow.document)}},0,iframe)}isElementIgnored(element){return element!=null&&element.classList.contains("cd-ignore")}registerFieldHandlers(document){const clazz=this;$(document).on("animationstart","input[type='text'],input[type='textbox'],input:not([type]), textarea, select, iframe, [contenteditable]",e=>clazz.setupFieldHandler(e,clazz));this.setupIframeHandler(document)}setupFieldHandler(e,clazz){if(e.originalEvent.animationName!=="cdTrigger"){return}if(this.isElementIgnored(e.target)){return}setTimeout(()=>{const matchingFields=this.configuredItems.filter(x=>$(e.target).is(x.field));if(matchingFields.length===0){return}const fieldsWithMatchingScreens=matchingFields.filter(x=>$(e.target.ownerDocument).find(`${x.screen} *`).is(e.target));if(fieldsWithMatchingScreens.length===0){return}clazz.focusOnFieldIfVisible(e.target,clazz)})}isValidSelector(selector){try{$(selector);return true}catch(e){return false}}getValidMappings(mappings){const validMappings=[];for(let item of mappings){const screenSelector=item.screen;const fieldSelector=item.field;if(this.isValidSelector(screenSelector)&&this.isValidSelector(fieldSelector)){validMappings.push(item)}}return validMappings}getThemeColor(field){const defaultColor="rgb(43, 145, 217)";const modal=$(field).closest(".modal");if(modal==null||modal.length===0){return defaultColor}const header=modal.find(".modal-header");if(header==null||header.length===0){return defaultColor}const headerStyle=getComputedStyle(header[0]);if("background-color"in headerStyle){return headerStyle["background-color"]}else{return defaultColor}}}if(typeof exports!=="undefined"){module.exports=CursorDefaultsHandler}else{window.cursorDefaultHandler=new CursorDefaultsHandler}