angular.module('demographics',[]).factory('Patientdemographics',function(){return{Patient:{},ResponsibleParty:{},MandatoryField:{},imagecontent:""}});function JellyBeanCountCntrl($scope,$ocLazyLoad,$interval,$window,PSACService,$route,$timeout,$modal){$scope.loadPopupurl="";$scope.username=global.TrUserName;$scope.userInitial=userInitial;$scope.superviserPopupModalJB="";$scope.isQueDashboardEnabled=isItemKeyEnabled("isQueDashboardEnabled");$scope.isCorrectionalFeatureEnable=getItemKeyValue("EnableCorrectionalFeatures").toLowerCase()=='yes';$scope.isPuertoRicoCorrectionEnable="YES"==getItemKeyValue("Corrections_Puerto_Rico").toUpperCase()&&getItemKeyValue("EnableCorrectionalFeatures").toLowerCase()=='yes';$scope.reviewInfCharts="#/reviewInfirmaryCharts";var patientPictureItemKey={};const NOPROFILEPICTURE='2';getItemKeyValuePair("PATIENT_PICTURE",patientPictureItemKey);$scope.isNoProfilePicture=patientPictureItemKey.itemId===NOPROFILEPICTURE;var patietPictureProperties={};getItemKeyValuePair("PatientPictureProperties",patietPictureProperties);$scope.isResizeOptionActive="0";$scope.showModalPopup='';$scope.showModal=function(modalId){$scope.showModalPopup=modalId};if(patietPictureProperties.itemId==="1"){$scope.isResizeOptionActive="1"}else if(patietPictureProperties.itemId==="2"){$scope.isResizeOptionActive="2"}$scope.hasQuickAccessForReconcile=getPermission("Interface_Reconciliation_View",global.TrUserId);$scope.isMedicationDispenseEnable=showHideMedDispenseLink();function showHideMedDispenseLink(){if(getItemKeyValue("EnableDispenseAndInventoryLink").toLowerCase()=='yes'&&getPermission("InventorySecurityAccess",global.TrUserId)){return true}return false}$scope.showUnauthorizedMessage=function(screen){showMessage("You don't have permissions to Access "+screen+". Please contact your administrator.")};$scope.parLabApprUsr=getPerep("YES");$scope.parLabApprType=getPerep("Labs");$scope.IsQuickRegEnabled=false;$scope.IsRoundListEnabled=false;$scope.IsQuickRegEnabled=isItemKeyEnabled("EnableQuickRegistration");$scope.IsRoundListEnabled=isItemKeyEnabled("enableIPCReports");$scope.isSkinTestEnabled=getItemKeyValue("AllergySkinTest").toLowerCase()==='1';$scope.isShotAdministrationEnabled=getItemKeyValue("AllergyShotAdministration").toLowerCase()==='yes';$scope.oSecurityAccess=getPermission("AllowImmTherapyOutstanding",global.TrUserId);$scope.rSecurityAccess=getPermission("AllowImmTherapyRecipe",global.TrUserId);$scope.lSecurityAccess=getPermission("AllowImmTherapyLab",global.TrUserId);$scope.aSecurityAccess=getPermission("AllowImmTherapyShotAdmin",global.TrUserId);$scope.dSecurityAccess=getPermission("AllowImmTherapyDueToday",global.TrUserId);$scope.bSecurityAccess=getPermission("AllowUserToAccessExtractBilling",global.TrUserId);$scope.rrSecurityAccess=getPermission("AllowImmTherapyRefillRequest",global.TrUserId);$scope.allAllergyTabsDenied=!$scope.oSecurityAccess&&!$scope.rSecurityAccess&&!$scope.lSecurityAccess&&!$scope.aSecurityAccess&&!$scope.dSecurityAccess&&!$scope.bSecurityAccess&&!$scope.rrSecurityAccess;$scope.isEPAQueueSecurityAccessAllowed=getPermission("ePAQueueSecurityAccess",global.TrUserId);$scope.isAccessClinicianDashboard=getPermission("AccessClinicianDashboard",global.TrUserId);$scope.regHealow=global.regHealow;$scope.registeredNHXUser=global.registeredNHXUser;$scope.bDisableP2PLinks=global.bDisableP2PLinks;$scope.viewAllPatientRequestsList=true;$scope.chatRequestUsersList=[];$scope.isOffline=false;$scope.jellyBeanSettings=function(){$scope.strUserId=getPerep($("#userProId").val());$scope.supProviderPopupEnabled=false;$scope.supProviderPopupEnabled=isItemKeyEnabled("setSupervisingProviderEachDay");$scope.supProvAlreadySet=supProAlreadySet;put("setSupProviderEachDayEnabled",setSupProviderEachDayEnabled);put("isNurseAnciMarked",isNurseAnciMarked);if(strPicklistFacilityValue=="yes"){$ocLazyLoad.load({name:'facilityListController',files:['/mobiledoc/jsp/webemr/menu/file/facilities/js/facilityList.js']}).then(function(){$scope.facilityPopupmodal=makeURL('/mobiledoc/jsp/webemr/menu/file/facilities/facilityList.jsp?parentScreen=loginform')},function(e){console.log(e)})}else if($scope.supProviderPopupEnabled&&setSupProviderEachDayEnabled=='1'&&$scope.supProvAlreadySet=="false"&&get("showSupProvOnLoginOnly")==null){put("showSupProvOnLoginOnly","True");$scope.currEncId=0;$ocLazyLoad.load({name:'assignProvider',files:['/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/SetSupProviderController.js']}).then(function(){$scope.superviserPopupModalJB=makeURL('/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/setSupervisingProvoder.jsp?currEncId='+$scope.currEncId+'&parentScr=login')},function(e){console.log(e)})}let hiMenuItemKeyEnabled=isItemKeyEnabled("HealowInsightsMenu");let hiWorklistItemKeyEnabled=isItemKeyEnabled("HealowInsightsWorkLists");let hiWorklistPermission=getPermission("AllowHealowInsightsWorkLists",global.TrUserId);if(hiMenuItemKeyEnabled&&hiWorklistItemKeyEnabled&&hiWorklistPermission){$ocLazyLoad.load({name:"healowInsightsWorklistCount",files:['/mobiledoc/jsp/healowInsights/worklists/js/healow-insights-worklist-count-info.js','/mobiledoc/jsp/healowInsights/worklists/css/healow-insights-worklist-count-info.css'],serie:true,cache:true}).then(function(){$scope.hiWorklistCountPage=makeURL('/mobiledoc/jsp/healowInsights/worklists/healow-insights-worklist-count-info.html')})}$(document).trigger("initHealowChat");$(document).trigger("initChatBot")};$scope.setFacilityData=function(facilityObj){put("pickListFacility",facilityObj.Id);put("pickListFacilityName",facilityObj.Name)};$scope.showOccHealthAppointment=function(encounterId,start,end,id,name,date,visitType,visitDesc,vcolor,facilityId,facilityName,patientId,patientName,parentScreen,slotId,POS,facilityFilter,block_id){$scope.occmedAppointmentURL="";$ocLazyLoad.load({name:'occMedApptApp',files:['/mobiledoc/jsp/webemr/occMedAppt/js/occMedAppointmentController.js','/mobiledoc/jsp/webemr/occMedAppt/css/occ-med.css']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/occMedAppt/occMedAppointment.jsp?encounterId="+encounterId+"&start="+start+"&end="+end+"&id="+id+"&name="+name+"&date="+date+"&visitType="+encodeURIComponent(visitType)+"&visitTypeDesc="+visitDesc+"&visitColor="+vcolor+"&facilityId="+facilityId+"&facilityName="+encodeURIComponent(facilityName)+"&parentScreen="+parentScreen+"&patientName="+patientName+"&patientId="+patientId+"&reservedSlotId="+slotId+"&vision="+$scope.isVision+"&encType=1&POS="+POS+"&resScheduleFacFilterId="+facilityFilter+"&block_id="+block_id+"&apptType=1");$scope.occmedAppointmentURL=url})};$scope.envType=getItemKeyValue("EnvironmentName");if($scope.bDisableP2PLinks){$('#ptRecordInbox').attr('href','');$('#p2pInvitationsRecieved').attr('href','');$('#addP2PProvidersLink').attr('href','');$('#healowAppointments').attr('href','')}var EnableReview4ConvenientCare=getItemKeyValue("EnableReview4ConvenientCare");if(EnableReview4ConvenientCare&&EnableReview4ConvenientCare.toLowerCase()==='yes'){$scope.reviewPN="#/mobiledoc/jsp/webemr/jellybean/sbeen/ReviewProgressNotesCC.jsp"}else{$scope.reviewPN="#/mobiledoc/jsp/webemr/jellybean/sbeen/ReviewProgressNotes.jsp"}$scope.patientSearchHistory=[];$scope.patientSearchHistory=getPatientSearchHistory();$scope.openPatientHub=function(id){PSACService.checkCommonStaffPermission(id,function(){$ocLazyLoad.load({name:'NewHub',files:['/mobiledoc/jsp/webemr/toppanel/patientHub/patienthubController.js'],cache:true}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/toppanel/patientHub/patient-hub.jsp?patientId='+id+'&nd='+(new Date).getTime())+"&fromjellybeanpanel=yes";$scope.pathubinfourl=url},function(e){console.log(e)})},function(){return})};$scope.trimText=function(visitStatusText,len){if(visitStatusText!==''&&visitStatusText!==undefined){visitStatusText=visitStatusText.length>len?visitStatusText.substring(0,len)+'...':visitStatusText}return visitStatusText};$scope.openProviderLicense=function(){if(sessionStorage.getItem("LicenseProviderFlag")==null){$ocLazyLoad.load({name:'LicenseProvider',files:['/mobiledoc/jsp/webemr/common/expiredProviderLicenseController.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/common/expiredProviderLicense.jsp");$scope.licenseProvider=url},function(e){console.log(e)})}};$(window).ready(function(){$scope.openProviderLicense()});$scope.eCliniSpeechEnabled=isItemKeyEnabled("EnableECliniSpeech");$scope.eCliniSpeechTimeOut=getItemKeyValue("eCliniSpeechTimeOut");stopSendingSpeechRequest1=1;$(document).on('keydown',function(event){var bStop=false;var keycode="";if(event.which!==undefined){keycode=event.which}else if(event.keyIdentifier!==undefined){keycode=event.keyIdentifier}else if(event.keyCode!==undefined){keycode=event.keyCode}else if(event.key!=undefined){keycode=event.key}if(keycode===16){var regex=/TEXT|PASSWORD|FILE|EMAIL|SEARCH|DATE|NUMBER/i;var element=event.srcElement||event.target;if(element.tagName.toUpperCase()==='INPUT'&&regex.test(element.type.toUpperCase())||element.tagName.toUpperCase()==='TEXTAREA'){bStop=element.readOnly||element.disabled}else if(element.tagName.toUpperCase()==='SPAN'||element.tagName.toUpperCase()==='DIV'||element.tagName.toUpperCase()==='TD'){bStop=!element.contentEditable}else{bStop=true}if(bStop){if($scope.eCliniSpeechEnabled){$scope.processVoice()}}}});$scope.processVoice=function(){var ele=document.getElementById('record');toggleRecording(ele);if(stopSendingSpeechRequest1==0){stopListningSpeech()}else if(stopSendingSpeechRequest1==1){$scope.intervalPromise=$interval(stopListningForcefully,$scope.eCliniSpeechTimeOut);recordVoice()}};function stopListningForcefully(){var ele=document.getElementById('record');if(ele.classList.contains("recording")){stopListningSpeech();toggleRecording(ele);$interval.cancel($scope.intervalPromise)}}function recordVoice(){$('#record').attr('src','/mobiledoc/jsp/webemr/eCliniSpeech/img/recording.png');stopSendingSpeechRequest1=0}function stopListningSpeech(){$('#record').attr('src','/mobiledoc/jsp/webemr/eCliniSpeech/img/disabled.png');stopSendingSpeechRequest1=1}$scope.launchScreen=function(command){$('#actionMsg').fadeOut();stopListningSpeech();var str=command.trim();if(str=='null'||str.toUpperCase()=="OPEN"||str==""||str.toLowerCase()=="cant identify, please try again"){$scope.action="Can't identify your Command,Please say again..";$('#actionMessage').html($scope.action);$('#actionMsg').css('height','5%');$('#actionMsg').fadeIn(800).delay(1e3).fadeOut(800)}else{$.ajax({type:"post",url:"/mobiledoc/jsp/webemr/eCliniSpeech/eCliniSpeechRequestHandler.jsp",data:'command='+command,success:function(data){data=JSON.parse(trim(data));if(!angular.isUndefined(data)&&(!angular.isUndefined(data.URL)&&data.URL.toString().trim().length>0||!angular.isUndefined(data.routingName)&&data.routingName.toString().trim().length>0)){if($window.location.hash.indexOf('/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/dashboard.jsp')!=-1&&data.routingName.trim().length>0){$scope.action='Opening '+data.Params;$('#actionMessage').html($scope.action);$('#actionMsg').css('height','5%');$('#actionMsg').fadeIn(800).delay(1e3).fadeOut(800);angular.element(document.getElementById('toppanelcontainer')).scope().loadmodalurl(data.routingName)}else{if(data.isModal=='1'){var dependencies=data.dependencies.split(',');if(data.URL!=''){data.URL+="?"+data.Params+"="+data.nUserId}$scope.loadPopupurl="";$ocLazyLoad.load({name:data.modulename,files:dependencies}).then(function(){var url=makeURL(data.URL);$scope.loadPopupurl=url},function(e){console.log(e)})}else if(data.isModal=='0'){$scope.action='Opening '+data.Params;$('#actionMessage').html($scope.action);$('#actionMsg').css('height','5%');$('#actionMsg').fadeIn(800).delay(1e3).fadeOut(800);$scope.openScreen(data.URL)}}}},error:function(msg){stopSendingSpeechRequest=1}})}};$scope.openScreen=function(URL){var url=""+URL.toString();$window.location=url};$scope.refreshSearchedPatients=function(){$scope.patientSearchHistory=getPatientSearchHistory()};$scope.refreshSearchProgressNote=function(){let listObj=getProgressNoteSearchHistory();if(listObj!=="[]"){$.ajax({contentType:'application/json',method:'POST',dataType:"json",url:makeURL('/mobiledoc/emr/recentlyAccessedProgressNotes/fetchProgressNotesList'),data:listObj}).success(function(response){if(response!==null){$scope.progressNoteSearchHistory=response.reverse();$scope.$digest()}})}};$scope.PopulateWaitingPtsList=function(){$.ajax({url:"/mobiledoc/jsp/webemr/jellybean/officevisit/getWaitingPatientsList.jsp?doctorId="+global.TrUserId,type:'POST',"async":false,cache:false,error:function(data){console.log("There was a problem "+data)},success:function(data){$scope.waitinglist=JSON.parse(data)}})};$scope.refreshSearchProgressNote();$scope.PopulateWaitingPtsList();$scope.openProgressNote=function(patientId,encounterId){var encryptedParameters=getPerep(JSON.stringify({ptId:patientId,encId:encounterId}));$window.location="#/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/dashboard.jsp/"+encryptedParameters};function LTrim(value){var re=/\s*((\S+\s*)*)/;return value.replace(re,"$1")}function RTrim(value){var re=/((\s*\S+)*)\s*/;return value.replace(re,"$1")}function trim(value){return LTrim(RTrim(value))}$scope.openPatientInfo=function(){$scope.linkurl="";$ocLazyLoad.load({name:'NewHub',files:['/mobiledoc/jsp/webemr/templates/topPanel-tpl.js','/mobiledoc/jsp/webemr/toppanel/patientHub/patienthubController.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/toppanel/patientHub/patient-hub.jsp?patientId="+$scope.patient.id+'&nd='+(new Date).getTime());$scope.linkurl=url},function(e){console.log(e)})};$scope.openMessage=function(type){if(appElement===undefined||appElement===null){var url='#/mobiledoc/jsp/webemr/jellybean/messages/MjellyBean.jsp/'+type;$window.location=url}};$scope.openMyDocument=function(myDocumentURL){var permit=getPermission("Progress Notes",global.TrUserId);if(permit){$window.location="#"+myDocumentURL}else{BootstrapDialog.show({title:"eClinicalWorks",closable:false,message:"You don't have permissions",buttons:[{label:'OK',cssClass:'btn-blue btn-sm btn-xs',action:function(dialog){dialog.close()}}]})}};$scope.cmdNewClick=function(){$scope.loadPopupurl="";let isWebView=true;let isChromeUIScreen=$('#isEdgeRequest').val();if(isChromeUIScreen&&isChromeUIScreen==='true'){isWebView=false}if(($scope.TJellyBeanObj===""||$scope.TJellyBeanObj.mjelly_webviewtype==="1"||$scope.TJellyBeanObj.mjelly_webviewtype==="2")&&isWebView){composeMessage()}else{$ocLazyLoad.load({name:'NewMsg',files:['/mobiledoc/jsp/webemr/jellybean/messages/ComposeMsg.js','/mobiledoc/jsp/webemr/templates/category-tpl.js','/mobiledoc/jsp/webemr/js/vendor/tagit.js','/mobiledoc/jsp/webemr/templates/browseCommon-tpl.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/jellybean/messages/ComposeMessage.jsp');$scope.loadPopupurl=url},function(e){})}};let composeMessage=function(){loadComposeMessageDependencies().then(function(){launchComposeMessageScreen()},function(){ecwAlert('Error occurred while launching the compose message screen.','eClinicalWorks',null,'','bluetheme')})};function loadComposeMessageDependencies(){return $ocLazyLoad.load({name:'messagesApp',files:['/mobiledoc/jsp/webemr/jellybean/messages/js/composeMessageCtrl.js','/mobiledoc/jsp/webemr/jellybean/messages/css/messagesPaneView.css','/mobiledoc/jsp/webemr/jellybean/messages/js/composeMessageDirective.js','/mobiledoc/jsp/resources/jslib/ckeditor4/ckeditor.js','/mobiledoc/jsp/webemr/jellybean/messages/js/messagesService.js']})}function launchComposeMessageScreen(){const $modalOptions={animation:true,templateUrl:'/mobiledoc/jsp/webemr/jellybean/messages/composeMessage.html',controller:'composeMessageController',controllerAs:'composeCtrl',windowClass:'bluetheme',backdrop:'static',keyboard:false};$modal.open($modalOptions)}$scope.composeP2PMessage=function(){if($scope.bDisableP2PLinks){return}$scope.composeP2PMsgPopupurl="";$ocLazyLoad.load({name:'composeP2PMessage',files:['/mobiledoc/jsp/webemr/jellybean/p2pmessage/composeP2PMessageController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/jellybean/p2pmessage/composeP2PMessage.jsp');$scope.composeP2PMsgPopupurl=url},function(e){})};$scope.addURLToP2PLink=function(elementId,url){if(elementId&&elementId==='p2pInvitationsRecieved'&&url){var startIndex=url.lastIndexOf("/")+1;if(startIndex>0){var loginUID=url.substring(startIndex);var p2pInvitationParams={loginUId:loginUID};var encryptedP2pInvitationParams=getPerep(JSON.stringify(p2pInvitationParams));url=url.substring(0,startIndex)+encryptedP2pInvitationParams}}if($scope.bDisableP2PLinks){$('#'+elementId).attr('href','')}else{$('#'+elementId).attr('href',url)}};$scope.cmdSendPtRecord=function(){if($scope.bDisableP2PLinks){return}$scope.ptRecordPopupurl="";$ocLazyLoad.load({name:'newP2PMessage',files:['/mobiledoc/jsp/webemr/jellybean/patientrecord/newP2PMessageController.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/jellybean/patientrecord/outgoingAttController.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/jellybean/patientrecord/newp2pmessage.jsp?parentFound=false&isP2P=1');$scope.ptRecordPopupurl=url},function(e){console.log(e)})};$scope.cmdNewReferral=function(){if($scope.bDisableP2PLinks){return}$scope.loadPopupurl="";var params={refId:0,patientId:0,callingFrom:'TJellyBean'};params=$.param(params);$ocLazyLoad.load({name:'referralPopUpApp',files:['/mobiledoc/jsp/webemr/jellybean/patientrecord/commanP2PService.js','/mobiledoc/jsp/webemr/jellybean/referral/referralPopupController.js','/mobiledoc/jsp/webemr/templates/icd-tpl.js','/mobiledoc/jsp/webemr/progressnotes/physiciansdashboard/EncDetailsService.js','/mobiledoc/jsp/webemr/templates/cpt-tpl.js','/mobiledoc/jsp/webemr/templates/savePrompt-tpl.js','/mobiledoc/jsp/webemr/progressnotes/ecwrx/RxHelper/ICD_Treatment.js']}).then(function(){var url=makeURL('/mobiledoc/jsp/webemr/jellybean/referral/referralPopup.jsp?'+params);$scope.loadPopupurl=url},function(e){console.log(e)})};$scope.cmdNewTelEncClick=function(patid){if(getPermission("TelephoneEncounter",global.TrUserId)){$ocLazyLoad.load({name:'TJellyDetailView',files:getDependencies('TJellyDetailView')}).then(function(){var url='/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-Telephone-Encounter-DetailView.jsp';url+='?parentfunctionname=cmdNewTelEncClick&enctype=2&index=-1&context=jellybeannewtelenc&EncounterId=0&PatientId='+patid;url=makeURL(url);$scope.loadPopupurl=url},function(e){console.log(e)})}else{ecwAlert("You don't have permissions to access Telephone Encounters. Please contact your administrator.")}};$scope.cmdNewActionClick=function(){$scope.loadPopupurl="";var params={ActionId:"0",patientId:"0",ms:(new Date).getTime()};params.context="JELLY_BEAN_PANEL";params=$.param(params);$ocLazyLoad.load({name:'actionsDetailViewApp',files:['/mobiledoc/jsp/webemr/lookup/lookup.js','/mobiledoc/jsp/webemr/js/dateformat.js','/mobiledoc/jsp/webemr/templates/keywords-tpl.js','/mobiledoc/jsp/webemr/templates/structuredata-tpl.js','/mobiledoc/jsp/webemr/js/xeditable.min.js','/mobiledoc/jsp/webemr/css/xeditable.css','/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.js'],cache:true}).then(function(){var url="/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionsDetailView.jsp?"+params;$scope.loadPopupurl=url},function(e){console.log(e)})};$scope.closeActionDetailsView=function(){$scope.loadPopupurl=""};$scope.onBuildingUserExperienceComplete=function(){$scope.loadProfilePicture()};$scope.loadProfilePicture=function(){$timeout(function(){$scope.ptpic=getUserPic("Pic").trim();if($scope.ptpic.indexOf("no_pic.jpg")>0||$scope.ptpic.indexOf("patient-infoimg.png")>0){$scope.isPtPic=true}else{$scope.isPtPic=false}},100)};$scope.showInitialImage=function(){$timeout(function(){$scope.isPtPic=true},1)};$scope.launchpt=function(searchText,userType){$ocLazyLoad.load({name:'PatientSearch',files:['/mobiledoc/jsp/webemr/toppanel/patientSearch/js/patientSearch.js','/mobiledoc/jsp/webemr/jellybean/patientrecord/patientMatchController.js','/mobiledoc/jsp/webemr/jellybean/patientrecord/recordPopupController.js','/mobiledoc/jsp/webemr/jellybean/patientrecord/commanP2PService.js']}).then(function(){var url='/mobiledoc/jsp/webemr/toppanel/patientSearch/patientSearch.jsp?context=JELLY_BEAN_PANEL&action='+userType+'&showTopButtons=1&nd='+(new Date).getTime();$scope.huburl=makeURL(url);$scope.patientSearchData_patientLookup=searchText},function(e){console.log(e)})};$scope.launchfrontdeskview=function(){$ocLazyLoad.load({name:'insuranceParticipationFrontDeskModule',files:['/mobiledoc/jsp/webemr/webpm/billingmenu/providerInsuranceMap/js/InsuranceParticipationFrontDeskViewController.js']}).then(function(){var url='/mobiledoc/jsp/webemr/webpm/billingmenu/providerInsuranceMap/InsuranceParticipationFrontDeskView.jsp';$scope.huburl=makeURL(url)},function(e){console.log(e)})};$scope.openquickreg=function(){var newPtPermission=getPermission("NewPatient",global.TrUserId);if(!newPtPermission){ecwAlert("You do not have access to create New Patient. Please contact your administrator.","Security Access");return}$ocLazyLoad.load({name:'PatientQuickReg',files:['/mobiledoc/jsp/webemr/toppanel/patientQuickReg/patientQuickReg.js']}).then(function(){var url='/mobiledoc/jsp/webemr/toppanel/patientQuickReg/patientQuickReg.jsp';$scope.huburl=makeURL(url)},function(e){console.log(e)})};$scope.openroundinglist=function(){$ocLazyLoad.load({name:'RoundingListByFacility',files:['/mobiledoc/jsp/webemr/toppanel/facilitylist/roundinglistbyfacility.js']}).then(function(){var url='/mobiledoc/jsp/webemr/toppanel/facilitylist/roundinglistbyfacility.jsp';$scope.huburl=makeURL(url)},function(e){console.log(e)})};$scope.uploadImage=function(event){if(!event||!event.target||!event.target.files){return}var files=event.target.files;var formData=new FormData;var mimeType=files[0].type;var checkType=mimeType.indexOf("image/");if(checkType>=0){var tmppath=URL.createObjectURL(event.target.files[0]);$scope.isPtPic=false;if(files&&files[0]){var i=0;for(i=0;i<1;i++){var foldername=$('.dropdown-toggle').text();var id=$('.caret').attr('id');var type=$("input[name=event]:checked").val();savetype="2";$scope.$apply();formData.append("sampleFile",files[i]);formData.append("foldername",foldername);formData.append("id",id);formData.append("flag",type)}}if(!$scope.ptpic||$scope.ptpic.indexOf("patient-infoimg.png")>0){$.ajax({url:"/mobiledoc/jsp/catalog/xml/setPatientPictureName.jsp?ptId="+global.TrUserId+"&picName="+global.TrUserId+".jpg",type:'POST',"async":false,cache:false,error:function(data){},success:function(data){}})}var imageName=global.TrUserId+".jpg";if(files&&files[0]){if($scope.isResizeOptionActive==="1"){$scope.resizeImage(files[0],formData,imageName)}else if($scope.isResizeOptionActive==="2"){$scope.openPatientPictureManagerModal(files[0],formData,imageName)}else{var ext=files[0].name.split('.').pop();if(ext==="jpeg"||ext==="jpg"){imageName=global.TrUserId+".jpg"}else{return ecwAlert("User Profile only allows file type of JPG.")}$scope.triggerImageUpload(formData)}}}else{BootstrapDialog.show({title:"eClinicalWorks",closable:false,message:"Please select file of image type and try again...........",buttons:[{label:'Ok',cssClass:'btn-blue btn-sm btn-xs',action:function(dialog){dialog.close()}}]})}};$('#uploadfile').change(function(event){$scope.uploadImage(event)});$scope.triggerImageUpload=function(formData,imageName){$("#userpic").fadeIn("fast").attr('src',URL.createObjectURL(formData.get("sampleFile")));$("#userpic2").fadeIn("fast").attr('src',URL.createObjectURL(formData.get("sampleFile")));$("#userpic3").fadeIn("fast").attr('src',URL.createObjectURL(formData.get("sampleFile")));$scope.isPtPic=false;$.ajax({url:"/mobiledoc/ecwimage?operation=upload&filename="+imageName+"&filepath=/mobiledoc/Patients",type:'POST',data:formData,mimeType:"multipart/form-data",contentType:false,cache:false,processData:false,error:function(data){ecwAlert("There was a problem while uploading.")},success:function(data){if(data!=null&&data.trim().toUpperCase()==='SUCCESS'){reloadpic()}else{ecwAlert("There was a problem while uploading.")}}})};$scope.openPatientPictureManagerModal=function(blobData,formData,imageName){$ocLazyLoad.load({name:'PatientPicture',files:['/mobiledoc/jsp/webemr/toppanel/patientpicture/profilepicture.js']}).then(function(){var url=makeURL("/mobiledoc/jsp/webemr/toppanel/patientpicture/previewProfilePicture.html");var modalInstance=$modal.open({templateUrl:makeURL(url),controller:'PatientPictureController as ppc',backdrop:"static",windowClass:'app-modal-window profilePicModal',resolve:{SelectedPicture:function(){return{"BlobData":blobData}}}});modalInstance.result.then(function(responseObject){setTimeout(function(){modalInstance=null;if(responseObject&&responseObject.triggerFrom!=='cancel'){formData["delete"]('sampleFile');formData.append("sampleFile",responseObject.result);$scope.triggerImageUpload(formData,imageName)}},1)},function(e){setTimeout(function(){modalInstance=null},1)})},function(e){})};$scope.resizeImage=function(file,formData,imageName){patientPictureService.resizeImage([file]).then(function(fileObj){formData["delete"]('sampleFile');formData.append("sampleFile",fileObj);$scope.triggerImageUpload(formData,imageName)},function(err){if(!err){ecwAlert("Error while compressing/resize the patient picture image. Please try again or contact eClinicalWorks support.")}else{ecwAlert(err)}})};$scope.getRegistrationRuleLogs=function(){var params={TrUserId:global.TrUserId,status:"0,3",ms:(new Date).getTime()};params=$.param(params);$ocLazyLoad.load({name:'RegRuleLogs',files:['/mobiledoc/jsp/webemr/webpm/ruleengine/js/regRulesDashboardController.js'],cache:true}).then(function(){var url="/mobiledoc/jsp/webemr/webpm/ruleengine/regRulesDashboard.jsp?"+params;$scope.loadPopupurl=url},function(e){console.log(e)})};$scope.loadFaxInbox=function(isFromPlugin,isPartial){isFromPlugin?launchPlugin("id=FAXINBOX|isPartial="+isPartial):window.location="#/mobiledoc/jsp/webemr/jellybean/fax/faxInbox.jsp/"+isPartial};if(isAthleticsLogin){$scope.bShowLISLeftPanel=false;$scope.bShowLISLeftPanelFlag=true;$scope.menuOpened=true;$('#loginForm').attr('action','/mobiledoc/jsp/ecwathletics/processLoginRequest')}$scope.toggleSideBar=function(){$scope.bShowLISLeftPanel=$scope.bShowLISLeftPanel?false:true;return $scope.bShowLISLeftPanel};$scope.TJellyBeanObj=getJellyBeanSettings();$scope.TJellyDefaultScreenMsg="";$scope.TJellyMsgChk=false;$scope.TJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-Telephone-Encounter-ListView.jsp";$scope.getTJellyDefaultScreen=function(){if($scope.TJellyBeanObj.TJellyDefaultScreen==="0"){$scope.TJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-Telephone-Encounter-ListView.jsp"}else if($scope.TJellyBeanObj.TJellyDefaultScreen==="1"){$scope.TJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/telephoneencounter/actionList.jsp"}else if($scope.TJellyBeanObj.TJellyDefaultScreen==="2"){if(!$scope.isQueDashboardEnabled){$scope.TJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/telephoneencounter/JellyBeanT-MyClaims-List view.jsp/"+getPerep(global.TrUserId)}}};$scope.getTJellyDefaultScreen();$scope.TJellyBeanClick=function(){if(!$scope.TJellyMsgChk){if($scope.TJellyBeanObj.TJellyScreenChange==='0'){if($scope.TJellyBeanObj.TJellyDefaultScreen==='1'){$scope.TJellyDefaultScreenMsg="Based on your 'My Settings' you have been redirected to the Action Page";$('#TJellyBeanMsgDialog').modal()}else if(!$scope.isQueDashboardEnabled&&$scope.TJellyBeanObj.TJellyDefaultScreen==='2'){$scope.TJellyDefaultScreenMsg="Based on your 'My Settings' you have been redirected to the Claims Page";$('#TJellyBeanMsgDialog').modal()}}}};$scope.setTJellyScreenChange=function(){if($scope.TJellyMsgChk){var response=urlPost('/mobiledoc/jsp/webemr/jellybean/settings/jellybeanSettingsService.jsp?action=setTJellyScreenChange');if(response&&response==='true'){$scope.isTJellyBeanChange=true}}$scope.closeTJellyBeanMsgDialog()};$scope.closeTJellyBeanMsgDialog=function(){$('#TJellyBeanMsgDialog').modal('hide');$('#TJellyBeanMsgDialog .det-view').remove();$('#TJellyBeanMsgDialog .modal-backdrop.fade').remove()};$scope.getRJellyDefaultScreen=function(){if($scope.TJellyBeanObj.RJellyDefaultScreen==="1"){$scope.RJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/referral/referral.jsp/Incoming"}else if(getItemKeyValue("EnableServiceAuthorization").toUpperCase()==='YES'&&$scope.TJellyBeanObj.RJellyDefaultScreen==="2"){$scope.RJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/webpm/srvcAuth278/ServiceAuthorizationDashboard.jsp"}else if(getItemKeyValue("EnableDentalPreDetermination").toUpperCase()==='YES'&&$scope.TJellyBeanObj.RJellyDefaultScreen==="3"){$scope.RJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/preDeterminationDashboard"}else{$scope.RJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/referral/referral.jsp/Outgoing"}};$scope.getRJellyDefaultScreen();$scope.loadIJellybeanDefaultTab=function($event){var tabParam=$('#jellybean-panelUl12 li:first-child a').attr('data-value');if(tabParam===null||tabParam===undefined||tabParam===''){return}else{var encParam=getPerep(tabParam);$($event.currentTarget).attr('href','#/mobiledoc/jsp/webemr/jellybean/immunotherapy/IjellyBean.jsp/'+encParam)}};$scope.loadIJellybeanTab=function($event,param){var encParam=getPerep(param);$($event.currentTarget).attr('href','#/mobiledoc/jsp/webemr/jellybean/immunotherapy/IjellyBean.jsp/'+encParam)};const sJellyDefaultScreenValue=$scope.TJellyBeanObj.SJellyDefaultScreen;const isTrackingBoardEnabled=getItemKeyValue("TrackingBoard").toLowerCase()==='yes';const isAfterCareEnabled=getItemKeyValue("AfterCareModule").toLowerCase()==='yes';$scope.SJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/jellybean/officevisit/officeVisits.jsp";if(sJellyDefaultScreenValue==="1"){$scope.SJellyDefaultScreenURL=$scope.reviewPN}else if(isAfterCareEnabled&&sJellyDefaultScreenValue==="2"){$scope.SJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/AfterCare/afterCare.jsp"}else if(isTrackingBoardEnabled&&sJellyDefaultScreenValue==="3"){$scope.SJellyDefaultScreenURL="#/mobiledoc/jsp/webemr/scheduling/trackingBoard/trackingBoard.jsp"}$scope.launchRPMModule=function(strUrl){$route.reload();$('#jellyBean-rpm-source').val('jellyBean');document.getElementById("jellybean-RPM-Link").href=strUrl};$scope.launchEPAModule=function(strUrl,id,tab){$route.reload();$('#jellyBean-epa-source').val(tab);document.getElementById(id).href=strUrl};$scope.showAccessDeniedClinicianDashboard=function(){ecwAlert('Clinician Dashboard access denied.  Please contact your administrator to grant access to "Clinician Dashboard" security setting.',"Clinician Dashboard â€“ Access")};$scope.hiWorklistSubMenuCountCallCompleted=true;$scope.getHIWorklistSubMenuCounts=function($event){let worklistCountConfController=angular.element("[ng-controller='healowInsightsWorklistCountController']").scope();if(worklistCountConfController&&!angular.element($event.currentTarget).hasClass('open')){let worklistCountConf=worklistCountConfController.getHIWorklistConfValueToGetSubMenuData(get("hIWorklistCountConf"));let worklistCountAssignToConf=worklistCountConfController.getHIWorklistCountAssignToConfValueToGetSubMenuData(get("hIWorklistCountPatientAssignToConf"));if($scope.hiWorklistSubMenuCountCallCompleted){$scope.hiWorklistSubMenuCountCallCompleted=false;$.ajax({type:"post",url:makeHealowInsightsAPIURL('tquicklaunch/worklist/count/submenu'),data:$.param({providers:get("hiMyProviders"),worklistCountConf:worklistCountConf,worklistCountAssignToConf:worklistCountAssignToConf}),cache:true,success:function(response){$scope.hiWorklistSubMenuCountCallCompleted=true;worklistCountConfController.updateHIWorklistCount(response)},error:function(){$scope.hiWorklistSubMenuCountCallCompleted=true;notification.show('error','Notification','Unable to get healow Insights worklist count data.',5e3)}})}}}}function showInitial(){angular.element($('#JellyBeanCountCntrl')).scope().showInitialImage()}function getPatientEncounters(patientId){var serverUrl='/mobiledoc/jsp/catalog/xml/getPtEncounters.jsp?PatientId='+patientId;ptEncountersXML=urlGet(serverUrl);var x2js=new X2JS;var jsonData=x2js.xml_str2json(ptEncountersXML);return jsonData.Envelope.Body['return'].resultset.data.row}function signOutUserFromAllSession(flag){if(flag===true){signOut(true)}else{signOut()}}function releaseRegistryLock(){var url=makeURL('/mobiledoc/jsp/registry/AcquireLock.jsp');var data={appkey:'REGISTRY_LOCK',releaselock:true};$.post(url,data)}function updateUserHealowRegistrationData(jData){var usernpi=jData.payload.usernpi;$.ajax({type:"post",url:"/mobiledoc/jsp/ereferralemr/requestHandler.jsp",data:{returntype:2,type:17,NPI:usernpi},success:function(msg){},error:function(msg){alert("Failed: "+msg)}})}function updateUserP2PRegistrationData(jData){var usernpi=jData.payload.usernpi;var useremruid=jData.payload.useremruid;$.ajax({type:"post",url:"/mobiledoc/jsp/ereferralemr/requestHandler.jsp",data:{returntype:2,type:15,NPI:usernpi,doctorid:useremruid},success:function(msg){refreshp2pLinks(false)},error:function(msg){alert("Failed: "+msg)}})}function enableCronJobs(jData){$.ajax({type:"post",url:"/mobiledoc/jsp/ereferralemr/requestHandler.jsp",data:{returntype:2,type:16},success:function(msg){},error:function(msg){alert("Failed: "+msg)}})}function getJTNRegistrationLearnMore(flag,regNhx){if(regNhx=="0")$('#jtnRegistrationHeader').text('P2P Registration');else $('#jtnRegistrationHeader').text('Home');$("#learnmoreFlag").val(flag);$("#jtnOrHealowFlag").val(0);$("#jtnRegistrationform").submit();$("#jtnRegistrationDiv").modal()}function getHealowRegistrationLearnMore(flag,regHealow){if(regHealow=="0")$('#jtnRegistrationHeader').text('healow Registration');else $('#jtnRegistrationHeader').text('Home');$("#learnmoreFlag").val(flag);$("#jtnOrHealowFlag").val(1);$("#jtnRegistrationform").submit();$("#jtnRegistrationDiv").modal()}function refreshp2pLinks(bDisableP2PLinks){global.bDisableP2PLinks=bDisableP2PLinks;var jellybeanPanelScope=angular.element($("#JellyBeanCountCntrl")).scope();jellybeanPanelScope.bDisableP2PLinks=bDisableP2PLinks;jellybeanPanelScope.$apply()}