var app=angular.module('evaUsersAutoComplete',[]);app.directive('usersAutoComplete',function(){return{restrict:'A',template:'<input id="usersAutocomplete" type="text" class="form-control input-sm" ng-model="userName" placeholder="{{placeHolder}}" ng-class="inputClass"/>',scope:{assignTo:'=',inputClass:'='},link:function(scope,element,attrs,ngModelCtrl){var userTypes=attrs.userTypes||"1,2";scope.placeHolder=attrs.placeHolder||"Search provider/staff";scope.userName=attrs.defaultValue||"";var url=encodeURI(makeURL("/mobiledoc/jsp/webemr/assistant/assistantController.jsp?action=getUsers&fnameFirst="+attrs.fnameFirst+"&userTypes="+userTypes));$(element).children("#usersAutocomplete").autocomplete({source:url,minLength:2,select:function(event,ui){scope.userName=ui.item.value;scope.assignTo=ui.item;scope.$apply()},change:function(event,ui){if(ui.item===null){scope.userName="";scope.assignTo="";scope.$apply()}},search:function(){$(".ui-autocomplete").addClass("show-providerlist")}})}}});app.directive('bindTemplateTo',function($timeout,$ocLazyLoad){return{restrict:'EA',scope:{bindTemplateTo:'@',templateUrl:'@',moduleName:'@',templateId:'@'},replace:true,link:function(scope,element,attrs){if(scope.templateUrl.startsWith("askeva/")){getEVAScope().bindTemplateToScope=scope}scope.finishedLoading=false;scope.getTemplateUrl=function(url){url='/mobiledoc/jsp/webemr/assistant/templates/'+url;if(url.indexOf('.')==-1){url+='.html';return url}return url};$timeout(function(){evaService.scrollToBottom()},0)},template:'<div ng-include="getTemplateUrl(templateUrl)"></div>',controller:function($scope){setCurrentTemplateScope($scope);$scope.parentScreen="Eva";$scope.historyIndex=getEVAScope()?getEVAScope().historyObj.length:0;if($scope.bindTemplateTo!=""){this.data=JSON.parse($scope.bindTemplateTo)}else{this.data={}}this.handleClick=function(patientId,patientName,additionalData){var commandName=this.data[0]?this.data[0].commandName:this.data.commandName;var patientData={uid:patientId,name:patientName,data:additionalData,params:this.data[0]?this.data[0].paramsData:this.data.paramsData,cmd:this.data[0]?this.data[0].command:this.data.command};if($scope.$parent.smartPanelEva){evaService.processCommandFromFT("",commandName,patientData,"")}else{evaService.processCommandFromEVA("",commandName,patientData,"")}};this.sortDataByDate=function(obj,entity){var date=new Date(obj.date);return date};this.trustAsHtml=function(string){return $scope.$parent.trustAsHtml(string)};this.escapeHtml=function(string){return escapeHtml(string)};this.executeCommand=function(transcript,callFrom){this.clearEvaHistory();getEVAScope().knowledgeLevel='';if(callFrom&&typeof scope!="undefined"){var askEvaContext=scope.container.data.contextData;evaService.processCommandFromEVA(transcript,'','',askEvaContext);return}evaService.processCommandFromEVA(transcript,"","","")};this.clearEvaHistory=function(){getEVAScope().clearEvaHistory($scope.historyIndex)};this.formateDate=function(collectionDate){return new Date(collectionDate)};this.queIconClickEva=function(section,index,item,patientid){this.SOURCEINFO="";var id="#"+section+index;var _that=$(id);$('.spiropopup').show().animate({},100,function(){$(this).position({of:_that,my:'left-23 top-200',at:'left top',collision:"flipfit"})});var actorId=item.source_Actor_ActorID;this.getjsonsourcedataEva=function(){$('.source_pop').hide();var serverurl='/mobiledoc/jsp/webemr/rightpanel/serviceEhxRightPane.jsp';var param={action:'getEhxRightPaneSourceInfo',PatientId:patientid,ActorId:actorId};var jsonRpData=urlPost(serverurl,param);if(jsonRpData!=undefined&&''!=jsonRpData.trim()&&'[{}]'!=jsonRpData.trim()){var json=JSON.parse(jsonRpData);this.SOURCEINFO=JSON.parse(json[0].DATAMAP)}else{this.SOURCEINFO=""}};this.getjsonsourcedataEva()};this.queIconCloseClickEva=function(){$('.spiropopup').hide()}},controllerAs:'container'}});